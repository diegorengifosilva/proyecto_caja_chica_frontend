import{a as es,r as o,j as e,N as xs,O as Is,u as Le,E as us,b as ge,L as Oa,F as We,c as qs,d as Bs,e as Gs,W as Je,C as Ce,f as Y,g as Oe,U as Pa,S as Ta,h as bs,i as js,k as La,X as ze,M as za,l as $a,m as Ia,t as qa,n as Ba,o as Us,P as Ga,p as Ks,q as Ua,T as Hs,D as Vs,R as Ka,s as Ha,v as Ws,w as Js,A as ys,x as I,_ as Fe,y as ve,z as q,B as Pe,G as te,H as G,I as pe,J as Ys,K as Va,Q as ss,V as Qs,Y as Ye,Z,$ as hs,a0 as Xs,a1 as ae,a2 as fe,a3 as Qe,a4 as Xe,a5 as _s,a6 as Zs,a7 as Wa,a8 as Ja,a9 as ps,aa as ea,ab as be,ac as Ya,ad as Qa,ae as vs,af as Xa,ag as Za,ah as sa,ai as et,aj as aa,ak as st,al as Ds,am as ta,an as ra,ao as oa,ap as at,aq as tt,ar as na,as as rt,at as ot,au as la,av as ke,aw as de,ax as me,ay as ia,az as as,aA as ts,aB as Ns,aC as ca,aD as da,aE as ma,aF as nt,aG as xa,aH as lt,aI as rs,aJ as os,aK as Fs,aL as it,aM as ct,aN as dt,aO as mt,aP as Ee,aQ as Me,aR as xt,aS as ut,aT as ht,aU as pt,aV as gt,aW as ft,aX as bt,aY as jt,aZ as Es,a_ as ws,a$ as yt,b0 as ua,b1 as ha,b2 as vt,b3 as pa,b4 as ga,b5 as Nt,b6 as fa,b7 as ba,b8 as wt,b9 as St,ba as Ct,bb as kt,bc as At,bd as _t,be as Ms,bf as Dt,bg as Ft,bh as Et,bi as Mt,bj as Rt,bk as z,bl as Ot}from"./vendor-BiYtyR9T.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const n of c.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function s(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(l){if(l.ep)return;l.ep=!0;const c=s(l);fetch(l.href,c)}})();const ja="https://proyecto-caja-chica-backend.onrender.com/api/",P=es.create({baseURL:ja,withCredentials:!1,headers:{"Content-Type":"application/json",Accept:"application/json"}});P.interceptors.request.use(a=>{const t=localStorage.getItem("access_token");return t&&(a.headers.Authorization=`Bearer ${t}`),a},a=>Promise.reject(a));P.interceptors.response.use(a=>a,async a=>{var s;const t=a.config;if(((s=a.response)==null?void 0:s.status)===401&&!t._retry){t._retry=!0;const r=localStorage.getItem("refresh_token");if(!r)return localStorage.clear(),window.location.replace("/login"),Promise.reject(a);try{const c=(await es.post(`${ja}token/refresh/`,{refresh:r})).data.access;return localStorage.setItem("access_token",c),P.defaults.headers.common.Authorization=`Bearer ${c}`,t.headers.Authorization=`Bearer ${c}`,P(t)}catch(l){return localStorage.clear(),window.location.replace("/login"),Promise.reject(l)}}return Promise.reject(a)});const ya=o.createContext(),va=({children:a})=>{const[t,s]=o.useState(null),[r,l]=o.useState(!0),c=async()=>{var b,i;try{const p=await P.get("usuarios/actual/");s(p.data),localStorage.setItem("auth_user",JSON.stringify(p.data))}catch(p){console.error("❌ No se pudo obtener usuario actual:",(b=p.response)==null?void 0:b.status,p),((i=p.response)==null?void 0:i.status)===401?f():s(null)}finally{l(!1)}};o.useEffect(()=>{const b=localStorage.getItem("access_token"),i=localStorage.getItem("auth_user");if(b){if(P.defaults.headers.common.Authorization=`Bearer ${b}`,i)try{s(JSON.parse(i))}catch{f();return}c()}else l(!1)},[]);const n=async({email:b,password:i})=>{try{const p=await P.post("login/",{email:b,password:i}),{access:g,refresh:j,user:x}=p.data;return localStorage.setItem("access_token",g),localStorage.setItem("refresh_token",j),localStorage.setItem("auth_user",JSON.stringify(x)),P.defaults.headers.common.Authorization=`Bearer ${g}`,s(x),{success:!0}}catch(p){return console.error("Error de inicio de sesión:",p),{success:!1,message:"Credenciales inválidas o servidor no disponible"}}},f=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("auth_user"),delete P.defaults.headers.common.Authorization,s(null),window.location.href="/login"},d=async()=>{try{const b=localStorage.getItem("refresh_token");if(!b)throw new Error("No refresh token");const i=await P.post("token/refresh/",{refresh:b}),{access:p}=i.data;localStorage.setItem("access_token",p),P.defaults.headers.common.Authorization=`Bearer ${p}`,await c()}catch(b){console.error("Error al refrescar token:",b),f()}};return e.jsx(ya.Provider,{value:{authUser:t,setAuthUser:s,login:n,logout:f,refreshToken:d,loading:r},children:a})},oe=()=>o.useContext(ya),Pt=({children:a})=>{const{authUser:t,loading:s}=oe();return s?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"Validando sesión..."})}):t?a??e.jsx(Is,{}):e.jsx(xs,{to:"/login",replace:!0})},Ss=""+new URL("logo-DoccodYy.png",import.meta.url).href,Na=""+new URL("Fondo-CcBCqOiu.jpg",import.meta.url).href;function Tt(){const{login:a}=oe(),t=Le(),[s,r]=o.useState({email:"",password:""}),[l,c]=o.useState(!1),[n,f]=o.useState(!1),[d,b]=o.useState(""),i=j=>{r({...s,[j.target.name]:j.target.value})},p=j=>/\S+@\S+\.\S+/.test(j),g=async j=>{var x,m;if(j.preventDefault(),b(""),!p(s.email)){b("Ingrese un correo válido.");return}f(!0);try{await a(s),t("/dashboard")}catch(y){const h=((m=(x=y.response)==null?void 0:x.data)==null?void 0:m.detail)??"Credenciales inválidas. Inténtalo nuevamente.";b(Array.isArray(h)?h[0]:h)}finally{f(!1)}};return e.jsxs("div",{className:"w-full min-h-screen bg-cover bg-center bg-fixed flex items-center justify-center px-4 sm:px-6 md:px-10",style:{backgroundImage:`url(${Na})`},children:[e.jsxs("div",{className:"relative z-10 p-6 sm:p-8 w-full max-w-3xl bg-white/60 backdrop-blur-min rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx("img",{src:Ss,alt:"Logo",className:"w-32 sm:w-40 h-auto mb-2"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 text-center",children:"Iniciar Sesión"}),d&&e.jsx("div",{className:"mt-3 text-sm text-red-700 bg-red-50 border border-red-100 px-3 py-2 rounded-md w-full text-center",children:d})]}),e.jsxs("form",{onSubmit:g,className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"text-xs font-medium text-gray-600 sr-only",children:"Correo electrónico"}),e.jsx("input",{id:"email",name:"email",type:"email",placeholder:"Correo electrónico",value:s.email,onChange:i,className:`w-full px-4 py-2 rounded-xl text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${s.email&&!p(s.email)?"border-red-500":"border-gray-300"}`,autoComplete:"email","aria-label":"Correo electrónico"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"password",className:"text-xs font-medium text-gray-600 sr-only",children:"Contraseña"}),e.jsx("input",{id:"password",name:"password",type:l?"text":"password",placeholder:"Contraseña",value:s.password,onChange:i,className:"w-full px-4 py-2 pr-10 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"current-password","aria-label":"Contraseña"}),e.jsx("button",{type:"button",onClick:()=>c(!l),"aria-label":l?"Ocultar contraseña":"Mostrar contraseña",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-600",children:l?e.jsx(us,{size:18}):e.jsx(ge,{size:18})})]}),e.jsx("button",{type:"submit",disabled:n,className:`w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-4 rounded-xl transition ${n?"cursor-not-allowed opacity-70":""}`,children:n?"Ingresando...":"Iniciar Sesión"})]}),e.jsxs("p",{className:"text-sm text-gray-700 mt-6 text-center",children:["¿No tienes una cuenta?"," ",e.jsx("span",{className:"text-teal-700 font-semibold hover:underline cursor-pointer",onClick:()=>t("/register"),children:"Regístrate aquí"})]})]}),e.jsx("div",{className:"absolute bottom-4 text-center text-sm text-white w-full z-10 px-4",children:"© 2025 Producto desarrollado por V&C Corporation SAC"})]})}const Lt=["Gerencia General","Industria","Minería","Mantenimiento","Petroquímica","Administración","Contabilidad","Tecnología de la Información","Logística - Almacén","Recursos Humanos","Comercial","SIG. HSEQ","Seguridad de Maquinaria","Comité CSSO"],zt=["Administrador","Jefe de Proyecto","Colaborador"],$t=["Perú","Argentina","Colombia","Chile"];function It(){const a=Le(),{register:t,login:s}=oe(),[r,l]=o.useState({nombre:"",apellido:"",email:"",edad:"",empresa:"",pais:"",rol:"",area:"",password:"",confirmarPassword:""}),[c,n]=o.useState(!1),[f,d]=o.useState(!1),[b,i]=o.useState(!1),[p,g]=o.useState(""),j=y=>{l({...r,[y.target.name]:y.target.value})},x=y=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(y),m=async y=>{var _,v;y.preventDefault(),g(""),n(!0);const{nombre:h,apellido:N,email:S,edad:w,empresa:k,pais:R,rol:A,area:C,password:O,confirmarPassword:K}=r;if(!h||!N||!S||!w||!R||!A||!C||!O||!K){g("Por favor completa todos los campos obligatorios."),n(!1);return}if(!x(S)){g("Correo electrónico inválido."),n(!1);return}if(Number(w)<=0||isNaN(Number(w))){g("La edad debe ser un número válido mayor que 0."),n(!1);return}if(O!==K){g("Las contraseñas no coinciden."),n(!1);return}const T={nombre:h,apellido:N,email:S,edad:Number(w),empresa:k,pais:R,rol:A,area:C,password:O};try{const D=await t(T);if(!D||D.success===!1){const L=(D==null?void 0:D.message)||(D==null?void 0:D.error)||"No se pudo registrar el usuario.";g(L),n(!1);return}const $=await s({email:S,password:O});$&&$.success,a("/login")}catch(D){console.error("Error en el registro:",D);const $=((v=(_=D==null?void 0:D.response)==null?void 0:_.data)==null?void 0:v.detail)||(D==null?void 0:D.message)||"Ocurrió un error al registrar.";g($)}finally{n(!1)}};return e.jsxs("div",{className:"w-full min-h-screen bg-cover bg-center bg-fixed flex items-center justify-center px-4 sm:px-6 md:px-10",style:{backgroundImage:`url(${Na})`},children:[e.jsxs("div",{className:"relative z-10 p-6 sm:p-8 w-full max-w-3xl bg-white/60 backdrop-blur-min rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx("img",{src:Ss,alt:"Logo",className:"w-32 sm:w-40 h-auto mb-2"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 text-center",children:"Registro de Usuario"}),p&&e.jsx("div",{className:"mt-3 text-sm text-red-700 bg-red-50 border border-red-100 px-3 py-2 rounded-md w-full text-center",children:p})]}),e.jsxs("form",{onSubmit:m,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nombre",className:"text-xs font-medium text-gray-600 sr-only",children:"Nombre"}),e.jsx("input",{id:"nombre",name:"nombre",type:"text",placeholder:"Nombre",value:r.nombre,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"given-name","aria-label":"Nombre"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"text-xs font-medium text-gray-600 sr-only",children:"Correo electrónico"}),e.jsx("input",{id:"email",name:"email",type:"email",placeholder:"Correo electrónico",value:r.email,onChange:j,className:`w-full px-4 py-2 rounded-xl text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${r.email&&!x(r.email)?"border-red-500":"border-gray-300"}`,autoComplete:"email","aria-label":"Correo electrónico"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"empresa",className:"text-xs font-medium text-gray-600 sr-only",children:"Empresa"}),e.jsx("input",{id:"empresa",name:"empresa",type:"text",placeholder:"Empresa",value:r.empresa,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Empresa"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"rol",className:"text-xs font-medium text-gray-600 sr-only",children:"Rol"}),e.jsxs("select",{id:"rol",name:"rol",value:r.rol,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Rol",children:[e.jsx("option",{value:"",children:"Selecciona un rol"}),zt.map(y=>e.jsx("option",{value:y,children:y},y))]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Contraseña"}),e.jsx("input",{id:"password",name:"password",type:f?"text":"password",placeholder:"Contraseña",value:r.password,onChange:j,className:"w-full px-4 py-2 pr-10 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"new-password","aria-label":"Contraseña"}),e.jsx("button",{type:"button",onClick:()=>d(!f),"aria-label":f?"Ocultar contraseña":"Mostrar contraseña",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-600",children:f?e.jsx(us,{size:18}):e.jsx(ge,{size:18})})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"apellido",className:"text-xs font-medium text-gray-600 sr-only",children:"Apellido"}),e.jsx("input",{id:"apellido",name:"apellido",type:"text",placeholder:"Apellido",value:r.apellido,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"family-name","aria-label":"Apellido"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edad",className:"text-xs font-medium text-gray-600 sr-only",children:"Edad"}),e.jsx("input",{id:"edad",name:"edad",type:"number",placeholder:"Edad",value:r.edad,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Edad",min:0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pais",className:"text-xs font-medium text-gray-600 sr-only",children:"País"}),e.jsxs("select",{id:"pais",name:"pais",value:r.pais,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"País",children:[e.jsx("option",{value:"",children:"Selecciona un país"}),$t.map(y=>e.jsx("option",{value:y,children:y},y))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"text-xs font-medium text-gray-600 sr-only",children:"Área"}),e.jsxs("select",{id:"area",name:"area",value:r.area,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Área",children:[e.jsx("option",{value:"",children:"Selecciona un área"}),Lt.map(y=>e.jsx("option",{value:y,children:y},y))]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"confirmarPassword",className:"sr-only",children:"Confirmar contraseña"}),e.jsx("input",{id:"confirmarPassword",name:"confirmarPassword",type:b?"text":"password",placeholder:"Confirmar contraseña",value:r.confirmarPassword,onChange:j,className:"w-full px-4 py-2 pr-10 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"new-password","aria-label":"Confirmar contraseña"}),e.jsx("button",{type:"button",onClick:()=>i(!b),"aria-label":b?"Ocultar confirmación":"Mostrar confirmación",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-600",children:b?e.jsx(us,{size:18}):e.jsx(ge,{size:18})})]})]}),e.jsx("div",{className:"md:col-span-2 mt-4",children:e.jsx("button",{type:"submit",disabled:c,className:`w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-4 rounded-xl transition ${c?"cursor-not-allowed opacity-70":""}`,children:c?"Registrando...":"Registrarse"})})]}),e.jsxs("p",{className:"text-sm text-gray-700 mt-6 text-center",children:["¿Ya tienes una cuenta?"," ",e.jsx("span",{className:"text-teal-700 font-semibold hover:underline cursor-pointer",onClick:()=>a("/login"),children:"Inicia sesión aquí"})]})]}),e.jsx("div",{className:"absolute bottom-4 text-center text-sm text-white w-full z-10 px-4",children:"© 2025 Producto desarrollado por V&C Corporation SAC"})]})}const qt=[{section:"Dashboard Principal",items:[{to:"/dashboard",label:"Pantalla Principal",icon:Oa,roles:["Administrador","Jefe de Proyecto","Colaborador"]}]},{section:"Gestión de Gastos y Liquidaciones",items:[{to:"/dashboard/liquidaciones/solicitud",label:"Solicitud de Gasto",icon:We,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/atencion-solicitudes",label:"Atención de Solicitudes",icon:qs,roles:["Administrador","Jefe de Proyecto"]},{to:"/dashboard/liquidaciones/presentar",label:"Liquidaciones",icon:Bs,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/gastos/aprobacion-liquidacion",label:"Aprobación de Liquidación",icon:Gs,roles:["Administrador"]}]},{section:"Registros y Movimientos",items:[{to:"/dashboard/movimientos/arqueo",label:"Caja Chica",icon:Je,roles:["Administrador"]},{to:"/dashboard/registros/actividades",label:"Registro de Actividades",icon:Ce,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/registros/guias-salida",label:"Guías de Salida",icon:Y,roles:["Administrador"]}]},{section:"Reportes y Análisis",items:[{to:"/dashboard/reportes",label:"Estadísticas y Reportes",icon:Oe,roles:["Administrador","Jefe de Proyecto","Colaborador"]}]},{section:"Mi Cuenta",items:[{to:"/dashboard/editar-perfil",label:"Editar Perfil",icon:Pa,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/cambiar-clave",label:"Cambiar Contraseña",icon:Ta,roles:["Administrador","Jefe de Proyecto","Colaborador"]}]}],Bt=({title:a})=>e.jsx("div",{className:"text-xs uppercase text-gray-400 font-semibold px-4 pt-6 pb-1",children:a}),Gt=({to:a,label:t,icon:s,collapsed:r,onClick:l})=>{const n=$a().pathname===a;return e.jsxs(Ia,{to:a,onClick:l,className:`relative group flex items-center gap-3 px-4 py-2 rounded-md text-sm transition-all duration-200 
        ${n?"bg-indigo-100 text-indigo-700 font-semibold":"text-gray-700 hover:bg-indigo-50 hover:shadow-sm"}`,children:[e.jsx(s,{className:"w-5 h-5"}),!r&&e.jsx("span",{className:"transition-opacity duration-300",children:t}),r&&e.jsx("span",{className:"absolute left-full ml-2 px-2 py-1 rounded-md bg-gray-800 text-white text-xs opacity-0 group-hover:opacity-100 whitespace-nowrap pointer-events-none",children:t})]})};function Ut(){const a=Le(),{authUser:t}=oe(),[s,r]=o.useState(!0),[l,c]=o.useState(!1),[n,f]=o.useState(!1),d=()=>{localStorage.clear(),a("/login")},b=o.useMemo(()=>t!=null&&t.rol?qt.map(i=>({...i,items:i.items.filter(p=>p.roles.includes(t.rol))})).filter(i=>i.items.length>0):[],[t]);return e.jsxs("div",{className:"flex min-h-screen bg-[#f3f4f6] relative",children:[l&&e.jsx("div",{onClick:()=>c(!1),className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm animate-fadeIn z-30 md:hidden"}),e.jsx("aside",{className:`fixed md:static z-40 top-0 left-0 h-screen bg-white shadow-md border-r flex flex-col transform transition-transform duration-300 ease-in-out
        ${l?"translate-x-0 w-64":"-translate-x-full w-64"}
        ${s?"md:w-64":"md:w-20"} md:translate-x-0`,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:e.jsxs("div",{className:"flex-1 flex flex-col overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center py-6 border-b relative group",children:[e.jsx("img",{src:Ss,alt:"V&C Corporation",className:`transition-all duration-300 ${s?"h-16":"h-12"} group-hover:scale-105`}),s&&e.jsx("span",{className:"mt-2 text-sm font-bold text-gray-700 text-center transition-opacity duration-500 ease-in-out",children:t!=null&&t.nombre?`${t.nombre} ${t.apellido||""}`:"Usuario"}),e.jsx("button",{onClick:()=>r(!s),className:`hidden md:flex absolute right-2 top-2 text-gray-500 hover:text-gray-700 transition-opacity duration-200 
              ${n?"opacity-100":"opacity-0"}`,children:s?e.jsx(bs,{className:"w-5 h-5"}):e.jsx(js,{className:"w-5 h-5"})})]}),e.jsx("nav",{className:"flex-1 px-2 py-4 space-y-1",children:b.map(i=>e.jsxs("div",{children:[s&&e.jsx(Bt,{title:i.section}),i.items.map(p=>e.jsx(Gt,{...p,collapsed:!s,onClick:()=>c(!1)},p.to))]},i.section))}),e.jsx("div",{className:"px-4 py-4 border-t",children:e.jsxs("button",{onClick:()=>{c(!1),d()},className:"flex items-center gap-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-md px-2 py-2 text-sm w-full transition-colors",children:[e.jsx(La,{className:"w-4 h-4"}),s&&e.jsx("span",{className:"transition-opacity duration-300",children:"Cerrar sesión"})]})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-screen",children:[e.jsxs("div",{className:"md:hidden flex items-center justify-between bg-white shadow px-4 py-2",children:[e.jsx("button",{onClick:()=>c(!l),children:l?e.jsx(ze,{className:"w-6 h-6 text-gray-700"}):e.jsx(za,{className:"w-6 h-6 text-gray-700"})}),e.jsx("span",{className:"font-bold text-gray-800",children:"Dashboard"})]}),e.jsx("main",{className:"flex-1 flex flex-col p-4 md:p-6 bg-white overflow-y-auto",children:e.jsx(Is,{})})]})]})}const je=o.forwardRef(({className:a="",...t},s)=>e.jsx("div",{ref:s,className:`rounded-2xl border bg-white shadow-sm ${a}`,...t}));je.displayName="Card";const Kt=o.forwardRef(({className:a="",...t},s)=>e.jsx("div",{ref:s,className:`p-4 border-b ${a}`,...t}));Kt.displayName="CardHeader";const Ht=o.forwardRef(({className:a="",...t},s)=>e.jsx("h3",{ref:s,className:`text-lg font-semibold leading-none tracking-tight ${a}`,...t}));Ht.displayName="CardTitle";const Vt=o.forwardRef(({className:a="",...t},s)=>e.jsx("p",{ref:s,className:`text-sm text-gray-500 ${a}`,...t}));Vt.displayName="CardDescription";const Ne=o.forwardRef(({className:a="",...t},s)=>e.jsx("div",{ref:s,className:`p-4 ${a}`,...t}));Ne.displayName="CardContent";function E(...a){return qa(Ba(a))}const ie=o.forwardRef(({className:a,variant:t="default",...s},r)=>e.jsx("div",{ref:r,className:E("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors",t==="default"&&"bg-gray-200 text-gray-900",t==="success"&&"bg-green-200 text-green-900",t==="warning"&&"bg-yellow-200 text-yellow-900",t==="error"&&"bg-red-200 text-red-900",a),...s}));ie.displayName="Badge";const Q=Ka,Wt=Ga,wa=o.forwardRef(({className:a,...t},s)=>e.jsx(Us,{ref:s,className:E("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t}));wa.displayName=Us.displayName;const V=o.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Wt,{children:[e.jsx(wa,{}),e.jsxs(Ks,{ref:r,className:E("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s,children:[t,e.jsxs(Ua,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));V.displayName=Ks.displayName;const W=({className:a,...t})=>e.jsx("div",{className:E("flex flex-col space-y-1.5 text-center sm:text-left",a),...t});W.displayName="DialogHeader";const xe=({className:a,...t})=>e.jsx("div",{className:E("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t});xe.displayName="DialogFooter";const J=o.forwardRef(({className:a,...t},s)=>e.jsx(Hs,{ref:s,className:E("text-lg font-semibold leading-none tracking-tight",a),...t}));J.displayName=Hs.displayName;const Sa=o.forwardRef(({className:a,...t},s)=>e.jsx(Vs,{ref:s,className:E("text-sm text-muted-foreground",a),...t}));Sa.displayName=Vs.displayName;const gs=Ws("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),M=o.forwardRef(({className:a,variant:t,size:s,asChild:r=!1,...l},c)=>{const n=r?Ha:"button";return e.jsx(n,{className:E(gs({variant:t,size:s,className:a})),ref:c,...l})});M.displayName="Button";const se=o.forwardRef(({className:a,type:t,...s},r)=>e.jsx("input",{type:t,className:E("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:r,...s}));se.displayName="Input";const Jt=Ws("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),le=o.forwardRef(({className:a,...t},s)=>e.jsx(Js,{ref:s,className:E(Jt(),a),...t}));le.displayName=Js.displayName;function Yt({label:a,name:t,value:s,onChange:r,placeholder:l,className:c=""}){return e.jsxs("div",{className:"flex flex-col mb-2",children:[a&&e.jsxs("label",{className:"mb-1 font-medium text-gray-700",children:[a,":"]}),e.jsx("textarea",{name:t,value:s,onChange:r,placeholder:l,className:`border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${c}`})]})}const Qt=({open:a,onClose:t,onSuccess:s})=>{const[r,l]=o.useState(""),[c,n]=o.useState(""),[f,d]=o.useState(!1),b=async()=>{if(!r||isNaN(r)){alert("Por favor ingresa un monto inicial válido.");return}try{d(!0),await P.post("/boleta/caja_diaria/",{monto_base:Number(r),observaciones:c||""}),s&&s(),t()}catch(i){console.error("Error al abrir caja diaria:",i),alert("Hubo un error al abrir la caja. Revisa la consola.")}finally{d(!1)}};return e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"max-w-md",children:[e.jsx(W,{children:e.jsx(J,{children:"Apertura de Caja"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(le,{children:"Monto Inicial"}),e.jsx(se,{type:"number",placeholder:"Ingrese el monto inicial",value:r,onChange:i=>l(i.target.value)})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Observaciones (opcional)"}),e.jsx(Yt,{placeholder:"Escribe aquí las observaciones...",value:c,onChange:i=>n(i.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(M,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(M,{onClick:b,disabled:f,children:f?"Abriendo...":"Abrir Caja"})]})]})]})})};function Xt({open:a,onClose:t,caja:s,onCajaCerrada:r}){const[l,c]=o.useState(!1),[n,f]=o.useState({totalIngresos:0,totalEgresos:0,saldoFinal:0});o.useEffect(()=>{s&&d()},[s]);const d=()=>{var g,j;const i=((g=s.movimientos)==null?void 0:g.filter(x=>x.tipo==="Ingreso").reduce((x,m)=>x+m.monto,0))||0,p=((j=s.movimientos)==null?void 0:j.filter(x=>x.tipo==="Egreso").reduce((x,m)=>x+m.monto,0))||0;f({totalIngresos:i,totalEgresos:p,saldoFinal:s.monto_inicial+i-p})},b=async()=>{if(window.confirm("¿Confirmas cerrar la caja? Esta acción no se puede revertir."))try{c(!0),await P.put(`/boleta/caja_diaria/${s.id}/cerrar/`),r==null||r(),t==null||t()}catch(i){console.error("Error cerrando caja:",i),alert("No se pudo cerrar la caja. Intenta nuevamente.")}finally{c(!1)}};return s?e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"max-w-md p-6 rounded-xl shadow-xl",children:[e.jsx(W,{children:e.jsx(J,{children:"Cierre de Caja"})}),e.jsxs("div",{className:"space-y-3 mt-2 text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de Apertura:"})," ",s.fecha_apertura]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto Inicial:"})," S/ ",s.monto_inicial.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Ingresos:"})," S/ ",n.totalIngresos.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Egresos:"})," S/ ",n.totalEgresos.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Saldo Final:"})," S/ ",n.saldoFinal.toFixed(2)]})]}),e.jsxs(xe,{className:"flex justify-between mt-4",children:[e.jsx(M,{variant:"outline",onClick:t,disabled:l,className:"hover:bg-gray-100 transition",children:"Cancelar"}),e.jsx(M,{onClick:b,disabled:l,className:`${l?"opacity-50 cursor-not-allowed":"hover:bg-red-700 transition"}`,children:l?"Cerrando...":"Cerrar Caja"})]})]})}):null}function Zt({open:a,onClose:t,cajaId:s,onMovimientoGuardado:r}){const[l,c]=o.useState("Ingreso"),[n,f]=o.useState(""),[d,b]=o.useState(""),[i,p]=o.useState(null),[g,j]=o.useState(!1),x=async()=>{if(!n.trim()){alert("Ingresa un concepto válido");return}if(!d||isNaN(Number(d))||Number(d)<=0){alert("Ingresa un monto válido mayor a 0");return}try{j(!0);const m=new FormData;m.append("tipo",l),m.append("concepto",n),m.append("monto",Number(d)),i&&m.append("documento",i),await P.post(`/boleta/caja_diaria/${s}/movimientos/`,m,{headers:{"Content-Type":"multipart/form-data"}}),alert("Movimiento registrado correctamente"),r==null||r(),t==null||t(),c("Ingreso"),f(""),b(""),p(null)}catch(m){console.error("Error registrando movimiento:",m),alert("No se pudo registrar el movimiento. Intenta nuevamente.")}finally{j(!1)}};return e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"max-w-md p-6 rounded-xl shadow-xl",children:[e.jsx(W,{children:e.jsx(J,{children:"Registrar Movimiento"})}),e.jsxs("div",{className:"space-y-3 mt-2 text-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Tipo"}),e.jsxs("select",{value:l,onChange:m=>c(m.target.value),className:"w-full border rounded p-2",disabled:g,children:[e.jsx("option",{value:"Ingreso",children:"Ingreso"}),e.jsx("option",{value:"Egreso",children:"Egreso"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Concepto / Descripción"}),e.jsx("input",{type:"text",value:n,onChange:m=>f(m.target.value),className:"w-full border rounded p-2",disabled:g})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Monto"}),e.jsx("input",{type:"number",min:"0",value:d,onChange:m=>b(m.target.value),className:"w-full border rounded p-2",disabled:g})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Documento (opcional)"}),e.jsx("input",{type:"file",onChange:m=>p(m.target.files[0]),className:"w-full",disabled:g})]})]}),e.jsxs(xe,{className:"flex justify-between mt-4",children:[e.jsx(M,{variant:"outline",onClick:t,disabled:g,className:"hover:bg-gray-100 transition",children:"Cancelar"}),e.jsx(M,{onClick:x,disabled:g,className:`${g?"opacity-50 cursor-not-allowed":"hover:bg-green-700 transition"}`,children:g?"Guardando...":"Guardar Movimiento"})]})]})})}function Cs({open:a,onClose:t,documento:s}){const r=o.useRef(),l=()=>{if(!s.url)return;const c=window.open("","_blank");c.document.write(`
      <html>
        <head>
          <title>${s.nombre||"Documento"}</title>
        </head>
        <body style="margin:0; display:flex; justify-content:center; align-items:center; height:100vh;">
          <img src="${s.url}" style="max-width:100%; max-height:100vh;" />
        </body>
      </html>
    `),c.document.close(),c.focus(),c.print(),c.close()};return s?e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"max-w-3xl w-full shadow-xl rounded-xl p-6",children:[e.jsx(W,{children:e.jsx(J,{children:s.nombre||"Documento"})}),e.jsx("div",{className:"flex justify-center my-4",children:s.url?e.jsx("img",{ref:r,src:s.url,alt:s.nombre||"Documento",className:"max-h-[70vh] w-auto object-contain rounded border"}):e.jsx("p",{className:"text-center text-gray-500",children:"No hay vista disponible"})}),e.jsxs(xe,{className:"flex justify-between",children:[e.jsx(M,{variant:"outline",onClick:t,className:"hover:bg-gray-100 transition",children:"Cerrar"}),s.url&&e.jsx(M,{onClick:l,className:"hover:bg-gray-100 transition",children:"Imprimir"})]})]})}):null}const er={Ingreso:"#16a34a",Egreso:"#ef4444"};function Ca({open:a,onClose:t,movimiento:s}){const[r,l]=o.useState(!1);return s?e.jsxs(e.Fragment,{children:[e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"max-w-lg shadow-xl rounded-xl p-6",children:[e.jsx(W,{children:e.jsxs(J,{children:["Movimiento #",s.numero_operacion||s.id]})}),e.jsxs("div",{className:"space-y-3 mt-2 text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",s.fecha]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tipo:"})," ",e.jsx(ie,{style:{backgroundColor:er[s.tipo],color:"#fff",marginLeft:4},children:s.tipo})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Concepto:"})," ",s.concepto]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto:"})," S/ ",s.monto.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Usuario:"})," ",s.usuario]}),s.documento?e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{children:e.jsx("strong",{children:"Documento:"})}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>l(!0),className:"hover:bg-gray-100 transition",children:"Ver Documento"})]}):e.jsx("p",{className:"text-gray-400",children:"Sin documento"}),s.observaciones&&e.jsxs("p",{children:[e.jsx("strong",{children:"Observaciones:"})," ",s.observaciones]})]}),e.jsx(xe,{className:"mt-4",children:e.jsx(M,{variant:"outline",onClick:t,className:"hover:bg-gray-100 transition",children:"Cerrar"})})]})}),r&&s.documento&&e.jsx(Cs,{open:r,onClose:()=>l(!1),documento:s.documento})]}):null}const sr={Ingreso:"#16a34a",Egreso:"#ef4444"};function ar({movimientos:a}){const[t,s]=o.useState(""),[r,l]=o.useState("Todos"),[c,n]=o.useState(null),[f,d]=o.useState(!1),[b,i]=o.useState(null),[p,g]=o.useState(!1),j=o.useMemo(()=>a.filter(N=>{var k,R;const S=((k=N.numero_operacion)==null?void 0:k.toString().includes(t))||((R=N.concepto)==null?void 0:R.toLowerCase().includes(t.toLowerCase())),w=r==="Todos"||N.tipo===r;return S&&w}),[a,t,r]),x=o.useMemo(()=>j.filter(N=>N.tipo==="Ingreso").reduce((N,S)=>N+(S.monto||0),0),[j]),m=o.useMemo(()=>j.filter(N=>N.tipo==="Egreso").reduce((N,S)=>N+(S.monto||0),0),[j]),y=x-m,h=N=>{N.documento&&(i(N),g(!0),n(N.id))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Buscar por N° operación o concepto...",value:t,onChange:N=>s(N.target.value),className:"max-w-xs border rounded-lg px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"}),e.jsx("div",{className:"flex gap-2",children:["Todos","Ingreso","Egreso"].map(N=>e.jsx(M,{variant:r===N?"secondary":"outline",onClick:()=>l(N),children:N},N))})]}),e.jsx("div",{className:"overflow-x-auto shadow-md rounded-xl border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-center",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"N° Operación"}),e.jsx("th",{className:"px-4 py-3",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3",children:"Concepto"}),e.jsx("th",{className:"px-4 py-3",children:"Monto"}),e.jsx("th",{className:"px-4 py-3",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3",children:"Documento"}),e.jsx("th",{className:"px-4 py-3",children:"Acciones"})]})}),e.jsx("tbody",{children:e.jsx(ys,{children:j.length>0?j.map(N=>e.jsxs(I.tr,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:`border-t border-gray-100 hover:shadow-lg hover:translate-y-[-2px] hover:bg-gray-50 transition-transform duration-200 ${c===N.id?"bg-blue-50":""}`,onClick:()=>n(N.id),children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:N.numero_operacion||"-"}),e.jsx("td",{className:"px-4 py-3",children:N.fecha||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(ie,{style:{backgroundColor:sr[N.tipo]||"#6b7280",color:"#fff"},children:N.tipo||"-"})}),e.jsx("td",{className:"px-4 py-3",children:N.concepto||"-"}),e.jsxs("td",{className:"px-4 py-3",children:["S/ ",(N.monto||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:N.usuario||"-"}),e.jsx("td",{className:"px-4 py-3",children:N.documento?e.jsx(M,{size:"sm",className:"bg-gradient-to-r from-blue-300 to-blue-400 hover:from-blue-400 hover:to-blue-500 text-white p-2 rounded-lg shadow-md transition",onClick:S=>{S.stopPropagation(),h(N)},children:N.documento.nombre}):"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{className:"bg-gradient-to-r from-indigo-400 to-indigo-500 hover:from-indigo-500 hover:to-indigo-600 text-white p-2 rounded-lg shadow-md transition",onClick:()=>{i(mov),setDetalleMovimientoOpen(!0)},children:e.jsx(ge,{size:16})})})]},N.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-6 text-gray-500",children:"No hay movimientos registrados."})})})})]})}),e.jsxs("div",{className:"flex justify-end gap-6 mt-2 font-medium text-sm",children:[e.jsxs("p",{children:["Total Ingresos: S/ ",x.toFixed(2)]}),e.jsxs("p",{children:["Total Egresos: S/ ",m.toFixed(2)]}),e.jsxs("p",{children:["Saldo Actual: S/ ",y.toFixed(2)]})]}),f&&b&&e.jsx(Ca,{open:f,onClose:()=>d(!1),movimiento:b}),p&&(b==null?void 0:b.documento)&&e.jsx(Cs,{open:p,onClose:()=>g(!1),documento:b.documento})]})}const tr={id:1,fecha_apertura:"2025-08-14",monto_inicial:1e3,cerrada:!1},rr=[{id:1,fecha:"2025-08-14",tipo:"Ingreso",concepto:"Rollover",monto:200,usuario:"Admin",documento:null},{id:2,fecha:"2025-08-14",tipo:"Egreso",concepto:"Compra de papelería",monto:50,usuario:"Admin",documento:{nombre:"Ticket Papelería",url:"/fake-doc1.jpg"}},{id:3,fecha:"2025-08-14",tipo:"Egreso",concepto:"Yape a proveedor",monto:150,usuario:"Admin",documento:{nombre:"Yape",url:"/fake-doc2.jpg"}}],Rs={Ingreso:"#16a34a",Egreso:"#ef4444"},ls={saldo:"#3b82f6",ingresos:"#16a34a",egresos:"#ef4444"},or="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center";function Os(){const[a,t]=o.useState(null),[s,r]=o.useState([]),[l,c]=o.useState(!0),[n,f]=o.useState(!1),[d,b]=o.useState(!1),[i,p]=o.useState(!1),[g,j]=o.useState(null),[x,m]=o.useState(null),[y,h]=o.useState(!1),[N,S]=o.useState(!1),w=async()=>{c(!0),setTimeout(()=>{r(rr),t(tr),c(!1)},800)};o.useEffect(()=>{w()},[]);const k=o.useMemo(()=>{const C=s.filter(T=>T.tipo==="Ingreso").reduce((T,_)=>T+_.monto,0),O=s.filter(T=>T.tipo==="Egreso").reduce((T,_)=>T+_.monto,0),K=((a==null?void 0:a.monto_inicial)||0)+C-O;return{ingresos:C,egresos:O,saldo:K}},[s,a]),R=o.useMemo(()=>[{name:"Ingresos",value:k.ingresos,fill:Rs.Ingreso},{name:"Egresos",value:k.egresos,fill:Rs.Egreso}],[k]),A=C=>{const O=Math.max(k.saldo,k.ingresos,k.egresos,1);return`${C/O*100}%`};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2 mb-4",children:[e.jsx(Je,{className:"w-6 h-6"})," Caja Chica"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 text-center",children:[{label:"Saldo Actual",value:k.saldo,color:ls.saldo},{label:"Total Ingresos",value:k.ingresos,color:ls.ingresos},{label:"Total Egresos",value:k.egresos,color:ls.egresos}].map((C,O)=>e.jsxs("div",{className:`${or} flex flex-col items-center justify-center text-white p-5 rounded-xl`,style:{background:`linear-gradient(135deg, ${C.color}cc, ${C.color}99)`},children:[e.jsx("p",{className:"text-sm font-medium",children:C.label}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:e.jsx(Fe,{end:C.value,duration:1.2,separator:",",decimals:2})}),C.label!=="Saldo Actual"&&e.jsx("div",{className:"w-full h-2 bg-white bg-opacity-30 rounded-full mt-2",children:e.jsx("div",{className:"h-2 rounded-full",style:{width:A(C.value),backgroundColor:C.color}})})]},O))}),e.jsx(je,{className:"shadow-lg rounded-xl mt-5",children:e.jsxs(Ne,{children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(ve,{className:"w-5 h-5 text-gray-800"}),e.jsx("h3",{className:"text-center font-medium",children:"Distribución Ingresos/Egresos"})]}),e.jsx(q,{width:"100%",height:300,children:e.jsxs(ve,{children:[e.jsx(Pe,{data:R,dataKey:"value",nameKey:"name",innerRadius:55,outerRadius:85,label:({name:C,percent:O})=>`${C} ${(O*100).toFixed(1)}%`,children:R.map((C,O)=>e.jsx(te,{fill:C.fill},O))}),e.jsx(G,{formatter:C=>`${C.toFixed(2)} S/`}),e.jsx(pe,{verticalAlign:"bottom",height:36})]})})]})}),e.jsx("div",{className:"flex flex-wrap gap-4 mt-4",children:a!=null&&a.cerrada?e.jsx(ie,{variant:"outline",className:"text-gray-600",children:"Caja cerrada"}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",onClick:()=>f(!0),children:[e.jsx(Ys,{size:16})," Abrir Caja"]}),e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",onClick:()=>p(!0),disabled:!a,children:[e.jsx(Va,{size:16})," Nuevo Movimiento"]}),e.jsxs("button",{className:"bg-gradient-to-r from-orange-500 to-red-500 hover:from-red-500 hover:to-red-600 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",onClick:()=>b(!0),disabled:!a,children:[e.jsx(ss,{size:16})," Cerrar Caja"]})]})}),e.jsx(ar,{movimientos:s,onMovimientoSeleccionado:C=>{j(C),h(!0)},onMovimientoGuardado:w}),n&&e.jsx(Qt,{open:n,onClose:()=>f(!1)}),d&&e.jsx(Xt,{open:d,onClose:()=>b(!1),caja:a,totales:k}),i&&e.jsx(Zt,{open:i,onClose:()=>p(!1),cajaId:a==null?void 0:a.id,onMovimientoGuardado:w}),y&&g&&e.jsx(Ca,{open:y,onClose:()=>h(!1),movimiento:g}),N&&x&&e.jsx(Cs,{open:N,onClose:()=>S(!1),documento:x})]})}const $e=({label:a,value:t,gradient:s,icon:r,tooltip:l,decimals:c=0})=>e.jsxs("div",{className:`\r
        rounded-xl p-4 shadow-md text-white relative\r
        flex flex-col items-center justify-center text-center\r
        transition-all duration-300 transform\r
        hover:scale-105 hover:shadow-lg cursor-pointer\r
        min-h-[90px] sm:min-h-[100px]\r
      `,style:{background:s},children:[l&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Qs,{content:l,children:e.jsx(Ye,{size:14,className:"text-white opacity-80 cursor-pointer"})})}),r&&e.jsx(r,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-xs sm:text-sm opacity-90",children:a}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold",children:e.jsx(Fe,{end:Number(t)||0,duration:1.2,separator:",",decimals:c})})]}),Re={"Pendiente de Envío":"bg-orange-200 text-orange-800","Pendiente para Atención":"bg-yellow-200 text-yellow-800","Atendido, Pendiente de Liquidación":"bg-sky-200 text-sky-800","Liquidación enviada para Aprobación":"bg-green-200 text-green-800","Liquidación Aprobada":"bg-gray-600 text-white",Rechazado:"bg-red-200 text-red-800"},we={"Pendiente de Envío":"#f97316","Pendiente para Atención":"#ffef00","Atendido, Pendiente de Liquidación":"#0ea5e9","Liquidación enviada para Aprobación":"#22c55e","Liquidación Aprobada":"#0f172a",Rechazado:"#ef4444"},ks={Viáticos:"bg-blue-600 text-white",Movilidad:"bg-emerald-500 text-white",Compras:"bg-purple-500 text-white","Otros gastos":"bg-yellow-100 text-yellow-800"},ce={Viáticos:"#0218db",Movilidad:"#059669",Compras:"#7c3aed","Otros gastos":"#eab308"},ye=(a,t,s)=>[`${a}`,`${t}`],Ze=(a,t,s)=>[`${a}`,`${t}`],re=({title:a,icon:t,subtitle:s,children:r,className:l="",legend:c=[],tooltipFormatter:n})=>e.jsx(je,{className:`rounded-xl shadow-md hover:shadow-lg transition-shadow ${l}`,children:e.jsxs(Ne,{className:"flex flex-col p-4 w-full h-full",children:[(a||s||t)&&e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx("span",{className:"text-gray-700",children:t}),a&&e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:a})]}),s&&e.jsx("div",{className:"text-sm text-gray-500",children:s})]}),c&&c.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:c.map((f,d)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:f.color}}),e.jsxs("span",{className:"text-sm text-gray-700",children:[f.name," (",f.value,")"]})]},d))}),e.jsx("div",{className:"flex-1 w-full min-h-[220px]",children:hs.Children.map(r,f=>{var d;return n&&((d=f==null?void 0:f.type)==null?void 0:d.displayName)==="Tooltip"?hs.cloneElement(f,{formatter:n}):f})})]})});re.propTypes={title:Z.string,icon:Z.element,subtitle:Z.string,children:Z.node.isRequired,className:Z.string,legend:Z.arrayOf(Z.shape({name:Z.string.isRequired,value:Z.oneOfType([Z.string,Z.number]).isRequired,color:Z.string.isRequired})),tooltipFormatter:Z.func};const nr=()=>{const{authUser:a}=oe(),[t,s]=o.useState({}),[r,l]=o.useState(!0),c=()=>{const i=new Date().getHours();return i<12?"Buenos días":i<19?"Buenas tardes":"Buenas noches"};o.useEffect(()=>{(async()=>{try{const p=await P.get("/dashboard/home-stats/");s(p.data.stats||{})}catch(p){console.error("Error cargando estadísticas del Dashboard Home:",p)}finally{l(!1)}})()},[]);const n=[{label:"Solicitudes Pendientes",value:t.solicitudesPendientes??0,icon:Ce,gradient:"linear-gradient(135deg,#f97316cc,#fb923c99)",tooltip:"Solicitudes que aún no han sido atendidas o aprobadas."},{label:"Liquidaciones Pendientes",value:t.liquidacionesPendientes??0,icon:Y,gradient:"linear-gradient(135deg,#0ea5e9cc,#38bdf899)",tooltip:"Solicitudes en estado pendiente de liquidación o aprobación."},{label:"Liquidaciones Aprobadas (Mes)",value:t.liquidacionesAprobadasMes??0,icon:Xs,gradient:"linear-gradient(135deg,#16a34acc,#4ade8099)",tooltip:"Cantidad de liquidaciones aprobadas este mes."},{label:"Monto Total Solicitado (Mes)",value:parseFloat(t.montoTotalSolicitadoMes??0),icon:ae,gradient:"linear-gradient(135deg,#7c3aedcc,#a78bfa99)",tooltip:"Monto total solicitado en caja chica este mes."}],f=i=>alert(`Ir a: ${i}`),d=[{name:"Viáticos",value:120},{name:"Movilidad",value:80},{name:"Compras",value:60},{name:"Otros gastos",value:40}],b=[{name:"Pendiente de Envío",value:15},{name:"Pendiente para Atención",value:10},{name:"Atendido, Pendiente de Liquidación",value:8},{name:"Liquidación enviada para Aprobación",value:12},{name:"Liquidación Aprobada",value:20},{name:"Rechazado",value:5}];return e.jsx("div",{className:"min-h-screen w-full flex flex-col bg-gray-50 font-sans",children:e.jsxs("div",{className:"flex-1 flex flex-col px-4 sm:px-6 md:px-8 py-4 lg:py-6",children:[e.jsxs("header",{className:"mb-4 sm:mb-6",children:[e.jsxs(I.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-lg sm:text-3xl md:text-4xl font-bold text-gray-900 flex items-center gap-2",children:[c(),", ",a!=null&&a.nombre?`${a.nombre} ${a.apellido||""}`:"Usuario"," 👋"]}),e.jsxs(I.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.8},className:"mt-1 text-xs sm:text-sm md:text-base text-gray-600 italic",children:["Bienvenido a ",e.jsx("span",{className:"font-semibold text-blue-600",children:"V&C"}),". Aquí tienes un resumen de hoy."]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-x-3 gap-y-4 sm:gap-x-4 sm:gap-y-5 md:gap-x-6 md:gap-y-6 mb-6 w-full justify-items-stretch",children:n.map(i=>e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx($e,{label:i.label,value:r?0:i.value,icon:i.icon,gradient:i.gradient,tooltip:i.tooltip,decimals:Number.isInteger(i.value)?0:2,className:"text-xs sm:text-sm md:text-base w-full p-3 sm:p-4"})},i.label))}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6 mb-6 w-full",children:[e.jsx(re,{title:"Distribución por tipo de solicitud",icon:e.jsx(fe,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-700"}),tooltipFormatter:ye,className:"flex-1 h-56 sm:h-64 md:h-80 xl:h-[28rem] w-full",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6 h-full items-stretch",children:[e.jsx("div",{className:"flex-1 min-h-[160px] sm:min-h-[200px] md:min-h-[280px]",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(ve,{children:[e.jsx(Pe,{data:d,dataKey:"value",nameKey:"name",innerRadius:"50%",outerRadius:"80%",paddingAngle:3,label:!0,children:d.map((i,p)=>e.jsx(te,{fill:ce[i.name]||"#334155"},p))}),e.jsx(G,{})]})})}),e.jsx("div",{className:"w-full lg:w-40 flex-shrink-0 mt-3 lg:mt-0",children:d.map(i=>e.jsxs("div",{className:"flex items-center gap-2 text-[10px] sm:text-xs md:text-sm text-gray-700 mb-2",children:[e.jsx("span",{style:{width:14,height:14,background:ce[i.name]||"#334155",display:"inline-block",borderRadius:3}}),e.jsx("span",{className:"font-medium",children:i.name}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",i.value,")"]})]},i.name))})]})}),e.jsx(re,{title:"Estado de solicitudes",icon:e.jsx(_s,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-700"}),tooltipFormatter:Ze,className:"flex-1 h-56 sm:h-64 md:h-80 xl:h-[28rem] w-full",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6 h-full items-stretch",children:[e.jsx("div",{className:"flex-1 min-h-[160px] sm:min-h-[200px] md:min-h-[280px]",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Qe,{cx:"50%",cy:"50%",innerRadius:"10%",outerRadius:"95%",barSize:14,data:b,children:[e.jsx(Xe,{minAngle:15,background:!0,clockWise:!0,dataKey:"value",cornerRadius:6,children:b.map((i,p)=>e.jsx(te,{fill:we[i.name]||"#334155"},p))}),e.jsx(G,{})]})})}),e.jsx("div",{className:"w-full lg:w-40 flex-shrink-0 mt-3 lg:mt-0",children:b.map(i=>e.jsxs("div",{className:"flex items-center gap-2 text-[10px] sm:text-xs md:text-sm text-gray-700 mb-2",children:[e.jsx("span",{style:{width:14,height:14,background:we[i.name]||"#334155",display:"inline-block",borderRadius:3}}),e.jsx("span",{className:"font-medium",children:i.name}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",i.value,")"]})]},i.name))})]})})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 mt-6 w-full",children:[{label:"Nueva Solicitud",icon:We,url:"/nueva-solicitud",bg:"blue",desc:"Registra una nueva solicitud de gasto."},{label:"Ver Liquidaciones",icon:fe,url:"/liquidaciones",bg:"emerald",desc:"Consulta el estado de tus liquidaciones."},{label:"Reportes",icon:_s,url:"/reportes",bg:"indigo",desc:"Estadísticas y reportes ejecutivos."}].map(i=>e.jsxs("button",{onClick:()=>f(i.url),className:`
                group relative flex flex-col items-center justify-center rounded-2xl p-3 sm:p-4 md:p-5 bg-white
                border border-gray-200 shadow-md hover:shadow-xl transition-all duration-300
                transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-${i.bg}-400 focus:ring-offset-2
              `,children:[e.jsx("div",{className:`
                flex items-center justify-center rounded-full p-2 sm:p-3 md:p-4 mb-2 sm:mb-3
                bg-${i.bg}-50 group-hover:bg-gradient-to-br group-hover:from-${i.bg}-400 group-hover:to-${i.bg}-200
                transition-all duration-500 transform group-hover:scale-105 sm:group-hover:scale-110
              `,children:e.jsx(i.icon,{size:20+(window.innerWidth>768?8:0),className:`text-${i.bg}-600 group-hover:text-white transition-colors duration-500`})}),e.jsx("h4",{className:"text-gray-800 font-semibold text-sm sm:text-base md:text-lg text-center group-hover:text-gray-900 transition-colors duration-300",children:i.label}),e.jsx("p",{className:"text-gray-500 text-[10px] sm:text-sm md:text-base text-center mt-1 group-hover:text-gray-700 transition-colors duration-300",children:i.desc}),e.jsx("span",{className:`
                absolute inset-0 rounded-2xl bg-gradient-to-r from-transparent via-white/5 to-transparent
                opacity-10 group-hover:opacity-100 pointer-events-none transition-opacity duration-500
              `})]},i.label))})]})})};function lr({data:a}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Código"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Referencia"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Empresa"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Área"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Monto Programado"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Monto Ejecutado"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Saldo"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Estado"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-4 text-gray-500",children:"No se encontraron programaciones registradas."})}):a.map((t,s)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 font-mono text-gray-600",children:t.codigo}),e.jsx("td",{className:"px-4 py-2",children:t.referencia}),e.jsx("td",{className:"px-4 py-2",children:t.empresa}),e.jsx("td",{className:"px-4 py-2",children:t.area}),e.jsx("td",{className:"px-4 py-2 font-semibold",children:t.monto_programado.toLocaleString("es-PE",{style:"currency",currency:"PEN"})}),e.jsx("td",{className:"px-4 py-2 text-green-700",children:t.monto_ejecutado?t.monto_ejecutado.toLocaleString("es-PE",{style:"currency",currency:"PEN"}):"-"}),e.jsx("td",{className:"px-4 py-2 font-semibold",children:t.saldo?t.saldo.toLocaleString("es-PE",{style:"currency",currency:"PEN"}):"-"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${t.estado==="Pendiente"?"bg-yellow-100 text-yellow-800":t.estado==="Ejecutado"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.estado})})]},s))})]})})}function ir({className:a,classNames:t,showOutsideDays:s=!0,captionLayout:r="label",buttonVariant:l="ghost",formatters:c,components:n,...f}){const d=Zs();return e.jsx(Wa,{showOutsideDays:s,className:E("bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,a),captionLayout:r,formatters:{formatMonthDropdown:b=>b.toLocaleString("default",{month:"short"}),...c},classNames:{root:E("w-fit",d.root),months:E("relative flex flex-col gap-4 md:flex-row",d.months),month:E("flex w-full flex-col gap-4",d.month),nav:E("absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1",d.nav),button_previous:E(gs({variant:l}),"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50",d.button_previous),button_next:E(gs({variant:l}),"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50",d.button_next),month_caption:E("flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]",d.month_caption),dropdowns:E("flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium",d.dropdowns),dropdown_root:E("has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border",d.dropdown_root),dropdown:E("bg-popover absolute inset-0 opacity-0",d.dropdown),caption_label:E("select-none font-medium",r==="label"?"text-sm":"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5",d.caption_label),table:"w-full border-collapse",weekdays:E("flex",d.weekdays),weekday:E("text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal",d.weekday),week:E("mt-2 flex w-full",d.week),week_number_header:E("w-[--cell-size] select-none",d.week_number_header),week_number:E("text-muted-foreground select-none text-[0.8rem]",d.week_number),day:E("group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md",d.day),range_start:E("bg-accent rounded-l-md",d.range_start),range_middle:E("rounded-none",d.range_middle),range_end:E("bg-accent rounded-r-md",d.range_end),today:E("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",d.today),outside:E("text-muted-foreground aria-selected:text-muted-foreground",d.outside),disabled:E("text-muted-foreground opacity-50",d.disabled),hidden:E("invisible",d.hidden),...t},components:{Root:({className:b,rootRef:i,...p})=>e.jsx("div",{"data-slot":"calendar",ref:i,className:E(b),...p}),Chevron:({className:b,orientation:i,...p})=>i==="left"?e.jsx(bs,{className:E("size-4",b),...p}):i==="right"?e.jsx(js,{className:E("size-4",b),...p}):e.jsx(Ja,{className:E("size-4",b),...p}),DayButton:cr,WeekNumber:({children:b,...i})=>e.jsx("td",{...i,children:e.jsx("div",{className:"flex size-[--cell-size] items-center justify-center text-center",children:b})}),...n},...f})}function cr({className:a,day:t,modifiers:s,...r}){const l=Zs(),c=o.useRef(null);return o.useEffect(()=>{var n;s.focused&&((n=c.current)==null||n.focus())},[s.focused]),e.jsx(M,{ref:c,variant:"ghost",size:"icon","data-day":t.date.toLocaleDateString(),"data-selected-single":s.selected&&!s.range_start&&!s.range_end&&!s.range_middle,"data-range-start":s.range_start,"data-range-end":s.range_end,"data-range-middle":s.range_middle,className:E("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70",l.day,a),...r})}const dr=({open:a,onClose:t,onSave:s,initialData:r})=>{const[l,c]=o.useState({codigo:"",referencia:"",descripcion:"",monto_programado:"",fecha:new Date,proyecto:"",area:"",empresa:""});o.useEffect(()=>{r&&c({codigo:r.codigo||"",referencia:r.referencia||"",descripcion:r.descripcion||"",monto_programado:r.monto_programado||"",fecha:r.fecha?new Date(r.fecha):new Date,proyecto:r.proyecto||"",area:r.area||"",empresa:r.empresa||""})},[r]);const n=(d,b)=>{c(i=>({...i,[d]:b}))},f=()=>{s(l),t()};return e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"max-w-lg",children:[e.jsx(W,{children:e.jsx(J,{children:r?"Editar Programación":"Nueva Programación"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"referencia",children:"Referencia"}),e.jsx(se,{id:"referencia",value:l.referencia,onChange:d=>n("referencia",d.target.value),placeholder:"Ej: PRG-2025-001"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(se,{id:"descripcion",value:l.descripcion,onChange:d=>n("descripcion",d.target.value),placeholder:"Ej: Compra de equipos de oficina"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"monto_programado",children:"Monto Programado (S/)"}),e.jsx(se,{id:"monto_programado",type:"number",value:l.monto_programado,onChange:d=>n("monto_programado",d.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"proyecto",children:"Proyecto"}),e.jsx(se,{id:"proyecto",value:l.proyecto,onChange:d=>n("proyecto",d.target.value),placeholder:"Ej: Proyecto Alfa"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"area",children:"Área"}),e.jsx(se,{id:"area",value:l.area,onChange:d=>n("area",d.target.value),placeholder:"Ej: Contabilidad"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"empresa",children:"Empresa"}),e.jsx(se,{id:"empresa",value:l.empresa,onChange:d=>n("empresa",d.target.value),placeholder:"Ej: V&C Corporation"})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Fecha de Ejecución"}),e.jsx(ir,{mode:"single",selected:l.fecha,onSelect:d=>n("fecha",d)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Fecha seleccionada: ",ps(l.fecha,"dd/MM/yyyy")]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(M,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(M,{onClick:f,children:r?"Actualizar":"Guardar"})]})]})})},mr="http://localhost:8000/api",ka=es.create({baseURL:mr,headers:{"Content-Type":"application/json"}});ka.interceptors.request.use(a=>{const t=localStorage.getItem("access");return t&&(a.headers.Authorization=`Bearer ${t}`),a},a=>Promise.reject(a));const xr=async()=>(await ka.get("/programaciones/")).data;function ur(){const[a,t]=o.useState([]),[s,r]=o.useState(!1),[l,c]=o.useState(!1),[n,f]=o.useState({year:"2025",proyecto:"",area:"",empresa:"",encargado:""}),d=async()=>{c(!0);try{const p=await xr(n);t(p)}catch(p){console.error("Error al cargar programaciones:",p)}finally{c(!1)}};o.useEffect(()=>{d()},[n]);const b=()=>{d()},i=()=>{console.log("Generando reporte...")};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Programación de Gastos"}),e.jsxs(M,{onClick:()=>r(!0),className:"flex items-center gap-2",children:[e.jsx(ea,{size:18})," Nueva Programación"]})]}),e.jsxs(je,{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{size:20,className:"text-gray-500"}),e.jsxs("select",{value:n.year,onChange:p=>f({...n,year:p.target.value}),className:"flex-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"2025",children:"2025"}),e.jsx("option",{value:"2024",children:"2024"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ya,{size:20,className:"text-gray-500"}),e.jsx("select",{value:n.proyecto,onChange:p=>f({...n,proyecto:p.target.value}),className:"flex-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:e.jsx("option",{value:"",children:"Todos"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qa,{size:20,className:"text-gray-500"}),e.jsx("select",{value:n.area,onChange:p=>f({...n,area:p.target.value}),className:"flex-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:e.jsx("option",{value:"",children:"Todos"})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsxs(M,{onClick:b,className:"flex items-center gap-2",children:[e.jsx(vs,{size:18})," Procesar"]}),e.jsxs(M,{onClick:i,className:"flex items-center gap-2",children:[e.jsx(Y,{size:18})," Reporte"]})]})]}),e.jsx(je,{children:e.jsx(Ne,{className:"p-6",children:l?e.jsx("p",{children:"Cargando datos..."}):e.jsx(lr,{data:a})})}),s&&e.jsx(dr,{open:s,onClose:()=>r(!1),onSave:()=>{r(!1),d()}})]})}class hr{constructor(){this.listeners={}}on(t,s){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(s),()=>this.off(t,s)}off(t,s){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(r=>r!==s))}emit(t,s){this.listeners[t]&&this.listeners[t].forEach(r=>r(s))}}const U=new hr;function ne({label:a,name:t,value:s,onChange:r,readOnly:l=!1,type:c="text"}){return e.jsxs("div",{className:"flex flex-col mb-3 w-full",children:[a&&e.jsxs("label",{className:"mb-1 text-xs sm:text-sm font-medium text-gray-700",children:[a,":"]}),e.jsx("input",{type:c,name:t,value:s,onChange:r,readOnly:l,className:"border border-gray-300 rounded-lg px-3 py-2 sm:px-4 sm:py-2 bg-gray-50 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm w-full"})]})}function Ps({label:a,name:t,value:s,onChange:r}){return e.jsxs("div",{className:"flex flex-col mb-3 w-full",children:[a&&e.jsxs("label",{className:"mb-1 text-xs sm:text-sm font-medium text-gray-700",children:[a,":"]}),e.jsx("textarea",{name:t,value:s,onChange:r,className:"border border-gray-300 rounded-lg px-3 py-2 sm:px-4 sm:py-2 bg-gray-50 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm resize-none w-full"})]})}function is({label:a,name:t,value:s,onChange:r,options:l=[]}){return e.jsxs("div",{className:"flex flex-col mb-3 w-full",children:[a&&e.jsxs("label",{className:"mb-1 text-xs sm:text-sm font-medium text-gray-700",children:[a,":"]}),e.jsxs("select",{name:t,value:s||"",onChange:r,className:"border border-gray-300 rounded-lg px-3 py-2 sm:px-4 sm:py-2 bg-gray-50 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm w-full",children:[e.jsx("option",{value:"",children:"Selecciona..."}),l.map(c=>e.jsxs("option",{value:c.id,children:[c.nombre," ",c.apellido]},c.id))]})]})}function Aa({open:a,onClose:t,onCreated:s}){const{authUser:r}=oe(),l=Le(),c=[{id:2,nombre:"Cristina",apellido:"Martinez"},{id:3,nombre:"Marisol",apellido:"Rojas"},{id:4,nombre:"Cristina",apellido:"Silva"}],[n,f]=o.useState({numero_solicitud:"",fecha:"",hora:"",codigo:"",solicitante:"",destinatario_id:null,tipo_solicitud:"",area:"",tipo_moneda:"",tipo_cambio:"3.55",monto_soles:"",monto_dolares:"",fecha_transferencia:"",fecha_liquidacion:"",banco:"",numero_cuenta:"",concepto_gasto:"",observacion:""});o.useEffect(()=>{if(!a)return;const i=new Date;f(p=>({...p,numero_solicitud:Math.floor(1e3+Math.random()*9e3),codigo:Xa().split("-")[0].toUpperCase(),fecha:ps(i,"yyyy-MM-dd"),hora:ps(i,"HH:mm:ss"),solicitante:(r==null?void 0:r.id)||"",area:(r==null?void 0:r.area)||"",banco:(r==null?void 0:r.banco)||"",numero_cuenta:(r==null?void 0:r.numero_cuenta)||"",tipo_cambio:"3.55"}))},[a,r]),o.useEffect(()=>{n.monto_soles&&n.tipo_cambio&&f(i=>({...i,monto_dolares:(parseFloat(i.monto_soles)/parseFloat(i.tipo_cambio)).toFixed(2)}))},[n.monto_soles,n.tipo_cambio]);const d=i=>{const{name:p,value:g}=i.target;f(j=>({...j,[p]:p==="destinatario_id"?g?parseInt(g):null:g}))},b=async()=>{var p;const i={numero_solicitud:n.numero_solicitud,fecha:n.fecha,hora:n.hora,codigo:n.codigo,solicitante:n.solicitante,destinatario_id:n.destinatario_id,tipo_solicitud:n.tipo_solicitud,area:n.area,estado:"Pendiente para Atención",moneda:"PEN",tipo_cambio:n.tipo_cambio,total_soles:n.monto_soles||0,total_dolares:n.monto_dolares||0,fecha_transferencia:n.fecha_transferencia,fecha_liquidacion:n.fecha_liquidacion,banco:n.banco,numero_cuenta:n.numero_cuenta,concepto_gasto:n.concepto_gasto,observacion:n.observacion};try{await P.post("boleta/solicitudes/guardar-solicitud/",i),Ds.fire("¡Guardado!","La solicitud fue registrada correctamente","success"),U.emit("solicitudCreada",i),s==null||s(),t==null||t(),l("/dashboard/liquidaciones/solicitud")}catch(g){const j=((p=g==null?void 0:g.response)==null?void 0:p.data)||{};Ds.fire("Error",`No se pudo guardar la solicitud. Detalles: ${JSON.stringify(j)}`,"error")}};return e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"max-w-3xl sm:max-w-4xl lg:max-w-5xl w-[95%] max-h-[90vh] overflow-y-auto bg-white rounded-2xl shadow-lg animate-fadeIn p-4 sm:p-6",children:[e.jsx(W,{children:e.jsxs(J,{className:"flex items-center gap-2 text-xl sm:text-2xl font-bold text-gray-800",children:[e.jsx(Za,{className:"w-6 h-6 sm:w-7 sm:h-7"})," Nueva Solicitud de Gasto"]})}),e.jsx("p",{className:"text-gray-700 mb-4 text-sm sm:text-base",children:"Completa los campos para registrar una nueva solicitud de gasto."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm sm:text-base font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(sa,{className:"w-5 h-5 sm:w-6 sm:h-6"})," Datos Generales"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsx(ne,{label:"N° Solicitud",value:n.numero_solicitud,readOnly:!0}),e.jsx(ne,{label:"Fecha",value:n.fecha,readOnly:!0}),e.jsx(ne,{label:"Hora",value:n.hora,readOnly:!0}),e.jsx(ne,{label:"Código",value:n.codigo,readOnly:!0}),e.jsx(ne,{label:"Solicitante",value:r?`${r.nombre} ${r.apellido}`:"",readOnly:!0}),e.jsx(is,{label:"Destinatario",name:"destinatario_id",value:n.destinatario_id,onChange:d,options:c}),e.jsx(is,{label:"Tipo de Solicitud",name:"tipo_solicitud",value:n.tipo_solicitud,onChange:d,options:[{id:"Viáticos",nombre:"Viáticos"},{id:"Movilidad",nombre:"Movilidad"},{id:"Compras",nombre:"Compras"},{id:"Otros Gastos",nombre:"Otros Gastos"}]}),e.jsx(ne,{label:"Área",value:n.area,readOnly:!0})]}),e.jsxs("h3",{className:"text-sm sm:text-base font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(et,{className:"w-5 h-5 sm:w-6 sm:h-6"})," Monto y Fechas"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsx(ne,{label:"Monto en Soles",name:"monto_soles",value:n.monto_soles,onChange:d}),e.jsx(ne,{label:"Fecha Transferencia",type:"date",name:"fecha_transferencia",value:n.fecha_transferencia,onChange:d}),e.jsx(ne,{label:"Fecha Liquidación",type:"date",name:"fecha_liquidacion",value:n.fecha_liquidacion,onChange:d})]}),e.jsxs("h3",{className:"text-sm sm:text-base font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(aa,{className:"w-5 h-5 sm:w-6 sm:h-6"})," Datos Bancarios"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx(is,{label:"Banco",name:"banco",value:n.banco,onChange:d,options:[{id:"BCP",nombre:"BCP"},{id:"Interbank",nombre:"Interbank"}]}),e.jsx(ne,{label:n.banco==="Interbank"?"CCI":"Número de Cuenta",name:"numero_cuenta",value:n.numero_cuenta,onChange:d})]}),e.jsxs("h3",{className:"text-sm sm:text-base font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(st,{className:"w-5 h-5 sm:w-6 sm:h-6"})," Detalles del Gasto"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx(Ps,{label:"Concepto de Gasto",name:"concepto_gasto",value:n.concepto_gasto,onChange:d}),e.jsx(Ps,{label:"Observación",name:"observacion",value:n.observacion,onChange:d})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 mt-4",children:[e.jsx(M,{onClick:t,className:"bg-gray-300 hover:bg-gray-400 text-white px-4 py-2 rounded-xl w-full sm:w-auto",children:"Cancelar"}),e.jsx(M,{onClick:b,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-xl w-full sm:w-auto",children:"Guardar"})]})]})})}const pr=at,_a=o.forwardRef(({className:a,...t},s)=>e.jsx(ta,{ref:s,className:E("inline-flex items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500",a),...t}));_a.displayName=ta.displayName;const Ve=o.forwardRef(({className:a,...t},s)=>e.jsx(ra,{ref:s,className:E("inline-flex min-w-[100px] items-center justify-center rounded-sm px-3 py-1.5 text-sm font-medium transition-all","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","data-[state=active]:bg-white data-[state=active]:text-black",a),...t}));Ve.displayName=ra.displayName;const fs=o.forwardRef(({className:a,...t},s)=>e.jsx(oa,{ref:s,className:E("mt-2 rounded-md border p-4 bg-white shadow-sm",a),...t}));fs.displayName=oa.displayName;function Da({open:a,onClose:t,solicitudId:s,solicitudInit:r}){const{authUser:l}=oe(),[c,n]=o.useState(r||null),[f,d]=o.useState([]),[b,i]=o.useState(!c),[p,g]=o.useState(!1),[j,x]=o.useState(!1),[m,y]=o.useState(null),h=()=>(l==null?void 0:l.rol)==="Colaborador"&&(c==null?void 0:c.estado)==="Pendiente de Envío";return o.useEffect(()=>{if(!s)return;(async()=>{try{i(!0);const{data:S}=await P.get(`/boleta/mis_solicitudes/${s}/`);n(S);try{const{data:w}=await P.get(`/boleta/mis_solicitudes/${s}/historial/`);d(w)}catch{d([])}}catch(S){console.error("❌ Error al cargar solicitud:",S),alert("No se pudo cargar la solicitud.")}finally{i(!1)}})()},[s]),e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"max-w-3xl sm:max-w-4xl w-[95%] max-h-[90vh] overflow-y-auto bg-white rounded-2xl shadow-lg animate-fadeIn p-4 sm:p-6",children:[e.jsxs(W,{children:[e.jsxs(J,{className:"flex items-center gap-2 text-xl sm:text-2xl font-bold text-gray-800",children:[e.jsx(Y,{className:"w-6 h-6 sm:w-7 sm:h-7"}),"Detalles de la Solicitud ",(c==null?void 0:c.numero_solicitud)||"-"]}),e.jsxs("p",{className:"text-sm sm:text-base text-gray-500 mt-1",children:["Usuario: ",l!=null&&l.nombre?`${l.nombre} ${l.apellido||""}`:"Usuario"]})]}),b?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Cargando solicitud..."}):c?e.jsxs(e.Fragment,{children:[e.jsxs(pr,{defaultValue:"basicos",className:"w-full mt-3",children:[e.jsxs(_a,{className:"grid grid-cols-3 gap-2 mb-4",children:[e.jsxs(Ve,{value:"basicos",className:"flex items-center gap-2 justify-center text-sm sm:text-base",children:[e.jsx(sa,{className:"w-5 h-5 sm:w-6 sm:h-6"})," Básicos"]}),e.jsxs(Ve,{value:"historial",className:"flex items-center gap-2 justify-center text-sm sm:text-base",children:[e.jsx(tt,{className:"w-5 h-5 sm:w-6 sm:h-6"})," Historial"]}),e.jsxs(Ve,{value:"adjuntos",className:"flex items-center gap-2 justify-center text-sm sm:text-base",children:[e.jsx(na,{className:"w-5 h-5 sm:w-6 sm:h-6"})," Adjuntos"]})]}),e.jsx(fs,{value:"basicos",className:"space-y-4 sm:space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsx(ee,{label:"N° Solicitud",value:c.numero_solicitud}),e.jsx(ee,{label:"Fecha",value:c.fecha}),e.jsx(ee,{label:"Destinatario",value:c.destinatario_nombre||"-"}),e.jsx(ee,{label:"Tipo de Solicitud",value:c.tipo_solicitud}),e.jsx(ee,{label:"Concepto",value:c.concepto_gasto}),e.jsx(ee,{label:"Estado",value:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs sm:text-sm font-semibold ${we[c.estado]||"bg-gray-200 text-gray-700"}`,children:c.estado})}),e.jsx(ee,{label:"Observación",value:c.observacion}),e.jsx(ee,{label:"Total (S/.)",value:c.total_soles}),e.jsx(ee,{label:"Total (USD)",value:c.total_dolares}),e.jsx(ee,{label:"Fecha Transferencia",value:c.fecha_transferencia}),e.jsx(ee,{label:"Fecha Liquidación",value:c.fecha_liquidacion}),e.jsx(ee,{label:"Banco",value:c.banco}),e.jsx(ee,{label:"N° Cuenta",value:c.numero_cuenta})]})}),e.jsx(fs,{value:"adjuntos",className:"text-gray-500",children:e.jsx("p",{children:"Aquí se mostrarán los documentos adjuntos."})})]}),e.jsx("div",{className:"flex justify-end mt-4 sm:mt-6 gap-3 flex-wrap",children:h()&&e.jsxs(M,{onClick:()=>{y("enviar"),x(!0)},disabled:p,className:"flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 sm:px-5 py-2 sm:py-3 rounded-xl shadow-md font-semibold transition-all duration-200 w-full sm:w-auto",children:[e.jsx(Y,{className:"w-4 h-4 sm:w-5 sm:h-5"})," ",p&&m==="enviar"?"Procesando...":"Enviar Solicitud"]})}),j&&m==="enviar"&&e.jsx(Q,{open:j,onOpenChange:()=>x(!1),children:e.jsxs(V,{className:"max-w-md sm:max-w-lg w-[90%] p-5 bg-white rounded-xl shadow-2xl animate-fadeInDown",children:[e.jsx(W,{children:e.jsx(J,{className:"text-lg sm:text-xl font-bold text-gray-800",children:"Confirmar envío"})}),e.jsxs("p",{className:"mt-2 text-gray-600",children:["¿Deseas enviar esta solicitud? Una vez enviada, pasará a ",e.jsx("b",{children:"Pendiente para Atención"}),"."]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-3 flex-wrap",children:[e.jsx(M,{variant:"outline",onClick:()=>x(!1),className:"w-full sm:w-auto",children:"Cancelar"}),e.jsx(M,{onClick:async()=>{var N,S,w;g(!0);try{const{data:k}=await P.patch(`/boleta/mis_solicitudes/${c.id}/estado/`,{estado:"Pendiente para Atención"});n(R=>{var A;return{...R,estado:((A=k.solicitud)==null?void 0:A.estado)||"Pendiente para Atención"}}),U.emit("solicitudEnviada",{numero_solicitud:((N=k.solicitud)==null?void 0:N.numero_solicitud)||c.numero_solicitud}),x(!1),y(null)}catch(k){console.error("❌ Error al enviar solicitud:",k),alert(((w=(S=k.response)==null?void 0:S.data)==null?void 0:w.error)||"No se pudo enviar la solicitud.")}finally{g(!1)}},disabled:p,className:"bg-blue-600 hover:bg-blue-700 text-white w-full sm:w-auto",children:"Sí, enviar"})]})]})})]}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No se encontró la solicitud."})]})})}function ee({label:a,value:t}){return e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-3 sm:p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:a}),e.jsx("p",{className:"text-sm sm:text-base lg:text-lg font-semibold text-gray-800 break-words",children:t||"-"})]})}const Ie=({headers:a,data:t,renderRow:s,emptyMessage:r="No hay datos disponibles.",activeRow:l=null,rowsPerPage:c=10,onDeleteRow:n})=>{const[f,d]=o.useState(1),b=Math.ceil(t.length/c)||1,i=(f-1)*c,p=i+c,g=t.slice(i,p),j=x=>{x>=1&&x<=b&&d(x)};return e.jsx(je,{className:"rounded-2xl shadow-md border border-gray-200",children:e.jsxs(Ne,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-2xl relative",children:e.jsxs("table",{className:"min-w-full table-auto text-sm text-center border-collapse relative",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 font-medium",children:e.jsx("tr",{children:a.map((x,m)=>e.jsx("th",{className:"px-3 sm:px-4 py-3 border border-gray-200",children:x},m))})}),e.jsx("tbody",{className:"bg-gray-50",children:e.jsx(ys,{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:a.length,className:"px-4 py-10 text-center text-gray-500 italic border border-gray-200",children:r})}):g.map((x,m)=>e.jsxs(I.tr,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.25},className:`group relative transition-all duration-200 ${l===(x.id||m)?"bg-blue-50 border-l-4 border-blue-500 shadow-sm":"hover:bg-gray-50 hover:shadow-md hover:ring-1 hover:ring-gray-200 cursor-pointer"}`,children:[Array.isArray(s(x))?s(x).map((y,h)=>e.jsx("td",{className:"px-3 sm:px-4 py-3 border border-gray-200",children:y},h)):s(x),n&&e.jsx("div",{className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition",children:e.jsx(M,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700 hover:bg-red-100 rounded-full",onClick:y=>{y.stopPropagation(),n(x)},children:e.jsx(rt,{className:"h-4 w-4"})})})]},x.id||m))})})]})}),b>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-3 border-t border-gray-200 bg-gray-50",children:[e.jsxs(M,{variant:"outline",size:"sm",disabled:f===1,onClick:()=>j(f-1),className:"flex items-center gap-1",children:[e.jsx(bs,{className:"w-4 h-4"})," Anterior"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:b},(x,m)=>m+1).map(x=>e.jsx(M,{variant:x===f?"default":"outline",size:"sm",onClick:()=>j(x),className:`w-8 h-8 rounded-full ${x===f?"bg-blue-500 text-white hover:bg-blue-600":"hover:bg-gray-100"}`,children:x},x))}),e.jsxs(M,{variant:"outline",size:"sm",disabled:f===b,onClick:()=>j(f+1),className:"flex items-center gap-1",children:["Siguiente ",e.jsx(js,{className:"w-4 h-4"})]})]})]})})},Fa=({open:a,onClose:t})=>{const[s,r]=o.useState([]),[l,c]=o.useState("Todos"),[n,f]=o.useState(""),[d,b]=o.useState(""),[i,p]=o.useState(!1),[g,j]=o.useState(null);o.useEffect(()=>{a&&x();const h=k=>{r(R=>[k,...R])},N=k=>{r(R=>R.map(A=>A.numero_solicitud===k.numero_solicitud?{...A,estado:"Enviada"}:A))},S=U.on("solicitudCreada",h),w=U.on("solicitudEnviada",N);return()=>{S(),w()}},[a]);const x=async()=>{try{const h=await P.get("/boleta/mis_solicitudes/");r(h.data)}catch(h){console.error("Error cargando solicitudes:",h)}},m=s.filter(h=>{const N=l==="Todos"||h.estado===l,S=(!n||new Date(h.fecha)>=new Date(n))&&(!d||new Date(h.fecha)<=new Date(d));return N&&S}),y=(h,N,S=null)=>{S&&(j(S),p(!0))};return e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"max-w-6xl w-full max-h-[90vh] bg-white rounded-xl p-4 sm:p-6",children:[e.jsx(W,{children:e.jsxs(J,{className:"flex items-center gap-2 text-xl sm:text-2xl font-bold text-gray-800",children:[e.jsx(Y,{className:"w-6 h-6"}),"Mis Solicitudes"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2 sm:gap-3 mb-3 sm:mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("label",{className:"font-medium",children:"Estado:"}),e.jsxs("select",{value:l,onChange:h=>c(h.target.value),className:"border rounded-md px-1 sm:px-2 py-1 text-xs sm:text-sm",children:[e.jsx("option",{value:"Todos",children:"Todos"}),Object.keys(Re).map((h,N)=>e.jsx("option",{value:h,children:h},N))]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("label",{className:"font-medium",children:"Desde:"}),e.jsx("input",{type:"date",value:n,onChange:h=>f(h.target.value),className:"border rounded-md px-1 sm:px-2 py-1 text-xs sm:text-sm"}),e.jsx("label",{className:"font-medium",children:"Hasta:"}),e.jsx("input",{type:"date",value:d,onChange:h=>b(h.target.value),className:"border rounded-md px-1 sm:px-2 py-1 text-xs sm:text-sm"})]})]}),e.jsx("div",{className:"overflow-x-auto max-h-[70vh]",children:e.jsx(Ie,{headers:["N°","Tipo","S/.","$","Fecha","Concepto","Estado","Acción"],data:m,emptyMessage:"No hay solicitudes en este estado o rango de fechas.",renderRow:h=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 font-semibold text-center text-xs sm:text-sm",children:h.numero_solicitud}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] sm:text-xs ${ks[h.tipo_solicitud]||"bg-gray-200 text-gray-700"}`,children:h.tipo_solicitud})}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:h.total_soles?`S/. ${h.total_soles}`:"-"}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:h.total_dolares?`$ ${h.total_dolares}`:"-"}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:h.fecha}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm truncate max-w-[120px] sm:max-w-[200px]",children:h.concepto_gasto??"-"}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] sm:text-xs ${Re[h.estado]||"bg-gray-200 text-gray-700"}`,children:h.estado})}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>y(h.id,"Ver Detalle",h),className:"flex items-center gap-1 px-2 py-1",children:[e.jsx(ge,{className:"w-4 h-4"})," Detalle"]})})]})})}),i&&g&&e.jsx(Da,{open:i,onClose:()=>p(!1),solicitudId:g==null?void 0:g.id,solicitudInit:g})]})})},Ge=Object.values(we),Ue=Object.values(ce);function gr(){return Array.from({length:12},(a,t)=>new Date(0,t).toLocaleString("es-PE",{month:"long"}))}function fr(){const{authUser:a}=oe(),t=gr(),s={total:0,montoTotalSoles:0,montoTotalDolares:0,promedioSoles:0,promedioDolares:0,chartAreaMes:t.map(m=>({mes:m.charAt(0).toUpperCase()+m.slice(1),solicitudes:0})),chartRadialEstado:Object.keys(we).map(m=>({name:m,value:0})),chartTreemapTipo:Object.keys(ce).map(m=>({name:m,value:0}))},[r,l]=o.useState(s),[c,n]=o.useState(!0),[f,d]=o.useState(null),[b,i]=o.useState(null),[p,g]=o.useState(!1),j=async()=>{if(!a)return;const m=localStorage.getItem("access_token");if(!m){d("Sesión expirada, inicia sesión nuevamente.");return}try{n(!0),d(null);const h=(await P.get("/boleta/solicitudes/dashboard/",{headers:{Authorization:`Bearer ${m}`}})).data||{},N=h.chartAreaMes&&h.chartAreaMes.length===12?h.chartAreaMes.map((k,R)=>({mes:t[R].charAt(0).toUpperCase()+t[R].slice(1),solicitudes:k.solicitudes??k.value??0})):s.chartAreaMes,S=h.chartRadialEstado&&h.chartRadialEstado.length?Object.keys(we).map(k=>{const R=(h.chartRadialEstado||[]).find(A=>String(A.name).toLowerCase().includes(String(k).toLowerCase()));return{name:k,value:R?Number(R.value||0):0}}):s.chartRadialEstado;let w=[];h.chartTreemapTipo&&h.chartTreemapTipo.length?(w=h.chartTreemapTipo.map(k=>({name:k.name,value:Number(k.value||0)})),Object.keys(ce).forEach(k=>{w.find(R=>String(R.name).toLowerCase()===k.toLowerCase())||w.push({name:k,value:0})})):w=s.chartTreemapTipo,l(k=>({...k,...h,chartAreaMes:N,chartRadialEstado:S,chartTreemapTipo:w}))}catch(y){console.error("Error al cargar datos",y),d(y.message||"No se pudieron cargar los datos."),l(s)}finally{n(!1)}};if(o.useEffect(()=>{j();const m=U.on("solicitudCreada",()=>j()),y=U.on("solicitudEnviada",()=>j());return()=>{m(),y()}},[a]),!a||c)return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"h-8 w-1/3 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6",children:Array.from({length:5}).map((m,y)=>e.jsx("div",{className:"bg-gray-200 h-24 rounded animate-pulse"},y))})]});if(f)return e.jsx("p",{className:"text-red-500 font-semibold p-6",children:f});const x=[{label:"Total Solicitudes",value:r.total??0,icon:Ce,gradient:"linear-gradient(135deg,#3b82f6cc,#60a5fa99)",tooltip:"Número total de solicitudes registradas."},{label:"Monto Total S/.",value:parseFloat(r.montoTotalSoles??0),icon:ae,gradient:"linear-gradient(135deg,#0ea5e9cc,#60a5fa99)",tooltip:"Suma total en soles."},{label:"Monto Total $",value:parseFloat(r.montoTotalDolares??0),icon:ae,gradient:"linear-gradient(135deg,#7c3aedcc,#a78bfa99)",tooltip:"Suma total en dólares."},{label:"Promedio S/.",value:parseFloat(r.promedioSoles??0),icon:Ye,gradient:"linear-gradient(135deg,#14b8a6cc,#34d39999)",tooltip:"Promedio por solicitud en soles."},{label:"Promedio $",value:parseFloat(r.promedioDolares??0),icon:Ye,gradient:"linear-gradient(135deg,#f59e0bcc,#fbbf24aa)",tooltip:"Promedio por solicitud en dólares."}];return e.jsx("div",{className:"min-h-screen w-full flex flex-col bg-gray-50 font-sans",children:e.jsxs("div",{className:"flex-1 flex flex-col px-4 sm:px-6 md:px-8 py-4 lg:py-6",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2 text-gray-800 mb-6",children:[e.jsx(We,{className:"w-6 h-6 sm:w-7 sm:h-7"})," Solicitud de Gasto"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-x-3 gap-y-4 sm:gap-x-4 sm:gap-y-5 md:gap-x-6 md:gap-y-6 mb-6 w-full justify-items-stretch",children:x.map(m=>e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx($e,{label:m.label,value:r.total===void 0?0:m.value,icon:m.icon,gradient:m.gradient,tooltip:m.tooltip,decimals:Number.isInteger(m.value)?0:2,className:"text-xs sm:text-sm md:text-base w-full p-3 sm:p-4"})},m.label))}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6 mb-6 w-full",children:[e.jsx(re,{title:"Estados de Solicitudes",icon:e.jsx(fe,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-700"}),tooltipFormatter:Ze,className:"flex-1 h-56 sm:h-64 md:h-80 xl:h-[28rem] w-full",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6 h-full items-stretch",children:[e.jsx("div",{className:"flex-1 min-h-[160px] sm:min-h-[200px] md:min-h-[280px]",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Qe,{cx:"50%",cy:"50%",innerRadius:"10%",outerRadius:"95%",barSize:14,data:r.chartRadialEstado,children:[e.jsx(Xe,{minAngle:15,background:!0,clockWise:!0,dataKey:"value",cornerRadius:6,children:r.chartRadialEstado.map((m,y)=>e.jsx(te,{fill:Ge[y%Ge.length]},y))}),e.jsx(G,{wrapperStyle:{outline:"none"},formatter:Ze})]})})}),e.jsx("div",{className:"w-full lg:w-40 flex-shrink-0 mt-3 lg:mt-0",children:r.chartRadialEstado.map((m,y)=>e.jsxs("div",{className:"flex items-center gap-2 text-[10px] sm:text-xs md:text-sm text-gray-700 mb-2",children:[e.jsx("span",{style:{width:14,height:14,background:Ge[y%Ge.length],display:"inline-block",borderRadius:3}}),e.jsx("span",{className:"font-medium",children:m.name}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",m.value,")"]})]},m.name))})]})}),e.jsx(re,{title:"Tipos de Solicitudes",icon:e.jsx(ot,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-700"}),tooltipFormatter:ye,className:"flex-1 h-56 sm:h-64 md:h-80 xl:h-[28rem] w-full",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6 h-full items-stretch",children:[e.jsx("div",{className:"flex-1 min-h-[160px] sm:min-h-[200px] md:min-h-[280px]",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Qe,{cx:"50%",cy:"50%",innerRadius:"10%",outerRadius:"95%",barSize:14,data:r.chartTreemapTipo,children:[e.jsx(Xe,{minAngle:15,background:!0,clockWise:!0,dataKey:"value",cornerRadius:6,children:r.chartTreemapTipo.map((m,y)=>e.jsx(te,{fill:Ue[y%Ue.length]||"#334155"},y))}),e.jsx(G,{wrapperStyle:{outline:"none"},formatter:ye})]})})}),e.jsx("div",{className:"w-full lg:w-40 flex-shrink-0 mt-3 lg:mt-0",children:r.chartTreemapTipo.map((m,y)=>e.jsxs("div",{className:"flex items-center gap-2 text-[10px] sm:text-xs md:text-sm text-gray-700 mb-2",children:[e.jsx("span",{style:{width:14,height:14,background:Ue[y%Ue.length]||"#334155",display:"inline-block",borderRadius:3}}),e.jsx("span",{className:"font-medium",children:m.name}),e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",m.value,")"]})]},m.name))})]})})]}),e.jsx("div",{className:"flex flex-col w-full mt-6",children:e.jsx(re,{title:"Evolución Mensual",icon:e.jsx(as,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-700"}),tooltipFormatter:ye,className:"w-full h-56 sm:h-64 md:h-80 xl:h-[28rem]",children:e.jsx("div",{className:"flex flex-col w-full h-full min-h-[160px] sm:min-h-[200px] md:min-h-[300px] ",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(la,{data:r.chartAreaMes,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorArea",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.35}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.05})]})}),e.jsx(ke,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(de,{dataKey:"mes",stroke:"#6b7280",tick:{fontSize:12}}),e.jsx(me,{stroke:"#6b7280",domain:[0,"dataMax + 1"],allowDecimals:!1}),e.jsx(G,{wrapperStyle:{outline:"none"}}),e.jsx(ia,{type:"monotone",dataKey:"solicitudes",stroke:"#3b82f6",fill:"url(#colorArea)",strokeWidth:3})]})})})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap gap-4 mt-6 w-full",children:[e.jsxs(M,{onClick:()=>i("nueva"),className:"w-full sm:w-auto bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white text-sm sm:text-base px-4 py-2 sm:px-5 sm:py-2.5 rounded-lg shadow-md flex items-center gap-2 justify-center transition transform hover:scale-105",children:[e.jsx(We,{className:"w-5 h-5 sm:w-6 sm:h-6"})," Nueva Solicitud"]}),e.jsxs(M,{onClick:()=>g(!0),className:"w-full sm:w-auto bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-white text-sm sm:text-base px-4 py-2 sm:px-5 sm:py-2.5 rounded-lg shadow-md flex items-center gap-2 justify-center transition transform hover:scale-105",children:[e.jsx(Ce,{className:"w-5 h-5 sm:w-6 sm:h-6"})," Mis Solicitudes"]})]}),e.jsx(Aa,{open:b==="nueva",onClose:()=>i(null),onCreated:j}),e.jsx(Fa,{open:p,onClose:()=>g(!1),onRefresh:j})]})})}function br({solicitudId:a,onClose:t,onDecided:s}){const{authUser:r,logout:l}=oe(),c=Le(),[n,f]=o.useState(null),[d,b]=o.useState(!0),[i,p]=o.useState(""),[g,j]=o.useState(null),[x,m]=o.useState(null);o.useEffect(()=>{(async()=>{var N;if(!(!r||!a)){b(!0),m(null);try{const S=localStorage.getItem("access_token"),{data:w}=await P.get(`/boleta/solicitudes/${a}/`,{headers:{Authorization:`Bearer ${S}`}});f(w)}catch(S){console.error(S),m("No se pudo cargar la información de la solicitud."),((N=S==null?void 0:S.response)==null?void 0:N.status)===401&&l()}finally{b(!1)}}})()},[r,a,l]);const y=async h=>{var N;if(a){j(h);try{const S=localStorage.getItem("access_token");await P.post(`/boleta/solicitudes/${a}/decision/`,{decision:h,comentario:i},{headers:{Authorization:`Bearer ${S}`}}),h==="Atendido"?U.emit("solicitudAtendida",{id:a}):h==="Rechazado"&&U.emit("solicitudRechazada",{id:a}),s&&s(h==="Atendido"?"Solicitud atendida correctamente.":"Solicitud rechazada correctamente."),t(),h==="Atendido"&&c("/dashboard/liquidaciones")}catch(S){console.error(S),xa.error("Error al registrar la acción."),((N=S==null?void 0:S.response)==null?void 0:N.status)===401&&l()}finally{j(null)}}};return a?e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex justify-center items-center z-50 px-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-3xl shadow-xl relative border border-gray-100 dark:border-gray-700 overflow-y-auto max-h-[90vh]",children:[e.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:hover:text-gray-200",onClick:t,"aria-label":"Cerrar",children:"✖"}),d?e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Cargando solicitud..."})}):x?e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:"text-red-500 font-semibold",children:x})}):e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100 text-center md:text-left",children:["Solicitud ",n==null?void 0:n.numero_solicitud]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-5 text-sm sm:text-base",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ts,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Solicitante:"})," ",(n==null?void 0:n.solicitante_nombre)||(n==null?void 0:n.solicitante)||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(Ns,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Tipo:"})," ",(n==null?void 0:n.tipo_solicitud)||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ca,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Monto S/:"})," ",(Number((n==null?void 0:n.total_soles)??0)||0).toFixed(2)]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Monto $:"})," ",(Number((n==null?void 0:n.total_dolares)??0)||0).toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Fecha:"})," ",n!=null&&n.fecha?new Date(n.fecha).toLocaleDateString("es-PE"):"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(da,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Estado actual:"})," ",(n==null?void 0:n.estado)||"—"]}),(n==null?void 0:n.banco)&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(aa,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Banco:"})," ",n.banco]}),(n==null?void 0:n.numero_cuenta)&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ma,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"N° Cuenta:"})," ",n.numero_cuenta]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"mb-2 font-medium text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4 text-gray-700"}),"Comentario del revisor (opcional)"]}),e.jsx("textarea",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-400",rows:4,value:i,onChange:h=>p(h.target.value),placeholder:"Agregar comentario opcional..."})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-3 mt-4",children:[e.jsx("button",{className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-2 rounded-lg shadow-md transition",onClick:()=>y("Rechazado"),disabled:g==="Rechazado",children:"Rechazar"}),e.jsx("button",{className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2 rounded-lg shadow-md transition",onClick:()=>y("Atendido"),disabled:g==="Atendido",children:"Atender"})]})]})]})}):null}function jr(){const{authUser:a,logout:t}=oe(),[s,r]=o.useState([]),[l,c]=o.useState(!0),[n,f]=o.useState(null),[d,b]=o.useState(null),i=o.useCallback(async()=>{var x;if(a){c(!0),f(null);try{const m=localStorage.getItem("access_token"),{data:y}=await P.get("/boleta/solicitudes/pendientes/",{headers:{Authorization:`Bearer ${m}`},params:{destinatario_id:a.id,estado:"Pendiente para Atención"}});r(y)}catch(m){console.error(m),f("No se pudieron cargar las solicitudes pendientes."),((x=m==null?void 0:m.response)==null?void 0:x.status)===401&&t()}finally{c(!1)}}},[a,t]);o.useEffect(()=>(U.on("solicitudEnviada",i),U.on("solicitudAtendida",i),U.on("solicitudRechazada",i),()=>{U.off("solicitudEnviada",i),U.off("solicitudAtendida",i),U.off("solicitudRechazada",i)}),[i]),o.useEffect(()=>{i()},[i]);const{kpis:p,serie:g,estados:j}=o.useMemo(()=>{const x=s.filter(A=>A.estado==="Pendiente para Atención").length,m=s.filter(A=>A.estado==="Atendido, Pendiente de Liquidación").length,y=s.filter(A=>A.estado==="Rechazado").length,h=s.filter(A=>A.estado==="Pendiente para Atención").reduce((A,C)=>A+(parseFloat(C.total_soles)||0),0),N=s.filter(A=>A.estado==="Atendido, Pendiente de Liquidación").reduce((A,C)=>A+(parseFloat(C.total_soles)||0),0),S=s.filter(A=>A.estado==="Rechazado").reduce((A,C)=>A+(parseFloat(C.total_soles)||0),0),w=new Map;s.forEach(A=>{if(A.estado==="Pendiente para Atención"){const O=new Date(A.fecha).toLocaleDateString("es-PE");w.set(O,(w.get(O)||0)+1)}});const k=[];for(let A=29;A>=0;A--){const C=new Date;C.setDate(C.getDate()-A);const O=C.toLocaleDateString("es-PE");k.push({dia:O,pendientes:w.get(O)||0})}const R={};return s.forEach(A=>{const C=A.estado||"Sin estado";R[C]=(R[C]||0)+1}),{kpis:{totalPendientes:x,totalAtendidas:m,totalRechazadas:y,montoPendienteSoles:h,montoAtendidoSoles:N,montoRechazadoSoles:S},serie:k,estados:Object.entries(R).map(([A,C])=>({name:A,value:C}))}},[s]);return l?e.jsxs("div",{className:"p-6 space-y-6 min-h-screen flex flex-col",children:[e.jsx("div",{className:"h-8 w-2/3 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Array.from({length:4}).map((x,m)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-2xl animate-pulse"},m))}),e.jsx("div",{className:"h-72 bg-gray-200 rounded-2xl animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded-2xl animate-pulse"})]}):n?e.jsx("div",{className:"p-6 min-h-screen flex flex-col",children:e.jsx("p",{className:"text-red-500 font-semibold",children:n})}):e.jsxs("div",{className:"p-6 w-full space-y-8 min-h-screen flex flex-col",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:e.jsxs("h2",{className:"text-2xl font-bold text-black flex items-center gap-3",children:[e.jsx(qs,{size:24}),"Atención de Solicitudes",e.jsx("button",{onClick:i,className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition",children:e.jsx(lt,{size:18})})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 md:gap-6 mb-6",children:[{label:"Pendientes",value:p.totalPendientes,gradient:"linear-gradient(135deg, #f97316cc, #fb923c99)",icon:rs},{label:"Atendidas",value:p.totalAtendidas,gradient:"linear-gradient(135deg,#3b82f6cc,#60a5fa99)",icon:os},{label:"Rechazadas",value:p.totalRechazadas,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",icon:ss},{label:"Monto Pendiente S/.",value:p.montoPendienteSoles,gradient:"linear-gradient(135deg, #facc15cc, #fcd34d99)",icon:ae},{label:"Monto Atendido S/.",value:p.montoAtendidoSoles,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",icon:ae},{label:"Monto Rechazado S/.",value:p.montoRechazadoSoles,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",icon:ae}].map(x=>e.jsx($e,{...x,decimals:isNaN(x.value)?0:String(x.value).includes(".")?2:0},x.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(re,{title:"Evolución de solicitudes",icon:e.jsx(Y,{size:18}),className:"h-80",tooltipFormatter:ye,children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(la,{data:g,margin:{top:10,right:20,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorPend",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#2563eb",stopOpacity:.45}),e.jsx("stop",{offset:"95%",stopColor:"#2563eb",stopOpacity:.05})]})}),e.jsx(ke,{strokeDasharray:"3 3",opacity:.3}),e.jsx(de,{dataKey:"dia",tick:{fontSize:11},minTickGap:24}),e.jsx(me,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(G,{contentStyle:{borderRadius:10,border:"none",boxShadow:"0 6px 18px rgba(0,0,0,.12)"},labelStyle:{fontWeight:600},formatter:ye}),e.jsx(ia,{type:"monotone",dataKey:"pendientes",stroke:"#2563eb",fill:"url(#colorPend)",strokeWidth:2})]})})}),e.jsx(re,{title:"Distribución por estado",icon:e.jsx(ve,{size:18}),className:"h-80",tooltipFormatter:Ze,children:e.jsx("div",{className:"flex flex-col lg:flex-row h-full gap-4 items-stretch",children:e.jsx("div",{className:"flex-1 min-h-[220px]",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsx(Qe,{innerRadius:"10%",outerRadius:"95%",data:j,children:e.jsx(Xe,{minAngle:10,background:!0,clockWise:!0,dataKey:"value",cornerRadius:8,children:j.map((x,m)=>e.jsx(te,{fill:we[x.name]||"#9ca3af"},`cell-${m}`))})})})})})})]}),e.jsx(Ie,{headers:["N° Solicitud","Solicitante","Tipo","Monto S/.","Monto $","Fecha","Estado","Acciones"],data:s,emptyMessage:"No hay solicitudes pendientes por ahora.",renderRow:x=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 sm:px-4 py-3 font-semibold text-center",children:x.numero_solicitud||"-"}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center",children:x.solicitante_nombre||"-"}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center hidden sm:table-cell",children:x.tipo_solicitud||"-"}),e.jsxs("td",{className:"px-3 sm:px-4 py-3 text-center",children:["S/ ",(Number(x.total_soles)||0).toFixed(2)]}),e.jsxs("td",{className:"px-3 sm:px-4 py-3 text-center",children:["$ ",(Number(x.total_dolares)||0).toFixed(2)]}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center hidden sm:table-cell",children:x.fecha?new Date(x.fecha).toLocaleDateString("es-PE"):"-"}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Re[x.estado]||"bg-gray-100 text-gray-700"}`,children:x.estado||"Sin estado"})}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center",children:e.jsxs("button",{className:"bg-indigo-500 hover:bg-indigo-600 text-white text-sm px-3 py-1.5 rounded-lg shadow-md flex items-center gap-2 justify-center",onClick:()=>b(x.id),children:[e.jsx(ge,{size:16})," Revisar"]})})]})}),d&&e.jsx(br,{solicitudId:d,onClose:()=>b(null),onDecided:x=>{x&&xa.success(x),b(null),i()}})]})}const yr="http://localhost:8000/api/boleta/documentos",vr=async a=>{var t,s;try{const r=await es.post(`${yr}/procesar/`,a,{headers:{"Content-Type":"multipart/form-data"}}),{datos_detectados:l}=r.data||{};console.log("✅ OCR recibido:",l);const n=["ruc"].filter(f=>!(l!=null&&l[f])||l[f]==="No encontrado"||l[f]==="");return n.length>0&&console.warn(`⚠️ OCR incompleto. Faltan: ${n.join(", ")}`),l||{}}catch(r){throw console.error("❌ Error procesando OCR:",r),new Error(((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.error)||"No se pudo procesar el documento. Intenta nuevamente con otra imagen.")}};function Ea({idSolicitud:a,tipoSolicitud:t,open:s,onClose:r,onProcesado:l}){const[c,n]=o.useState("Boleta"),[f,d]=o.useState(null),[b,i]=o.useState(!1),[p,g]=o.useState(null),[j,x]=o.useState(""),[m,y]=o.useState(!1);o.useEffect(()=>{const S=/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);y(S)},[]);const h=S=>{const w=S.target.files[0];w&&(d(w),g(null),x(""))},N=async()=>{if(!f){alert("⚠️ Selecciona un archivo antes de procesar.");return}const S=new FormData;S.append("archivo",f),S.append("tipo_documento",c),S.append("id_solicitud",a);try{i(!0);const w=await vr(S);console.log("📦 OCR recibido:",w);const k={nombre_archivo:f.name,tipo_documento:c,numero_documento:w.numero_documento||"",fecha:w.fecha||"",ruc:w.ruc||"",razon_social:w.razon_social||"",total:w.total&&w.total.toString().replace(",",".")||j||"",archivo:f};if(!k.total){alert("⚠️ Ingresa un total válido."),i(!1);return}l(k),r()}catch(w){console.error("❌ Error procesando OCR:",w),g("No se pudo procesar el documento. Intenta nuevamente.")}finally{i(!1)}};return e.jsx(Q,{open:s,onOpenChange:r,children:e.jsxs(V,{className:"w-[95vw] max-w-md h-auto max-h-[90vh] overflow-y-auto",children:[e.jsx(W,{children:e.jsxs(J,{className:"flex items-center gap-2 text-base sm:text-lg",children:[e.jsx(Fs,{className:"w-5 h-5 text-gray-700"}),"Subir Documento - Solicitud # ",a]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tipo de Documento"}),e.jsxs("select",{value:c,onChange:S=>n(S.target.value),className:"mt-1 p-2 w-full border rounded-md focus:ring focus:ring-blue-200 text-sm",children:[e.jsx("option",{value:"",children:"--Seleccionar--"}),e.jsx("option",{value:"Boleta",children:"Boleta"}),e.jsx("option",{value:"Factura",children:"Factura"}),e.jsx("option",{value:"Honorarios",children:"Honorarios"}),e.jsx("option",{value:"Otros",children:"Otros"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[m&&e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:h,style:{display:"none"}}),e.jsxs("span",{className:"bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white text-sm px-4 py-2 rounded-lg shadow-md flex items-center gap-2 justify-center",children:[e.jsx(it,{className:"w-4 h-4"})," Cámara"]})]}),e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*,application/pdf",onChange:h,style:{display:"none"}}),e.jsxs("span",{className:"bg-gradient-to-r from-amber-200 to-amber-300 hover:from-amber-300 hover:to-amber-400 text-white text-sm px-4 py-2 rounded-lg shadow-md flex items-center gap-2 justify-center",children:[e.jsx(Fs,{className:"w-4 h-4"})," Archivo"]})]})]}),f&&e.jsxs("p",{className:"text-xs text-gray-600 mt-2 flex items-center gap-1 truncate",children:[e.jsx(na,{className:"w-4 h-4"})," ",f.name]}),!p&&f&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Total (si OCR no lo detecta)"}),e.jsx("input",{type:"number",step:"0.01",value:j,onChange:S=>x(S.target.value),className:"mt-1 p-2 w-full border rounded-md focus:ring focus:ring-blue-200 text-sm",placeholder:"Ej. 150.75"})]}),p&&e.jsxs("p",{className:"text-sm text-red-600 bg-red-100 rounded p-2 flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4"})," ",p]})]}),e.jsxs(xe,{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[e.jsxs(M,{variant:"outline",onClick:r,className:"bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white text-sm px-4 py-2 rounded-lg flex items-center gap-2 justify-center w-full sm:w-auto",children:[e.jsx(ze,{className:"w-4 h-4"})," Cerrar"]}),e.jsx(M,{onClick:N,disabled:b,className:"bg-gradient-to-r from-green-400 to-green-500 hover:from-green-500 hover:to-green-600 text-white text-sm px-4 py-2 rounded-lg flex items-center gap-2 justify-center w-full sm:w-auto",children:b?"Procesando...":e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"w-4 h-4"})," Procesar"]})})]})]})})}const Nr=3.52,Ma=({open:a,onClose:t,solicitud:s})=>{const[r,l]=o.useState([]),[c,n]=o.useState(!1),[f,d]=o.useState(!1);if(!s)return null;const{totalSoles:b,totalDolares:i}=o.useMemo(()=>{const m=r.reduce((y,h)=>y+parseFloat(h.total||0),0);return{totalSoles:m,totalDolares:m/Nr}},[r]),p=m=>{l(y=>[...y,m]),console.log("✅ Documento agregado:",m)},g=m=>{l(y=>y.filter(h=>h!==m))},j=m=>{if(!m)return;const y=URL.createObjectURL(m);window.open(y,"_blank","noopener,noreferrer")},x=async()=>{var m;if(r.length===0)return alert("⚠️ Agrega al menos un comprobante.");try{n(!0);const y=localStorage.getItem("access_token");if(!y)return alert("⚠️ No se encontró token. Debes iniciar sesión.");const h=new FormData;h.append("solicitud_id",s.id);const N=r.map(w=>({tipo_documento:w.tipo_documento,numero_documento:w.numero_documento,fecha:w.fecha,ruc:w.ruc,razon_social:w.razon_social,total:parseFloat(w.total)}));h.append("documentos",JSON.stringify(N)),r.forEach(w=>{w.archivo&&h.append("archivos",w.archivo)}),console.log("📤 Enviando FormData:");for(let w of h.entries())w[1]instanceof File?console.log(w[0],w[1].name,w[1].size,w[1].type):console.log(w[0],w[1]);const S=await P.post("/boleta/documentos/guardar/",h,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${y}`}});console.log("✅ Liquidación presentada:",S.data),t(),alert("✅ Liquidación presentada correctamente")}catch(y){console.error("❌ Error guardando documento:",((m=y.response)==null?void 0:m.data)||y),alert("❌ Ocurrió un error al presentar la liquidación. Revisa consola.")}finally{n(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"w-full max-w-5xl max-h-[90vh] overflow-y-auto p-4 sm:p-6",children:[e.jsx(W,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-gray-700"}),"Presentar Documentación"]})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx(je,{children:e.jsxs(Ne,{className:"p-4 space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Solicitud:"})," ",s.numero_solicitud]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ts,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Solicitante:"})," ",s.solicitante||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(Ns,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Tipo:"})," ",s.tipo_solicitud||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ca,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Monto Soles (S/.):"})," ",s.total_soles||s.monto||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Monto Dólares ($):"})," ",s.total_dolares||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Fecha:"})," ",s.fecha||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(da,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Estado actual:"})," ",s.estado||"Pendiente"]})]})}),e.jsx(je,{children:e.jsxs(Ne,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-2",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(dt,{className:"w-5 h-5 text-gray-700"}),"Comprobantes OCR"]}),e.jsxs(M,{size:"sm",onClick:()=>d(!0),className:"bg-gradient-to-r from-violet-400 to-violet-500 hover:from-violet-500 hover:to-violet-600 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2",children:[e.jsx(ea,{className:"h-4 w-4"})," Agregar"]})]}),e.jsx(Ie,{headers:["Nombre del Archivo","N° Doc","Tipo","Fecha","RUC","Razón Social","Total"],data:r,emptyMessage:"No se han agregado comprobantes todavía.",renderRow:m=>[e.jsx("span",{className:"cursor-pointer text-blue-600 hover:underline",onClick:()=>j(m.archivo),children:m.nombre_archivo}),m.numero_documento,m.tipo_documento,m.fecha,m.ruc,m.razon_social,m.total],onDeleteRow:m=>g(m)}),e.jsxs("div",{className:"mt-4 text-right font-semibold text-gray-800 text-sm sm:text-base",children:[e.jsxs("p",{children:["Total: S/ ",b.toFixed(2)]}),e.jsxs("p",{children:["Total: $ ",i.toFixed(2)]})]})]})})]}),e.jsxs(xe,{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[e.jsxs(M,{onClick:t,className:"bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white text-sm px-4 py-2 rounded-lg flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(ze,{className:"w-4 h-4"})," Cancelar"]}),e.jsxs(M,{onClick:x,disabled:c||r.length===0,className:"bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white text-sm px-4 py-2 rounded-lg flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(mt,{className:"w-4 h-4"})," ",c?"Presentando...":"Presentar Liquidación"]})]})]})}),f&&e.jsx(Ea,{idSolicitud:s.id,open:f,onClose:()=>d(!1),onProcesado:p})]})};function wr(){const{authUser:a,logout:t}=oe(),[s,r]=o.useState([]),[l,c]=o.useState(!0),[n,f]=o.useState(null),[d,b]=o.useState(""),[i,p]=o.useState(""),[g,j]=o.useState(""),[x,m]=o.useState(""),[y,h]=o.useState(""),[N,S]=o.useState(null),[w,k]=o.useState(!1),R=o.useCallback(async()=>{var v,D,$;c(!0),f(null);try{const L=localStorage.getItem("access_token"),{data:H}=await P.get("/boleta/liquidaciones_pendientes/",{headers:{Authorization:`Bearer ${L}`}});console.log("✅ Liquidaciones pendientes raw:",H);const X=H.map(ue=>{var u;return{...ue,solicitante:((u=ue.solicitante)==null?void 0:u.replace(/\s*<.*?>/,"").trim())||"-"}});console.log("✅ Liquidaciones pendientes limpias:",X),r(X)}catch(L){console.error("Error cargando solicitudes pendientes:",L),f(((D=(v=L==null?void 0:L.response)==null?void 0:v.data)==null?void 0:D.detail)||"No se pudieron cargar las liquidaciones pendientes."),(($=L==null?void 0:L.response)==null?void 0:$.status)===401&&t()}finally{c(!1)}},[t]);o.useEffect(()=>(U.on("solicitudAtendida",R),U.on("solicitudRechazada",R),()=>{U.off("solicitudAtendida",R),U.off("solicitudRechazada",R)}),[R]),o.useEffect(()=>{R()},[R]);const A=o.useMemo(()=>{const v=new Set(s.map(D=>D.solicitante));return Array.from(v)},[s]),C=o.useMemo(()=>s.filter(v=>{const D=v.solicitante.toLowerCase().includes(d.toLowerCase())||v.numero_solicitud.toString().includes(d),$=i===""||v.solicitante===i,L=g===""||v.tipo_solicitud===g,H=(!x||new Date(v.fecha)>=new Date(x))&&(!y||new Date(v.fecha)<=new Date(y));return D&&$&&L&&H}),[s,d,i,g,x,y]),O=o.useMemo(()=>{const v=C.length,D=C.reduce((H,X)=>H+(X.total_soles||0),0),$=C.reduce((H,X)=>H+(X.total_dolares||0),0),L=v?(D/v).toFixed(2):0;return{total:v,totalSoles:D,totalDolares:$,promedio:L}},[C]),K=o.useMemo(()=>Object.entries(C.reduce((v,D)=>(v[D.tipo_solicitud]=(v[D.tipo_solicitud]||0)+1,v),{})).map(([v,D])=>({name:v,value:D})),[C]),T=o.useMemo(()=>Object.entries(C.reduce((v,D)=>(v[D.tipo_solicitud]=(v[D.tipo_solicitud]||0)+(D.total_soles||0),v),{})).map(([v,D])=>({name:v,value:Number(D.toFixed(2))})),[C]),_=(v,D,$)=>{S($),k(!0)};return e.jsx("div",{className:"min-h-screen w-full flex flex-col bg-gray-50 font-sans",children:e.jsxs("div",{className:"flex-1 flex flex-col px-4 sm:px-6 md:px-8 py-4 lg:py-6",children:[e.jsx("div",{className:"flex justify-center md:justify-start items-center mb-4",children:e.jsxs("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold flex items-center gap-2 text-black",children:[e.jsx(Bs,{className:"w-5 sm:w-6 h-5 sm:h-6"})," Liquidaciones Pendientes"]})}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-x-3 gap-y-4 sm:gap-x-4 sm:gap-y-5 md:gap-x-6 md:gap-y-6 mb-6 w-full justify-items-stretch",children:[{label:"Total Pendientes",value:O.total,gradient:"linear-gradient(135deg, #f97316cc, #fb923c99)",icon:rs,tooltip:"Número total de solicitudes pendientes."},{label:"Monto Total (S/)",value:O.totalSoles,gradient:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)",icon:ae,tooltip:"Monto acumulado en soles.",decimals:2},{label:"Monto Total ($)",value:O.totalDolares,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",icon:ae,tooltip:"Monto acumulado en dólares.",decimals:2},{label:"Promedio por Solicitud (S/)",value:O.promedio,gradient:"linear-gradient(135deg, #f59e0bcc, #fcd34d99)",icon:ae,tooltip:"Promedio por solicitud.",decimals:2}].map(v=>e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx($e,{label:v.label,value:l?0:v.value,icon:v.icon,gradient:v.gradient,tooltip:v.tooltip,decimals:Number.isInteger(v.value)?0:2,className:"text-xs sm:text-sm md:text-base w-full p-2 sm:p-3"})},v.label))}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-6 mb-6 w-full",children:[e.jsx(re,{title:"Montos por Tipo de Solicitud (S/.)",icon:e.jsx(xt,{className:"w-4 h-4"}),className:"flex-1 h-56 sm:h-64 md:h-80 lg:h-96 w-full",tooltipFormatter:v=>`S/ ${v.toLocaleString()}`,children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Ee,{data:T,layout:"vertical",margin:{left:10},children:[e.jsx(ke,{strokeDasharray:"3 3",opacity:.2}),e.jsx(de,{type:"number"}),e.jsx(me,{dataKey:"name",type:"category",width:100}),e.jsx(G,{formatter:v=>`S/ ${v.toLocaleString()}`}),e.jsx(Me,{dataKey:"value",barSize:40,children:T.map((v,D)=>e.jsx(te,{fill:ce[v.name]||"#9CA3AF"},D))})]})})}),e.jsx(re,{title:"Distribución por Tipo",icon:e.jsx(ut,{className:"w-4 h-4"}),className:"flex-1 h-56 sm:h-64 md:h-80 lg:h-96 w-full",tooltipFormatter:ye,children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Ee,{data:K,children:[e.jsx(ke,{strokeDasharray:"3 3",opacity:.2}),e.jsx(de,{dataKey:"name"}),e.jsx(me,{allowDecimals:!1}),e.jsx(G,{formatter:ye}),e.jsx(Me,{dataKey:"value",barSize:40,children:K.map((v,D)=>e.jsx(te,{fill:ce[v.name]||"#9CA3AF"},D))})]})})})]}),e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-xl border border-gray-200 shadow-sm mb-6 w-full overflow-x-auto",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 items-end",children:[e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-600 mb-1 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"})," Solicitante"]}),e.jsxs("select",{value:i,onChange:v=>p(v.target.value),className:"border rounded-lg px-2 py-2 text-sm focus:ring-2 focus:ring-blue-400 focus:outline-none w-full",children:[e.jsx("option",{value:"",children:"Todos"}),A.map(v=>e.jsx("option",{value:v,children:v},v))]})]}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-600 mb-1 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"})," Tipo"]}),e.jsxs("select",{value:g,onChange:v=>j(v.target.value),className:"border rounded-lg px-2 py-2 text-sm focus:ring-2 focus:ring-green-400 focus:outline-none w-full",children:[e.jsx("option",{value:"",children:"Todos"}),Object.keys(ce).map(v=>e.jsx("option",{value:v,children:v},v))]})]}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-600 mb-1 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-purple-500 rounded-full"})," Rango de Fechas"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx("input",{type:"date",value:x,onChange:v=>m(v.target.value),className:"border rounded-lg px-2 py-2 text-sm focus:ring-2 focus:ring-purple-400 focus:outline-none w-full sm:w-auto"}),e.jsx("span",{className:"text-gray-400 text-xs hidden sm:inline",children:"→"}),e.jsx("input",{type:"date",value:y,onChange:v=>h(v.target.value),className:"border rounded-lg px-2 py-2 text-sm focus:ring-2 focus:ring-purple-400 focus:outline-none w-full sm:w-auto"})]})]})]})}),e.jsx("div",{className:"overflow-x-auto max-h-[70vh]",children:e.jsx(Ie,{headers:["N°","Tipo","S/.","$","Fecha","Concepto","Estado","Acción"],data:C,emptyMessage:"No hay solicitudes en este estado o rango de fechas.",renderRow:v=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 font-semibold text-center text-xs sm:text-sm",children:v.numero_solicitud}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] sm:text-xs ${ks[v.tipo_solicitud]||"bg-gray-200 text-gray-700"}`,children:v.tipo_solicitud})}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:v.total_soles?`S/. ${v.total_soles}`:"-"}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:v.total_dolares?`$ ${v.total_dolares}`:"-"}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:v.fecha}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm truncate max-w-[120px] sm:max-w-[200px]",children:v.concepto_gasto??"-"}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] sm:text-xs ${Re[v.estado]||"bg-gray-200 text-gray-700"}`,children:v.estado})}),e.jsx("td",{className:"px-1 sm:px-2 py-1 sm:py-2 text-center text-xs sm:text-sm",children:e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>_(v.id,"Presentar Documentación",v),className:"flex items-center gap-1 px-2 py-1",children:[e.jsx(Y,{className:"w-4 h-4"})," Presentar"]})})]})})}),w&&e.jsx(Ma,{open:w,onClose:()=>k(!1),solicitud:N})]})})}function Sr({open:a,onClose:t,accion:s,onConfirm:r,liquidacion:l}){if(!s)return null;const c={aprobar:{text:"aprobar",color:"from-green-400 to-green-600",icon:e.jsx(Xs,{className:"w-5 h-5"})},ajuste:{text:"ajustar",color:"from-orange-400 to-orange-600",icon:e.jsx(pt,{className:"w-5 h-5"})},rechazar:{text:"rechazar",color:"from-red-400 to-red-600",icon:e.jsx(ss,{className:"w-5 h-5"})},devolucion:{text:"devolver",color:"from-yellow-400 to-yellow-600",icon:e.jsx(ht,{className:"w-5 h-5"})}},{text:n,color:f,icon:d}=c[s]||c.aprobar;return e.jsx(Q,{open:a,onOpenChange:t,children:e.jsx(V,{className:"p-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl overflow-hidden border border-gray-200",children:[e.jsx(W,{className:"p-4 border-b border-gray-100",children:e.jsxs(J,{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(I.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.3},children:d}),"Confirmar acción"]})}),e.jsx(I.div,{className:"p-4 text-gray-700",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3,delay:.1},children:e.jsxs("p",{className:"text-sm",children:["¿Estás seguro de que deseas ",e.jsx("strong",{children:n}),l?` la liquidación #${l.id}`:" esta liquidación","?"]})}),e.jsxs(xe,{className:"p-4 flex justify-end gap-2 border-t border-gray-100",children:[e.jsx(M,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(I.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:e.jsx(M,{className:`bg-gradient-to-r ${f} text-white hover:brightness-110 transition-all flex items-center gap-1`,onClick:r,children:e.jsx(I.span,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:n.charAt(0).toUpperCase()+n.slice(1)})})})]})]})})})}function Cr({open:a,onClose:t,documento:s}){const r=o.useRef();if(!s)return null;const l=s.archivo_url||s.url,c=()=>{if(!l)return;const n=window.open("","_blank");n.document.write(`
      <html>
        <head>
          <title>${s.nombre||"Documento"}</title>
        </head>
        <body style="margin:0; display:flex; justify-content:center; align-items:center; height:100vh;">
          <img src="${l}" style="max-width:100%; max-height:100vh;" />
        </body>
      </html>
    `),n.document.close(),n.focus(),n.print(),n.close()};return e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"max-w-3xl w-full shadow-xl rounded-xl p-6",children:[e.jsx(W,{children:e.jsx(J,{children:s.nombre||s.numero_documento||"Documento"})}),e.jsx("div",{className:"flex justify-center my-4",children:l?e.jsx("img",{ref:r,src:l,alt:s.nombre||"Documento",className:"max-h-[70vh] w-auto object-contain rounded border"}):e.jsx("p",{className:"text-center text-gray-500",children:"No hay vista disponible"})}),e.jsxs(xe,{className:"flex justify-between",children:[e.jsx(M,{variant:"outline",onClick:t,children:"Cerrar"}),l&&e.jsx(M,{onClick:c,children:"Imprimir"})]})]})})}const cs=3.52;function kr({open:a,onClose:t,liquidacion:s}){var y;const[r,l]=o.useState(!1),[c,n]=o.useState(null);if(!s)return null;const f=h=>Number(h).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2}),d=h=>(h/cs).toFixed(2),b=o.useMemo(()=>s.total_documentado||s.monto,[s]),i=b/cs,p=s.monto-b,g=p/cs,j=h=>{n(h),l(!0)},x=h=>typeof h=="string"?h:h.numero_documento||h.nombre_archivo||"Documento",m=h=>(h==null?void 0:h.archivo_url)||null;return e.jsxs(e.Fragment,{children:[e.jsx(Q,{open:a,onOpenChange:t,children:e.jsxs(V,{className:"max-w-lg shadow-xl rounded-xl p-6","aria-describedby":`detalle-liquidacion-${s.id}`,children:[e.jsxs(W,{children:[e.jsxs(J,{children:["Liquidación #",s.id]}),e.jsx(Sa,{id:`detalle-liquidacion-${s.id}`,children:"Detalles"})]}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Operación:"})," ",s.numero_operacion||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",s.fecha]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Solicitante:"})," ",s.solicitante]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("span",{className:"font-semibold",children:"Monto Solicitado:"}),e.jsxs("span",{children:["S/ ",f(s.monto)]}),e.jsxs("span",{children:["$ ",d(s.monto)]}),e.jsx("span",{className:"font-semibold",children:"Total Documentado:"}),e.jsxs("span",{children:["S/ ",f(b)]}),e.jsxs("span",{children:["$ ",d(i)]}),e.jsx("span",{className:"font-semibold",children:"Diferencia:"}),e.jsxs("span",{children:["S/ ",f(p)]}),e.jsxs("span",{children:["$ ",d(g)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Estado:"}),e.jsx(ie,{style:{STATE_CLASSES:Re},children:s.estado})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Observaciones:"})," ",s.observaciones||"Sin observaciones"]}),((y=s.documentos)==null?void 0:y.length)>0&&e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Documentos:"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.documentos.map((h,N)=>{const S=x(h),w=m(h);return e.jsx(ie,{variant:"outline",className:"cursor-pointer hover:bg-blue-100 transition",onClick:()=>w?window.open(w,"_blank"):j(h),children:S},N)})})]})]}),e.jsx(xe,{className:"mt-4",children:e.jsx(M,{variant:"outline",onClick:t,children:"Cerrar"})})]})}),r&&c&&e.jsx(Cr,{open:r,documento:c,onClose:()=>l(!1)})]})}const Ts=!0,ds=3.52,Ar=[{id:1,numero_operacion:"OP-1001",fecha:"2025-08-14",monto_soles:150,monto_dolares:42.96,tipo:"Viáticos",estado:"Pendiente de Envío",solicitante:"Juan Pérez",observaciones:"Documento completo",documentos:["F001-123","F002-456"]},{id:2,numero_operacion:"OP-1002",fecha:"2025-08-12",monto_soles:300,monto_dolares:86.09,tipo:"Movilidad",estado:"Pendiente para Atención",solicitante:"María López",observaciones:"Falta recibo",documentos:["F003-789"]},{id:3,numero_operacion:"OP-1003",fecha:"2025-08-10",monto:200,tipo:"Compras",estado:"Atendido, Pendiente de Liquidación",solicitante:"Carlos Díaz",observaciones:"Revisar gastos",documentos:["F004-101"]},{id:4,numero_operacion:"OP-1004",fecha:"2025-08-11",monto:500,tipo:"Otros gastos",estado:"Liquidación enviada para Aprobación",solicitante:"Ana Torres",observaciones:"Completo",documentos:["F005-202","F006-303"]},{id:5,numero_operacion:"OP-1005",fecha:"2025-08-09",monto:250,tipo:"Viáticos",estado:"Liquidación Aprobada",solicitante:"Luis Ramírez",observaciones:"",documentos:["F007-404"]},{id:6,numero_operacion:"OP-1006",fecha:"2025-08-08",monto:180,tipo:"Compras",estado:"Rechazado",solicitante:"Sofía Martínez",observaciones:"Error en factura",documentos:["F008-505"]}];function _r(){const[a,t]=o.useState([]),[s,r]=o.useState(!0),[l,c]=o.useState(""),[n,f]=o.useState("Todas"),[d,b]=o.useState(""),[i,p]=o.useState(""),[g,j]=o.useState(""),[x,m]=o.useState(""),[y,h]=o.useState(""),[N,S]=o.useState(!1),[w,k]=o.useState(null),[R,A]=o.useState(!1),[C,O]=o.useState(""),[K,T]=o.useState(null),_=async()=>{try{r(!0),Ts&&setTimeout(()=>{t(Ar),r(!1)},800)}catch(u){console.error(u),r(!1)}};o.useEffect(()=>{_()},[]);const v=o.useMemo(()=>a.filter(u=>{const F=u.solicitante.toLowerCase().includes(l.toLowerCase())||u.id.toString().includes(l),B=n==="Todas"||u.tipo===n,he=d===""||new Date(u.fecha)>=new Date(d),Se=i===""||new Date(u.fecha)<=new Date(i),ns=g===""||u.monto>=parseFloat(g),qe=x===""||u.monto<=parseFloat(x),Be=y===""||u.documentos.some(Ra=>Ra.toLowerCase().includes(y.toLowerCase()));return F&&B&&he&&Se&&ns&&qe&&Be}),[a,l,n,d,i,g,x,y]),D=o.useMemo(()=>{const u={Aprobado:0,Rechazado:0};let F=0,B=0;a.forEach(Se=>{F++,B+=Se.monto,u[Se.estado]!==void 0&&u[Se.estado]++});const he=B/ds;return{Total:F,Aprobadas:u.Aprobado,Rechazadas:u.Rechazado,TotalSoles:B,TotalDolares:he}},[a]),$=async()=>{if(w)try{const u=ACTION_STATE_MAP[C];Ts&&t(F=>F.map(B=>B.id===w.id?{...B,estado:u}:B)),A(!1),S(!1),T(w.id),setTimeout(()=>T(null),1500)}catch(u){console.error(u)}},L=o.useMemo(()=>Object.entries(v.reduce((u,F)=>(u[F.estado]=(u[F.estado]||0)+1,u),{})).map(([u,F])=>({name:u,value:F})),[v]),H=o.useMemo(()=>Object.entries(v.reduce((u,F)=>(u[F.tipo]=(u[F.tipo]||0)+1,u),{})).map(([u,F])=>({name:u,value:F})),[v]),X=u=>Number(u).toLocaleString("es-PE",{minimumFractionDigits:2}),ue=u=>(u/ds).toLocaleString("en-US",{minimumFractionDigits:2});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Gs,{className:"w-6 h-6"})," Aprobación de Liquidaciones"]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 md:gap-6 mb-6",children:[{label:"Total",value:D.Total,gradient:"linear-gradient(135deg, #6366f1cc, #818cf899)",icon:Je,tooltip:"Cantidad total de liquidaciones."},{label:"Aprobadas",value:D.Aprobadas,gradient:"linear-gradient(135deg, #16a34acc, #22c55e99)",icon:os,tooltip:"Liquidaciones aprobadas."},{label:"Rechazadas",value:D.Rechazadas,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",icon:ss,tooltip:"Liquidaciones rechazadas."},{label:"Total S/",value:D.TotalSoles,gradient:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)",icon:Je,tooltip:"Monto total en soles."},{label:"Total $",value:D.TotalDolares,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",icon:ae,tooltip:"Monto total en dólares."}].map(u=>e.jsx($e,{label:u.label,value:u.value,icon:u.icon,gradient:u.gradient,tooltip:u.tooltip,decimals:typeof u.value=="number"?0:2},u.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(re,{title:"Distribución por Estado",className:"h-64",tooltipFormatter:(u,F)=>[`${u}`,`${F}`],children:[e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(ve,{children:[e.jsx(Pe,{data:L,dataKey:"value",nameKey:"name",innerRadius:60,outerRadius:100,paddingAngle:5,children:L.map((u,F)=>e.jsx(te,{fill:we[u.name]},F))}),e.jsx(G,{})]})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total"}),e.jsx("div",{className:"text-xl font-bold",children:a.length})]})]})}),e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsx(re,{title:"Distribución por Tipo",className:"h-64",tooltipFormatter:(u,F)=>[`${u}`,`${F}`],children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Ee,{data:H,margin:{top:20,right:20,bottom:20,left:0},children:[e.jsx(de,{dataKey:"name",tick:{fill:"#6b7280",fontWeight:500},axisLine:{stroke:"#d1d5db"},tickLine:!1}),e.jsx(me,{allowDecimals:!1,tick:{fill:"#6b7280",fontWeight:500},axisLine:{stroke:"#d1d5db"},tickLine:!1}),e.jsx(G,{}),e.jsx(Me,{dataKey:"value",radius:[6,6,0,0],children:H.map((u,F)=>e.jsx(te,{fill:ce[u.name]},F))})]})})})})]}),e.jsxs(je,{className:"rounded-xl p-4 shadow-md mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsx(se,{type:"date",value:d,onChange:u=>b(u.target.value),placeholder:"Desde"}),e.jsx(se,{type:"date",value:i,onChange:u=>p(u.target.value),placeholder:"Hasta"}),e.jsx(se,{type:"number",value:g,onChange:u=>j(u.target.value),placeholder:"Monto mínimo"}),e.jsx(se,{type:"number",value:x,onChange:u=>m(u.target.value),placeholder:"Monto máximo"})]}),e.jsx(se,{placeholder:"Documento...",value:y,onChange:u=>h(u.target.value),className:"mb-4"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["Todas","Viáticos","Movilidad","Compras","Otros gastos"].map(u=>e.jsx(ie,{className:"px-4 py-1 rounded-full cursor-pointer transition-transform hover:scale-105",style:{backgroundColor:n===u?ce[u]:"#f3f4f6",color:n===u?"#fff":"#000"},onClick:()=>f(u),children:u},u))})]}),e.jsx(Ne,{children:s?e.jsx("p",{className:"text-center py-10 animate-pulse",children:"Cargando..."}):e.jsx(Ie,{headers:["Solicitante","Tipo","Fecha","Monto S/","Monto $","Estado","Documentos","Acciones"],data:v,emptyMessage:"No hay liquidaciones.",activeRow:K,renderRow:u=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",title:u.observaciones,children:u.solicitante}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx(ie,{className:`${ks[u.tipo]||"bg-gray-200 text-gray-700"} px-3 py-1 rounded-full`,children:u.tipo})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:u.fecha}),e.jsxs("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:["S/ ",X(u.monto)]}),e.jsxs("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:["$ ",ue(u.monto/ds)]}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx(ie,{className:`${Re[u.estado]||"bg-gray-200 text-gray-700"} px-3 py-1 rounded-full`,children:u.estado})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:u.documentos.map((F,B)=>e.jsx(ie,{variant:"outline",className:`mr-1 ${y&&F.toLowerCase().includes(y.toLowerCase())?"bg-yellow-300 font-medium shadow-md":""}`,children:F},B))}),e.jsxs("td",{className:"px-2 sm:px-4 py-2 sm:py-3 flex gap-1 justify-center",children:[e.jsx("button",{"data-tooltip-id":"tooltip","data-tooltip-content":"Ver Detalle",className:"bg-indigo-500 hover:bg-indigo-600 text-white p-2 rounded-lg shadow-md",onClick:()=>{k(u),S(!0)},children:e.jsx(ge,{size:16})}),e.jsx("button",{"data-tooltip-id":"tooltip","data-tooltip-content":"Aprobar",className:"bg-green-500 hover:bg-green-600 text-white p-2 rounded-lg shadow-md",onClick:()=>{k(u),O("aprobar"),A(!0)},children:e.jsx(gt,{size:16})}),e.jsx("button",{"data-tooltip-id":"tooltip","data-tooltip-content":"Rechazar",className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded-lg shadow-md",onClick:()=>{k(u),O("rechazar"),A(!0)},children:e.jsx(ze,{size:16})})]})]})})}),N&&w&&e.jsx(kr,{open:N,liquidacion:w,onClose:()=>S(!1)}),e.jsx(Sr,{open:R,onClose:()=>A(!1),accion:C,onConfirm:$,liquidacion:w}),e.jsx(ft,{id:"tooltip",place:"top",effect:"solid"})]})}const As=!0;function Dr({filtroId:a,setFiltroId:t,filtroUsuario:s,setFiltroUsuario:r,filtroTipo:l,setFiltroTipo:c,filtroDescripcion:n,setFiltroDescripcion:f,filtroFechaInicio:d,setFiltroFechaInicio:b,filtroFechaFin:i,setFiltroFechaFin:p,onLimpiarFiltros:g}){return e.jsxs("div",{className:"bg-white rounded-xl shadow p-4 border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(ma,{size:16})," ID"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por ID",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:a,onChange:j=>t(j.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(ts,{size:16})," Usuario"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por usuario",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:s,onChange:j=>r(j.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(bt,{size:16})," Tipo de Acción"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por tipo de acción",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:l,onChange:j=>c(j.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(Y,{size:16})," Descripción"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por descripción",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:n,onChange:j=>f(j.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(be,{size:16})," Fecha Inicio"]}),e.jsx("input",{type:"date",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:d,onChange:j=>b(j.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(be,{size:16})," Fecha Fin"]}),e.jsx("input",{type:"date",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:i,onChange:j=>p(j.target.value)})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("button",{onClick:g,className:`bg-gradient-to-r from-pink-500 to-rose-600 hover:from-pink-600 hover:to-rose-700 \r
                     text-white font-medium px-5 py-2 rounded-lg shadow-md transition flex items-center gap-2`,children:[e.jsx(jt,{size:16})," Limpiar filtros"]})})]})}function Fr(a){return a?new Date(a).toLocaleString():"-"}const Ke={tipos:{Aprobación:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Rechazo:"bg-red-200 text-red-800 dark:bg-red-700/40 dark:text-red-200",Devolución:"bg-orange-200 text-orange-800 dark:bg-orange-700/40 dark:text-orange-200",Pendiente:"bg-yellow-200 text-yellow-800 dark:bg-yellow-700/40 dark:text-yellow-200",Otro:"bg-indigo-200 text-indigo-800 dark:bg-indigo-700/40 dark:text-indigo-200"},acciones:{Aprobado:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Rechazado:"bg-red-200 text-red-800 dark:bg-red-700/40 dark:text-red-200",Pendiente:"bg-yellow-200 text-yellow-800 dark:bg-yellow-700/40 dark:text-yellow-200",Devolucion:"bg-orange-200 text-orange-800 dark:bg-orange-700/40 dark:text-orange-200",Otro:"bg-gray-200 text-gray-800 dark:bg-gray-700/40 dark:text-gray-200"}};function Er({actividades:a,abrirModal:t}){return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(Y,{size:18}),"Registro de Actividades"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Total: ",a.length]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-100 text-center",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"N°"}),e.jsx("th",{className:"px-4 py-3",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3",children:"Acción"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Detalle"})]})}),e.jsxs("tbody",{children:[a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-10 text-center text-gray-500 dark:text-gray-400",children:"No hay actividades registradas por ahora."})}),a.map((s,r)=>e.jsxs(I.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"border-t border-gray-100 dark:border-gray-700 hover:shadow-lg hover:translate-y-[-2px] hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-transform duration-200",children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:r+1}),e.jsx("td",{className:"px-4 py-3",children:s.usuario??"-"}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ke.tipos[s.tipo]||Ke.tipos.Otro}`,children:s.tipo??"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ke.acciones[s.accion]||Ke.acciones.Otro}`,children:s.accion??"-"})}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:s.descripcion??"-"}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:Fr(s.fecha)??"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{onClick:()=>t(s),className:"bg-gradient-to-r from-indigo-300 to-indigo-400 hover:from-indigo-400 hover:to-indigo-500 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition flex items-center gap-2 justify-center",children:[e.jsx(ge,{size:16}),"Ver detalle"]})})]},s.id))]})]})})]})}function Mr(a){return a?new Date(a).toLocaleString():"-"}function Rr({actividad:a,isOpen:t,onClose:s}){return a?e.jsx(ys,{children:t&&e.jsx(I.div,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(I.div,{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 relative shadow-lg",initial:{scale:.8},animate:{scale:1},exit:{scale:.8},transition:{duration:.2},children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Detalle de Actividad"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"ID / Número"}),e.jsx("p",{className:"text-gray-800",children:a.id??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Fecha y Hora"}),e.jsx("p",{className:"text-gray-800",children:Mr(a.fecha)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Usuario"}),e.jsx("p",{className:"text-gray-800",children:a.usuario??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Tipo"}),e.jsx("p",{className:"text-gray-800",children:a.tipo??"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Acción"}),e.jsx("p",{className:"text-gray-800",children:a.accion??"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Descripción"}),e.jsx("p",{className:"text-gray-800",children:a.descripcion??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Estado"}),e.jsx("p",{className:`font-medium ${a.estado==="pendiente"?"text-yellow-600":a.estado==="completada"?"text-green-600":"text-gray-600"}`,children:a.estado??"-"})]}),a.documentos&&a.documentos.length>0&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Documentos Referenciados"}),e.jsx("ul",{className:"list-disc list-inside text-gray-800",children:a.documentos.map((r,l)=>e.jsx("li",{children:e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:r.nombre??`Documento ${l+1}`})},l))})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:s,className:"bg-gray-400 text-gray-800 px-4 py-2 rounded hover:bg-gray-500 transition",children:"Cerrar"})})]})})}):null}const Ae={total:"#3b82f6",usuarios:"#22c55e",promedio:"#8b5cf6",frecuente:"#f59e0b",ultima:"#6366f1",eficiencia:"#10b981"},_e={aprobado:"#22c55e",rechazado:"#ef4444",devolucion:"#f97316",pendiente:"#f59e0b",azul:"#3b82f6",morado:"#a78bfa"},Te="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center",Or="transition-all duration-300 hover:scale-[1.01] hover:shadow-md";function Pr(){const[a,t]=o.useState([]),[s,r]=o.useState(!1),[l,c]=o.useState(null),[n,f]=o.useState(!1),[d,b]=o.useState(null),[i,p]=o.useState(""),[g,j]=o.useState(""),[x,m]=o.useState(""),[y,h]=o.useState(""),[N,S]=o.useState("fecha"),[w,k]=o.useState("desc");o.useEffect(()=>{R()},[]);const R=async()=>{r(!0),c(null);try{let u=[];As&&(u=[{id:1,fecha:"2025-08-14 | 08:30:00",usuario:"Juan",tipo:"Liquidaciones",accion:"Aprobado",descripcion:"Liquidación aprobada correctamente"},{id:2,fecha:"2025-08-14 | 09:15:00",usuario:"Maria",tipo:"Solicitudes",accion:"Pendiente",descripcion:"Solicitud de reembolso creada"},{id:3,fecha:"2025-08-14 | 10:45:00",usuario:"Carlos",tipo:"Liquidaciones",accion:"Rechazado",descripcion:"Liquidación con errores"},{id:4,fecha:"2025-08-14 | 11:30:00",usuario:"Ana",tipo:"Solicitudes",accion:"Devolución",descripcion:"Solicitud devuelta para corrección"}]),t(u)}catch(u){console.error(u),c("Error cargando actividades.")}finally{r(!1)}},A=u=>{b(u),f(!0)},C=()=>{f(!1),b(null)},O=o.useMemo(()=>a.filter(u=>{var qe,Be;const F=i?(qe=u.usuario)==null?void 0:qe.toLowerCase().includes(i.toLowerCase()):!0,B=g?(Be=u.tipo)==null?void 0:Be.toLowerCase().includes(g.toLowerCase()):!0,he=new Date(u.fecha),Se=x?he>=new Date(x):!0,ns=y?he<=new Date(y):!0;return F&&B&&Se&&ns}).sort((u,F)=>{if(N==="fecha")return w==="asc"?new Date(u.fecha)-new Date(F.fecha):new Date(F.fecha)-new Date(u.fecha);{const B=(u[N]??"").toString().toLowerCase(),he=(F[N]??"").toString().toLowerCase();return B<he?w==="asc"?-1:1:B>he?w==="asc"?1:-1:0}}),[a,i,g,x,y,N,w]),K=O.length,T=new Set(O.map(u=>u.usuario)).size,_=T>0?(K/T).toFixed(1):0,v=O.reduce((u,F)=>(u[F.accion]=(u[F.accion]||0)+1,u),{}),D=Object.entries(v).sort((u,F)=>F[1]-u[1])[0]||[],$=O.length>0?O[0].fecha:"Sin registros",L=v.Aprobado?(v.Aprobado/K*100).toFixed(1):0,H=Object.entries(v).map(([u,F])=>({name:u,value:F})),X=Object.entries(v).map(([u,F])=>({name:u,count:F})),ue=Object.values(O.reduce((u,F)=>{const B=new Date(F.fecha).toLocaleDateString();return u[B]=(u[B]||0)+1,u},{})).map((u,F)=>({fecha:Object.keys(v)[F],count:u}));return e.jsxs("div",{className:"p-6",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-7 h-7 text-gray-800"}),"Registro de Actividades"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6 text-center mb-8",children:[{label:"Total Actividades",value:K,color:Ae.total,icon:Es},{label:"Usuarios Activos",value:T,color:Ae.usuarios,icon:ws},{label:"Promedio por Usuario",value:_,color:Ae.promedio,icon:Y},{label:"Acción más Frecuente",value:D.length>0?`${D[0]} (${D[1]})`:"N/A",color:Ae.frecuente,icon:as},{label:"Última Actividad",value:$,color:Ae.ultima,icon:rs},{label:"% Aprobaciones",value:L+"%",color:Ae.eficiencia,icon:yt}].map((u,F)=>e.jsxs("div",{className:`flex flex-col items-center justify-center text-white p-4 rounded-xl cursor-pointer ${Te}`,style:{background:`linear-gradient(135deg, ${u.color}cc, ${u.color}99)`},children:[e.jsx(u.icon,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm",children:u.label}),e.jsx("p",{className:"text-2xl font-bold",children:typeof u.value=="number"?e.jsx(Fe,{end:u.value,duration:1.2,separator:","}):u.value})]},F))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md ${Te}`,children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(fe,{className:"w-5 h-5 text-blue-500"})," Distribución de Acciones"]}),e.jsx(q,{width:"100%",height:300,children:e.jsxs(ve,{children:[e.jsx(Pe,{data:H,dataKey:"value",nameKey:"name",outerRadius:110,label:!0,children:H.map((u,F)=>e.jsx(te,{fill:_e[u.name.toLowerCase()]||_e.azul,stroke:"#fff",strokeWidth:2},`cell-${F}`))}),e.jsx(G,{contentStyle:{background:"#1f2937",color:"#fff",borderRadius:"8px"}}),e.jsx(pe,{})]})})]}),e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md ${Te}`,children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Oe,{className:"w-5 h-5 text-green-600"})," Cantidad por Acción"]}),e.jsx(q,{width:"100%",height:300,children:e.jsxs(Ee,{data:X,margin:{top:10,right:10,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",strokeOpacity:.2}),e.jsx(de,{dataKey:"name"}),e.jsx(me,{}),e.jsx(G,{contentStyle:{background:"#1f2937",color:"#fff",borderRadius:"8px"}}),e.jsx(pe,{}),X.map((u,F)=>e.jsx(Me,{dataKey:"count",fill:_e[u.name.toLowerCase()]||_e.azul,name:u.name,radius:[6,6,0,0]},F))]})})]}),e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md ${Te}`,children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Es,{className:"w-5 h-5 text-purple-600"})," Evolución en el Tiempo"]}),e.jsx(q,{width:"100%",height:300,children:e.jsxs(ua,{data:ue,children:[e.jsx(ke,{strokeDasharray:"3 3",strokeOpacity:.2}),e.jsx(de,{dataKey:"fecha"}),e.jsx(me,{}),e.jsx(G,{contentStyle:{background:"#1f2937",color:"#fff",borderRadius:"8px"}}),e.jsx(pe,{}),e.jsx(ha,{type:"monotone",dataKey:"count",stroke:_e.morado,strokeWidth:3,dot:{r:5,strokeWidth:2,fill:_e.morado},activeDot:{r:8}})]})})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(Dr,{filtroUsuario:i,setFiltroUsuario:p,filtroTipo:g,setFiltroTipo:j,filtroFechaInicio:x,setFiltroFechaInicio:m,filtroFechaFin:y,setFiltroFechaFin:h})}),l&&e.jsx("div",{className:`mb-4 p-3 bg-red-100 text-red-700 rounded ${Or}`,children:l}),s&&e.jsx("p",{children:"Cargando actividades..."}),!s&&e.jsx("div",{className:Te,children:e.jsx(Er,{actividades:O,abrirModal:A})}),n&&d&&e.jsx(Rr,{actividad:d,cerrarModal:C})]})}function Tr({isOpen:a,onClose:t,onGuardar:s}){const[r,l]=o.useState(""),[c,n]=o.useState(""),[f,d]=o.useState(""),[b,i]=o.useState(""),[p,g]=o.useState([{cantidad:1,descripcion:""}]),j=()=>g([...p,{cantidad:1,descripcion:""}]),x=h=>g(p.filter((N,S)=>S!==h)),m=(h,N,S)=>{const w=[...p];w[h][N]=N==="cantidad"?Number(S):S,g(w)},y=()=>{if(!r||!c||!f){alert("Por favor, completa los campos obligatorios.");return}const h={origen:r,destino:c,responsable:f,observaciones:b,items:p,estado:"Pendiente",fecha:new Date().toISOString()};s(h),t(),l(""),n(""),d(""),i(""),g([{cantidad:1,descripcion:""}])};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 relative",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"📦 Crear Nueva Guía"}),e.jsxs("div",{className:"flex flex-col gap-3 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Origen *",className:"border rounded p-2",value:r,onChange:h=>l(h.target.value)}),e.jsx("input",{type:"text",placeholder:"Destino *",className:"border rounded p-2",value:c,onChange:h=>n(h.target.value)}),e.jsx("input",{type:"text",placeholder:"Responsable *",className:"border rounded p-2",value:f,onChange:h=>d(h.target.value)}),e.jsx("textarea",{placeholder:"Observaciones (opcional)",className:"border rounded p-2",value:b,onChange:h=>i(h.target.value)})]}),e.jsx("h3",{className:"font-semibold mb-2",children:"Ítems de la Guía"}),e.jsx("div",{className:"overflow-x-auto mb-4",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Cantidad"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Descripción"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Acciones"})]})}),e.jsx("tbody",{children:p.map((h,N)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx("input",{type:"number",min:1,className:"border rounded p-1 w-full",value:h.cantidad,onChange:S=>m(N,"cantidad",S.target.value)})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx("input",{type:"text",className:"border rounded p-1 w-full",value:h.descripcion,onChange:S=>m(N,"descripcion",S.target.value)})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center",children:e.jsx("button",{onClick:()=>x(N),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition",children:"Eliminar"})})]},N))})]})}),e.jsx("button",{onClick:j,className:"mb-4 bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition",children:"+ Agregar Ítem"}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:t,className:"bg-gray-400 text-gray-800 px-4 py-2 rounded hover:bg-gray-500 transition",children:"Cancelar"}),e.jsx("button",{onClick:y,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Guardar Guía"})]})]})}):null}function Lr({isOpen:a,onClose:t,guia:s}){var r;return!a||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 relative",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Detalle de Guía #",s.numero??"-"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Fecha:"}),e.jsx("p",{children:new Date(s.fecha).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Responsable:"}),e.jsx("p",{children:s.responsable})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Origen:"}),e.jsx("p",{children:s.origen})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Destino:"}),e.jsx("p",{children:s.destino})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"font-semibold",children:"Observaciones:"}),e.jsx("p",{children:s.observaciones||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Estado:"}),e.jsx("span",{className:`px-2 py-1 rounded font-semibold ${s.estado==="Pendiente"?"bg-yellow-200 text-yellow-800":s.estado==="Enviada"?"bg-blue-200 text-blue-800":s.estado==="Recibida"?"bg-green-200 text-green-800":"bg-gray-200 text-gray-800"}`,children:s.estado})]})]}),e.jsx("h3",{className:"font-semibold mb-2",children:"Ítems de la Guía"}),e.jsx("div",{className:"overflow-x-auto mb-4",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Cantidad"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Descripción"})]})}),e.jsx("tbody",{children:((r=s.items)==null?void 0:r.length)>0?s.items.map((l,c)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:l.cantidad}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:l.descripcion})]},c)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-4",children:"No hay ítems registrados."})})})]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:t,className:"bg-gray-400 text-gray-800 px-4 py-2 rounded hover:bg-gray-500 transition",children:"Cerrar"}),e.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Imprimir / PDF"})]})]})})}const Ls={Pendiente:"bg-yellow-200 text-yellow-800 dark:bg-yellow-700/40 dark:text-yellow-200",Enviada:"bg-blue-200 text-blue-800 dark:bg-blue-700/40 dark:text-blue-200",Recibida:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Otro:"bg-gray-200 text-gray-800 dark:bg-gray-700/40 dark:text-gray-200"},zr="transition-all duration-300 hover:shadow-lg hover:scale-[1.02] hover:bg-gray-50 dark:hover:bg-gray-700/40";function $r({guias:a,abrirDetalle:t}){const[s,r]=o.useState(""),[l,c]=o.useState(""),[n,f]=o.useState("fecha"),[d,b]=o.useState("desc"),i=g=>{n===g?b(d==="asc"?"desc":"asc"):(f(g),b("asc"))},p=o.useMemo(()=>a.filter(g=>{const j=s?g.responsable.toLowerCase().includes(s.toLowerCase()):!0,x=l?g.estado.toLowerCase().includes(l.toLowerCase()):!0;return j&&x}).sort((g,j)=>{if(n==="fecha")return d==="asc"?new Date(g.fecha)-new Date(j.fecha):new Date(j.fecha)-new Date(g.fecha);{const x=(g[n]??"").toString().toLowerCase(),m=(j[n]??"").toString().toLowerCase();return x<m?d==="asc"?-1:1:x>m?d==="asc"?1:-1:0}}),[a,s,l,n,d]);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(vt,{size:18}),"Guías de Salida"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Total: ",a.length]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4 items-end",children:[e.jsx("input",{type:"text",placeholder:"Filtrar por responsable",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:s,onChange:g=>r(g.target.value)}),e.jsx("input",{type:"text",placeholder:"Filtrar por estado",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:l,onChange:g=>c(g.target.value)}),e.jsx("button",{onClick:()=>{r(""),c("")},className:"bg-gradient-to-r from-indigo-400 to-indigo-500 hover:from-indigo-500 hover:to-indigo-600 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition",children:"Limpiar filtros"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-100 text-left",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 cursor-pointer",onClick:()=>i("numero"),children:"N°"}),e.jsx("th",{className:"px-4 py-3 cursor-pointer",onClick:()=>i("fecha"),children:"Fecha"}),e.jsx("th",{className:"px-4 py-3",children:"Origen → Destino"}),e.jsx("th",{className:"px-4 py-3 cursor-pointer",onClick:()=>i("responsable"),children:"Responsable"}),e.jsx("th",{className:"px-4 py-3",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Detalle"})]})}),e.jsxs("tbody",{children:[p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-10 text-center text-gray-500 dark:text-gray-400",children:"No hay guías registradas por ahora."})}),p.map(g=>e.jsxs(I.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:`border-t border-gray-100 dark:border-gray-700 ${zr}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:g.numero??"-"}),e.jsx("td",{className:"px-4 py-3",children:new Date(g.fecha).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3",children:[g.origen," → ",g.destino]}),e.jsx("td",{className:"px-4 py-3",children:g.responsable}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ls[g.estado]||Ls.Otro}`,children:g.estado})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{onClick:()=>t(g),className:"bg-gradient-to-r from-indigo-400 to-indigo-500 hover:from-indigo-500 hover:to-indigo-600 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition flex items-center gap-2 justify-center transform hover:scale-[1.05]",children:[e.jsx(ge,{size:16}),"Ver detalle"]})})]},g.numero))]})]})})]})}const He={Pendiente:"#f59e0b",Enviada:"#3b82f6",Recibida:"#10b981"},Ir={Pendiente:rs,Enviada:pa,Recibida:os},ms="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center",De="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center";function qr(){const[a,t]=o.useState([]),[s,r]=o.useState(!1),[l,c]=o.useState(null),[n,f]=o.useState(!1),[d,b]=o.useState(null),[i,p]=o.useState(!1),[g,j]=o.useState(""),[x,m]=o.useState(""),[y,h]=o.useState(""),[N,S]=o.useState("");o.useEffect(()=>{w()},[]);const w=async()=>{r(!0),c(null);try{let _=[];As&&(_=[{id:1,fecha:"2025-08-14T08:00:00",origen:"Almacén A",destino:"Sucursal 1",responsable:"Juan",estado:"Pendiente",items:[{cantidad:10,descripcion:"Formularios"}]},{id:2,fecha:"2025-08-14T09:30:00",origen:"Almacén B",destino:"Sucursal 2",responsable:"Maria",estado:"Enviada",items:[{cantidad:5,descripcion:"Cartuchos"}]},{id:3,fecha:"2025-08-14T10:15:00",origen:"Almacén A",destino:"Sucursal 3",responsable:"Carlos",estado:"Recibida",items:[{cantidad:3,descripcion:"Documentos"}]}]),t(_)}catch(_){console.error(_),c("Error cargando guías de salida.")}finally{r(!1)}},k=_=>{b(_),f(!0)},R=()=>{f(!1),b(null)},A=o.useMemo(()=>a.filter(_=>{var X,ue;const v=g?(X=_.responsable)==null?void 0:X.toLowerCase().includes(g.toLowerCase()):!0,D=x?(ue=_.estado)==null?void 0:ue.toLowerCase().includes(x.toLowerCase()):!0,$=new Date(_.fecha),L=y?$>=new Date(y):!0,H=N?$<=new Date(N):!0;return v&&D&&L&&H}),[a,g,x,y,N]),C=A.length,O=A.reduce((_,v)=>(_[v.estado]=(_[v.estado]||0)+1,_),{}),K=Object.entries(O).map(([_,v])=>({name:_,value:v})),T=Object.entries(O).map(([_,v])=>({name:_,count:v}));return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(pa,{})," Guías de Salida"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 text-center",children:[e.jsxs("div",{className:`${De} flex flex-col items-center justify-center text-white p-4 rounded-xl`,style:{background:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)"},children:[e.jsx(Ce,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm",children:"Total Guías"}),e.jsx("p",{className:"text-2xl font-bold",children:e.jsx(Fe,{end:C,duration:1.2,separator:","})})]}),K.map(_=>{const v=Ir[_.name]||fe;return e.jsxs("div",{className:`${De} flex flex-col items-center justify-center text-white p-4 rounded-xl`,style:{background:`linear-gradient(135deg, ${He[_.name]||"#6b7280"}cc, ${He[_.name]||"#6b7280"}99)`},children:[e.jsx(v,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm",children:_.name}),e.jsx("p",{className:"text-2xl font-bold",children:e.jsx(Fe,{end:_.value,duration:1.2,separator:","})})]},_.name)})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:`${ms} ${De}`,children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(fe,{size:18})," Distribución por Estado"]}),e.jsx(q,{width:"100%",height:250,children:e.jsxs(ve,{children:[e.jsx(Pe,{data:K,dataKey:"value",nameKey:"name",outerRadius:80,label:!0,isAnimationActive:!0,children:K.map(_=>e.jsx(te,{fill:He[_.name]||"#6b7280"},_.name))}),e.jsx(G,{}),e.jsx(pe,{})]})})]}),e.jsxs("div",{className:`${ms} ${De}`,children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Oe,{size:18})," Cantidad por Estado"]}),e.jsx(q,{width:"100%",height:250,children:e.jsxs(Ee,{data:T,margin:{top:10,right:20,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name"}),e.jsx(me,{}),e.jsx(G,{}),e.jsx(pe,{}),T.map(_=>e.jsx(Me,{dataKey:"count",data:[_],fill:He[_.name]||"#6b7280"},_.name))]})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>p(!0),className:`${De} flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-5 py-2 rounded-xl shadow hover:from-indigo-600 hover:to-indigo-700 transition`,children:[e.jsx(Ys,{size:18})," Crear Guía"]})}),e.jsxs("div",{className:`${ms} ${De} flex flex-wrap gap-4 items-end`,children:[e.jsxs("div",{className:"flex flex-col flex-1 min-w-[180px]",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(ts,{size:16})," Responsable"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por responsable",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:g,onChange:_=>j(_.target.value)})]}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-[180px]",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(Y,{size:16})," Estado"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por estado",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:x,onChange:_=>m(_.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(be,{size:16})," Fecha Inicio"]}),e.jsx("input",{type:"date",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:y,onChange:_=>h(_.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(be,{size:16})," Fecha Fin"]}),e.jsx("input",{type:"date",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:N,onChange:_=>S(_.target.value)})]}),e.jsxs("button",{onClick:()=>{j(""),m(""),h(""),S("")},className:"flex items-center gap-2 bg-gradient-to-r from-gray-400 to-gray-500 text-white px-4 py-2 rounded-lg shadow hover:from-gray-500 hover:to-gray-600 transition",children:[e.jsx(vs,{size:16})," Limpiar"]})]}),l&&e.jsx("div",{className:"p-3 bg-red-100 text-red-700 rounded",children:l}),s?e.jsx("p",{children:"Cargando guías..."}):e.jsx($r,{guias:A,abrirDetalle:k}),e.jsx(Lr,{guia:d,isOpen:n,onClose:R}),e.jsx(Tr,{isOpen:i,onClose:()=>p(!1),onSave:_=>t(v=>[_,...v])})]})}function Br({filtros:a={},setFiltros:t,data:s=[]}){const[r,l]=o.useState({fechaInicio:a.fechaInicio||"",fechaFin:a.fechaFin||"",categoria:a.categoria||"",responsable:a.responsable||""}),[c,n]=o.useState([]);o.useEffect(()=>{const d=[...new Set(s.map(b=>b.responsable))];n(d)},[s]);const f=()=>{t(r)};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-md mb-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4 items-end",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(be,{className:"mr-2",size:16})," Fecha Inicio"]}),e.jsx("input",{type:"date",value:r.fechaInicio,onChange:d=>l({...r,fechaInicio:d.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(be,{className:"mr-2",size:16})," Fecha Fin"]}),e.jsx("input",{type:"date",value:r.fechaFin,onChange:d=>l({...r,fechaFin:d.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(Ns,{className:"mr-2",size:16})," Categoría"]}),e.jsxs("select",{value:r.categoria,onChange:d=>l({...r,categoria:d.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"Transporte",children:"Transporte"}),e.jsx("option",{value:"Alimentación",children:"Alimentación"}),e.jsx("option",{value:"Oficina",children:"Oficina"}),e.jsx("option",{value:"Hospedaje",children:"Hospedaje"}),e.jsx("option",{value:"Otros",children:"Otros"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(ws,{className:"mr-2",size:16})," Responsable"]}),e.jsxs("select",{value:r.responsable,onChange:d=>l({...r,responsable:d.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",children:[e.jsx("option",{value:"",children:"Todos"}),c.map((d,b)=>e.jsx("option",{value:d,children:d},b))]})]}),e.jsx("div",{className:"flex items-center justify-start",children:e.jsxs("button",{onClick:f,className:"flex items-center gap-2 bg-gradient-to-r from-gray-400 to-gray-500 text-white px-4 py-2 rounded-lg shadow hover:from-gray-500 hover:to-gray-600 transition",children:[e.jsx(vs,{size:16})," Filtrar"]})})]})}const zs=["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ef4444"];function Gr({data:a}){const t=a.length>5?10:12;return e.jsxs(I.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(fe,{size:18})," Gastos por Categoría"]}),e.jsx(q,{width:"100%",height:"85%",children:e.jsxs(ve,{children:[e.jsx(Pe,{data:a,dataKey:"monto",nameKey:"categoria",cx:"50%",cy:"50%",outerRadius:100,label:{fontSize:t},children:a.map((s,r)=>e.jsx(te,{fill:zs[r%zs.length]},r))}),e.jsx(G,{formatter:s=>`S/ ${s}`}),e.jsx(pe,{})]})})]})}function Ur({data:a}){const t=a.length>8?-30:0,s=a.length>12?10:12,r=a.length>12?Math.max(8,60-a.length*2):50;return e.jsxs(I.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(Oe,{size:18})," Comparativa Mensual"]}),e.jsx(q,{width:"100%",height:"90%",children:e.jsxs(Ee,{data:a,margin:{top:10,right:20,left:0,bottom:10},children:[e.jsx(de,{dataKey:"mes",stroke:"#374151",tick:{fontSize:s,fontWeight:"bold",angle:t,textAnchor:t!==0?"end":"middle"}}),e.jsx(me,{stroke:"#374151",tick:{fontWeight:"bold"}}),e.jsx(G,{formatter:l=>`S/ ${l.toLocaleString()}`}),e.jsx(pe,{}),e.jsx(Me,{dataKey:"gastos",fill:"#3b82f6",barSize:r})]})})]})}function Kr({data:a}){return e.jsxs(I.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(as,{size:18})," Tendencia de Gastos"]}),e.jsx(q,{width:"100%",height:"90%",children:e.jsxs(ua,{data:a,children:[e.jsx(de,{dataKey:"mes",stroke:"#374151",tick:{fontWeight:"bold"}}),e.jsx(me,{stroke:"#374151",tick:{fontWeight:"bold"}}),e.jsx(G,{formatter:t=>`S/ ${t.toLocaleString()}`}),e.jsx(pe,{}),e.jsx(ha,{type:"monotone",dataKey:"gastos",stroke:"#10b981",strokeWidth:2})]})})]})}ga.register(Nt,fa,ba);function Hr({data:a}){const t={labels:a.map(r=>r.categoria),datasets:[{label:"Gastos por Categoría",data:a.map(r=>r.monto),backgroundColor:["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ef4444"],borderColor:"#ffffff",borderWidth:2}]},s={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:"#374151"}},tooltip:{callbacks:{label:r=>`S/ ${r.raw}`}}},animation:{animateScale:!0,animateRotate:!0}};return e.jsxs(I.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(fe,{size:18})," Top Categorías de Gasto"]}),e.jsx("div",{className:"w-full h-[90%]",children:e.jsx(wt,{data:t,options:s})})]})}ga.register(St,Ct,kt,At,fa,ba);function Vr({data:a}){const t={labels:a.map(r=>r.responsable),datasets:[{label:"Gasto por Responsable",data:a.map(r=>r.monto),backgroundColor:"#3b82f6",borderColor:"#3b82f6",borderWidth:1,hoverBackgroundColor:"#2563eb",hoverBorderColor:"#2563eb"}]},s={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{color:"#374151",font:{weight:"bold"}}},tooltip:{callbacks:{label:r=>`S/ ${r.raw.toLocaleString()}`}}},scales:{x:{ticks:{color:"#374151",font:{weight:"bold"}},grid:{display:!1}},y:{beginAtZero:!0,ticks:{color:"#374151",font:{weight:"bold"}},grid:{color:"rgba(229,231,235,0.5)"}}},animation:{duration:1e3,easing:"easeOutQuart"}};return e.jsxs(I.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(Oe,{size:18})," Gasto por Responsable"]}),e.jsx("div",{className:"w-full h-[90%]",children:e.jsx(_t,{data:t,options:s})})]})}const $s={categorias:{Transporte:"bg-blue-200 text-blue-800 dark:bg-blue-700/40 dark:text-blue-200",Alimentación:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Oficina:"bg-indigo-200 text-indigo-800 dark:bg-indigo-700/40 dark:text-indigo-200",Hospedaje:"bg-purple-200 text-purple-800 dark:bg-purple-700/40 dark:text-purple-200",Otros:"bg-gray-200 text-gray-800 dark:bg-gray-700/40 dark:text-gray-200"}};function Wr({data:a=[],abrirModal:t}){return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 overflow-x-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(Y,{size:18}),"Detalle de Reportes"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Total: ",a.length]})]}),e.jsxs("table",{className:"min-w-full table-auto rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-100 text-center",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"#"}),e.jsx("th",{className:"px-4 py-3",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3",children:"Categoría"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3",children:"Monto"})]})}),e.jsxs("tbody",{children:[a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-10 text-center text-gray-500 dark:text-gray-400",children:"No hay registros disponibles."})}),a.map((s,r)=>{var l;return e.jsxs(I.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"border-t border-gray-100 dark:border-gray-700 hover:shadow-lg hover:translate-y-[-2px] hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-transform duration-200",children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:r+1}),e.jsx("td",{className:"px-4 py-3",children:s.fecha??"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${$s.categorias[s.categoria]??$s.categorias.Otros}`,children:s.categoria??"-"})}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:s.descripcion??"-"}),e.jsxs("td",{className:"px-4 py-3 font-semibold",children:["S/ ",((l=s.monto)==null?void 0:l.toFixed(2))??"0.00"]})]},s.id??r)})]})]})]})}function Jr(){const a=()=>window.open("/api/reportes/exportar_excel/","_blank"),t=()=>window.open("/api/reportes/exportar_pdf/","_blank");return e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsxs("button",{onClick:a,className:"px-4 py-2 bg-gradient-to-r from-green-400 to-green-500 hover:from-green-500 hover:to-green-600 text-white rounded-lg flex items-center gap-2 shadow-md transition transform hover:scale-[1.05]",children:[e.jsx(Ms,{size:18})," Exportar Excel"]}),e.jsxs("button",{onClick:t,className:"px-4 py-2 bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white rounded-lg flex items-center gap-2 shadow-md transition transform hover:scale-[1.05]",children:[e.jsx(Ms,{size:18})," Exportar PDF"]})]})}function Yr(){const[a,t]=o.useState({fechaInicio:"",fechaFin:"",categoria:"todas",rango:"mensual"}),[s,r]=o.useState({gastosPorCategoria:[],comparativoMensual:[],tendencias:[],tabla:[]}),l=async()=>{try{As&&r({gastosPorCategoria:[{categoria:"Transporte",monto:1200},{categoria:"Alimentación",monto:2e3},{categoria:"Oficina",monto:800}],comparativoMensual:[{mes:"Enero",gastos:1200},{mes:"Febrero",gastos:1600},{mes:"Marzo",gastos:1400}],tendencias:[{mes:"Enero",gastos:200},{mes:"Febrero",gastos:350},{mes:"Marzo",gastos:400}],tabla:[{id:1,fecha:"2025-01-10",categoria:"Transporte",descripcion:"Taxi",monto:300,responsable:"Juan"},{id:2,fecha:"2025-02-12",categoria:"Alimentación",descripcion:"Comida",monto:500,responsable:"Ana"},{id:3,fecha:"2025-03-15",categoria:"Oficina",descripcion:"Papelería",monto:800,responsable:"Luis"}]})}catch(x){console.error("Error cargando datos de reportes:",x)}};o.useEffect(()=>{l()},[a]);const c=s.tabla.reduce((x,m)=>x+m.monto,0),n=s.tabla.length?(c/3).toFixed(2):0,f=s.tabla.length?Math.max(...s.tabla.map(x=>x.monto)):0,d=s.tabla.length,b=new Set(s.tabla.map(x=>x.responsable)).size,i=1500,p=c-i,g=(p/i*100).toFixed(1),j="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center";return e.jsxs("div",{className:"p-4 md:p-6 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Oe,{size:25,className:"text-gray-800"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Estadísticas y Reportes"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 md:gap-6 mb-6",children:[{label:"Total Gastos",value:c,icon:ae,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",tooltip:"Suma total de todos los gastos registrados"},{label:"Promedio Mensual",value:n,icon:as,gradient:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)",tooltip:"Gasto promedio mensual"},{label:"Mayor Gasto",value:f,icon:fe,gradient:"linear-gradient(135deg, #8b5cf6cc, #a78bfa99)",tooltip:"Registro de gasto individual más alto"},{label:"Transacciones",value:d,icon:Y,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",tooltip:"Número total de transacciones"},{label:"Responsables",value:b,icon:ws,gradient:"linear-gradient(135deg, #facc15cc, #fcd34d99)",tooltip:"Cantidad de personas responsables"},{label:"Crecimiento Mensual",value:p,icon:p>=0?Dt:Ft,gradient:"linear-gradient(135deg, #f97316cc, #fb923c99)",tooltip:`Cambio respecto al mes anterior: ${g}%`,positive:p>=0}].map(x=>{const m=x.icon,y=x.positive??!0;return e.jsxs("div",{className:j,style:{background:x.gradient},children:[e.jsx(m,{size:28,className:"text-white mb-2"}),e.jsxs("p",{className:"text-sm text-white opacity-90 flex items-center justify-center gap-1",children:[x.label,e.jsx(Qs,{content:x.tooltip,children:e.jsx(Ye,{size:16,className:"text-white opacity-70"})})]}),e.jsx("p",{className:`text-2xl font-bold text-white ${x.label==="Crecimiento Mensual"?y?"text-green-400":"text-red-400":""}`,children:e.jsx(Fe,{end:x.value,duration:1.5,separator:",",decimals:2,decimal:"."})})]},x.label)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6",children:[e.jsx("div",{className:j,children:e.jsx(Gr,{data:s.gastosPorCategoria})}),e.jsx("div",{className:j,children:e.jsx(Ur,{data:s.comparativoMensual})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6",children:[e.jsx("div",{className:j,children:e.jsx(Hr,{data:s.gastosPorCategoria})}),e.jsx("div",{className:j,children:e.jsx(Vr,{data:s.tabla})})]}),e.jsx("div",{className:`${j} mb-6`,children:e.jsx(Kr,{data:s.tendencias})}),e.jsx("div",{className:`${j} mb-6 bg-gray-100 dark:bg-gray-700/50`,children:e.jsx(Br,{filtros:a,setFiltros:t,data:s.tabla})}),e.jsx("div",{className:`${j} mb-6`,children:e.jsx(Wr,{data:s.tabla})}),e.jsx("div",{className:`${j} mb-6`,children:e.jsx(Jr,{})})]})}function Qr(){return e.jsx(Et,{children:e.jsxs(va,{children:[e.jsx(Mt,{position:"top-right",autoClose:3e3}),e.jsxs(Rt,{children:[e.jsx(z,{path:"/login",element:e.jsx(Tt,{})}),e.jsx(z,{path:"/register",element:e.jsx(It,{})}),e.jsxs(z,{path:"/dashboard/*",element:e.jsx(Pt,{children:e.jsx(Ut,{})}),children:[e.jsx(z,{index:!0,element:e.jsx(nr,{})}),e.jsx(z,{path:"gastos/programacion",element:e.jsx(ur,{})}),e.jsx(z,{path:"liquidaciones",element:e.jsx(Os,{})}),e.jsx(z,{path:"liquidaciones/solicitud",element:e.jsx(fr,{})}),e.jsx(z,{path:"liquidaciones/solicitud/nueva",element:e.jsx(Aa,{})}),e.jsx(z,{path:"liquidaciones/solicitud/mis-solicitudes",element:e.jsx(Fa,{})}),e.jsx(z,{path:"solicitudes/:nro_solicitud",element:e.jsx(Da,{})}),e.jsx(z,{path:"atencion-solicitudes",element:e.jsx(jr,{})}),e.jsx(z,{path:"liquidaciones/presentar",element:e.jsx(wr,{})}),e.jsx(z,{path:"liquidaciones/presentar/:id",element:e.jsx(Ma,{})}),e.jsx(z,{path:"liquidaciones/solicitud/:id/documento",element:e.jsx(Ea,{})}),e.jsx(z,{path:"gastos/aprobacion-liquidacion",element:e.jsx(_r,{})}),e.jsx(z,{path:"movimientos/arqueo",element:e.jsx(Os,{})}),e.jsx(z,{path:"registros/actividades",element:e.jsx(Pr,{})}),e.jsx(z,{path:"registros/guias-salida",element:e.jsx(qr,{})}),e.jsx(z,{path:"reportes",element:e.jsx(Yr,{})})]}),e.jsx(z,{path:"/",element:e.jsx(xs,{to:"/dashboard",replace:!0})}),e.jsx(z,{path:"*",element:e.jsx(xs,{to:"/dashboard",replace:!0})})]})]})})}Ot.createRoot(document.getElementById("root")).render(e.jsx(hs.StrictMode,{children:e.jsx(va,{children:e.jsx(Qr,{})})}));
