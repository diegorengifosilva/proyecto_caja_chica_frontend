import{a as ea,r as o,j as e,N as xa,O as za,u as ze,E as ua,b as ge,L as Os,F as We,c as $a,d as Ia,e as qa,W as Je,C as Se,f as Y,g as Ee,U as Ps,S as Ts,h as Ls,X as $e,M as zs,i as $s,t as Is,k as qs,l as Ba,P as Bs,m as Ga,n as Gs,T as Ua,D as Ka,R as Us,o as Ks,p as Ha,q as Va,A as ba,s as I,_ as De,v as ye,w as q,x as Oe,y as te,z as G,B as pe,G as Wa,H as Hs,I as aa,J as Ja,K as Ye,Q as Vs,V as Ya,Y as Qa,Z,$ as ha,a0 as Xa,a1 as se,a2 as fe,a3 as Qe,a4 as Xe,a5 as ka,a6 as Za,a7 as Ws,a8 as Js,a9 as pa,aa as es,ab as be,ac as Ys,ad as Qs,ae as ja,af as Xs,ag as Zs,ah as as,ai as et,aj as ss,ak as at,al as Aa,am as ts,an as rs,ao as os,ap as st,aq as tt,ar as ns,as as rt,at as ls,au as Ce,av as de,aw as me,ax as is,ay as sa,az as ta,aA as ya,aB as cs,aC as ds,aD as ms,aE as ot,aF as xs,aG as nt,aH as ra,aI as oa,aJ as _a,aK as lt,aL as it,aM as ct,aN as dt,aO as Fe,aP as Me,aQ as mt,aR as xt,aS as ut,aT as ht,aU as pt,aV as gt,aW as ft,aX as bt,aY as Da,aZ as va,a_ as jt,a$ as us,b0 as hs,b1 as yt,b2 as ps,b3 as gs,b4 as vt,b5 as fs,b6 as bs,b7 as Nt,b8 as wt,b9 as St,ba as Ct,bb as kt,bc as At,bd as Fa,be as _t,bf as Dt,bg as Ft,bh as Mt,bi as Rt,bj as z,bk as Et}from"./vendor-D_d-ihaK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function a(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(l){if(l.ep)return;l.ep=!0;const i=a(l);fetch(l.href,i)}})();const js="https://proyecto-caja-chica-api.onrender.com/api/",P=ea.create({baseURL:js,withCredentials:!1,headers:{"Content-Type":"application/json",Accept:"application/json"}});P.interceptors.request.use(s=>{const t=localStorage.getItem("access_token");return t&&(s.headers.Authorization=`Bearer ${t}`),s},s=>Promise.reject(s));P.interceptors.response.use(s=>s,async s=>{var a;const t=s.config;if(((a=s.response)==null?void 0:a.status)===401&&!t._retry){t._retry=!0;const r=localStorage.getItem("refresh_token");if(!r)return localStorage.clear(),window.location.href="/login",Promise.reject(s);try{const i=(await ea.post(`${js}token/refresh/`,{refresh:r})).data.access;return localStorage.setItem("access_token",i),P.defaults.headers.common.Authorization=`Bearer ${i}`,t.headers.Authorization=`Bearer ${i}`,P(t)}catch(l){return localStorage.clear(),window.location.href="/login",Promise.reject(l)}}return Promise.reject(s)});const ys=o.createContext(),vs=({children:s})=>{const[t,a]=o.useState(null),[r,l]=o.useState(!0),i=async()=>{var v,p;try{const b=await P.get("usuarios/actual/");a(b.data),localStorage.setItem("auth_user",JSON.stringify(b.data))}catch(b){console.error("❌ No se pudo obtener usuario actual:",(v=b.response)==null?void 0:v.status,b),((p=b.response)==null?void 0:p.status)===401?f():a(null)}finally{l(!1)}};o.useEffect(()=>{const v=localStorage.getItem("access_token"),p=localStorage.getItem("auth_user");if(v){if(P.defaults.headers.common.Authorization=`Bearer ${v}`,p)try{a(JSON.parse(p))}catch{f();return}i()}else l(!1)},[]);const n=async({email:v,password:p})=>{try{const b=await P.post("login/",{email:v,password:p}),{access:g,refresh:j,user:x}=b.data;return localStorage.setItem("access_token",g),localStorage.setItem("refresh_token",j),localStorage.setItem("auth_user",JSON.stringify(x)),P.defaults.headers.common.Authorization=`Bearer ${g}`,a(x),{success:!0}}catch(b){return console.error("Error de inicio de sesión:",b),{success:!1,message:"Credenciales inválidas o servidor no disponible"}}},f=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("auth_user"),delete P.defaults.headers.common.Authorization,a(null),window.location.href="/login"},c=async()=>{try{const v=localStorage.getItem("refresh_token");if(!v)throw new Error("No refresh token");const p=await P.post("token/refresh/",{refresh:v}),{access:b}=p.data;localStorage.setItem("access_token",b),P.defaults.headers.common.Authorization=`Bearer ${b}`,await i()}catch(v){console.error("Error al refrescar token:",v),f()}};return e.jsx(ys.Provider,{value:{authUser:t,setAuthUser:a,login:n,logout:f,refreshToken:c,loading:r},children:s})},oe=()=>o.useContext(ys),Ot=({children:s})=>{const{authUser:t,loading:a}=oe();return a?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"Validando sesión..."})}):t?s??e.jsx(za,{}):e.jsx(xa,{to:"/login",replace:!0})},Na=""+new URL("logo-DoccodYy.png",import.meta.url).href,Ns=""+new URL("Fondo-CcBCqOiu.jpg",import.meta.url).href;function Pt(){const{login:s}=oe(),t=ze(),[a,r]=o.useState({email:"",password:""}),[l,i]=o.useState(!1),[n,f]=o.useState(!1),[c,v]=o.useState(""),p=j=>{r({...a,[j.target.name]:j.target.value})},b=j=>/\S+@\S+\.\S+/.test(j),g=async j=>{var x,d;if(j.preventDefault(),v(""),!b(a.email)){v("Ingrese un correo válido.");return}f(!0);try{await s(a),t("/dashboard")}catch(m){const h=((d=(x=m.response)==null?void 0:x.data)==null?void 0:d.detail)??"Credenciales inválidas. Inténtalo nuevamente.";v(Array.isArray(h)?h[0]:h)}finally{f(!1)}};return e.jsxs("div",{className:"w-full min-h-screen bg-cover bg-center bg-fixed flex items-center justify-center px-4 sm:px-6 md:px-10",style:{backgroundImage:`url(${Ns})`},children:[e.jsxs("div",{className:"relative z-10 p-6 sm:p-8 w-full max-w-3xl bg-white/60 backdrop-blur-min rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx("img",{src:Na,alt:"Logo",className:"w-32 sm:w-40 h-auto mb-2"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 text-center",children:"Iniciar Sesión"}),c&&e.jsx("div",{className:"mt-3 text-sm text-red-700 bg-red-50 border border-red-100 px-3 py-2 rounded-md w-full text-center",children:c})]}),e.jsxs("form",{onSubmit:g,className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"text-xs font-medium text-gray-600 sr-only",children:"Correo electrónico"}),e.jsx("input",{id:"email",name:"email",type:"email",placeholder:"Correo electrónico",value:a.email,onChange:p,className:`w-full px-4 py-2 rounded-xl text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${a.email&&!b(a.email)?"border-red-500":"border-gray-300"}`,autoComplete:"email","aria-label":"Correo electrónico"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"password",className:"text-xs font-medium text-gray-600 sr-only",children:"Contraseña"}),e.jsx("input",{id:"password",name:"password",type:l?"text":"password",placeholder:"Contraseña",value:a.password,onChange:p,className:"w-full px-4 py-2 pr-10 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"current-password","aria-label":"Contraseña"}),e.jsx("button",{type:"button",onClick:()=>i(!l),"aria-label":l?"Ocultar contraseña":"Mostrar contraseña",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-600",children:l?e.jsx(ua,{size:18}):e.jsx(ge,{size:18})})]}),e.jsx("button",{type:"submit",disabled:n,className:`w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-4 rounded-xl transition ${n?"cursor-not-allowed opacity-70":""}`,children:n?"Ingresando...":"Iniciar Sesión"})]}),e.jsxs("p",{className:"text-sm text-gray-700 mt-6 text-center",children:["¿No tienes una cuenta?"," ",e.jsx("span",{className:"text-teal-700 font-semibold hover:underline cursor-pointer",onClick:()=>t("/register"),children:"Regístrate aquí"})]})]}),e.jsx("div",{className:"absolute bottom-4 text-center text-sm text-white w-full z-10 px-4",children:"© 2025 Producto desarrollado por V&C Corporation SAC"})]})}const Tt=["Gerencia General","Industria","Minería","Mantenimiento","Petroquímica","Administración","Contabilidad","Tecnología de la Información","Logística - Almacén","Recursos Humanos","Comercial","SIG. HSEQ","Seguridad de Maquinaria","Comité CSSO"],Lt=["Administrador","Jefe de Proyecto","Colaborador"],zt=["Perú","Argentina","Colombia","Chile"];function $t(){const s=ze(),{register:t,login:a}=oe(),[r,l]=o.useState({nombre:"",apellido:"",email:"",edad:"",empresa:"",pais:"",rol:"",area:"",password:"",confirmarPassword:""}),[i,n]=o.useState(!1),[f,c]=o.useState(!1),[v,p]=o.useState(!1),[b,g]=o.useState(""),j=m=>{l({...r,[m.target.name]:m.target.value})},x=m=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m),d=async m=>{var D,N;m.preventDefault(),g(""),n(!0);const{nombre:h,apellido:y,email:w,edad:S,empresa:C,pais:E,rol:_,area:k,password:O,confirmarPassword:K}=r;if(!h||!y||!w||!S||!E||!_||!k||!O||!K){g("Por favor completa todos los campos obligatorios."),n(!1);return}if(!x(w)){g("Correo electrónico inválido."),n(!1);return}if(Number(S)<=0||isNaN(Number(S))){g("La edad debe ser un número válido mayor que 0."),n(!1);return}if(O!==K){g("Las contraseñas no coinciden."),n(!1);return}const T={nombre:h,apellido:y,email:w,edad:Number(S),empresa:C,pais:E,rol:_,area:k,password:O};try{const A=await t(T);if(!A||A.success===!1){const L=(A==null?void 0:A.message)||(A==null?void 0:A.error)||"No se pudo registrar el usuario.";g(L),n(!1);return}const $=await a({email:w,password:O});$&&$.success,s("/login")}catch(A){console.error("Error en el registro:",A);const $=((N=(D=A==null?void 0:A.response)==null?void 0:D.data)==null?void 0:N.detail)||(A==null?void 0:A.message)||"Ocurrió un error al registrar.";g($)}finally{n(!1)}};return e.jsxs("div",{className:"w-full min-h-screen bg-cover bg-center bg-fixed flex items-center justify-center px-4 sm:px-6 md:px-10",style:{backgroundImage:`url(${Ns})`},children:[e.jsxs("div",{className:"relative z-10 p-6 sm:p-8 w-full max-w-3xl bg-white/60 backdrop-blur-min rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx("img",{src:Na,alt:"Logo",className:"w-32 sm:w-40 h-auto mb-2"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 text-center",children:"Registro de Usuario"}),b&&e.jsx("div",{className:"mt-3 text-sm text-red-700 bg-red-50 border border-red-100 px-3 py-2 rounded-md w-full text-center",children:b})]}),e.jsxs("form",{onSubmit:d,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nombre",className:"text-xs font-medium text-gray-600 sr-only",children:"Nombre"}),e.jsx("input",{id:"nombre",name:"nombre",type:"text",placeholder:"Nombre",value:r.nombre,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"given-name","aria-label":"Nombre"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"text-xs font-medium text-gray-600 sr-only",children:"Correo electrónico"}),e.jsx("input",{id:"email",name:"email",type:"email",placeholder:"Correo electrónico",value:r.email,onChange:j,className:`w-full px-4 py-2 rounded-xl text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${r.email&&!x(r.email)?"border-red-500":"border-gray-300"}`,autoComplete:"email","aria-label":"Correo electrónico"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"empresa",className:"text-xs font-medium text-gray-600 sr-only",children:"Empresa"}),e.jsx("input",{id:"empresa",name:"empresa",type:"text",placeholder:"Empresa",value:r.empresa,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Empresa"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"rol",className:"text-xs font-medium text-gray-600 sr-only",children:"Rol"}),e.jsxs("select",{id:"rol",name:"rol",value:r.rol,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Rol",children:[e.jsx("option",{value:"",children:"Selecciona un rol"}),Lt.map(m=>e.jsx("option",{value:m,children:m},m))]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Contraseña"}),e.jsx("input",{id:"password",name:"password",type:f?"text":"password",placeholder:"Contraseña",value:r.password,onChange:j,className:"w-full px-4 py-2 pr-10 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"new-password","aria-label":"Contraseña"}),e.jsx("button",{type:"button",onClick:()=>c(!f),"aria-label":f?"Ocultar contraseña":"Mostrar contraseña",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-600",children:f?e.jsx(ua,{size:18}):e.jsx(ge,{size:18})})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"apellido",className:"text-xs font-medium text-gray-600 sr-only",children:"Apellido"}),e.jsx("input",{id:"apellido",name:"apellido",type:"text",placeholder:"Apellido",value:r.apellido,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"family-name","aria-label":"Apellido"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edad",className:"text-xs font-medium text-gray-600 sr-only",children:"Edad"}),e.jsx("input",{id:"edad",name:"edad",type:"number",placeholder:"Edad",value:r.edad,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Edad",min:0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pais",className:"text-xs font-medium text-gray-600 sr-only",children:"País"}),e.jsxs("select",{id:"pais",name:"pais",value:r.pais,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"País",children:[e.jsx("option",{value:"",children:"Selecciona un país"}),zt.map(m=>e.jsx("option",{value:m,children:m},m))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"text-xs font-medium text-gray-600 sr-only",children:"Área"}),e.jsxs("select",{id:"area",name:"area",value:r.area,onChange:j,className:"w-full px-4 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Área",children:[e.jsx("option",{value:"",children:"Selecciona un área"}),Tt.map(m=>e.jsx("option",{value:m,children:m},m))]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"confirmarPassword",className:"sr-only",children:"Confirmar contraseña"}),e.jsx("input",{id:"confirmarPassword",name:"confirmarPassword",type:v?"text":"password",placeholder:"Confirmar contraseña",value:r.confirmarPassword,onChange:j,className:"w-full px-4 py-2 pr-10 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"new-password","aria-label":"Confirmar contraseña"}),e.jsx("button",{type:"button",onClick:()=>p(!v),"aria-label":v?"Ocultar confirmación":"Mostrar confirmación",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-600",children:v?e.jsx(ua,{size:18}):e.jsx(ge,{size:18})})]})]}),e.jsx("div",{className:"md:col-span-2 mt-4",children:e.jsx("button",{type:"submit",disabled:i,className:`w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-4 rounded-xl transition ${i?"cursor-not-allowed opacity-70":""}`,children:i?"Registrando...":"Registrarse"})})]}),e.jsxs("p",{className:"text-sm text-gray-700 mt-6 text-center",children:["¿Ya tienes una cuenta?"," ",e.jsx("span",{className:"text-teal-700 font-semibold hover:underline cursor-pointer",onClick:()=>s("/login"),children:"Inicia sesión aquí"})]})]}),e.jsx("div",{className:"absolute bottom-4 text-center text-sm text-white w-full z-10 px-4",children:"© 2025 Producto desarrollado por V&C Corporation SAC"})]})}const It=[{section:"Dashboard Principal",items:[{to:"/dashboard",label:"Pantalla Principal",icon:Os,roles:["Administrador","Jefe de Proyecto","Colaborador"]}]},{section:"Gestión de Gastos y Liquidaciones",items:[{to:"/dashboard/liquidaciones/solicitud",label:"Solicitud de Gasto",icon:We,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/atencion-solicitudes",label:"Atención de Solicitudes",icon:$a,roles:["Administrador","Jefe de Proyecto"]},{to:"/dashboard/liquidaciones/presentar",label:"Liquidaciones",icon:Ia,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/gastos/aprobacion-liquidacion",label:"Aprobación de Liquidación",icon:qa,roles:["Administrador"]}]},{section:"Registros y Movimientos",items:[{to:"/dashboard/movimientos/arqueo",label:"Caja Chica",icon:Je,roles:["Administrador"]},{to:"/dashboard/registros/actividades",label:"Registro de Actividades",icon:Se,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/registros/guias-salida",label:"Guías de Salida",icon:Y,roles:["Administrador"]}]},{section:"Reportes y Análisis",items:[{to:"/dashboard/reportes",label:"Estadísticas y Reportes",icon:Ee,roles:["Administrador","Jefe de Proyecto","Colaborador"]}]},{section:"Mi Cuenta",items:[{to:"/dashboard/editar-perfil",label:"Editar Perfil",icon:Ps,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/cambiar-clave",label:"Cambiar Contraseña",icon:Ts,roles:["Administrador","Jefe de Proyecto","Colaborador"]}]}],qt=({title:s})=>e.jsx("div",{className:"text-xs uppercase text-gray-400 font-semibold px-4 pt-6 pb-1",children:s}),Bt=({to:s,label:t,icon:a})=>e.jsxs($s,{to:s,className:({isActive:r})=>`flex items-center gap-3 px-4 py-2 rounded-md text-sm transition-colors duration-200 ${r?"bg-indigo-100 text-indigo-700 font-semibold":"text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(a,{className:"w-4 h-4"}),t]});function Gt(){const s=ze(),[t,a]=o.useState(!1),{authUser:r}=oe(),l=()=>{localStorage.removeItem("token"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),s("/login")},i=o.useMemo(()=>r!=null&&r.rol?It.map(n=>({...n,items:n.items.filter(f=>f.roles.includes(r.rol))})).filter(n=>n.items.length>0):[],[r]);return e.jsxs("div",{className:"flex min-h-screen bg-[#f3f4f6]",children:[e.jsxs("aside",{className:`fixed md:static z-40 top-0 left-0 h-screen bg-white shadow-md border-r flex flex-col transform transition-transform duration-300 
        ${t?"translate-x-0 w-64":"-translate-x-full w-64"} md:translate-x-0`,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center py-6 border-b",children:[e.jsx("img",{src:Na,alt:"V&C Corporation",className:"h-16"}),e.jsx("span",{className:"text-sm font-bold text-gray-700 mt-2",children:r!=null&&r.nombre?`${r.nombre} ${r.apellido||""}`:"Usuario"})]}),e.jsx("nav",{className:"flex-1 overflow-y-auto pb-6",children:i.map(n=>e.jsxs("div",{children:[e.jsx(qt,{title:n.section}),n.items.map(f=>e.jsx(Bt,{...f},f.to))]},n.section))}),e.jsx("div",{className:"px-4 py-4 border-t",children:e.jsxs("button",{onClick:l,className:"flex items-center gap-2 text-red-600 hover:text-red-800 text-sm",children:[e.jsx(Ls,{className:"w-4 h-4"}),"Cerrar sesión"]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-screen",children:[e.jsxs("div",{className:"md:hidden flex items-center justify-between bg-white shadow px-4 py-2",children:[e.jsx("button",{onClick:()=>a(!t),children:t?e.jsx($e,{className:"w-6 h-6 text-gray-700"}):e.jsx(zs,{className:"w-6 h-6 text-gray-700"})}),e.jsx("span",{className:"font-bold text-gray-800",children:"Dashboard"})]}),e.jsx("main",{className:"flex-1 flex flex-col p-4 md:p-6 bg-white overflow-y-auto",children:e.jsx(za,{})})]})]})}const je=o.forwardRef(({className:s="",...t},a)=>e.jsx("div",{ref:a,className:`rounded-2xl border bg-white shadow-sm ${s}`,...t}));je.displayName="Card";const Ut=o.forwardRef(({className:s="",...t},a)=>e.jsx("div",{ref:a,className:`p-4 border-b ${s}`,...t}));Ut.displayName="CardHeader";const Kt=o.forwardRef(({className:s="",...t},a)=>e.jsx("h3",{ref:a,className:`text-lg font-semibold leading-none tracking-tight ${s}`,...t}));Kt.displayName="CardTitle";const Ht=o.forwardRef(({className:s="",...t},a)=>e.jsx("p",{ref:a,className:`text-sm text-gray-500 ${s}`,...t}));Ht.displayName="CardDescription";const ve=o.forwardRef(({className:s="",...t},a)=>e.jsx("div",{ref:a,className:`p-4 ${s}`,...t}));ve.displayName="CardContent";function M(...s){return Is(qs(s))}const ie=o.forwardRef(({className:s,variant:t="default",...a},r)=>e.jsx("div",{ref:r,className:M("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors",t==="default"&&"bg-gray-200 text-gray-900",t==="success"&&"bg-green-200 text-green-900",t==="warning"&&"bg-yellow-200 text-yellow-900",t==="error"&&"bg-red-200 text-red-900",s),...a}));ie.displayName="Badge";const Q=Us,Vt=Bs,ws=o.forwardRef(({className:s,...t},a)=>e.jsx(Ba,{ref:a,className:M("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));ws.displayName=Ba.displayName;const V=o.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(Vt,{children:[e.jsx(ws,{}),e.jsxs(Ga,{ref:r,className:M("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[t,e.jsxs(Gs,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));V.displayName=Ga.displayName;const W=({className:s,...t})=>e.jsx("div",{className:M("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});W.displayName="DialogHeader";const xe=({className:s,...t})=>e.jsx("div",{className:M("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});xe.displayName="DialogFooter";const J=o.forwardRef(({className:s,...t},a)=>e.jsx(Ua,{ref:a,className:M("text-lg font-semibold leading-none tracking-tight",s),...t}));J.displayName=Ua.displayName;const Ss=o.forwardRef(({className:s,...t},a)=>e.jsx(Ka,{ref:a,className:M("text-sm text-muted-foreground",s),...t}));Ss.displayName=Ka.displayName;const ga=Ha("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),R=o.forwardRef(({className:s,variant:t,size:a,asChild:r=!1,...l},i)=>{const n=r?Ks:"button";return e.jsx(n,{className:M(ga({variant:t,size:a,className:s})),ref:i,...l})});R.displayName="Button";const ae=o.forwardRef(({className:s,type:t,...a},r)=>e.jsx("input",{type:t,className:M("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...a}));ae.displayName="Input";const Wt=Ha("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),le=o.forwardRef(({className:s,...t},a)=>e.jsx(Va,{ref:a,className:M(Wt(),s),...t}));le.displayName=Va.displayName;function Jt({label:s,name:t,value:a,onChange:r,placeholder:l,className:i=""}){return e.jsxs("div",{className:"flex flex-col mb-2",children:[s&&e.jsxs("label",{className:"mb-1 font-medium text-gray-700",children:[s,":"]}),e.jsx("textarea",{name:t,value:a,onChange:r,placeholder:l,className:`border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${i}`})]})}const Yt=({open:s,onClose:t,onSuccess:a})=>{const[r,l]=o.useState(""),[i,n]=o.useState(""),[f,c]=o.useState(!1),v=async()=>{if(!r||isNaN(r)){alert("Por favor ingresa un monto inicial válido.");return}try{c(!0),await P.post("/boleta/caja_diaria/",{monto_base:Number(r),observaciones:i||""}),a&&a(),t()}catch(p){console.error("Error al abrir caja diaria:",p),alert("Hubo un error al abrir la caja. Revisa la consola.")}finally{c(!1)}};return e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"max-w-md",children:[e.jsx(W,{children:e.jsx(J,{children:"Apertura de Caja"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(le,{children:"Monto Inicial"}),e.jsx(ae,{type:"number",placeholder:"Ingrese el monto inicial",value:r,onChange:p=>l(p.target.value)})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Observaciones (opcional)"}),e.jsx(Jt,{placeholder:"Escribe aquí las observaciones...",value:i,onChange:p=>n(p.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(R,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(R,{onClick:v,disabled:f,children:f?"Abriendo...":"Abrir Caja"})]})]})]})})};function Qt({open:s,onClose:t,caja:a,onCajaCerrada:r}){const[l,i]=o.useState(!1),[n,f]=o.useState({totalIngresos:0,totalEgresos:0,saldoFinal:0});o.useEffect(()=>{a&&c()},[a]);const c=()=>{var g,j;const p=((g=a.movimientos)==null?void 0:g.filter(x=>x.tipo==="Ingreso").reduce((x,d)=>x+d.monto,0))||0,b=((j=a.movimientos)==null?void 0:j.filter(x=>x.tipo==="Egreso").reduce((x,d)=>x+d.monto,0))||0;f({totalIngresos:p,totalEgresos:b,saldoFinal:a.monto_inicial+p-b})},v=async()=>{if(window.confirm("¿Confirmas cerrar la caja? Esta acción no se puede revertir."))try{i(!0),await P.put(`/boleta/caja_diaria/${a.id}/cerrar/`),r==null||r(),t==null||t()}catch(p){console.error("Error cerrando caja:",p),alert("No se pudo cerrar la caja. Intenta nuevamente.")}finally{i(!1)}};return a?e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"max-w-md p-6 rounded-xl shadow-xl",children:[e.jsx(W,{children:e.jsx(J,{children:"Cierre de Caja"})}),e.jsxs("div",{className:"space-y-3 mt-2 text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de Apertura:"})," ",a.fecha_apertura]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto Inicial:"})," S/ ",a.monto_inicial.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Ingresos:"})," S/ ",n.totalIngresos.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Egresos:"})," S/ ",n.totalEgresos.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Saldo Final:"})," S/ ",n.saldoFinal.toFixed(2)]})]}),e.jsxs(xe,{className:"flex justify-between mt-4",children:[e.jsx(R,{variant:"outline",onClick:t,disabled:l,className:"hover:bg-gray-100 transition",children:"Cancelar"}),e.jsx(R,{onClick:v,disabled:l,className:`${l?"opacity-50 cursor-not-allowed":"hover:bg-red-700 transition"}`,children:l?"Cerrando...":"Cerrar Caja"})]})]})}):null}function Xt({open:s,onClose:t,cajaId:a,onMovimientoGuardado:r}){const[l,i]=o.useState("Ingreso"),[n,f]=o.useState(""),[c,v]=o.useState(""),[p,b]=o.useState(null),[g,j]=o.useState(!1),x=async()=>{if(!n.trim()){alert("Ingresa un concepto válido");return}if(!c||isNaN(Number(c))||Number(c)<=0){alert("Ingresa un monto válido mayor a 0");return}try{j(!0);const d=new FormData;d.append("tipo",l),d.append("concepto",n),d.append("monto",Number(c)),p&&d.append("documento",p),await P.post(`/boleta/caja_diaria/${a}/movimientos/`,d,{headers:{"Content-Type":"multipart/form-data"}}),alert("Movimiento registrado correctamente"),r==null||r(),t==null||t(),i("Ingreso"),f(""),v(""),b(null)}catch(d){console.error("Error registrando movimiento:",d),alert("No se pudo registrar el movimiento. Intenta nuevamente.")}finally{j(!1)}};return e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"max-w-md p-6 rounded-xl shadow-xl",children:[e.jsx(W,{children:e.jsx(J,{children:"Registrar Movimiento"})}),e.jsxs("div",{className:"space-y-3 mt-2 text-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Tipo"}),e.jsxs("select",{value:l,onChange:d=>i(d.target.value),className:"w-full border rounded p-2",disabled:g,children:[e.jsx("option",{value:"Ingreso",children:"Ingreso"}),e.jsx("option",{value:"Egreso",children:"Egreso"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Concepto / Descripción"}),e.jsx("input",{type:"text",value:n,onChange:d=>f(d.target.value),className:"w-full border rounded p-2",disabled:g})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Monto"}),e.jsx("input",{type:"number",min:"0",value:c,onChange:d=>v(d.target.value),className:"w-full border rounded p-2",disabled:g})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Documento (opcional)"}),e.jsx("input",{type:"file",onChange:d=>b(d.target.files[0]),className:"w-full",disabled:g})]})]}),e.jsxs(xe,{className:"flex justify-between mt-4",children:[e.jsx(R,{variant:"outline",onClick:t,disabled:g,className:"hover:bg-gray-100 transition",children:"Cancelar"}),e.jsx(R,{onClick:x,disabled:g,className:`${g?"opacity-50 cursor-not-allowed":"hover:bg-green-700 transition"}`,children:g?"Guardando...":"Guardar Movimiento"})]})]})})}function wa({open:s,onClose:t,documento:a}){const r=o.useRef(),l=()=>{if(!a.url)return;const i=window.open("","_blank");i.document.write(`
      <html>
        <head>
          <title>${a.nombre||"Documento"}</title>
        </head>
        <body style="margin:0; display:flex; justify-content:center; align-items:center; height:100vh;">
          <img src="${a.url}" style="max-width:100%; max-height:100vh;" />
        </body>
      </html>
    `),i.document.close(),i.focus(),i.print(),i.close()};return a?e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"max-w-3xl w-full shadow-xl rounded-xl p-6",children:[e.jsx(W,{children:e.jsx(J,{children:a.nombre||"Documento"})}),e.jsx("div",{className:"flex justify-center my-4",children:a.url?e.jsx("img",{ref:r,src:a.url,alt:a.nombre||"Documento",className:"max-h-[70vh] w-auto object-contain rounded border"}):e.jsx("p",{className:"text-center text-gray-500",children:"No hay vista disponible"})}),e.jsxs(xe,{className:"flex justify-between",children:[e.jsx(R,{variant:"outline",onClick:t,className:"hover:bg-gray-100 transition",children:"Cerrar"}),a.url&&e.jsx(R,{onClick:l,className:"hover:bg-gray-100 transition",children:"Imprimir"})]})]})}):null}const Zt={Ingreso:"#16a34a",Egreso:"#ef4444"};function Cs({open:s,onClose:t,movimiento:a}){const[r,l]=o.useState(!1);return a?e.jsxs(e.Fragment,{children:[e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"max-w-lg shadow-xl rounded-xl p-6",children:[e.jsx(W,{children:e.jsxs(J,{children:["Movimiento #",a.numero_operacion||a.id]})}),e.jsxs("div",{className:"space-y-3 mt-2 text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",a.fecha]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tipo:"})," ",e.jsx(ie,{style:{backgroundColor:Zt[a.tipo],color:"#fff",marginLeft:4},children:a.tipo})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Concepto:"})," ",a.concepto]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto:"})," S/ ",a.monto.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Usuario:"})," ",a.usuario]}),a.documento?e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{children:e.jsx("strong",{children:"Documento:"})}),e.jsx(R,{size:"sm",variant:"outline",onClick:()=>l(!0),className:"hover:bg-gray-100 transition",children:"Ver Documento"})]}):e.jsx("p",{className:"text-gray-400",children:"Sin documento"}),a.observaciones&&e.jsxs("p",{children:[e.jsx("strong",{children:"Observaciones:"})," ",a.observaciones]})]}),e.jsx(xe,{className:"mt-4",children:e.jsx(R,{variant:"outline",onClick:t,className:"hover:bg-gray-100 transition",children:"Cerrar"})})]})}),r&&a.documento&&e.jsx(wa,{open:r,onClose:()=>l(!1),documento:a.documento})]}):null}const er={Ingreso:"#16a34a",Egreso:"#ef4444"};function ar({movimientos:s}){const[t,a]=o.useState(""),[r,l]=o.useState("Todos"),[i,n]=o.useState(null),[f,c]=o.useState(!1),[v,p]=o.useState(null),[b,g]=o.useState(!1),j=o.useMemo(()=>s.filter(y=>{var C,E;const w=((C=y.numero_operacion)==null?void 0:C.toString().includes(t))||((E=y.concepto)==null?void 0:E.toLowerCase().includes(t.toLowerCase())),S=r==="Todos"||y.tipo===r;return w&&S}),[s,t,r]),x=o.useMemo(()=>j.filter(y=>y.tipo==="Ingreso").reduce((y,w)=>y+(w.monto||0),0),[j]),d=o.useMemo(()=>j.filter(y=>y.tipo==="Egreso").reduce((y,w)=>y+(w.monto||0),0),[j]),m=x-d,h=y=>{y.documento&&(p(y),g(!0),n(y.id))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Buscar por N° operación o concepto...",value:t,onChange:y=>a(y.target.value),className:"max-w-xs border rounded-lg px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"}),e.jsx("div",{className:"flex gap-2",children:["Todos","Ingreso","Egreso"].map(y=>e.jsx(R,{variant:r===y?"secondary":"outline",onClick:()=>l(y),children:y},y))})]}),e.jsx("div",{className:"overflow-x-auto shadow-md rounded-xl border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-center",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"N° Operación"}),e.jsx("th",{className:"px-4 py-3",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3",children:"Concepto"}),e.jsx("th",{className:"px-4 py-3",children:"Monto"}),e.jsx("th",{className:"px-4 py-3",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3",children:"Documento"}),e.jsx("th",{className:"px-4 py-3",children:"Acciones"})]})}),e.jsx("tbody",{children:e.jsx(ba,{children:j.length>0?j.map(y=>e.jsxs(I.tr,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:`border-t border-gray-100 hover:shadow-lg hover:translate-y-[-2px] hover:bg-gray-50 transition-transform duration-200 ${i===y.id?"bg-blue-50":""}`,onClick:()=>n(y.id),children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:y.numero_operacion||"-"}),e.jsx("td",{className:"px-4 py-3",children:y.fecha||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(ie,{style:{backgroundColor:er[y.tipo]||"#6b7280",color:"#fff"},children:y.tipo||"-"})}),e.jsx("td",{className:"px-4 py-3",children:y.concepto||"-"}),e.jsxs("td",{className:"px-4 py-3",children:["S/ ",(y.monto||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:y.usuario||"-"}),e.jsx("td",{className:"px-4 py-3",children:y.documento?e.jsx(R,{size:"sm",className:"bg-gradient-to-r from-blue-300 to-blue-400 hover:from-blue-400 hover:to-blue-500 text-white p-2 rounded-lg shadow-md transition",onClick:w=>{w.stopPropagation(),h(y)},children:y.documento.nombre}):"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{className:"bg-gradient-to-r from-indigo-400 to-indigo-500 hover:from-indigo-500 hover:to-indigo-600 text-white p-2 rounded-lg shadow-md transition",onClick:()=>{p(mov),setDetalleMovimientoOpen(!0)},children:e.jsx(ge,{size:16})})})]},y.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-6 text-gray-500",children:"No hay movimientos registrados."})})})})]})}),e.jsxs("div",{className:"flex justify-end gap-6 mt-2 font-medium text-sm",children:[e.jsxs("p",{children:["Total Ingresos: S/ ",x.toFixed(2)]}),e.jsxs("p",{children:["Total Egresos: S/ ",d.toFixed(2)]}),e.jsxs("p",{children:["Saldo Actual: S/ ",m.toFixed(2)]})]}),f&&v&&e.jsx(Cs,{open:f,onClose:()=>c(!1),movimiento:v}),b&&(v==null?void 0:v.documento)&&e.jsx(wa,{open:b,onClose:()=>g(!1),documento:v.documento})]})}const sr={id:1,fecha_apertura:"2025-08-14",monto_inicial:1e3,cerrada:!1},tr=[{id:1,fecha:"2025-08-14",tipo:"Ingreso",concepto:"Rollover",monto:200,usuario:"Admin",documento:null},{id:2,fecha:"2025-08-14",tipo:"Egreso",concepto:"Compra de papelería",monto:50,usuario:"Admin",documento:{nombre:"Ticket Papelería",url:"/fake-doc1.jpg"}},{id:3,fecha:"2025-08-14",tipo:"Egreso",concepto:"Yape a proveedor",monto:150,usuario:"Admin",documento:{nombre:"Yape",url:"/fake-doc2.jpg"}}],Ma={Ingreso:"#16a34a",Egreso:"#ef4444"},la={saldo:"#3b82f6",ingresos:"#16a34a",egresos:"#ef4444"},rr="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center";function Ra(){const[s,t]=o.useState(null),[a,r]=o.useState([]),[l,i]=o.useState(!0),[n,f]=o.useState(!1),[c,v]=o.useState(!1),[p,b]=o.useState(!1),[g,j]=o.useState(null),[x,d]=o.useState(null),[m,h]=o.useState(!1),[y,w]=o.useState(!1),S=async()=>{i(!0),setTimeout(()=>{r(tr),t(sr),i(!1)},800)};o.useEffect(()=>{S()},[]);const C=o.useMemo(()=>{const k=a.filter(T=>T.tipo==="Ingreso").reduce((T,D)=>T+D.monto,0),O=a.filter(T=>T.tipo==="Egreso").reduce((T,D)=>T+D.monto,0),K=((s==null?void 0:s.monto_inicial)||0)+k-O;return{ingresos:k,egresos:O,saldo:K}},[a,s]),E=o.useMemo(()=>[{name:"Ingresos",value:C.ingresos,fill:Ma.Ingreso},{name:"Egresos",value:C.egresos,fill:Ma.Egreso}],[C]),_=k=>{const O=Math.max(C.saldo,C.ingresos,C.egresos,1);return`${k/O*100}%`};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2 mb-4",children:[e.jsx(Je,{className:"w-6 h-6"})," Caja Chica"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 text-center",children:[{label:"Saldo Actual",value:C.saldo,color:la.saldo},{label:"Total Ingresos",value:C.ingresos,color:la.ingresos},{label:"Total Egresos",value:C.egresos,color:la.egresos}].map((k,O)=>e.jsxs("div",{className:`${rr} flex flex-col items-center justify-center text-white p-5 rounded-xl`,style:{background:`linear-gradient(135deg, ${k.color}cc, ${k.color}99)`},children:[e.jsx("p",{className:"text-sm font-medium",children:k.label}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:e.jsx(De,{end:k.value,duration:1.2,separator:",",decimals:2})}),k.label!=="Saldo Actual"&&e.jsx("div",{className:"w-full h-2 bg-white bg-opacity-30 rounded-full mt-2",children:e.jsx("div",{className:"h-2 rounded-full",style:{width:_(k.value),backgroundColor:k.color}})})]},O))}),e.jsx(je,{className:"shadow-lg rounded-xl mt-5",children:e.jsxs(ve,{children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(ye,{className:"w-5 h-5 text-gray-800"}),e.jsx("h3",{className:"text-center font-medium",children:"Distribución Ingresos/Egresos"})]}),e.jsx(q,{width:"100%",height:300,children:e.jsxs(ye,{children:[e.jsx(Oe,{data:E,dataKey:"value",nameKey:"name",innerRadius:55,outerRadius:85,label:({name:k,percent:O})=>`${k} ${(O*100).toFixed(1)}%`,children:E.map((k,O)=>e.jsx(te,{fill:k.fill},O))}),e.jsx(G,{formatter:k=>`${k.toFixed(2)} S/`}),e.jsx(pe,{verticalAlign:"bottom",height:36})]})})]})}),e.jsx("div",{className:"flex flex-wrap gap-4 mt-4",children:s!=null&&s.cerrada?e.jsx(ie,{variant:"outline",className:"text-gray-600",children:"Caja cerrada"}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",onClick:()=>f(!0),children:[e.jsx(Wa,{size:16})," Abrir Caja"]}),e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",onClick:()=>b(!0),disabled:!s,children:[e.jsx(Hs,{size:16})," Nuevo Movimiento"]}),e.jsxs("button",{className:"bg-gradient-to-r from-orange-500 to-red-500 hover:from-red-500 hover:to-red-600 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",onClick:()=>v(!0),disabled:!s,children:[e.jsx(aa,{size:16})," Cerrar Caja"]})]})}),e.jsx(ar,{movimientos:a,onMovimientoSeleccionado:k=>{j(k),h(!0)},onMovimientoGuardado:S}),n&&e.jsx(Yt,{open:n,onClose:()=>f(!1)}),c&&e.jsx(Qt,{open:c,onClose:()=>v(!1),caja:s,totales:C}),p&&e.jsx(Xt,{open:p,onClose:()=>b(!1),cajaId:s==null?void 0:s.id,onMovimientoGuardado:S}),m&&g&&e.jsx(Cs,{open:m,onClose:()=>h(!1),movimiento:g}),y&&x&&e.jsx(wa,{open:y,onClose:()=>w(!1),documento:x})]})}const Ie=({label:s,value:t,gradient:a,icon:r,tooltip:l,decimals:i=0})=>e.jsxs("div",{className:`\r
        rounded-xl p-4 shadow-md text-white relative\r
        flex flex-col items-center justify-center text-center\r
        transition-all duration-300 transform\r
        hover:scale-105 hover:shadow-lg cursor-pointer\r
        min-h-[90px] sm:min-h-[100px]\r
      `,style:{background:a},children:[l&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Ja,{content:l,children:e.jsx(Ye,{size:14,className:"text-white opacity-80 cursor-pointer"})})}),r&&e.jsx(r,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-xs sm:text-sm opacity-90",children:s}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold",children:e.jsx(De,{end:Number(t)||0,duration:1.2,separator:",",decimals:i})})]}),Pe=({headers:s,data:t,renderRow:a,emptyMessage:r="No hay datos disponibles.",activeRow:l=null,rowsPerPage:i=10,onDeleteRow:n})=>{const[f,c]=o.useState(1),v=Math.ceil(t.length/i)||1,p=(f-1)*i,b=p+i,g=t.slice(p,b),j=x=>{x>=1&&x<=v&&c(x)};return e.jsx(je,{className:"rounded-2xl shadow-md border border-gray-200",children:e.jsxs(ve,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-2xl relative",children:e.jsxs("table",{className:"min-w-full table-auto text-sm text-center border-collapse relative",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 font-medium",children:e.jsx("tr",{children:s.map((x,d)=>e.jsx("th",{className:"px-3 sm:px-4 py-3 border border-gray-200",children:x},d))})}),e.jsx("tbody",{className:"bg-gray-50",children:e.jsx(ba,{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"px-4 py-10 text-center text-gray-500 italic border border-gray-200",children:r})}):g.map((x,d)=>e.jsxs(I.tr,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.25},className:`group relative transition-all duration-200 ${l===(x.id||d)?"bg-blue-50 border-l-4 border-blue-500 shadow-sm":"hover:bg-gray-50 hover:shadow-md hover:ring-1 hover:ring-gray-200 cursor-pointer"}`,children:[Array.isArray(a(x))?a(x).map((m,h)=>e.jsx("td",{className:"px-3 sm:px-4 py-3 border border-gray-200",children:m},h)):a(x),n&&e.jsx("div",{className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition",children:e.jsx(R,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700 hover:bg-red-100 rounded-full",onClick:m=>{m.stopPropagation(),n(x)},children:e.jsx(Vs,{className:"h-4 w-4"})})})]},x.id||d))})})]})}),v>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-3 border-t border-gray-200 bg-gray-50",children:[e.jsxs(R,{variant:"outline",size:"sm",disabled:f===1,onClick:()=>j(f-1),className:"flex items-center gap-1",children:[e.jsx(Ya,{className:"w-4 h-4"})," Anterior"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:v},(x,d)=>d+1).map(x=>e.jsx(R,{variant:x===f?"default":"outline",size:"sm",onClick:()=>j(x),className:`w-8 h-8 rounded-full ${x===f?"bg-blue-500 text-white hover:bg-blue-600":"hover:bg-gray-100"}`,children:x},x))}),e.jsxs(R,{variant:"outline",size:"sm",disabled:f===v,onClick:()=>j(f+1),className:"flex items-center gap-1",children:["Siguiente ",e.jsx(Qa,{className:"w-4 h-4"})]})]})]})})},Le={"Pendiente de Envío":"bg-orange-200 text-orange-800","Pendiente para Atención":"bg-yellow-200 text-yellow-800","Atendido, Pendiente de Liquidación":"bg-sky-200 text-sky-800","Liquidación enviada para Aprobación":"bg-green-200 text-green-800","Liquidación Aprobada":"bg-gray-600 text-white",Rechazado:"bg-red-200 text-red-800"},Ne={"Pendiente de Envío":"#f97316","Pendiente para Atención":"#ffef00","Atendido, Pendiente de Liquidación":"#0ea5e9","Liquidación enviada para Aprobación":"#22c55e","Liquidación Aprobada":"#0f172a",Rechazado:"#ef4444"},Sa={Viáticos:"bg-blue-600 text-white",Movilidad:"bg-emerald-500 text-white",Compras:"bg-purple-500 text-white","Otros gastos":"bg-yellow-100 text-yellow-800"},ce={Viáticos:"#0218db",Movilidad:"#059669",Compras:"#7c3aed","Otros gastos":"#eab308"},Re=(s,t,a)=>[`${s}`,`${t}`],Ze=(s,t,a)=>[`${s}`,`${t}`],re=({title:s,icon:t,subtitle:a,children:r,className:l="",legend:i=[],tooltipFormatter:n})=>e.jsx(je,{className:`rounded-xl shadow-md hover:shadow-lg transition-shadow ${l}`,children:e.jsxs(ve,{className:"flex flex-col p-4 w-full h-full",children:[(s||a||t)&&e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx("span",{className:"text-gray-700",children:t}),s&&e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:s})]}),a&&e.jsx("div",{className:"text-sm text-gray-500",children:a})]}),i&&i.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:i.map((f,c)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:f.color}}),e.jsxs("span",{className:"text-sm text-gray-700",children:[f.name," (",f.value,")"]})]},c))}),e.jsx("div",{className:"flex-1 w-full min-h-[220px]",children:ha.Children.map(r,f=>{var c;return n&&((c=f==null?void 0:f.type)==null?void 0:c.displayName)==="Tooltip"?ha.cloneElement(f,{formatter:n}):f})})]})});re.propTypes={title:Z.string,icon:Z.element,subtitle:Z.string,children:Z.node.isRequired,className:Z.string,legend:Z.arrayOf(Z.shape({name:Z.string.isRequired,value:Z.oneOfType([Z.string,Z.number]).isRequired,color:Z.string.isRequired})),tooltipFormatter:Z.func};const or=()=>{const{authUser:s}=oe(),[t,a]=o.useState({}),[r,l]=o.useState(!0),[i,n]=o.useState([]),[f,c]=o.useState([]),[v,p]=o.useState(null),b=()=>{const m=new Date().getHours();return m<12?"Buenos días":m<18?"Buenas tardes":"Buenas noches"};o.useEffect(()=>{(async()=>{try{const h=await P.get("/dashboard/home-stats/");a(h.data.stats||{}),n(h.data.solicitudesRecientes||[]),c(h.data.alertas||[])}catch(h){console.error("Error cargando estadísticas del Dashboard Home:",h)}finally{l(!1)}})()},[]);const g=[{label:"Solicitudes Pendientes",value:t.solicitudesPendientes??0,icon:Se,gradient:"linear-gradient(135deg,#f97316cc,#fb923c99)",tooltip:"Solicitudes que aún no han sido atendidas o aprobadas."},{label:"Liquidaciones Pendientes",value:t.liquidacionesPendientes??0,icon:Y,gradient:"linear-gradient(135deg,#0ea5e9cc,#38bdf899)",tooltip:"Solicitudes en estado pendiente de liquidación o aprobación."},{label:"Liquidaciones Aprobadas (Mes)",value:t.liquidacionesAprobadasMes??0,icon:Xa,gradient:"linear-gradient(135deg,#16a34acc,#4ade8099)",tooltip:"Cantidad de liquidaciones aprobadas este mes."},{label:"Monto Total Solicitado (Mes)",value:parseFloat(t.montoTotalSolicitadoMes??0),icon:se,gradient:"linear-gradient(135deg,#7c3aedcc,#a78bfa99)",tooltip:"Monto total solicitado en caja chica este mes."}],j=m=>{alert(`Ir a: ${m}`)},x=[{name:"Viáticos",value:120},{name:"Movilidad",value:80},{name:"Compras",value:60},{name:"Otros gastos",value:40}],d=[{name:"Pendiente de Envío",value:15},{name:"Pendiente para Atención",value:10},{name:"Atendido, Pendiente de Liquidación",value:8},{name:"Liquidación enviada para Aprobación",value:12},{name:"Liquidación Aprobada",value:20},{name:"Rechazado",value:5}];return e.jsxs("div",{className:"min-h-screen w-full flex flex-col p-4 sm:p-6 bg-gray-50 font-sans overflow-auto",children:[e.jsxs("header",{className:"mb-6",children:[e.jsxs(I.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-3xl sm:text-4xl font-bold text-gray-900 flex items-center gap-2",children:[b(),", ",s!=null&&s.nombre?`${s.nombre} ${s.apellido||""}`:"Usuario"," 👋"]}),e.jsxs(I.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.8},className:"mt-1 text-lg sm:text-xl text-gray-600 italic",children:["Bienvenido a ",e.jsx("span",{className:"font-semibold text-blue-600",children:"PMInsight"}),". Aquí tienes un resumen de hoy."]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6 mb-6",children:g.map(m=>e.jsx(Ie,{label:m.label,value:r?0:m.value,icon:m.icon,gradient:m.gradient,tooltip:m.tooltip,decimals:Number.isInteger(m.value)?0:2},m.label))}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 mb-8 w-full h-auto",children:[e.jsx(re,{title:"Distribución por tipo de solicitud",icon:e.jsx(fe,{className:"w-5 h-5 text-gray-700"}),tooltipFormatter:Re,className:"flex-1 h-[360px] w-full",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 h-full items-stretch",children:[e.jsx("div",{className:"flex-1 min-h-[220px]",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(ye,{children:[e.jsx(Oe,{data:x,dataKey:"value",nameKey:"name",innerRadius:"60%",outerRadius:"90%",paddingAngle:3,label:!0,children:x.map((m,h)=>e.jsx(te,{fill:ce[m.name]||"#334155"},h))}),e.jsx(G,{})]})})}),e.jsx("div",{className:"w-full lg:w-48 flex-shrink-0 mt-4 lg:mt-0",children:x.map((m,h)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[e.jsx("span",{style:{width:12,height:12,background:ce[m.name]||"#334155",display:"inline-block",borderRadius:3}}),e.jsx("span",{className:"font-medium",children:m.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",m.value,")"]})]},m.name))})]})}),e.jsx(re,{title:"Estado de solicitudes",icon:e.jsx(ka,{className:"w-5 h-5 text-gray-700"}),tooltipFormatter:Ze,className:"flex-1 h-[360px] w-full",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 h-full items-stretch",children:[e.jsx("div",{className:"flex-1 min-h-[220px]",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Qe,{cx:"50%",cy:"50%",innerRadius:"10%",outerRadius:"95%",barSize:15,data:d,children:[e.jsx(Xe,{minAngle:15,background:!0,clockWise:!0,dataKey:"value",cornerRadius:8,children:d.map((m,h)=>e.jsx(te,{fill:Ne[m.name]||"#334155"},h))}),e.jsx(G,{})]})})}),e.jsx("div",{className:"w-full lg:w-48 flex-shrink-0 mt-4 lg:mt-0",children:d.map((m,h)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[e.jsx("span",{style:{width:12,height:12,background:Ne[m.name]||"#334155",display:"inline-block",borderRadius:3}}),e.jsx("span",{className:"font-medium",children:m.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",m.value,")"]})]},m.name))})]})})]}),e.jsxs("div",{className:"mb-8 w-full overflow-x-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"})," Movimientos recientes"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Total: ",i.length]})]}),e.jsx(Pe,{headers:["N°","Fecha","Solicitante","Estado","Acciones"],data:i,emptyMessage:"No hay movimientos recientes.",rowsPerPage:5,renderRow:m=>[e.jsx("span",{className:"font-semibold",children:m.nro}),m.fecha,m.solicitante,e.jsx("span",{className:`font-bold ${m.estado==="Aprobada"?"text-green-600":m.estado==="Pendiente"?"text-yellow-600":"text-red-600"}`,children:m.estado}),e.jsx("button",{className:"bg-gradient-to-r from-blue-400 to-blue-600 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition flex items-center gap-2 justify-center",onClick:()=>p(m.nro),children:"Revisar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 mt-6 w-full",children:[e.jsxs("div",{onClick:()=>j("/nueva-solicitud"),className:"group bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-2xl shadow-md p-6 flex flex-col items-center justify-center cursor-pointer transition transform hover:scale-105 hover:shadow-lg",children:[e.jsx("div",{className:"bg-white/20 rounded-full p-3 mb-3 group-hover:bg-white/30 transition",children:e.jsx(We,{size:28})}),e.jsx("h4",{className:"font-semibold text-lg",children:"Nueva Solicitud"}),e.jsx("p",{className:"text-sm opacity-80 text-center mt-1",children:"Registra una nueva solicitud de gasto."})]}),e.jsxs("div",{onClick:()=>j("/liquidaciones"),className:"group bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-2xl shadow-md p-6 flex flex-col items-center justify-center cursor-pointer transition transform hover:scale-105 hover:shadow-lg",children:[e.jsx("div",{className:"bg-white/20 rounded-full p-3 mb-3 group-hover:bg-white/30 transition",children:e.jsx(fe,{size:28})}),e.jsx("h4",{className:"font-semibold text-lg",children:"Ver Liquidaciones"}),e.jsx("p",{className:"text-sm opacity-80 text-center mt-1",children:"Consulta el estado de tus liquidaciones."})]}),e.jsxs("div",{onClick:()=>j("/reportes"),className:"group bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-2xl shadow-md p-6 flex flex-col items-center justify-center cursor-pointer transition transform hover:scale-105 hover:shadow-lg",children:[e.jsx("div",{className:"bg-white/20 rounded-full p-3 mb-3 group-hover:bg-white/30 transition",children:e.jsx(ka,{size:28})}),e.jsx("h4",{className:"font-semibold text-lg",children:"Reportes"}),e.jsx("p",{className:"text-sm opacity-80 text-center mt-1",children:"Estadísticas y reportes ejecutivos."})]})]})]})};function nr({data:s}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Código"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Referencia"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Empresa"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Área"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Monto Programado"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Monto Ejecutado"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Saldo"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Estado"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-4 text-gray-500",children:"No se encontraron programaciones registradas."})}):s.map((t,a)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 font-mono text-gray-600",children:t.codigo}),e.jsx("td",{className:"px-4 py-2",children:t.referencia}),e.jsx("td",{className:"px-4 py-2",children:t.empresa}),e.jsx("td",{className:"px-4 py-2",children:t.area}),e.jsx("td",{className:"px-4 py-2 font-semibold",children:t.monto_programado.toLocaleString("es-PE",{style:"currency",currency:"PEN"})}),e.jsx("td",{className:"px-4 py-2 text-green-700",children:t.monto_ejecutado?t.monto_ejecutado.toLocaleString("es-PE",{style:"currency",currency:"PEN"}):"-"}),e.jsx("td",{className:"px-4 py-2 font-semibold",children:t.saldo?t.saldo.toLocaleString("es-PE",{style:"currency",currency:"PEN"}):"-"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${t.estado==="Pendiente"?"bg-yellow-100 text-yellow-800":t.estado==="Ejecutado"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.estado})})]},a))})]})})}function lr({className:s,classNames:t,showOutsideDays:a=!0,captionLayout:r="label",buttonVariant:l="ghost",formatters:i,components:n,...f}){const c=Za();return e.jsx(Ws,{showOutsideDays:a,className:M("bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,s),captionLayout:r,formatters:{formatMonthDropdown:v=>v.toLocaleString("default",{month:"short"}),...i},classNames:{root:M("w-fit",c.root),months:M("relative flex flex-col gap-4 md:flex-row",c.months),month:M("flex w-full flex-col gap-4",c.month),nav:M("absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1",c.nav),button_previous:M(ga({variant:l}),"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50",c.button_previous),button_next:M(ga({variant:l}),"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50",c.button_next),month_caption:M("flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]",c.month_caption),dropdowns:M("flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium",c.dropdowns),dropdown_root:M("has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border",c.dropdown_root),dropdown:M("bg-popover absolute inset-0 opacity-0",c.dropdown),caption_label:M("select-none font-medium",r==="label"?"text-sm":"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5",c.caption_label),table:"w-full border-collapse",weekdays:M("flex",c.weekdays),weekday:M("text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal",c.weekday),week:M("mt-2 flex w-full",c.week),week_number_header:M("w-[--cell-size] select-none",c.week_number_header),week_number:M("text-muted-foreground select-none text-[0.8rem]",c.week_number),day:M("group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md",c.day),range_start:M("bg-accent rounded-l-md",c.range_start),range_middle:M("rounded-none",c.range_middle),range_end:M("bg-accent rounded-r-md",c.range_end),today:M("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",c.today),outside:M("text-muted-foreground aria-selected:text-muted-foreground",c.outside),disabled:M("text-muted-foreground opacity-50",c.disabled),hidden:M("invisible",c.hidden),...t},components:{Root:({className:v,rootRef:p,...b})=>e.jsx("div",{"data-slot":"calendar",ref:p,className:M(v),...b}),Chevron:({className:v,orientation:p,...b})=>p==="left"?e.jsx(Ya,{className:M("size-4",v),...b}):p==="right"?e.jsx(Qa,{className:M("size-4",v),...b}):e.jsx(Js,{className:M("size-4",v),...b}),DayButton:ir,WeekNumber:({children:v,...p})=>e.jsx("td",{...p,children:e.jsx("div",{className:"flex size-[--cell-size] items-center justify-center text-center",children:v})}),...n},...f})}function ir({className:s,day:t,modifiers:a,...r}){const l=Za(),i=o.useRef(null);return o.useEffect(()=>{var n;a.focused&&((n=i.current)==null||n.focus())},[a.focused]),e.jsx(R,{ref:i,variant:"ghost",size:"icon","data-day":t.date.toLocaleDateString(),"data-selected-single":a.selected&&!a.range_start&&!a.range_end&&!a.range_middle,"data-range-start":a.range_start,"data-range-end":a.range_end,"data-range-middle":a.range_middle,className:M("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70",l.day,s),...r})}const cr=({open:s,onClose:t,onSave:a,initialData:r})=>{const[l,i]=o.useState({codigo:"",referencia:"",descripcion:"",monto_programado:"",fecha:new Date,proyecto:"",area:"",empresa:""});o.useEffect(()=>{r&&i({codigo:r.codigo||"",referencia:r.referencia||"",descripcion:r.descripcion||"",monto_programado:r.monto_programado||"",fecha:r.fecha?new Date(r.fecha):new Date,proyecto:r.proyecto||"",area:r.area||"",empresa:r.empresa||""})},[r]);const n=(c,v)=>{i(p=>({...p,[c]:v}))},f=()=>{a(l),t()};return e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"max-w-lg",children:[e.jsx(W,{children:e.jsx(J,{children:r?"Editar Programación":"Nueva Programación"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"referencia",children:"Referencia"}),e.jsx(ae,{id:"referencia",value:l.referencia,onChange:c=>n("referencia",c.target.value),placeholder:"Ej: PRG-2025-001"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(ae,{id:"descripcion",value:l.descripcion,onChange:c=>n("descripcion",c.target.value),placeholder:"Ej: Compra de equipos de oficina"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"monto_programado",children:"Monto Programado (S/)"}),e.jsx(ae,{id:"monto_programado",type:"number",value:l.monto_programado,onChange:c=>n("monto_programado",c.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"proyecto",children:"Proyecto"}),e.jsx(ae,{id:"proyecto",value:l.proyecto,onChange:c=>n("proyecto",c.target.value),placeholder:"Ej: Proyecto Alfa"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"area",children:"Área"}),e.jsx(ae,{id:"area",value:l.area,onChange:c=>n("area",c.target.value),placeholder:"Ej: Contabilidad"})]}),e.jsxs("div",{children:[e.jsx(le,{htmlFor:"empresa",children:"Empresa"}),e.jsx(ae,{id:"empresa",value:l.empresa,onChange:c=>n("empresa",c.target.value),placeholder:"Ej: V&C Corporation"})]}),e.jsxs("div",{children:[e.jsx(le,{children:"Fecha de Ejecución"}),e.jsx(lr,{mode:"single",selected:l.fecha,onSelect:c=>n("fecha",c)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Fecha seleccionada: ",pa(l.fecha,"dd/MM/yyyy")]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(R,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(R,{onClick:f,children:r?"Actualizar":"Guardar"})]})]})})},dr="http://localhost:8000/api",ks=ea.create({baseURL:dr,headers:{"Content-Type":"application/json"}});ks.interceptors.request.use(s=>{const t=localStorage.getItem("access");return t&&(s.headers.Authorization=`Bearer ${t}`),s},s=>Promise.reject(s));const mr=async()=>(await ks.get("/programaciones/")).data;function xr(){const[s,t]=o.useState([]),[a,r]=o.useState(!1),[l,i]=o.useState(!1),[n,f]=o.useState({year:"2025",proyecto:"",area:"",empresa:"",encargado:""}),c=async()=>{i(!0);try{const b=await mr(n);t(b)}catch(b){console.error("Error al cargar programaciones:",b)}finally{i(!1)}};o.useEffect(()=>{c()},[n]);const v=()=>{c()},p=()=>{console.log("Generando reporte...")};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Programación de Gastos"}),e.jsxs(R,{onClick:()=>r(!0),className:"flex items-center gap-2",children:[e.jsx(es,{size:18})," Nueva Programación"]})]}),e.jsxs(je,{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{size:20,className:"text-gray-500"}),e.jsxs("select",{value:n.year,onChange:b=>f({...n,year:b.target.value}),className:"flex-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"2025",children:"2025"}),e.jsx("option",{value:"2024",children:"2024"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ys,{size:20,className:"text-gray-500"}),e.jsx("select",{value:n.proyecto,onChange:b=>f({...n,proyecto:b.target.value}),className:"flex-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:e.jsx("option",{value:"",children:"Todos"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qs,{size:20,className:"text-gray-500"}),e.jsx("select",{value:n.area,onChange:b=>f({...n,area:b.target.value}),className:"flex-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:e.jsx("option",{value:"",children:"Todos"})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsxs(R,{onClick:v,className:"flex items-center gap-2",children:[e.jsx(ja,{size:18})," Procesar"]}),e.jsxs(R,{onClick:p,className:"flex items-center gap-2",children:[e.jsx(Y,{size:18})," Reporte"]})]})]}),e.jsx(je,{children:e.jsx(ve,{className:"p-6",children:l?e.jsx("p",{children:"Cargando datos..."}):e.jsx(nr,{data:s})})}),a&&e.jsx(cr,{open:a,onClose:()=>r(!1),onSave:()=>{r(!1),c()}})]})}class ur{constructor(){this.listeners={}}on(t,a){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(a),()=>this.off(t,a)}off(t,a){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(r=>r!==a))}emit(t,a){this.listeners[t]&&this.listeners[t].forEach(r=>r(a))}}const U=new ur;function ne({label:s,name:t,value:a,onChange:r,readOnly:l=!1,type:i="text"}){return e.jsxs("div",{className:"flex flex-col mb-3 w-full",children:[s&&e.jsxs("label",{className:"mb-1 text-xs sm:text-sm font-medium text-gray-700",children:[s,":"]}),e.jsx("input",{type:i,name:t,value:a,onChange:r,readOnly:l,className:"border border-gray-300 rounded-lg px-3 py-2 sm:px-4 sm:py-2 bg-gray-50 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm w-full"})]})}function Ea({label:s,name:t,value:a,onChange:r}){return e.jsxs("div",{className:"flex flex-col mb-3 w-full",children:[s&&e.jsxs("label",{className:"mb-1 text-xs sm:text-sm font-medium text-gray-700",children:[s,":"]}),e.jsx("textarea",{name:t,value:a,onChange:r,className:"border border-gray-300 rounded-lg px-3 py-2 sm:px-4 sm:py-2 bg-gray-50 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm resize-none w-full"})]})}function ia({label:s,name:t,value:a,onChange:r,options:l=[]}){return e.jsxs("div",{className:"flex flex-col mb-3 w-full",children:[s&&e.jsxs("label",{className:"mb-1 text-xs sm:text-sm font-medium text-gray-700",children:[s,":"]}),e.jsxs("select",{name:t,value:a||"",onChange:r,className:"border border-gray-300 rounded-lg px-3 py-2 sm:px-4 sm:py-2 bg-gray-50 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm w-full",children:[e.jsx("option",{value:"",children:"Selecciona..."}),l.map(i=>e.jsxs("option",{value:i.id,children:[i.nombre," ",i.apellido]},i.id))]})]})}function As({open:s,onClose:t,onCreated:a}){const{authUser:r}=oe(),l=ze(),i=[{id:2,nombre:"Cristina",apellido:"Martinez"},{id:3,nombre:"Marisol",apellido:"Rojas"},{id:4,nombre:"Cristina",apellido:"Silva"}],[n,f]=o.useState({numero_solicitud:"",fecha:"",hora:"",codigo:"",solicitante:"",destinatario_id:null,tipo_solicitud:"",area:"",tipo_moneda:"",tipo_cambio:"3.55",monto_soles:"",monto_dolares:"",fecha_transferencia:"",fecha_liquidacion:"",banco:"",numero_cuenta:"",concepto_gasto:"",observacion:""});o.useEffect(()=>{if(!s)return;const p=new Date;f(b=>({...b,numero_solicitud:Math.floor(1e3+Math.random()*9e3),codigo:Xs().split("-")[0].toUpperCase(),fecha:pa(p,"yyyy-MM-dd"),hora:pa(p,"HH:mm:ss"),solicitante:(r==null?void 0:r.id)||"",area:(r==null?void 0:r.area)||"",banco:(r==null?void 0:r.banco)||"",numero_cuenta:(r==null?void 0:r.numero_cuenta)||"",tipo_cambio:"3.55"}))},[s,r]),o.useEffect(()=>{n.monto_soles&&n.tipo_cambio&&f(p=>({...p,monto_dolares:(parseFloat(p.monto_soles)/parseFloat(p.tipo_cambio)).toFixed(2)}))},[n.monto_soles,n.tipo_cambio]);const c=p=>{const{name:b,value:g}=p.target;f(j=>({...j,[b]:b==="destinatario_id"?g?parseInt(g):null:g}))},v=async()=>{var b;const p={numero_solicitud:n.numero_solicitud,fecha:n.fecha,hora:n.hora,codigo:n.codigo,solicitante:n.solicitante,destinatario_id:n.destinatario_id,tipo_solicitud:n.tipo_solicitud,area:n.area,estado:"Pendiente para Atención",moneda:"PEN",tipo_cambio:n.tipo_cambio,total_soles:n.monto_soles||0,total_dolares:n.monto_dolares||0,fecha_transferencia:n.fecha_transferencia,fecha_liquidacion:n.fecha_liquidacion,banco:n.banco,numero_cuenta:n.numero_cuenta,concepto_gasto:n.concepto_gasto,observacion:n.observacion};try{await P.post("boleta/solicitudes/guardar-solicitud/",p),Aa.fire("¡Guardado!","La solicitud fue registrada correctamente","success"),U.emit("solicitudCreada",p),a==null||a(),t==null||t(),l("/dashboard/liquidaciones/solicitud")}catch(g){const j=((b=g==null?void 0:g.response)==null?void 0:b.data)||{};Aa.fire("Error",`No se pudo guardar la solicitud. Detalles: ${JSON.stringify(j)}`,"error")}};return e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"max-w-5xl w-[95%] max-h-[90vh] overflow-y-auto bg-white",children:[e.jsx(W,{children:e.jsxs(J,{className:"flex items-center gap-2 text-lg sm:text-xl md:text-2xl font-bold text-gray-800",children:[e.jsx(Zs,{className:"w-5 h-5 sm:w-6 sm:h-6"})," Nueva Solicitud de Gasto"]})}),e.jsx("p",{className:"text-gray-700 mb-6 text-xs sm:text-sm md:text-base",children:"Completa los campos para registrar una nueva solicitud de gasto."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm sm:text-base md:text-lg font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(as,{className:"w-4 h-4 sm:w-5 sm:h-5"})," Datos Generales"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(ne,{label:"N° Solicitud",value:n.numero_solicitud,readOnly:!0}),e.jsx(ne,{label:"Fecha",value:n.fecha,readOnly:!0}),e.jsx(ne,{label:"Hora",value:n.hora,readOnly:!0}),e.jsx(ne,{label:"Código",value:n.codigo,readOnly:!0}),e.jsx(ne,{label:"Solicitante",value:r?`${r.nombre} ${r.apellido}`:"",readOnly:!0}),e.jsx(ia,{label:"Destinatario",name:"destinatario_id",value:n.destinatario_id,onChange:c,options:i}),e.jsx(ia,{label:"Tipo de Solicitud",name:"tipo_solicitud",value:n.tipo_solicitud,onChange:c,options:[{id:"Viáticos",nombre:"Viáticos",apellido:""},{id:"Movilidad",nombre:"Movilidad",apellido:""},{id:"Compras",nombre:"Compras",apellido:""},{id:"Otros Gastos",nombre:"Otros Gastos",apellido:""}]}),e.jsx(ne,{label:"Área",value:n.area,readOnly:!0})]}),e.jsxs("h3",{className:"text-sm sm:text-base md:text-lg font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(et,{className:"w-4 h-4 sm:w-5 sm:h-5"})," Monto y Fechas"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(ne,{label:"Monto en Soles",name:"monto_soles",value:n.monto_soles,onChange:c}),e.jsx(ne,{label:"Fecha Transferencia",type:"date",name:"fecha_transferencia",value:n.fecha_transferencia,onChange:c}),e.jsx(ne,{label:"Fecha Liquidación",type:"date",name:"fecha_liquidacion",value:n.fecha_liquidacion,onChange:c})]}),e.jsxs("h3",{className:"text-sm sm:text-base md:text-lg font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(ss,{className:"w-4 h-4 sm:w-5 sm:h-5"})," Datos Bancarios"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(ia,{label:"Banco",name:"banco",value:n.banco,onChange:c,options:[{id:"BCP",nombre:"BCP",apellido:""},{id:"Interbank",nombre:"Interbank",apellido:""}]}),e.jsx(ne,{label:n.banco==="Interbank"?"CCI":"Número de Cuenta",name:"numero_cuenta",value:n.numero_cuenta,onChange:c})]}),e.jsxs("h3",{className:"text-sm sm:text-base md:text-lg font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(at,{className:"w-4 h-4 sm:w-5 sm:h-5"})," Detalles del Gasto"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(Ea,{label:"Concepto de Gasto",name:"concepto_gasto",value:n.concepto_gasto,onChange:c}),e.jsx(Ea,{label:"Observación",name:"observacion",value:n.observacion,onChange:c})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 mt-6",children:[e.jsx(R,{onClick:t,className:"bg-gradient-to-r from-gray-300 to-gray-400 hover:from-gray-400 hover:to-gray-500 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",children:"Cancelar"}),e.jsx(R,{onClick:v,className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",children:"Guardar"})]})]})})}const hr=st,_s=o.forwardRef(({className:s,...t},a)=>e.jsx(ts,{ref:a,className:M("inline-flex items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500",s),...t}));_s.displayName=ts.displayName;const Ve=o.forwardRef(({className:s,...t},a)=>e.jsx(rs,{ref:a,className:M("inline-flex min-w-[100px] items-center justify-center rounded-sm px-3 py-1.5 text-sm font-medium transition-all","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","data-[state=active]:bg-white data-[state=active]:text-black",s),...t}));Ve.displayName=rs.displayName;const fa=o.forwardRef(({className:s,...t},a)=>e.jsx(os,{ref:a,className:M("mt-2 rounded-md border p-4 bg-white shadow-sm",s),...t}));fa.displayName=os.displayName;function Ds({open:s,onClose:t,solicitudId:a,solicitudInit:r}){const{authUser:l}=oe(),[i,n]=o.useState(r||null),[f,c]=o.useState([]),[v,p]=o.useState(!i),[b,g]=o.useState(!1),[j,x]=o.useState(!1),[d,m]=o.useState(null),h=()=>(l==null?void 0:l.rol)==="Colaborador"&&(i==null?void 0:i.estado)==="Pendiente de Envío";return o.useEffect(()=>{if(!a)return;(async()=>{try{p(!0);const{data:w}=await P.get(`/boleta/mis_solicitudes/${a}/`);n(w);try{const{data:S}=await P.get(`/boleta/mis_solicitudes/${a}/historial/`);c(S)}catch{c([])}}catch(w){console.error("❌ Error al cargar solicitud:",w),alert("No se pudo cargar la solicitud.")}finally{p(!1)}})()},[a]),e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"max-w-4xl w-[95%] max-h-[90vh] overflow-y-auto bg-white rounded-2xl shadow-lg animate-fadeIn",children:[e.jsxs(W,{children:[e.jsxs(J,{className:"flex items-center gap-2 text-lg sm:text-xl font-bold text-gray-800",children:[e.jsx(Y,{className:"w-5 h-5"}),"Detalles de la Solicitud ",(i==null?void 0:i.numero_solicitud)||"-"]}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:["Usuario: ",l!=null&&l.nombre?`${l.nombre} ${l.apellido||""}`:"Usuario"]})]}),v?e.jsx("p",{className:"text-gray-500",children:"Cargando solicitud..."}):i?e.jsxs(e.Fragment,{children:[e.jsxs(hr,{defaultValue:"basicos",className:"w-full mt-2",children:[e.jsxs(_s,{className:"grid grid-cols-3 gap-2 mb-4",children:[e.jsxs(Ve,{value:"basicos",className:"flex items-center gap-1",children:[e.jsx(as,{className:"w-4 h-4"})," Básicos"]}),e.jsxs(Ve,{value:"historial",className:"flex items-center gap-1",children:[e.jsx(tt,{className:"w-4 h-4"})," Historial"]}),e.jsxs(Ve,{value:"adjuntos",className:"flex items-center gap-1",children:[e.jsx(ns,{className:"w-4 h-4"})," Adjuntos"]})]}),e.jsx(fa,{value:"basicos",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(ee,{label:"N° Solicitud",value:i.numero_solicitud}),e.jsx(ee,{label:"Fecha",value:i.fecha}),e.jsx(ee,{label:"Destinatario",value:i.destinatario_nombre||"-"}),e.jsx(ee,{label:"Tipo de Solicitud",value:i.tipo_solicitud}),e.jsx(ee,{label:"Concepto",value:i.concepto_gasto}),e.jsx(ee,{label:"Estado",value:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs sm:text-sm font-semibold ${Ne[i.estado]||"bg-gray-200 text-gray-700"}`,children:i.estado})}),e.jsx(ee,{label:"Observación",value:i.observacion}),e.jsx(ee,{label:"Total (S/.)",value:i.total_soles}),e.jsx(ee,{label:"Total (USD)",value:i.total_dolares}),e.jsx(ee,{label:"Fecha Transferencia",value:i.fecha_transferencia}),e.jsx(ee,{label:"Fecha Liquidación",value:i.fecha_liquidacion}),e.jsx(ee,{label:"Banco",value:i.banco}),e.jsx(ee,{label:"N° Cuenta",value:i.numero_cuenta})]})}),e.jsx(fa,{value:"adjuntos",children:e.jsx("p",{className:"text-gray-500",children:"Aquí se mostrarán los documentos adjuntos."})})]}),e.jsx("div",{className:"flex justify-end mt-6 gap-3 flex-wrap",children:h()&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(R,{onClick:()=>{m("enviar"),x(!0)},disabled:b,className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-5 py-2 rounded-lg shadow-lg font-semibold transition-all duration-200",children:b&&d==="enviar"?"Procesando...":"Enviar Solicitud"})})}),j&&d==="enviar"&&e.jsx(Q,{open:j,onOpenChange:()=>x(!1),children:e.jsxs(V,{className:"max-w-md w-[90%] p-6 bg-white rounded-xl shadow-2xl animate-fadeInDown",children:[e.jsx(W,{children:e.jsx(J,{className:"text-lg font-bold text-gray-800",children:"Confirmar envío"})}),e.jsxs("p",{className:"mt-2 text-gray-600",children:["¿Deseas enviar esta solicitud? Una vez enviada, pasará a ",e.jsx("b",{children:"Pendiente para Atención"}),"."]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-3",children:[e.jsx(R,{variant:"outline",onClick:()=>x(!1),children:"Cancelar"}),e.jsx(R,{onClick:async()=>{var y,w,S;g(!0);try{const{data:C}=await P.patch(`/boleta/mis_solicitudes/${i.id}/estado/`,{estado:"Pendiente para Atención"});n(E=>{var _;return{...E,estado:((_=C.solicitud)==null?void 0:_.estado)||"Pendiente para Atención"}}),U.emit("solicitudEnviada",{numero_solicitud:((y=C.solicitud)==null?void 0:y.numero_solicitud)||i.numero_solicitud}),x(!1),m(null)}catch(C){console.error("❌ Error al enviar solicitud:",C),alert(((S=(w=C.response)==null?void 0:w.data)==null?void 0:S.error)||"No se pudo enviar la solicitud.")}finally{g(!1)}},disabled:b,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Sí, enviar"})]})]})})]}):e.jsx("p",{className:"text-gray-500",children:"No se encontró la solicitud."})]})})}function ee({label:s,value:t}){return e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-3 sm:p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:s}),e.jsx("p",{className:"text-sm sm:text-base lg:text-lg font-semibold text-gray-800 break-words",children:t||"-"})]})}const Fs=({open:s,onClose:t})=>{const[a,r]=o.useState([]),[l,i]=o.useState("Todos"),[n,f]=o.useState(""),[c,v]=o.useState(""),[p,b]=o.useState(!1),[g,j]=o.useState(null);o.useEffect(()=>{s&&x();const h=C=>{r(E=>[C,...E])},y=C=>{r(E=>E.map(_=>_.numero_solicitud===C.numero_solicitud?{..._,estado:"Enviada"}:_))},w=U.on("solicitudCreada",h),S=U.on("solicitudEnviada",y);return()=>{w(),S()}},[s]);const x=async()=>{try{const h=await P.get("/boleta/mis_solicitudes/");r(h.data)}catch(h){console.error("Error cargando solicitudes:",h)}},d=a.filter(h=>{const y=l==="Todos"||h.estado===l,w=(!n||new Date(h.fecha)>=new Date(n))&&(!c||new Date(h.fecha)<=new Date(c));return y&&w}),m=(h,y,w=null)=>{w&&(j(w),b(!0))};return e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"max-w-6xl w-[95%] max-h-[90vh] overflow-y-auto bg-white",children:[e.jsx(W,{children:e.jsxs(J,{className:"flex items-center gap-2 text-xl sm:text-2xl font-bold text-gray-800",children:[e.jsx(Y,{className:"w-6 h-6"}),"Mis Solicitudes"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Estado:"}),e.jsxs("select",{value:l,onChange:h=>i(h.target.value),className:"border rounded-md px-2 py-1 text-sm",children:[e.jsx("option",{value:"Todos",children:"Todos"}),Object.keys(Le).map((h,y)=>e.jsx("option",{value:h,children:h},y))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Desde:"}),e.jsx("input",{type:"date",value:n,onChange:h=>f(h.target.value),className:"border rounded-md px-2 py-1 text-sm"}),e.jsx("label",{className:"text-sm font-medium",children:"Hasta:"}),e.jsx("input",{type:"date",value:c,onChange:h=>v(h.target.value),className:"border rounded-md px-2 py-1 text-sm"})]})]}),e.jsx(Pe,{headers:["N° Solicitud","Tipo","Monto (S/.)","Monto ($)","Fecha","Concepto","Estado","Acción"],data:d,emptyMessage:"No hay solicitudes en este estado o rango de fechas.",renderRow:h=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 font-semibold text-center",children:h.numero_solicitud}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Sa[h.tipo_solicitud]||"bg-gray-200 text-gray-700"}`,children:h.tipo_solicitud})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:h.total_soles?`S/. ${h.total_soles}`:"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:h.total_dolares?`$ ${h.total_dolares}`:"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:h.fecha}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:h.concepto_gasto??"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Le[h.estado]||"bg-gray-200 text-gray-700"}`,children:h.estado})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>m(h.id,"Ver Detalle",h),className:"flex items-center gap-1",children:[e.jsx(ge,{className:"w-4 h-4"})," Detalle"]})})]})}),p&&g&&e.jsx(Ds,{open:p,onClose:()=>b(!1),solicitudId:g==null?void 0:g.id,solicitudInit:g})]})})},Ge=Object.values(Ne),Ue=Object.values(ce);function pr(){return Array.from({length:12},(s,t)=>new Date(0,t).toLocaleString("es-PE",{month:"long"}))}function gr(){const{authUser:s}=oe(),t=pr(),a={total:0,montoTotalSoles:0,montoTotalDolares:0,promedioSoles:0,promedioDolares:0,chartAreaMes:t.map(d=>({mes:d.charAt(0).toUpperCase()+d.slice(1),solicitudes:0})),chartRadialEstado:Object.keys(Ne).map(d=>({name:d,value:0})),chartTreemapTipo:Object.keys(ce).map(d=>({name:d,value:0}))},[r,l]=o.useState(a),[i,n]=o.useState(!0),[f,c]=o.useState(null),[v,p]=o.useState(null),[b,g]=o.useState(!1),j=async()=>{if(!s)return;const d=localStorage.getItem("access_token");if(!d){c("Sesión expirada, inicia sesión nuevamente.");return}try{n(!0),c(null);const h=(await P.get("/boleta/solicitudes/dashboard/",{headers:{Authorization:`Bearer ${d}`}})).data||{},y=h.chartAreaMes&&h.chartAreaMes.length===12?h.chartAreaMes.map((C,E)=>({mes:t[E].charAt(0).toUpperCase()+t[E].slice(1),solicitudes:C.solicitudes??C.value??0})):a.chartAreaMes,w=h.chartRadialEstado&&h.chartRadialEstado.length?Object.keys(Ne).map(C=>{const E=(h.chartRadialEstado||[]).find(_=>String(_.name).toLowerCase().includes(String(C).toLowerCase()));return{name:C,value:E?Number(E.value||0):0}}):a.chartRadialEstado;let S=[];h.chartTreemapTipo&&h.chartTreemapTipo.length?(S=h.chartTreemapTipo.map(C=>({name:C.name,value:Number(C.value||0)})),Object.keys(ce).forEach(C=>{S.find(E=>String(E.name).toLowerCase()===C.toLowerCase())||S.push({name:C,value:0})})):S=a.chartTreemapTipo,l(C=>({...C,...h,chartAreaMes:y,chartRadialEstado:w,chartTreemapTipo:S}))}catch(m){console.error("Error al cargar datos",m),c(m.message||"No se pudieron cargar los datos."),l(a)}finally{n(!1)}};if(o.useEffect(()=>{j();const d=U.on("solicitudCreada",()=>j()),m=U.on("solicitudEnviada",()=>j());return()=>{d(),m()}},[s]),!s||i)return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"h-8 w-1/3 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6",children:Array.from({length:5}).map((d,m)=>e.jsx("div",{className:"bg-gray-200 h-24 rounded animate-pulse"},m))})]});if(f)return e.jsx("p",{className:"text-red-500 font-semibold p-6",children:f});const x=[{label:"Total Solicitudes",value:r.total??0,icon:Se,gradient:"linear-gradient(135deg,#3b82f6cc,#60a5fa99)",tooltip:"Número total de solicitudes registradas."},{label:"Monto Total S/.",value:parseFloat(r.montoTotalSoles??0),icon:se,gradient:"linear-gradient(135deg,#0ea5e9cc,#60a5fa99)",tooltip:"Suma total en soles."},{label:"Monto Total $",value:parseFloat(r.montoTotalDolares??0),icon:se,gradient:"linear-gradient(135deg,#7c3aedcc,#a78bfa99)",tooltip:"Suma total en dólares."},{label:"Promedio S/.",value:parseFloat(r.promedioSoles??0),icon:Ye,gradient:"linear-gradient(135deg,#14b8a6cc,#34d39999)",tooltip:"Promedio por solicitud en soles."},{label:"Promedio $",value:parseFloat(r.promedioDolares??0),icon:Ye,gradient:"linear-gradient(135deg,#f59e0bcc,#fbbf24aa)",tooltip:"Promedio por solicitud en dólares."}];return e.jsxs("div",{className:"min-h-screen w-full flex flex-col p-4 sm:p-6 bg-gray-50 overflow-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2 text-gray-800 mb-6",children:[e.jsx(We,{className:"w-7 h-7 text-gray-800"})," Solicitud de Gasto"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 md:gap-6 mb-6",children:x.map(d=>e.jsx(Ie,{label:d.label,value:d.value,icon:d.icon,gradient:d.gradient,tooltip:d.tooltip,decimals:Number.isInteger(d.value)?0:2},d.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 w-full",children:[e.jsx(re,{title:"Estados de Solicitudes",icon:e.jsx(fe,{className:"w-5 h-5 text-gray-700"}),subtitle:"Última actualización",className:"h-[350px] w-[550px]",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 h-full items-stretch",children:[e.jsx("div",{className:"flex-1 min-h-[220px]",children:e.jsx(q,{width:"100%",height:260,children:e.jsxs(Qe,{innerRadius:"10%",outerRadius:"95%",data:r.chartRadialEstado,children:[e.jsx(Xe,{minAngle:10,background:!0,clockWise:!0,dataKey:"value",cornerRadius:8,children:r.chartRadialEstado.map((d,m)=>e.jsx(te,{fill:Ge[m%Ge.length]},`cell-${m}`))}),e.jsx(G,{formatter:Ze,wrapperStyle:{outline:"none"}})]})})}),e.jsx("div",{className:"w-full lg:w-48 flex-shrink-0",children:r.chartRadialEstado.map((d,m)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[e.jsx("span",{style:{width:12,height:12,background:Ge[m%Ge.length],display:"inline-block",borderRadius:3}}),e.jsx("span",{className:"font-medium",children:d.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",d.value,")"]})]},d.name))})]})}),e.jsx(re,{title:"Tipos de Solicitudes",icon:e.jsx(rt,{className:"w-5 h-5 text-gray-700"}),className:"h-[350px] w-[550px]",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 h-full items-stretch",children:[e.jsx("div",{className:"flex-1 min-h-[220px]",children:e.jsx(q,{width:"100%",height:260,children:e.jsxs(Qe,{innerRadius:"10%",outerRadius:"95%",data:r.chartTreemapTipo,children:[e.jsx(Xe,{minAngle:10,background:!0,clockWise:!0,dataKey:"value",cornerRadius:8,children:r.chartTreemapTipo.map((d,m)=>e.jsx(te,{fill:Ue[m%Ue.length]||"#334155"},`cell-type-${m}`))}),e.jsx(G,{formatter:Ze,wrapperStyle:{outline:"none"}})]})})}),e.jsx("div",{className:"w-full lg:w-48 flex-shrink-0",children:r.chartTreemapTipo.map((d,m)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[e.jsx("span",{style:{width:12,height:12,background:Ue[m%Ue.length]||"#334155",display:"inline-block",borderRadius:3}}),e.jsx("span",{className:"font-medium",children:d.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",d.value,")"]})]},d.name))})]})})]}),e.jsx("div",{className:"grid grid-cols-1 mt-6",children:e.jsx(re,{title:"Evolución Mensual",icon:e.jsx(sa,{className:"w-5 h-5 text-gray-700"}),className:"h-[420px]",tooltipFormatter:Re,children:e.jsx(q,{width:"100%",height:320,children:e.jsxs(ls,{data:r.chartAreaMes,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorArea",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.35}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.05})]})}),e.jsx(Ce,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(de,{dataKey:"mes",stroke:"#6b7280",tick:{fontSize:12}}),e.jsx(me,{stroke:"#6b7280",domain:[0,"dataMax + 1"],allowDecimals:!1}),e.jsx(G,{wrapperStyle:{outline:"none"}}),e.jsx(is,{type:"monotone",dataKey:"solicitudes",stroke:"#3b82f6",fill:"url(#colorArea)",strokeWidth:3})]})})})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-6",children:[e.jsxs(R,{onClick:()=>p("nueva"),className:"bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white text-sm px-4 py-2 rounded-lg shadow-md transition flex items-center gap-2 justify-center",children:[e.jsx(We,{className:"w-5 h-5"})," Nueva Solicitud"]}),e.jsxs(R,{onClick:()=>g(!0),className:"bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-white text-sm px-4 py-2 rounded-lg shadow-md transition flex items-center gap-2 justify-center",children:[e.jsx(Se,{className:"w-5 h-5"})," Mis Solicitudes"]})]}),e.jsx(As,{open:v==="nueva",onClose:()=>p(null),onCreated:j}),e.jsx(Fs,{open:b,onClose:()=>g(!1),onRefresh:j})]})}function fr({solicitudId:s,onClose:t,onDecided:a}){const{authUser:r,logout:l}=oe(),i=ze(),[n,f]=o.useState(null),[c,v]=o.useState(!0),[p,b]=o.useState(""),[g,j]=o.useState(null),[x,d]=o.useState(null);o.useEffect(()=>{(async()=>{var y;if(!(!r||!s)){v(!0),d(null);try{const w=localStorage.getItem("access_token"),{data:S}=await P.get(`/boleta/solicitudes/${s}/`,{headers:{Authorization:`Bearer ${w}`}});f(S)}catch(w){console.error(w),d("No se pudo cargar la información de la solicitud."),((y=w==null?void 0:w.response)==null?void 0:y.status)===401&&l()}finally{v(!1)}}})()},[r,s,l]);const m=async h=>{var y;if(s){j(h);try{const w=localStorage.getItem("access_token");await P.post(`/boleta/solicitudes/${s}/decision/`,{decision:h,comentario:p},{headers:{Authorization:`Bearer ${w}`}}),h==="Atendido"?U.emit("solicitudAtendida",{id:s}):h==="Rechazado"&&U.emit("solicitudRechazada",{id:s}),a&&a(h==="Atendido"?"Solicitud atendida correctamente.":"Solicitud rechazada correctamente."),t(),h==="Atendido"&&i("/dashboard/liquidaciones")}catch(w){console.error(w),xs.error("Error al registrar la acción."),((y=w==null?void 0:w.response)==null?void 0:y.status)===401&&l()}finally{j(null)}}};return s?e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex justify-center items-center z-50 px-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-3xl shadow-xl relative border border-gray-100 dark:border-gray-700 overflow-y-auto max-h-[90vh]",children:[e.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:hover:text-gray-200",onClick:t,"aria-label":"Cerrar",children:"✖"}),c?e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Cargando solicitud..."})}):x?e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:"text-red-500 font-semibold",children:x})}):e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100 text-center md:text-left",children:["Solicitud ",n==null?void 0:n.numero_solicitud]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-5 text-sm sm:text-base",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ta,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Solicitante:"})," ",(n==null?void 0:n.solicitante_nombre)||(n==null?void 0:n.solicitante)||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ya,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Tipo:"})," ",(n==null?void 0:n.tipo_solicitud)||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(cs,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Monto S/:"})," ",(Number((n==null?void 0:n.total_soles)??0)||0).toFixed(2)]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Monto $:"})," ",(Number((n==null?void 0:n.total_dolares)??0)||0).toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Fecha:"})," ",n!=null&&n.fecha?new Date(n.fecha).toLocaleDateString("es-PE"):"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ds,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Estado actual:"})," ",(n==null?void 0:n.estado)||"—"]}),(n==null?void 0:n.banco)&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ss,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Banco:"})," ",n.banco]}),(n==null?void 0:n.numero_cuenta)&&e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ms,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"N° Cuenta:"})," ",n.numero_cuenta]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"mb-2 font-medium text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-gray-700"}),"Comentario del revisor (opcional)"]}),e.jsx("textarea",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-400",rows:4,value:p,onChange:h=>b(h.target.value),placeholder:"Agregar comentario opcional..."})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-3 mt-4",children:[e.jsx("button",{className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-2 rounded-lg shadow-md transition",onClick:()=>m("Rechazado"),disabled:g==="Rechazado",children:"Rechazar"}),e.jsx("button",{className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2 rounded-lg shadow-md transition",onClick:()=>m("Atendido"),disabled:g==="Atendido",children:"Atender"})]})]})]})}):null}function br(){const{authUser:s,logout:t}=oe(),[a,r]=o.useState([]),[l,i]=o.useState(!0),[n,f]=o.useState(null),[c,v]=o.useState(null),p=o.useCallback(async()=>{var x;if(s){i(!0),f(null);try{const d=localStorage.getItem("access_token"),{data:m}=await P.get("/boleta/solicitudes/pendientes/",{headers:{Authorization:`Bearer ${d}`},params:{destinatario_id:s.id,estado:"Pendiente para Atención"}});r(m)}catch(d){console.error(d),f("No se pudieron cargar las solicitudes pendientes."),((x=d==null?void 0:d.response)==null?void 0:x.status)===401&&t()}finally{i(!1)}}},[s,t]);o.useEffect(()=>(U.on("solicitudEnviada",p),U.on("solicitudAtendida",p),U.on("solicitudRechazada",p),()=>{U.off("solicitudEnviada",p),U.off("solicitudAtendida",p),U.off("solicitudRechazada",p)}),[p]),o.useEffect(()=>{p()},[p]);const{kpis:b,serie:g,estados:j}=o.useMemo(()=>{const x=a.filter(_=>_.estado==="Pendiente para Atención").length,d=a.filter(_=>_.estado==="Atendido, Pendiente de Liquidación").length,m=a.filter(_=>_.estado==="Rechazado").length,h=a.filter(_=>_.estado==="Pendiente para Atención").reduce((_,k)=>_+(parseFloat(k.total_soles)||0),0),y=a.filter(_=>_.estado==="Atendido, Pendiente de Liquidación").reduce((_,k)=>_+(parseFloat(k.total_soles)||0),0),w=a.filter(_=>_.estado==="Rechazado").reduce((_,k)=>_+(parseFloat(k.total_soles)||0),0),S=new Map;a.forEach(_=>{if(_.estado==="Pendiente para Atención"){const O=new Date(_.fecha).toLocaleDateString("es-PE");S.set(O,(S.get(O)||0)+1)}});const C=[];for(let _=29;_>=0;_--){const k=new Date;k.setDate(k.getDate()-_);const O=k.toLocaleDateString("es-PE");C.push({dia:O,pendientes:S.get(O)||0})}const E={};return a.forEach(_=>{const k=_.estado||"Sin estado";E[k]=(E[k]||0)+1}),{kpis:{totalPendientes:x,totalAtendidas:d,totalRechazadas:m,montoPendienteSoles:h,montoAtendidoSoles:y,montoRechazadoSoles:w},serie:C,estados:Object.entries(E).map(([_,k])=>({name:_,value:k}))}},[a]);return l?e.jsxs("div",{className:"p-6 space-y-6 min-h-screen flex flex-col",children:[e.jsx("div",{className:"h-8 w-2/3 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Array.from({length:4}).map((x,d)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-2xl animate-pulse"},d))}),e.jsx("div",{className:"h-72 bg-gray-200 rounded-2xl animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded-2xl animate-pulse"})]}):n?e.jsx("div",{className:"p-6 min-h-screen flex flex-col",children:e.jsx("p",{className:"text-red-500 font-semibold",children:n})}):e.jsxs("div",{className:"p-6 w-full space-y-8 min-h-screen flex flex-col",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:e.jsxs("h2",{className:"text-2xl font-bold text-black flex items-center gap-3",children:[e.jsx($a,{size:24}),"Atención de Solicitudes",e.jsx("button",{onClick:p,className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition",children:e.jsx(nt,{size:18})})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 md:gap-6 mb-6",children:[{label:"Pendientes",value:b.totalPendientes,gradient:"linear-gradient(135deg, #f97316cc, #fb923c99)",icon:ra},{label:"Atendidas",value:b.totalAtendidas,gradient:"linear-gradient(135deg,#3b82f6cc,#60a5fa99)",icon:oa},{label:"Rechazadas",value:b.totalRechazadas,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",icon:aa},{label:"Monto Pendiente S/.",value:b.montoPendienteSoles,gradient:"linear-gradient(135deg, #facc15cc, #fcd34d99)",icon:se},{label:"Monto Atendido S/.",value:b.montoAtendidoSoles,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",icon:se},{label:"Monto Rechazado S/.",value:b.montoRechazadoSoles,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",icon:se}].map(x=>e.jsx(Ie,{...x,decimals:isNaN(x.value)?0:String(x.value).includes(".")?2:0},x.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(re,{title:"Evolución de solicitudes",icon:e.jsx(Y,{size:18}),className:"h-80",tooltipFormatter:Re,children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(ls,{data:g,margin:{top:10,right:20,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorPend",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#2563eb",stopOpacity:.45}),e.jsx("stop",{offset:"95%",stopColor:"#2563eb",stopOpacity:.05})]})}),e.jsx(Ce,{strokeDasharray:"3 3",opacity:.3}),e.jsx(de,{dataKey:"dia",tick:{fontSize:11},minTickGap:24}),e.jsx(me,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(G,{contentStyle:{borderRadius:10,border:"none",boxShadow:"0 6px 18px rgba(0,0,0,.12)"},labelStyle:{fontWeight:600},formatter:Re}),e.jsx(is,{type:"monotone",dataKey:"pendientes",stroke:"#2563eb",fill:"url(#colorPend)",strokeWidth:2})]})})}),e.jsx(re,{title:"Distribución por estado",icon:e.jsx(ye,{size:18}),className:"h-80",tooltipFormatter:Ze,children:e.jsx("div",{className:"flex flex-col lg:flex-row h-full gap-4 items-stretch",children:e.jsx("div",{className:"flex-1 min-h-[220px]",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsx(Qe,{innerRadius:"10%",outerRadius:"95%",data:j,children:e.jsx(Xe,{minAngle:10,background:!0,clockWise:!0,dataKey:"value",cornerRadius:8,children:j.map((x,d)=>e.jsx(te,{fill:Ne[x.name]||"#9ca3af"},`cell-${d}`))})})})})})})]}),e.jsx(Pe,{headers:["N° Solicitud","Solicitante","Tipo","Monto S/.","Monto $","Fecha","Estado","Acciones"],data:a,emptyMessage:"No hay solicitudes pendientes por ahora.",renderRow:x=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 sm:px-4 py-3 font-semibold text-center",children:x.numero_solicitud||"-"}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center",children:x.solicitante_nombre||"-"}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center hidden sm:table-cell",children:x.tipo_solicitud||"-"}),e.jsxs("td",{className:"px-3 sm:px-4 py-3 text-center",children:["S/ ",(Number(x.total_soles)||0).toFixed(2)]}),e.jsxs("td",{className:"px-3 sm:px-4 py-3 text-center",children:["$ ",(Number(x.total_dolares)||0).toFixed(2)]}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center hidden sm:table-cell",children:x.fecha?new Date(x.fecha).toLocaleDateString("es-PE"):"-"}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Le[x.estado]||"bg-gray-100 text-gray-700"}`,children:x.estado||"Sin estado"})}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center",children:e.jsxs("button",{className:"bg-indigo-500 hover:bg-indigo-600 text-white text-sm px-3 py-1.5 rounded-lg shadow-md flex items-center gap-2 justify-center",onClick:()=>v(x.id),children:[e.jsx(ge,{size:16})," Revisar"]})})]})}),c&&e.jsx(fr,{solicitudId:c,onClose:()=>v(null),onDecided:x=>{x&&xs.success(x),v(null),p()}})]})}const jr="http://localhost:8000/api/boleta/documentos",yr=async s=>{var t,a;try{const r=await ea.post(`${jr}/procesar/`,s,{headers:{"Content-Type":"multipart/form-data"}}),{datos_detectados:l}=r.data||{};console.log("✅ OCR recibido:",l);const n=["ruc"].filter(f=>!(l!=null&&l[f])||l[f]==="No encontrado"||l[f]==="");return n.length>0&&console.warn(`⚠️ OCR incompleto. Faltan: ${n.join(", ")}`),l||{}}catch(r){throw console.error("❌ Error procesando OCR:",r),new Error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"No se pudo procesar el documento. Intenta nuevamente con otra imagen.")}};function Ms({idSolicitud:s,tipoSolicitud:t,open:a,onClose:r,onProcesado:l}){const[i,n]=o.useState("Boleta"),[f,c]=o.useState(null),[v,p]=o.useState(!1),[b,g]=o.useState(null),[j,x]=o.useState(""),[d,m]=o.useState(!1);o.useEffect(()=>{const w=/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);m(w)},[]);const h=w=>{const S=w.target.files[0];S&&(c(S),g(null),x(""))},y=async()=>{if(!f){alert("⚠️ Selecciona un archivo antes de procesar.");return}const w=new FormData;w.append("archivo",f),w.append("tipo_documento",i),w.append("id_solicitud",s);try{p(!0);const S=await yr(w);console.log("📦 OCR recibido:",S);const C=S!=null&&S.total?S.total.toString().trim().replace(",","."):"";if((!C||C==="0.00")&&!j){alert("⚠️ El OCR no detectó el total. Ingresa el importe manualmente."),p(!1);return}l({...S,total:C||j,tipo_documento:i,nombre_archivo:f.name,archivo:f}),r()}catch(S){console.error("❌ Error procesando OCR:",S),g("No se pudo procesar el documento. Intenta nuevamente.")}finally{p(!1)}};return e.jsx(Q,{open:a,onOpenChange:r,children:e.jsxs(V,{className:"w-[95vw] max-w-md h-auto max-h-[90vh] overflow-y-auto",children:[e.jsx(W,{children:e.jsxs(J,{className:"flex items-center gap-2 text-base sm:text-lg",children:[e.jsx(_a,{className:"w-5 h-5 text-gray-700"}),"Subir Documento - Solicitud # ",s]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tipo de Documento"}),e.jsxs("select",{value:i,onChange:w=>n(w.target.value),className:"mt-1 p-2 w-full border rounded-md focus:ring focus:ring-blue-200 text-sm",children:[e.jsx("option",{value:"",children:"--Seleccionar--"}),e.jsx("option",{value:"Boleta",children:"Boleta"}),e.jsx("option",{value:"Factura",children:"Factura"}),e.jsx("option",{value:"Honorarios",children:"Honorarios"}),e.jsx("option",{value:"Otros",children:"Otros"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[d&&e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:h,style:{display:"none"}}),e.jsxs("span",{className:"bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white text-sm px-4 py-2 rounded-lg shadow-md flex items-center gap-2 justify-center",children:[e.jsx(lt,{className:"w-4 h-4"})," Cámara"]})]}),e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*,application/pdf",onChange:h,style:{display:"none"}}),e.jsxs("span",{className:"bg-gradient-to-r from-amber-200 to-amber-300 hover:from-amber-300 hover:to-amber-400 text-white text-sm px-4 py-2 rounded-lg shadow-md flex items-center gap-2 justify-center",children:[e.jsx(_a,{className:"w-4 h-4"})," Archivo"]})]})]}),f&&e.jsxs("p",{className:"text-xs text-gray-600 mt-2 flex items-center gap-1 truncate",children:[e.jsx(ns,{className:"w-4 h-4"})," ",f.name]}),!b&&f&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Total (si OCR no lo detecta)"}),e.jsx("input",{type:"number",step:"0.01",value:j,onChange:w=>x(w.target.value),className:"mt-1 p-2 w-full border rounded-md focus:ring focus:ring-blue-200 text-sm",placeholder:"Ej. 150.75"})]}),b&&e.jsxs("p",{className:"text-sm text-red-600 bg-red-100 rounded p-2 flex items-center gap-2",children:[e.jsx(it,{className:"w-4 h-4"})," ",b]})]}),e.jsxs(xe,{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[e.jsxs(R,{variant:"outline",onClick:r,className:"bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white text-sm px-4 py-2 rounded-lg flex items-center gap-2 justify-center w-full sm:w-auto",children:[e.jsx($e,{className:"w-4 h-4"})," Cerrar"]}),e.jsx(R,{onClick:y,disabled:v,className:"bg-gradient-to-r from-green-400 to-green-500 hover:from-green-500 hover:to-green-600 text-white text-sm px-4 py-2 rounded-lg flex items-center gap-2 justify-center w-full sm:w-auto",children:v?"Procesando...":e.jsxs(e.Fragment,{children:[e.jsx(oa,{className:"w-4 h-4"})," Procesar"]})})]})]})})}const vr=3.52,Rs=({open:s,onClose:t,solicitud:a})=>{const[r,l]=o.useState([]),[i,n]=o.useState(!1),[f,c]=o.useState(!1);if(!a)return null;const{totalSoles:v,totalDolares:p}=o.useMemo(()=>{const d=r.reduce((m,h)=>m+parseFloat(h.total||0),0);return{totalSoles:d,totalDolares:d/vr}},[r]),b=d=>{l(m=>[...m,d]),console.log("✅ Documento agregado:",d)},g=d=>{l(m=>m.filter(h=>h!==d))},j=d=>{if(!d)return;const m=URL.createObjectURL(d);window.open(m,"_blank","noopener,noreferrer")},x=async()=>{if(r.length===0){alert("⚠️ Debes agregar al menos un comprobante antes de presentar.");return}try{n(!0);const d=new FormData;d.append("solicitud_id",a.id),d.append("estado","Liquidación enviada para Aprobación"),d.append("total_documentado_soles",v.toFixed(2)),d.append("total_documentado_dolares",p.toFixed(2)),r.forEach((m,h)=>{d.append(`documentos[${h}][archivo]`,m.archivo),d.append(`documentos[${h}][tipo_documento]`,m.tipo_documento),d.append(`documentos[${h}][numero_documento]`,m.numero_documento),d.append(`documentos[${h}][fecha]`,m.fecha),d.append(`documentos[${h}][ruc]`,m.ruc),d.append(`documentos[${h}][razon_social]`,m.razon_social),d.append(`documentos[${h}][total]`,m.total)}),await P.post("/boleta/documentos/guardar/",d,{headers:{"Content-Type":"multipart/form-data"}}),alert("✅ Liquidación presentada y documentos guardados correctamente."),t()}catch(d){console.error("❌ Error presentando liquidación:",d),alert("❌ Ocurrió un error al presentar la liquidación. Intenta nuevamente.")}finally{n(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"w-full max-w-5xl max-h-[90vh] overflow-y-auto p-4 sm:p-6",children:[e.jsx(W,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-gray-700"}),"Presentar Documentación"]})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx(je,{children:e.jsxs(ve,{className:"p-4 space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Solicitud:"})," ",a.numero_solicitud]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ta,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Solicitante:"})," ",a.solicitante||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ya,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Tipo:"})," ",a.tipo_solicitud||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(cs,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Monto Soles (S/.):"})," ",a.total_soles||a.monto||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Monto Dólares ($):"})," ",a.total_dolares||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Fecha:"})," ",a.fecha||"—"]}),e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(ds,{className:"w-4 h-4 text-gray-800"}),e.jsx("span",{className:"font-semibold",children:"Estado actual:"})," ",a.estado||"Pendiente"]})]})}),e.jsx(je,{children:e.jsxs(ve,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-2",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(ct,{className:"w-5 h-5 text-gray-700"}),"Comprobantes OCR"]}),e.jsxs(R,{size:"sm",onClick:()=>c(!0),className:"bg-gradient-to-r from-violet-400 to-violet-500 hover:from-violet-500 hover:to-violet-600 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2",children:[e.jsx(es,{className:"h-4 w-4"})," Agregar"]})]}),e.jsx(Pe,{headers:["Nombre del Archivo","N° Doc","Tipo","Fecha","RUC","Razón Social","Total"],data:r,emptyMessage:"No se han agregado comprobantes todavía.",renderRow:d=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 py-3 text-center cursor-pointer text-blue-600 hover:underline",onClick:()=>j(d.archivo),children:d.nombre_archivo}),e.jsx("td",{className:"px-3 py-3 text-center",children:d.numero_documento}),e.jsx("td",{className:"px-3 py-3 text-center",children:d.tipo_documento}),e.jsx("td",{className:"px-3 py-3 text-center",children:d.fecha}),e.jsx("td",{className:"px-3 py-3 text-center",children:d.ruc}),e.jsx("td",{className:"px-3 py-3 text-center",children:d.razon_social}),e.jsx("td",{className:"px-3 py-3 text-center",children:d.total})]}),onDeleteRow:d=>g(d)}),e.jsxs("div",{className:"mt-4 text-right font-semibold text-gray-800 text-sm sm:text-base",children:[e.jsxs("p",{children:["Total: S/ ",v.toFixed(2)]}),e.jsxs("p",{children:["Total: $ ",p.toFixed(2)]})]})]})})]}),e.jsxs(xe,{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[e.jsxs(R,{onClick:t,className:"bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white text-sm px-4 py-2 rounded-lg flex items-center gap-2 w-full sm:w-auto",children:[e.jsx($e,{className:"w-4 h-4"})," Cancelar"]}),e.jsxs(R,{onClick:x,disabled:i||r.length===0,className:"bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white text-sm px-4 py-2 rounded-lg flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(dt,{className:"w-4 h-4"})," ",i?"Presentando...":"Presentar Liquidación"]})]})]})}),f&&e.jsx(Ms,{idSolicitud:a.id,open:f,onClose:()=>c(!1),onProcesado:b})]})};function Nr(){const{authUser:s,logout:t}=oe(),[a,r]=o.useState([]),[l,i]=o.useState(!0),[n,f]=o.useState(null),[c,v]=o.useState(""),[p,b]=o.useState(""),[g,j]=o.useState(""),[x,d]=o.useState(""),[m,h]=o.useState(""),[y,w]=o.useState(null),[S,C]=o.useState(!1),E=o.useCallback(async()=>{var N,A,$;i(!0),f(null);try{const L=localStorage.getItem("access_token"),{data:H}=await P.get("/boleta/liquidaciones_pendientes/",{headers:{Authorization:`Bearer ${L}`}});console.log("✅ Liquidaciones pendientes raw:",H);const X=H.map(ue=>{var u;return{...ue,solicitante:((u=ue.solicitante)==null?void 0:u.replace(/\s*<.*?>/,"").trim())||"-"}});console.log("✅ Liquidaciones pendientes limpias:",X),r(X)}catch(L){console.error("Error cargando solicitudes pendientes:",L),f(((A=(N=L==null?void 0:L.response)==null?void 0:N.data)==null?void 0:A.detail)||"No se pudieron cargar las liquidaciones pendientes."),(($=L==null?void 0:L.response)==null?void 0:$.status)===401&&t()}finally{i(!1)}},[t]);o.useEffect(()=>(U.on("solicitudAtendida",E),U.on("solicitudRechazada",E),()=>{U.off("solicitudAtendida",E),U.off("solicitudRechazada",E)}),[E]),o.useEffect(()=>{E()},[E]);const _=o.useMemo(()=>{const N=new Set(a.map(A=>A.solicitante));return Array.from(N)},[a]),k=o.useMemo(()=>a.filter(N=>{const A=N.solicitante.toLowerCase().includes(c.toLowerCase())||N.numero_solicitud.toString().includes(c),$=p===""||N.solicitante===p,L=g===""||N.tipo_solicitud===g,H=(!x||new Date(N.fecha)>=new Date(x))&&(!m||new Date(N.fecha)<=new Date(m));return A&&$&&L&&H}),[a,c,p,g,x,m]),O=o.useMemo(()=>{const N=k.length,A=k.reduce((H,X)=>H+(X.total_soles||0),0),$=k.reduce((H,X)=>H+(X.total_dolares||0),0),L=N?(A/N).toFixed(2):0;return{total:N,totalSoles:A,totalDolares:$,promedio:L}},[k]),K=o.useMemo(()=>Object.entries(k.reduce((N,A)=>(N[A.tipo_solicitud]=(N[A.tipo_solicitud]||0)+1,N),{})).map(([N,A])=>({name:N,value:A})),[k]),T=o.useMemo(()=>Object.entries(k.reduce((N,A)=>(N[A.tipo_solicitud]=(N[A.tipo_solicitud]||0)+(A.total_soles||0),N),{})).map(([N,A])=>({name:N,value:Number(A.toFixed(2))})),[k]),D=(N,A,$)=>{w($),C(!0)};return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-center md:justify-start items-center mb-4",children:e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold flex items-center gap-2 text-black",children:[e.jsx(Ia,{className:"w-5 sm:w-6 h-5 sm:h-6"})," Liquidaciones Pendientes"]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 text-center",children:[{label:"Total Pendientes",value:O.total,gradient:"linear-gradient(135deg, #f97316cc, #fb923c99)",icon:ra,tooltip:"Número total de solicitudes pendientes."},{label:"Monto Total (S/)",value:O.totalSoles,gradient:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)",icon:se,tooltip:"Monto acumulado en soles.",decimals:2},{label:"Monto Total ($)",value:O.totalDolares,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",icon:se,tooltip:"Monto acumulado en dólares.",decimals:2},{label:"Promedio por Solicitud (S/)",value:O.promedio,gradient:"linear-gradient(135deg, #f59e0bcc, #fcd34d99)",icon:se,tooltip:"Promedio por solicitud.",decimals:2}].map((N,A)=>e.jsx(Ie,{...N},A))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsx(re,{title:"Montos por Tipo de Solicitud (S/.)",icon:e.jsx(mt,{className:"w-4 h-4"}),className:"h-72",tooltipFormatter:N=>`S/ ${N.toLocaleString()}`,children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:T,layout:"vertical",margin:{left:20},children:[e.jsx(Ce,{strokeDasharray:"3 3",opacity:.2}),e.jsx(de,{type:"number"}),e.jsx(me,{dataKey:"name",type:"category",width:100}),e.jsx(G,{formatter:N=>`S/ ${N.toLocaleString()}`}),e.jsx(Me,{dataKey:"value",barSize:35,children:T.map((N,A)=>e.jsx(te,{fill:ce[N.name]||"#9CA3AF"},A))})]})})}),e.jsx(re,{title:"Distribución por Tipo",icon:e.jsx(xt,{className:"w-4 h-4"}),className:"h-72",tooltipFormatter:Re,children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:K,children:[e.jsx(Ce,{strokeDasharray:"3 3",opacity:.2}),e.jsx(de,{dataKey:"name"}),e.jsx(me,{allowDecimals:!1}),e.jsx(G,{formatter:Re}),e.jsx(Me,{dataKey:"value",barSize:35,children:K.map((N,A)=>e.jsx(te,{fill:ce[N.name]||"#9CA3AF"},A))})]})})})]}),e.jsx("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 items-center",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-600 mb-1 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"})," Solicitante"]}),e.jsxs("select",{value:p,onChange:N=>b(N.target.value),className:"border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-400 focus:outline-none",children:[e.jsx("option",{value:"",children:"Todos"}),_.map(N=>e.jsx("option",{value:N,children:N},N))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-600 mb-1 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"})," Tipo"]}),e.jsxs("select",{value:g,onChange:N=>j(N.target.value),className:"border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-green-400 focus:outline-none",children:[e.jsx("option",{value:"",children:"Todos"}),Object.keys(ce).map(N=>e.jsx("option",{value:N,children:N},N))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-semibold text-gray-600 mb-1 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-purple-500 rounded-full"})," Rango de Fechas"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx("input",{type:"date",value:x,onChange:N=>d(N.target.value),className:"border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-400 focus:outline-none w-full sm:w-auto"}),e.jsx("span",{className:"text-gray-400 text-xs hidden sm:inline",children:"→"}),e.jsx("input",{type:"date",value:m,onChange:N=>h(N.target.value),className:"border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-400 focus:outline-none w-full sm:w-auto"})]})]})]})}),e.jsx(Pe,{headers:["N° Solicitud","Tipo","Monto (S/.)","Monto ($)","Fecha","Concepto","Estado","Acción"],data:k,emptyMessage:"No hay solicitudes en este estado o rango de fechas.",renderRow:N=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 font-semibold text-center",children:N.numero_solicitud}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Sa[N.tipo_solicitud]||"bg-gray-200 text-gray-700"}`,children:N.tipo_solicitud})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:N.total_soles?`S/. ${N.total_soles}`:"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:N.total_dolares?`$ ${N.total_dolares}`:"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:N.fecha}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:N.concepto_gasto??"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Le[N.estado]||"bg-gray-200 text-gray-700"}`,children:N.estado})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>D(N.id,"Presentar Documentación",N),className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4"})," Presentar"]})})]})}),S&&e.jsx(Rs,{open:S,onClose:()=>C(!1),solicitud:y})]})}function wr({open:s,onClose:t,accion:a,onConfirm:r,liquidacion:l}){if(!a)return null;const i={aprobar:{text:"aprobar",color:"from-green-400 to-green-600",icon:e.jsx(Xa,{className:"w-5 h-5"})},ajuste:{text:"ajustar",color:"from-orange-400 to-orange-600",icon:e.jsx(ht,{className:"w-5 h-5"})},rechazar:{text:"rechazar",color:"from-red-400 to-red-600",icon:e.jsx(aa,{className:"w-5 h-5"})},devolucion:{text:"devolver",color:"from-yellow-400 to-yellow-600",icon:e.jsx(ut,{className:"w-5 h-5"})}},{text:n,color:f,icon:c}=i[a]||i.aprobar;return e.jsx(Q,{open:s,onOpenChange:t,children:e.jsx(V,{className:"p-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl overflow-hidden border border-gray-200",children:[e.jsx(W,{className:"p-4 border-b border-gray-100",children:e.jsxs(J,{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(I.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.3},children:c}),"Confirmar acción"]})}),e.jsx(I.div,{className:"p-4 text-gray-700",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3,delay:.1},children:e.jsxs("p",{className:"text-sm",children:["¿Estás seguro de que deseas ",e.jsx("strong",{children:n}),l?` la liquidación #${l.id}`:" esta liquidación","?"]})}),e.jsxs(xe,{className:"p-4 flex justify-end gap-2 border-t border-gray-100",children:[e.jsx(R,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(I.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:e.jsx(R,{className:`bg-gradient-to-r ${f} text-white hover:brightness-110 transition-all flex items-center gap-1`,onClick:r,children:e.jsx(I.span,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:n.charAt(0).toUpperCase()+n.slice(1)})})})]})]})})})}function Sr({open:s,onClose:t,documento:a}){const r=o.useRef();if(!a)return null;const l=a.archivo_url||a.url,i=()=>{if(!l)return;const n=window.open("","_blank");n.document.write(`
      <html>
        <head>
          <title>${a.nombre||"Documento"}</title>
        </head>
        <body style="margin:0; display:flex; justify-content:center; align-items:center; height:100vh;">
          <img src="${l}" style="max-width:100%; max-height:100vh;" />
        </body>
      </html>
    `),n.document.close(),n.focus(),n.print(),n.close()};return e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"max-w-3xl w-full shadow-xl rounded-xl p-6",children:[e.jsx(W,{children:e.jsx(J,{children:a.nombre||a.numero_documento||"Documento"})}),e.jsx("div",{className:"flex justify-center my-4",children:l?e.jsx("img",{ref:r,src:l,alt:a.nombre||"Documento",className:"max-h-[70vh] w-auto object-contain rounded border"}):e.jsx("p",{className:"text-center text-gray-500",children:"No hay vista disponible"})}),e.jsxs(xe,{className:"flex justify-between",children:[e.jsx(R,{variant:"outline",onClick:t,children:"Cerrar"}),l&&e.jsx(R,{onClick:i,children:"Imprimir"})]})]})})}const ca=3.52;function Cr({open:s,onClose:t,liquidacion:a}){var h;const[r,l]=o.useState(!1),[i,n]=o.useState(null);if(!a)return null;const f={Pendiente:"#facc15",Aprobado:"#16a34a",Rechazado:"#ef4444","Aprobado con ajuste":"#f59e0b",Devolucion:"#f97316"}[a.estado]||"#ccc",c=y=>Number(y).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2}),v=y=>(y/ca).toFixed(2),p=o.useMemo(()=>a.total_documentado||a.monto,[a]),b=p/ca,g=a.monto-p,j=g/ca,x=y=>{n(y),l(!0)},d=y=>typeof y=="string"?y:y.numero_documento||y.nombre_archivo||"Documento",m=y=>(y==null?void 0:y.archivo_url)||null;return e.jsxs(e.Fragment,{children:[e.jsx(Q,{open:s,onOpenChange:t,children:e.jsxs(V,{className:"max-w-lg shadow-xl rounded-xl p-6","aria-describedby":`detalle-liquidacion-${a.id}`,children:[e.jsxs(W,{children:[e.jsxs(J,{children:["Liquidación #",a.id]}),e.jsx(Ss,{id:`detalle-liquidacion-${a.id}`,children:"Detalles"})]}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Operación:"})," ",a.numero_operacion||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",a.fecha]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Solicitante:"})," ",a.solicitante]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("span",{className:"font-semibold",children:"Monto Solicitado:"}),e.jsxs("span",{children:["S/ ",c(a.monto)]}),e.jsxs("span",{children:["$ ",v(a.monto)]}),e.jsx("span",{className:"font-semibold",children:"Total Documentado:"}),e.jsxs("span",{children:["S/ ",c(p)]}),e.jsxs("span",{children:["$ ",v(b)]}),e.jsx("span",{className:"font-semibold",children:"Diferencia:"}),e.jsxs("span",{children:["S/ ",c(g)]}),e.jsxs("span",{children:["$ ",v(j)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Estado:"}),e.jsx(ie,{style:{backgroundColor:f,color:"#fff"},children:a.estado})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Observaciones:"})," ",a.observaciones||"Sin observaciones"]}),((h=a.documentos)==null?void 0:h.length)>0&&e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Documentos:"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.documentos.map((y,w)=>{const S=d(y),C=m(y);return e.jsx(ie,{variant:"outline",className:"cursor-pointer hover:bg-blue-100 transition",onClick:()=>C?window.open(C,"_blank"):x(y),children:S},w)})})]})]}),e.jsx(xe,{className:"mt-4",children:e.jsx(R,{variant:"outline",onClick:t,children:"Cerrar"})})]})}),r&&i&&e.jsx(Sr,{open:r,documento:i,onClose:()=>l(!1)})]})}const Oa=!0,da=3.52,kr=[{id:1,numero_operacion:"OP-1001",fecha:"2025-08-14",monto_soles:150,monto_dolares:42.96,tipo:"Viáticos",estado:"Pendiente de Envío",solicitante:"Juan Pérez",observaciones:"Documento completo",documentos:["F001-123","F002-456"]},{id:2,numero_operacion:"OP-1002",fecha:"2025-08-12",monto_soles:300,monto_dolares:86.09,tipo:"Movilidad",estado:"Pendiente para Atención",solicitante:"María López",observaciones:"Falta recibo",documentos:["F003-789"]},{id:3,numero_operacion:"OP-1003",fecha:"2025-08-10",monto:200,tipo:"Compras",estado:"Atendido, Pendiente de Liquidación",solicitante:"Carlos Díaz",observaciones:"Revisar gastos",documentos:["F004-101"]},{id:4,numero_operacion:"OP-1004",fecha:"2025-08-11",monto:500,tipo:"Otros gastos",estado:"Liquidación enviada para Aprobación",solicitante:"Ana Torres",observaciones:"Completo",documentos:["F005-202","F006-303"]},{id:5,numero_operacion:"OP-1005",fecha:"2025-08-09",monto:250,tipo:"Viáticos",estado:"Liquidación Aprobada",solicitante:"Luis Ramírez",observaciones:"",documentos:["F007-404"]},{id:6,numero_operacion:"OP-1006",fecha:"2025-08-08",monto:180,tipo:"Compras",estado:"Rechazado",solicitante:"Sofía Martínez",observaciones:"Error en factura",documentos:["F008-505"]}];function Ar(){const[s,t]=o.useState([]),[a,r]=o.useState(!0),[l,i]=o.useState(""),[n,f]=o.useState("Todas"),[c,v]=o.useState(""),[p,b]=o.useState(""),[g,j]=o.useState(""),[x,d]=o.useState(""),[m,h]=o.useState(""),[y,w]=o.useState(!1),[S,C]=o.useState(null),[E,_]=o.useState(!1),[k,O]=o.useState(""),[K,T]=o.useState(null),D=async()=>{try{r(!0),Oa&&setTimeout(()=>{t(kr),r(!1)},800)}catch(u){console.error(u),r(!1)}};o.useEffect(()=>{D()},[]);const N=o.useMemo(()=>s.filter(u=>{const F=u.solicitante.toLowerCase().includes(l.toLowerCase())||u.id.toString().includes(l),B=n==="Todas"||u.tipo===n,he=c===""||new Date(u.fecha)>=new Date(c),we=p===""||new Date(u.fecha)<=new Date(p),na=g===""||u.monto>=parseFloat(g),qe=x===""||u.monto<=parseFloat(x),Be=m===""||u.documentos.some(Es=>Es.toLowerCase().includes(m.toLowerCase()));return F&&B&&he&&we&&na&&qe&&Be}),[s,l,n,c,p,g,x,m]),A=o.useMemo(()=>{const u={Aprobado:0,Rechazado:0};let F=0,B=0;s.forEach(we=>{F++,B+=we.monto,u[we.estado]!==void 0&&u[we.estado]++});const he=B/da;return{Total:F,Aprobadas:u.Aprobado,Rechazadas:u.Rechazado,TotalSoles:B,TotalDolares:he}},[s]),$=async()=>{if(S)try{const u=ACTION_STATE_MAP[k];Oa&&t(F=>F.map(B=>B.id===S.id?{...B,estado:u}:B)),_(!1),w(!1),T(S.id),setTimeout(()=>T(null),1500)}catch(u){console.error(u)}},L=o.useMemo(()=>Object.entries(N.reduce((u,F)=>(u[F.estado]=(u[F.estado]||0)+1,u),{})).map(([u,F])=>({name:u,value:F})),[N]),H=o.useMemo(()=>Object.entries(N.reduce((u,F)=>(u[F.tipo]=(u[F.tipo]||0)+1,u),{})).map(([u,F])=>({name:u,value:F})),[N]),X=u=>Number(u).toLocaleString("es-PE",{minimumFractionDigits:2}),ue=u=>(u/da).toLocaleString("en-US",{minimumFractionDigits:2});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(qa,{className:"w-6 h-6"})," Aprobación de Liquidaciones"]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 md:gap-6 mb-6",children:[{label:"Total",value:A.Total,gradient:"linear-gradient(135deg, #6366f1cc, #818cf899)",icon:Je,tooltip:"Cantidad total de liquidaciones."},{label:"Aprobadas",value:A.Aprobadas,gradient:"linear-gradient(135deg, #16a34acc, #22c55e99)",icon:oa,tooltip:"Liquidaciones aprobadas."},{label:"Rechazadas",value:A.Rechazadas,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",icon:aa,tooltip:"Liquidaciones rechazadas."},{label:"Total S/",value:A.TotalSoles,gradient:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)",icon:Je,tooltip:"Monto total en soles."},{label:"Total $",value:A.TotalDolares,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",icon:se,tooltip:"Monto total en dólares."}].map(u=>e.jsx(Ie,{label:u.label,value:u.value,icon:u.icon,gradient:u.gradient,tooltip:u.tooltip,decimals:typeof u.value=="number"?0:2},u.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(re,{title:"Distribución por Estado",className:"h-64",tooltipFormatter:(u,F)=>[`${u}`,`${F}`],children:[e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(ye,{children:[e.jsx(Oe,{data:L,dataKey:"value",nameKey:"name",innerRadius:60,outerRadius:100,paddingAngle:5,children:L.map((u,F)=>e.jsx(te,{fill:Ne[u.name]},F))}),e.jsx(G,{})]})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total"}),e.jsx("div",{className:"text-xl font-bold",children:s.length})]})]})}),e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsx(re,{title:"Distribución por Tipo",className:"h-64",tooltipFormatter:(u,F)=>[`${u}`,`${F}`],children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:H,margin:{top:20,right:20,bottom:20,left:0},children:[e.jsx(de,{dataKey:"name",tick:{fill:"#6b7280",fontWeight:500},axisLine:{stroke:"#d1d5db"},tickLine:!1}),e.jsx(me,{allowDecimals:!1,tick:{fill:"#6b7280",fontWeight:500},axisLine:{stroke:"#d1d5db"},tickLine:!1}),e.jsx(G,{}),e.jsx(Me,{dataKey:"value",radius:[6,6,0,0],children:H.map((u,F)=>e.jsx(te,{fill:ce[u.name]},F))})]})})})})]}),e.jsxs(je,{className:"rounded-xl p-4 shadow-md mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsx(ae,{type:"date",value:c,onChange:u=>v(u.target.value),placeholder:"Desde"}),e.jsx(ae,{type:"date",value:p,onChange:u=>b(u.target.value),placeholder:"Hasta"}),e.jsx(ae,{type:"number",value:g,onChange:u=>j(u.target.value),placeholder:"Monto mínimo"}),e.jsx(ae,{type:"number",value:x,onChange:u=>d(u.target.value),placeholder:"Monto máximo"})]}),e.jsx(ae,{placeholder:"Documento...",value:m,onChange:u=>h(u.target.value),className:"mb-4"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["Todas","Viáticos","Movilidad","Compras","Otros gastos"].map(u=>e.jsx(ie,{className:"px-4 py-1 rounded-full cursor-pointer transition-transform hover:scale-105",style:{backgroundColor:n===u?ce[u]:"#f3f4f6",color:n===u?"#fff":"#000"},onClick:()=>f(u),children:u},u))})]}),e.jsx(ve,{children:a?e.jsx("p",{className:"text-center py-10 animate-pulse",children:"Cargando..."}):e.jsx(Pe,{headers:["Solicitante","Tipo","Fecha","Monto S/","Monto $","Estado","Documentos","Acciones"],data:N,emptyMessage:"No hay liquidaciones.",activeRow:K,renderRow:u=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",title:u.observaciones,children:u.solicitante}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx(ie,{className:`${Sa[u.tipo]||"bg-gray-200 text-gray-700"} px-3 py-1 rounded-full`,children:u.tipo})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:u.fecha}),e.jsxs("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:["S/ ",X(u.monto)]}),e.jsxs("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:["$ ",ue(u.monto/da)]}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx(ie,{className:`${Le[u.estado]||"bg-gray-200 text-gray-700"} px-3 py-1 rounded-full`,children:u.estado})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:u.documentos.map((F,B)=>e.jsx(ie,{variant:"outline",className:`mr-1 ${m&&F.toLowerCase().includes(m.toLowerCase())?"bg-yellow-300 font-medium shadow-md":""}`,children:F},B))}),e.jsxs("td",{className:"px-2 sm:px-4 py-2 sm:py-3 flex gap-1 justify-center",children:[e.jsx("button",{"data-tooltip-id":"tooltip","data-tooltip-content":"Ver Detalle",className:"bg-indigo-500 hover:bg-indigo-600 text-white p-2 rounded-lg shadow-md",onClick:()=>{C(u),w(!0)},children:e.jsx(ge,{size:16})}),e.jsx("button",{"data-tooltip-id":"tooltip","data-tooltip-content":"Aprobar",className:"bg-green-500 hover:bg-green-600 text-white p-2 rounded-lg shadow-md",onClick:()=>{C(u),O("aprobar"),_(!0)},children:e.jsx(pt,{size:16})}),e.jsx("button",{"data-tooltip-id":"tooltip","data-tooltip-content":"Rechazar",className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded-lg shadow-md",onClick:()=>{C(u),O("rechazar"),_(!0)},children:e.jsx($e,{size:16})})]})]})})}),y&&S&&e.jsx(Cr,{open:y,liquidacion:S,onClose:()=>w(!1)}),e.jsx(wr,{open:E,onClose:()=>_(!1),accion:k,onConfirm:$,liquidacion:S}),e.jsx(gt,{id:"tooltip",place:"top",effect:"solid"})]})}const Ca=!0;function _r({filtroId:s,setFiltroId:t,filtroUsuario:a,setFiltroUsuario:r,filtroTipo:l,setFiltroTipo:i,filtroDescripcion:n,setFiltroDescripcion:f,filtroFechaInicio:c,setFiltroFechaInicio:v,filtroFechaFin:p,setFiltroFechaFin:b,onLimpiarFiltros:g}){return e.jsxs("div",{className:"bg-white rounded-xl shadow p-4 border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(ms,{size:16})," ID"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por ID",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:s,onChange:j=>t(j.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(ta,{size:16})," Usuario"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por usuario",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:a,onChange:j=>r(j.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(ft,{size:16})," Tipo de Acción"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por tipo de acción",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:l,onChange:j=>i(j.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(Y,{size:16})," Descripción"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por descripción",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:n,onChange:j=>f(j.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(be,{size:16})," Fecha Inicio"]}),e.jsx("input",{type:"date",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:c,onChange:j=>v(j.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(be,{size:16})," Fecha Fin"]}),e.jsx("input",{type:"date",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:p,onChange:j=>b(j.target.value)})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("button",{onClick:g,className:`bg-gradient-to-r from-pink-500 to-rose-600 hover:from-pink-600 hover:to-rose-700 \r
                     text-white font-medium px-5 py-2 rounded-lg shadow-md transition flex items-center gap-2`,children:[e.jsx(bt,{size:16})," Limpiar filtros"]})})]})}function Dr(s){return s?new Date(s).toLocaleString():"-"}const Ke={tipos:{Aprobación:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Rechazo:"bg-red-200 text-red-800 dark:bg-red-700/40 dark:text-red-200",Devolución:"bg-orange-200 text-orange-800 dark:bg-orange-700/40 dark:text-orange-200",Pendiente:"bg-yellow-200 text-yellow-800 dark:bg-yellow-700/40 dark:text-yellow-200",Otro:"bg-indigo-200 text-indigo-800 dark:bg-indigo-700/40 dark:text-indigo-200"},acciones:{Aprobado:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Rechazado:"bg-red-200 text-red-800 dark:bg-red-700/40 dark:text-red-200",Pendiente:"bg-yellow-200 text-yellow-800 dark:bg-yellow-700/40 dark:text-yellow-200",Devolucion:"bg-orange-200 text-orange-800 dark:bg-orange-700/40 dark:text-orange-200",Otro:"bg-gray-200 text-gray-800 dark:bg-gray-700/40 dark:text-gray-200"}};function Fr({actividades:s,abrirModal:t}){return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(Y,{size:18}),"Registro de Actividades"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Total: ",s.length]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-100 text-center",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"N°"}),e.jsx("th",{className:"px-4 py-3",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3",children:"Acción"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Detalle"})]})}),e.jsxs("tbody",{children:[s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-10 text-center text-gray-500 dark:text-gray-400",children:"No hay actividades registradas por ahora."})}),s.map((a,r)=>e.jsxs(I.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"border-t border-gray-100 dark:border-gray-700 hover:shadow-lg hover:translate-y-[-2px] hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-transform duration-200",children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:r+1}),e.jsx("td",{className:"px-4 py-3",children:a.usuario??"-"}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ke.tipos[a.tipo]||Ke.tipos.Otro}`,children:a.tipo??"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ke.acciones[a.accion]||Ke.acciones.Otro}`,children:a.accion??"-"})}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:a.descripcion??"-"}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:Dr(a.fecha)??"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{onClick:()=>t(a),className:"bg-gradient-to-r from-indigo-300 to-indigo-400 hover:from-indigo-400 hover:to-indigo-500 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition flex items-center gap-2 justify-center",children:[e.jsx(ge,{size:16}),"Ver detalle"]})})]},a.id))]})]})})]})}function Mr(s){return s?new Date(s).toLocaleString():"-"}function Rr({actividad:s,isOpen:t,onClose:a}){return s?e.jsx(ba,{children:t&&e.jsx(I.div,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(I.div,{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 relative shadow-lg",initial:{scale:.8},animate:{scale:1},exit:{scale:.8},transition:{duration:.2},children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Detalle de Actividad"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"ID / Número"}),e.jsx("p",{className:"text-gray-800",children:s.id??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Fecha y Hora"}),e.jsx("p",{className:"text-gray-800",children:Mr(s.fecha)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Usuario"}),e.jsx("p",{className:"text-gray-800",children:s.usuario??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Tipo"}),e.jsx("p",{className:"text-gray-800",children:s.tipo??"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Acción"}),e.jsx("p",{className:"text-gray-800",children:s.accion??"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Descripción"}),e.jsx("p",{className:"text-gray-800",children:s.descripcion??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Estado"}),e.jsx("p",{className:`font-medium ${s.estado==="pendiente"?"text-yellow-600":s.estado==="completada"?"text-green-600":"text-gray-600"}`,children:s.estado??"-"})]}),s.documentos&&s.documentos.length>0&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Documentos Referenciados"}),e.jsx("ul",{className:"list-disc list-inside text-gray-800",children:s.documentos.map((r,l)=>e.jsx("li",{children:e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:r.nombre??`Documento ${l+1}`})},l))})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:a,className:"bg-gray-400 text-gray-800 px-4 py-2 rounded hover:bg-gray-500 transition",children:"Cerrar"})})]})})}):null}const ke={total:"#3b82f6",usuarios:"#22c55e",promedio:"#8b5cf6",frecuente:"#f59e0b",ultima:"#6366f1",eficiencia:"#10b981"},Ae={aprobado:"#22c55e",rechazado:"#ef4444",devolucion:"#f97316",pendiente:"#f59e0b",azul:"#3b82f6",morado:"#a78bfa"},Te="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center",Er="transition-all duration-300 hover:scale-[1.01] hover:shadow-md";function Or(){const[s,t]=o.useState([]),[a,r]=o.useState(!1),[l,i]=o.useState(null),[n,f]=o.useState(!1),[c,v]=o.useState(null),[p,b]=o.useState(""),[g,j]=o.useState(""),[x,d]=o.useState(""),[m,h]=o.useState(""),[y,w]=o.useState("fecha"),[S,C]=o.useState("desc");o.useEffect(()=>{E()},[]);const E=async()=>{r(!0),i(null);try{let u=[];Ca&&(u=[{id:1,fecha:"2025-08-14 | 08:30:00",usuario:"Juan",tipo:"Liquidaciones",accion:"Aprobado",descripcion:"Liquidación aprobada correctamente"},{id:2,fecha:"2025-08-14 | 09:15:00",usuario:"Maria",tipo:"Solicitudes",accion:"Pendiente",descripcion:"Solicitud de reembolso creada"},{id:3,fecha:"2025-08-14 | 10:45:00",usuario:"Carlos",tipo:"Liquidaciones",accion:"Rechazado",descripcion:"Liquidación con errores"},{id:4,fecha:"2025-08-14 | 11:30:00",usuario:"Ana",tipo:"Solicitudes",accion:"Devolución",descripcion:"Solicitud devuelta para corrección"}]),t(u)}catch(u){console.error(u),i("Error cargando actividades.")}finally{r(!1)}},_=u=>{v(u),f(!0)},k=()=>{f(!1),v(null)},O=o.useMemo(()=>s.filter(u=>{var qe,Be;const F=p?(qe=u.usuario)==null?void 0:qe.toLowerCase().includes(p.toLowerCase()):!0,B=g?(Be=u.tipo)==null?void 0:Be.toLowerCase().includes(g.toLowerCase()):!0,he=new Date(u.fecha),we=x?he>=new Date(x):!0,na=m?he<=new Date(m):!0;return F&&B&&we&&na}).sort((u,F)=>{if(y==="fecha")return S==="asc"?new Date(u.fecha)-new Date(F.fecha):new Date(F.fecha)-new Date(u.fecha);{const B=(u[y]??"").toString().toLowerCase(),he=(F[y]??"").toString().toLowerCase();return B<he?S==="asc"?-1:1:B>he?S==="asc"?1:-1:0}}),[s,p,g,x,m,y,S]),K=O.length,T=new Set(O.map(u=>u.usuario)).size,D=T>0?(K/T).toFixed(1):0,N=O.reduce((u,F)=>(u[F.accion]=(u[F.accion]||0)+1,u),{}),A=Object.entries(N).sort((u,F)=>F[1]-u[1])[0]||[],$=O.length>0?O[0].fecha:"Sin registros",L=N.Aprobado?(N.Aprobado/K*100).toFixed(1):0,H=Object.entries(N).map(([u,F])=>({name:u,value:F})),X=Object.entries(N).map(([u,F])=>({name:u,count:F})),ue=Object.values(O.reduce((u,F)=>{const B=new Date(F.fecha).toLocaleDateString();return u[B]=(u[B]||0)+1,u},{})).map((u,F)=>({fecha:Object.keys(N)[F],count:u}));return e.jsxs("div",{className:"p-6",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(Se,{className:"w-7 h-7 text-gray-800"}),"Registro de Actividades"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6 text-center mb-8",children:[{label:"Total Actividades",value:K,color:ke.total,icon:Da},{label:"Usuarios Activos",value:T,color:ke.usuarios,icon:va},{label:"Promedio por Usuario",value:D,color:ke.promedio,icon:Y},{label:"Acción más Frecuente",value:A.length>0?`${A[0]} (${A[1]})`:"N/A",color:ke.frecuente,icon:sa},{label:"Última Actividad",value:$,color:ke.ultima,icon:ra},{label:"% Aprobaciones",value:L+"%",color:ke.eficiencia,icon:jt}].map((u,F)=>e.jsxs("div",{className:`flex flex-col items-center justify-center text-white p-4 rounded-xl cursor-pointer ${Te}`,style:{background:`linear-gradient(135deg, ${u.color}cc, ${u.color}99)`},children:[e.jsx(u.icon,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm",children:u.label}),e.jsx("p",{className:"text-2xl font-bold",children:typeof u.value=="number"?e.jsx(De,{end:u.value,duration:1.2,separator:","}):u.value})]},F))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md ${Te}`,children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(fe,{className:"w-5 h-5 text-blue-500"})," Distribución de Acciones"]}),e.jsx(q,{width:"100%",height:300,children:e.jsxs(ye,{children:[e.jsx(Oe,{data:H,dataKey:"value",nameKey:"name",outerRadius:110,label:!0,children:H.map((u,F)=>e.jsx(te,{fill:Ae[u.name.toLowerCase()]||Ae.azul,stroke:"#fff",strokeWidth:2},`cell-${F}`))}),e.jsx(G,{contentStyle:{background:"#1f2937",color:"#fff",borderRadius:"8px"}}),e.jsx(pe,{})]})})]}),e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md ${Te}`,children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Ee,{className:"w-5 h-5 text-green-600"})," Cantidad por Acción"]}),e.jsx(q,{width:"100%",height:300,children:e.jsxs(Fe,{data:X,margin:{top:10,right:10,left:0,bottom:5},children:[e.jsx(Ce,{strokeDasharray:"3 3",strokeOpacity:.2}),e.jsx(de,{dataKey:"name"}),e.jsx(me,{}),e.jsx(G,{contentStyle:{background:"#1f2937",color:"#fff",borderRadius:"8px"}}),e.jsx(pe,{}),X.map((u,F)=>e.jsx(Me,{dataKey:"count",fill:Ae[u.name.toLowerCase()]||Ae.azul,name:u.name,radius:[6,6,0,0]},F))]})})]}),e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md ${Te}`,children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Da,{className:"w-5 h-5 text-purple-600"})," Evolución en el Tiempo"]}),e.jsx(q,{width:"100%",height:300,children:e.jsxs(us,{data:ue,children:[e.jsx(Ce,{strokeDasharray:"3 3",strokeOpacity:.2}),e.jsx(de,{dataKey:"fecha"}),e.jsx(me,{}),e.jsx(G,{contentStyle:{background:"#1f2937",color:"#fff",borderRadius:"8px"}}),e.jsx(pe,{}),e.jsx(hs,{type:"monotone",dataKey:"count",stroke:Ae.morado,strokeWidth:3,dot:{r:5,strokeWidth:2,fill:Ae.morado},activeDot:{r:8}})]})})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(_r,{filtroUsuario:p,setFiltroUsuario:b,filtroTipo:g,setFiltroTipo:j,filtroFechaInicio:x,setFiltroFechaInicio:d,filtroFechaFin:m,setFiltroFechaFin:h})}),l&&e.jsx("div",{className:`mb-4 p-3 bg-red-100 text-red-700 rounded ${Er}`,children:l}),a&&e.jsx("p",{children:"Cargando actividades..."}),!a&&e.jsx("div",{className:Te,children:e.jsx(Fr,{actividades:O,abrirModal:_})}),n&&c&&e.jsx(Rr,{actividad:c,cerrarModal:k})]})}function Pr({isOpen:s,onClose:t,onGuardar:a}){const[r,l]=o.useState(""),[i,n]=o.useState(""),[f,c]=o.useState(""),[v,p]=o.useState(""),[b,g]=o.useState([{cantidad:1,descripcion:""}]),j=()=>g([...b,{cantidad:1,descripcion:""}]),x=h=>g(b.filter((y,w)=>w!==h)),d=(h,y,w)=>{const S=[...b];S[h][y]=y==="cantidad"?Number(w):w,g(S)},m=()=>{if(!r||!i||!f){alert("Por favor, completa los campos obligatorios.");return}const h={origen:r,destino:i,responsable:f,observaciones:v,items:b,estado:"Pendiente",fecha:new Date().toISOString()};a(h),t(),l(""),n(""),c(""),p(""),g([{cantidad:1,descripcion:""}])};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 relative",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"📦 Crear Nueva Guía"}),e.jsxs("div",{className:"flex flex-col gap-3 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Origen *",className:"border rounded p-2",value:r,onChange:h=>l(h.target.value)}),e.jsx("input",{type:"text",placeholder:"Destino *",className:"border rounded p-2",value:i,onChange:h=>n(h.target.value)}),e.jsx("input",{type:"text",placeholder:"Responsable *",className:"border rounded p-2",value:f,onChange:h=>c(h.target.value)}),e.jsx("textarea",{placeholder:"Observaciones (opcional)",className:"border rounded p-2",value:v,onChange:h=>p(h.target.value)})]}),e.jsx("h3",{className:"font-semibold mb-2",children:"Ítems de la Guía"}),e.jsx("div",{className:"overflow-x-auto mb-4",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Cantidad"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Descripción"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Acciones"})]})}),e.jsx("tbody",{children:b.map((h,y)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx("input",{type:"number",min:1,className:"border rounded p-1 w-full",value:h.cantidad,onChange:w=>d(y,"cantidad",w.target.value)})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx("input",{type:"text",className:"border rounded p-1 w-full",value:h.descripcion,onChange:w=>d(y,"descripcion",w.target.value)})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center",children:e.jsx("button",{onClick:()=>x(y),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition",children:"Eliminar"})})]},y))})]})}),e.jsx("button",{onClick:j,className:"mb-4 bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition",children:"+ Agregar Ítem"}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:t,className:"bg-gray-400 text-gray-800 px-4 py-2 rounded hover:bg-gray-500 transition",children:"Cancelar"}),e.jsx("button",{onClick:m,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Guardar Guía"})]})]})}):null}function Tr({isOpen:s,onClose:t,guia:a}){var r;return!s||!a?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 relative",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Detalle de Guía #",a.numero??"-"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Fecha:"}),e.jsx("p",{children:new Date(a.fecha).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Responsable:"}),e.jsx("p",{children:a.responsable})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Origen:"}),e.jsx("p",{children:a.origen})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Destino:"}),e.jsx("p",{children:a.destino})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"font-semibold",children:"Observaciones:"}),e.jsx("p",{children:a.observaciones||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Estado:"}),e.jsx("span",{className:`px-2 py-1 rounded font-semibold ${a.estado==="Pendiente"?"bg-yellow-200 text-yellow-800":a.estado==="Enviada"?"bg-blue-200 text-blue-800":a.estado==="Recibida"?"bg-green-200 text-green-800":"bg-gray-200 text-gray-800"}`,children:a.estado})]})]}),e.jsx("h3",{className:"font-semibold mb-2",children:"Ítems de la Guía"}),e.jsx("div",{className:"overflow-x-auto mb-4",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Cantidad"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Descripción"})]})}),e.jsx("tbody",{children:((r=a.items)==null?void 0:r.length)>0?a.items.map((l,i)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:l.cantidad}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:l.descripcion})]},i)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-4",children:"No hay ítems registrados."})})})]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:t,className:"bg-gray-400 text-gray-800 px-4 py-2 rounded hover:bg-gray-500 transition",children:"Cerrar"}),e.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Imprimir / PDF"})]})]})})}const Pa={Pendiente:"bg-yellow-200 text-yellow-800 dark:bg-yellow-700/40 dark:text-yellow-200",Enviada:"bg-blue-200 text-blue-800 dark:bg-blue-700/40 dark:text-blue-200",Recibida:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Otro:"bg-gray-200 text-gray-800 dark:bg-gray-700/40 dark:text-gray-200"},Lr="transition-all duration-300 hover:shadow-lg hover:scale-[1.02] hover:bg-gray-50 dark:hover:bg-gray-700/40";function zr({guias:s,abrirDetalle:t}){const[a,r]=o.useState(""),[l,i]=o.useState(""),[n,f]=o.useState("fecha"),[c,v]=o.useState("desc"),p=g=>{n===g?v(c==="asc"?"desc":"asc"):(f(g),v("asc"))},b=o.useMemo(()=>s.filter(g=>{const j=a?g.responsable.toLowerCase().includes(a.toLowerCase()):!0,x=l?g.estado.toLowerCase().includes(l.toLowerCase()):!0;return j&&x}).sort((g,j)=>{if(n==="fecha")return c==="asc"?new Date(g.fecha)-new Date(j.fecha):new Date(j.fecha)-new Date(g.fecha);{const x=(g[n]??"").toString().toLowerCase(),d=(j[n]??"").toString().toLowerCase();return x<d?c==="asc"?-1:1:x>d?c==="asc"?1:-1:0}}),[s,a,l,n,c]);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(yt,{size:18}),"Guías de Salida"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Total: ",s.length]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4 items-end",children:[e.jsx("input",{type:"text",placeholder:"Filtrar por responsable",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:a,onChange:g=>r(g.target.value)}),e.jsx("input",{type:"text",placeholder:"Filtrar por estado",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:l,onChange:g=>i(g.target.value)}),e.jsx("button",{onClick:()=>{r(""),i("")},className:"bg-gradient-to-r from-indigo-400 to-indigo-500 hover:from-indigo-500 hover:to-indigo-600 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition",children:"Limpiar filtros"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-100 text-left",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 cursor-pointer",onClick:()=>p("numero"),children:"N°"}),e.jsx("th",{className:"px-4 py-3 cursor-pointer",onClick:()=>p("fecha"),children:"Fecha"}),e.jsx("th",{className:"px-4 py-3",children:"Origen → Destino"}),e.jsx("th",{className:"px-4 py-3 cursor-pointer",onClick:()=>p("responsable"),children:"Responsable"}),e.jsx("th",{className:"px-4 py-3",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Detalle"})]})}),e.jsxs("tbody",{children:[b.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-10 text-center text-gray-500 dark:text-gray-400",children:"No hay guías registradas por ahora."})}),b.map(g=>e.jsxs(I.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:`border-t border-gray-100 dark:border-gray-700 ${Lr}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:g.numero??"-"}),e.jsx("td",{className:"px-4 py-3",children:new Date(g.fecha).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3",children:[g.origen," → ",g.destino]}),e.jsx("td",{className:"px-4 py-3",children:g.responsable}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Pa[g.estado]||Pa.Otro}`,children:g.estado})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{onClick:()=>t(g),className:"bg-gradient-to-r from-indigo-400 to-indigo-500 hover:from-indigo-500 hover:to-indigo-600 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition flex items-center gap-2 justify-center transform hover:scale-[1.05]",children:[e.jsx(ge,{size:16}),"Ver detalle"]})})]},g.numero))]})]})})]})}const He={Pendiente:"#f59e0b",Enviada:"#3b82f6",Recibida:"#10b981"},$r={Pendiente:ra,Enviada:ps,Recibida:oa},ma="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center",_e="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center";function Ir(){const[s,t]=o.useState([]),[a,r]=o.useState(!1),[l,i]=o.useState(null),[n,f]=o.useState(!1),[c,v]=o.useState(null),[p,b]=o.useState(!1),[g,j]=o.useState(""),[x,d]=o.useState(""),[m,h]=o.useState(""),[y,w]=o.useState("");o.useEffect(()=>{S()},[]);const S=async()=>{r(!0),i(null);try{let D=[];Ca&&(D=[{id:1,fecha:"2025-08-14T08:00:00",origen:"Almacén A",destino:"Sucursal 1",responsable:"Juan",estado:"Pendiente",items:[{cantidad:10,descripcion:"Formularios"}]},{id:2,fecha:"2025-08-14T09:30:00",origen:"Almacén B",destino:"Sucursal 2",responsable:"Maria",estado:"Enviada",items:[{cantidad:5,descripcion:"Cartuchos"}]},{id:3,fecha:"2025-08-14T10:15:00",origen:"Almacén A",destino:"Sucursal 3",responsable:"Carlos",estado:"Recibida",items:[{cantidad:3,descripcion:"Documentos"}]}]),t(D)}catch(D){console.error(D),i("Error cargando guías de salida.")}finally{r(!1)}},C=D=>{v(D),f(!0)},E=()=>{f(!1),v(null)},_=o.useMemo(()=>s.filter(D=>{var X,ue;const N=g?(X=D.responsable)==null?void 0:X.toLowerCase().includes(g.toLowerCase()):!0,A=x?(ue=D.estado)==null?void 0:ue.toLowerCase().includes(x.toLowerCase()):!0,$=new Date(D.fecha),L=m?$>=new Date(m):!0,H=y?$<=new Date(y):!0;return N&&A&&L&&H}),[s,g,x,m,y]),k=_.length,O=_.reduce((D,N)=>(D[N.estado]=(D[N.estado]||0)+1,D),{}),K=Object.entries(O).map(([D,N])=>({name:D,value:N})),T=Object.entries(O).map(([D,N])=>({name:D,count:N}));return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ps,{})," Guías de Salida"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 text-center",children:[e.jsxs("div",{className:`${_e} flex flex-col items-center justify-center text-white p-4 rounded-xl`,style:{background:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)"},children:[e.jsx(Se,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm",children:"Total Guías"}),e.jsx("p",{className:"text-2xl font-bold",children:e.jsx(De,{end:k,duration:1.2,separator:","})})]}),K.map(D=>{const N=$r[D.name]||fe;return e.jsxs("div",{className:`${_e} flex flex-col items-center justify-center text-white p-4 rounded-xl`,style:{background:`linear-gradient(135deg, ${He[D.name]||"#6b7280"}cc, ${He[D.name]||"#6b7280"}99)`},children:[e.jsx(N,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm",children:D.name}),e.jsx("p",{className:"text-2xl font-bold",children:e.jsx(De,{end:D.value,duration:1.2,separator:","})})]},D.name)})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:`${ma} ${_e}`,children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(fe,{size:18})," Distribución por Estado"]}),e.jsx(q,{width:"100%",height:250,children:e.jsxs(ye,{children:[e.jsx(Oe,{data:K,dataKey:"value",nameKey:"name",outerRadius:80,label:!0,isAnimationActive:!0,children:K.map(D=>e.jsx(te,{fill:He[D.name]||"#6b7280"},D.name))}),e.jsx(G,{}),e.jsx(pe,{})]})})]}),e.jsxs("div",{className:`${ma} ${_e}`,children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Ee,{size:18})," Cantidad por Estado"]}),e.jsx(q,{width:"100%",height:250,children:e.jsxs(Fe,{data:T,margin:{top:10,right:20,left:0,bottom:5},children:[e.jsx(Ce,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name"}),e.jsx(me,{}),e.jsx(G,{}),e.jsx(pe,{}),T.map(D=>e.jsx(Me,{dataKey:"count",data:[D],fill:He[D.name]||"#6b7280"},D.name))]})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>b(!0),className:`${_e} flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-5 py-2 rounded-xl shadow hover:from-indigo-600 hover:to-indigo-700 transition`,children:[e.jsx(Wa,{size:18})," Crear Guía"]})}),e.jsxs("div",{className:`${ma} ${_e} flex flex-wrap gap-4 items-end`,children:[e.jsxs("div",{className:"flex flex-col flex-1 min-w-[180px]",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(ta,{size:16})," Responsable"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por responsable",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:g,onChange:D=>j(D.target.value)})]}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-[180px]",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(Y,{size:16})," Estado"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por estado",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:x,onChange:D=>d(D.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(be,{size:16})," Fecha Inicio"]}),e.jsx("input",{type:"date",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:m,onChange:D=>h(D.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(be,{size:16})," Fecha Fin"]}),e.jsx("input",{type:"date",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:y,onChange:D=>w(D.target.value)})]}),e.jsxs("button",{onClick:()=>{j(""),d(""),h(""),w("")},className:"flex items-center gap-2 bg-gradient-to-r from-gray-400 to-gray-500 text-white px-4 py-2 rounded-lg shadow hover:from-gray-500 hover:to-gray-600 transition",children:[e.jsx(ja,{size:16})," Limpiar"]})]}),l&&e.jsx("div",{className:"p-3 bg-red-100 text-red-700 rounded",children:l}),a?e.jsx("p",{children:"Cargando guías..."}):e.jsx(zr,{guias:_,abrirDetalle:C}),e.jsx(Tr,{guia:c,isOpen:n,onClose:E}),e.jsx(Pr,{isOpen:p,onClose:()=>b(!1),onSave:D=>t(N=>[D,...N])})]})}function qr({filtros:s={},setFiltros:t,data:a=[]}){const[r,l]=o.useState({fechaInicio:s.fechaInicio||"",fechaFin:s.fechaFin||"",categoria:s.categoria||"",responsable:s.responsable||""}),[i,n]=o.useState([]);o.useEffect(()=>{const c=[...new Set(a.map(v=>v.responsable))];n(c)},[a]);const f=()=>{t(r)};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-md mb-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4 items-end",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(be,{className:"mr-2",size:16})," Fecha Inicio"]}),e.jsx("input",{type:"date",value:r.fechaInicio,onChange:c=>l({...r,fechaInicio:c.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(be,{className:"mr-2",size:16})," Fecha Fin"]}),e.jsx("input",{type:"date",value:r.fechaFin,onChange:c=>l({...r,fechaFin:c.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(ya,{className:"mr-2",size:16})," Categoría"]}),e.jsxs("select",{value:r.categoria,onChange:c=>l({...r,categoria:c.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"Transporte",children:"Transporte"}),e.jsx("option",{value:"Alimentación",children:"Alimentación"}),e.jsx("option",{value:"Oficina",children:"Oficina"}),e.jsx("option",{value:"Hospedaje",children:"Hospedaje"}),e.jsx("option",{value:"Otros",children:"Otros"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(va,{className:"mr-2",size:16})," Responsable"]}),e.jsxs("select",{value:r.responsable,onChange:c=>l({...r,responsable:c.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",children:[e.jsx("option",{value:"",children:"Todos"}),i.map((c,v)=>e.jsx("option",{value:c,children:c},v))]})]}),e.jsx("div",{className:"flex items-center justify-start",children:e.jsxs("button",{onClick:f,className:"flex items-center gap-2 bg-gradient-to-r from-gray-400 to-gray-500 text-white px-4 py-2 rounded-lg shadow hover:from-gray-500 hover:to-gray-600 transition",children:[e.jsx(ja,{size:16})," Filtrar"]})})]})}const Ta=["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ef4444"];function Br({data:s}){const t=s.length>5?10:12;return e.jsxs(I.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(fe,{size:18})," Gastos por Categoría"]}),e.jsx(q,{width:"100%",height:"85%",children:e.jsxs(ye,{children:[e.jsx(Oe,{data:s,dataKey:"monto",nameKey:"categoria",cx:"50%",cy:"50%",outerRadius:100,label:{fontSize:t},children:s.map((a,r)=>e.jsx(te,{fill:Ta[r%Ta.length]},r))}),e.jsx(G,{formatter:a=>`S/ ${a}`}),e.jsx(pe,{})]})})]})}function Gr({data:s}){const t=s.length>8?-30:0,a=s.length>12?10:12,r=s.length>12?Math.max(8,60-s.length*2):50;return e.jsxs(I.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(Ee,{size:18})," Comparativa Mensual"]}),e.jsx(q,{width:"100%",height:"90%",children:e.jsxs(Fe,{data:s,margin:{top:10,right:20,left:0,bottom:10},children:[e.jsx(de,{dataKey:"mes",stroke:"#374151",tick:{fontSize:a,fontWeight:"bold",angle:t,textAnchor:t!==0?"end":"middle"}}),e.jsx(me,{stroke:"#374151",tick:{fontWeight:"bold"}}),e.jsx(G,{formatter:l=>`S/ ${l.toLocaleString()}`}),e.jsx(pe,{}),e.jsx(Me,{dataKey:"gastos",fill:"#3b82f6",barSize:r})]})})]})}function Ur({data:s}){return e.jsxs(I.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(sa,{size:18})," Tendencia de Gastos"]}),e.jsx(q,{width:"100%",height:"90%",children:e.jsxs(us,{data:s,children:[e.jsx(de,{dataKey:"mes",stroke:"#374151",tick:{fontWeight:"bold"}}),e.jsx(me,{stroke:"#374151",tick:{fontWeight:"bold"}}),e.jsx(G,{formatter:t=>`S/ ${t.toLocaleString()}`}),e.jsx(pe,{}),e.jsx(hs,{type:"monotone",dataKey:"gastos",stroke:"#10b981",strokeWidth:2})]})})]})}gs.register(vt,fs,bs);function Kr({data:s}){const t={labels:s.map(r=>r.categoria),datasets:[{label:"Gastos por Categoría",data:s.map(r=>r.monto),backgroundColor:["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ef4444"],borderColor:"#ffffff",borderWidth:2}]},a={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:"#374151"}},tooltip:{callbacks:{label:r=>`S/ ${r.raw}`}}},animation:{animateScale:!0,animateRotate:!0}};return e.jsxs(I.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(fe,{size:18})," Top Categorías de Gasto"]}),e.jsx("div",{className:"w-full h-[90%]",children:e.jsx(Nt,{data:t,options:a})})]})}gs.register(wt,St,Ct,kt,fs,bs);function Hr({data:s}){const t={labels:s.map(r=>r.responsable),datasets:[{label:"Gasto por Responsable",data:s.map(r=>r.monto),backgroundColor:"#3b82f6",borderColor:"#3b82f6",borderWidth:1,hoverBackgroundColor:"#2563eb",hoverBorderColor:"#2563eb"}]},a={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{color:"#374151",font:{weight:"bold"}}},tooltip:{callbacks:{label:r=>`S/ ${r.raw.toLocaleString()}`}}},scales:{x:{ticks:{color:"#374151",font:{weight:"bold"}},grid:{display:!1}},y:{beginAtZero:!0,ticks:{color:"#374151",font:{weight:"bold"}},grid:{color:"rgba(229,231,235,0.5)"}}},animation:{duration:1e3,easing:"easeOutQuart"}};return e.jsxs(I.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(Ee,{size:18})," Gasto por Responsable"]}),e.jsx("div",{className:"w-full h-[90%]",children:e.jsx(At,{data:t,options:a})})]})}const La={categorias:{Transporte:"bg-blue-200 text-blue-800 dark:bg-blue-700/40 dark:text-blue-200",Alimentación:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Oficina:"bg-indigo-200 text-indigo-800 dark:bg-indigo-700/40 dark:text-indigo-200",Hospedaje:"bg-purple-200 text-purple-800 dark:bg-purple-700/40 dark:text-purple-200",Otros:"bg-gray-200 text-gray-800 dark:bg-gray-700/40 dark:text-gray-200"}};function Vr({data:s=[],abrirModal:t}){return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 overflow-x-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(Y,{size:18}),"Detalle de Reportes"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Total: ",s.length]})]}),e.jsxs("table",{className:"min-w-full table-auto rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-100 text-center",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"#"}),e.jsx("th",{className:"px-4 py-3",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3",children:"Categoría"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3",children:"Monto"})]})}),e.jsxs("tbody",{children:[s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-10 text-center text-gray-500 dark:text-gray-400",children:"No hay registros disponibles."})}),s.map((a,r)=>{var l;return e.jsxs(I.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"border-t border-gray-100 dark:border-gray-700 hover:shadow-lg hover:translate-y-[-2px] hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-transform duration-200",children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:r+1}),e.jsx("td",{className:"px-4 py-3",children:a.fecha??"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${La.categorias[a.categoria]??La.categorias.Otros}`,children:a.categoria??"-"})}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:a.descripcion??"-"}),e.jsxs("td",{className:"px-4 py-3 font-semibold",children:["S/ ",((l=a.monto)==null?void 0:l.toFixed(2))??"0.00"]})]},a.id??r)})]})]})]})}function Wr(){const s=()=>window.open("/api/reportes/exportar_excel/","_blank"),t=()=>window.open("/api/reportes/exportar_pdf/","_blank");return e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsxs("button",{onClick:s,className:"px-4 py-2 bg-gradient-to-r from-green-400 to-green-500 hover:from-green-500 hover:to-green-600 text-white rounded-lg flex items-center gap-2 shadow-md transition transform hover:scale-[1.05]",children:[e.jsx(Fa,{size:18})," Exportar Excel"]}),e.jsxs("button",{onClick:t,className:"px-4 py-2 bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white rounded-lg flex items-center gap-2 shadow-md transition transform hover:scale-[1.05]",children:[e.jsx(Fa,{size:18})," Exportar PDF"]})]})}function Jr(){const[s,t]=o.useState({fechaInicio:"",fechaFin:"",categoria:"todas",rango:"mensual"}),[a,r]=o.useState({gastosPorCategoria:[],comparativoMensual:[],tendencias:[],tabla:[]}),l=async()=>{try{Ca&&r({gastosPorCategoria:[{categoria:"Transporte",monto:1200},{categoria:"Alimentación",monto:2e3},{categoria:"Oficina",monto:800}],comparativoMensual:[{mes:"Enero",gastos:1200},{mes:"Febrero",gastos:1600},{mes:"Marzo",gastos:1400}],tendencias:[{mes:"Enero",gastos:200},{mes:"Febrero",gastos:350},{mes:"Marzo",gastos:400}],tabla:[{id:1,fecha:"2025-01-10",categoria:"Transporte",descripcion:"Taxi",monto:300,responsable:"Juan"},{id:2,fecha:"2025-02-12",categoria:"Alimentación",descripcion:"Comida",monto:500,responsable:"Ana"},{id:3,fecha:"2025-03-15",categoria:"Oficina",descripcion:"Papelería",monto:800,responsable:"Luis"}]})}catch(x){console.error("Error cargando datos de reportes:",x)}};o.useEffect(()=>{l()},[s]);const i=a.tabla.reduce((x,d)=>x+d.monto,0),n=a.tabla.length?(i/3).toFixed(2):0,f=a.tabla.length?Math.max(...a.tabla.map(x=>x.monto)):0,c=a.tabla.length,v=new Set(a.tabla.map(x=>x.responsable)).size,p=1500,b=i-p,g=(b/p*100).toFixed(1),j="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center";return e.jsxs("div",{className:"p-4 md:p-6 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ee,{size:25,className:"text-gray-800"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Estadísticas y Reportes"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 md:gap-6 mb-6",children:[{label:"Total Gastos",value:i,icon:se,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",tooltip:"Suma total de todos los gastos registrados"},{label:"Promedio Mensual",value:n,icon:sa,gradient:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)",tooltip:"Gasto promedio mensual"},{label:"Mayor Gasto",value:f,icon:fe,gradient:"linear-gradient(135deg, #8b5cf6cc, #a78bfa99)",tooltip:"Registro de gasto individual más alto"},{label:"Transacciones",value:c,icon:Y,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",tooltip:"Número total de transacciones"},{label:"Responsables",value:v,icon:va,gradient:"linear-gradient(135deg, #facc15cc, #fcd34d99)",tooltip:"Cantidad de personas responsables"},{label:"Crecimiento Mensual",value:b,icon:b>=0?_t:Dt,gradient:"linear-gradient(135deg, #f97316cc, #fb923c99)",tooltip:`Cambio respecto al mes anterior: ${g}%`,positive:b>=0}].map(x=>{const d=x.icon,m=x.positive??!0;return e.jsxs("div",{className:j,style:{background:x.gradient},children:[e.jsx(d,{size:28,className:"text-white mb-2"}),e.jsxs("p",{className:"text-sm text-white opacity-90 flex items-center justify-center gap-1",children:[x.label,e.jsx(Ja,{content:x.tooltip,children:e.jsx(Ye,{size:16,className:"text-white opacity-70"})})]}),e.jsx("p",{className:`text-2xl font-bold text-white ${x.label==="Crecimiento Mensual"?m?"text-green-400":"text-red-400":""}`,children:e.jsx(De,{end:x.value,duration:1.5,separator:",",decimals:2,decimal:"."})})]},x.label)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6",children:[e.jsx("div",{className:j,children:e.jsx(Br,{data:a.gastosPorCategoria})}),e.jsx("div",{className:j,children:e.jsx(Gr,{data:a.comparativoMensual})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6",children:[e.jsx("div",{className:j,children:e.jsx(Kr,{data:a.gastosPorCategoria})}),e.jsx("div",{className:j,children:e.jsx(Hr,{data:a.tabla})})]}),e.jsx("div",{className:`${j} mb-6`,children:e.jsx(Ur,{data:a.tendencias})}),e.jsx("div",{className:`${j} mb-6 bg-gray-100 dark:bg-gray-700/50`,children:e.jsx(qr,{filtros:s,setFiltros:t,data:a.tabla})}),e.jsx("div",{className:`${j} mb-6`,children:e.jsx(Vr,{data:a.tabla})}),e.jsx("div",{className:`${j} mb-6`,children:e.jsx(Wr,{})})]})}function Yr(){return e.jsx(Ft,{children:e.jsxs(vs,{children:[e.jsx(Mt,{position:"top-right",autoClose:3e3}),e.jsxs(Rt,{children:[e.jsx(z,{path:"/login",element:e.jsx(Pt,{})}),e.jsx(z,{path:"/register",element:e.jsx($t,{})}),e.jsxs(z,{path:"/dashboard/*",element:e.jsx(Ot,{children:e.jsx(Gt,{})}),children:[e.jsx(z,{index:!0,element:e.jsx(or,{})}),e.jsx(z,{path:"gastos/programacion",element:e.jsx(xr,{})}),e.jsx(z,{path:"liquidaciones",element:e.jsx(Ra,{})}),e.jsx(z,{path:"liquidaciones/solicitud",element:e.jsx(gr,{})}),e.jsx(z,{path:"liquidaciones/solicitud/nueva",element:e.jsx(As,{})}),e.jsx(z,{path:"liquidaciones/solicitud/mis-solicitudes",element:e.jsx(Fs,{})}),e.jsx(z,{path:"solicitudes/:nro_solicitud",element:e.jsx(Ds,{})}),e.jsx(z,{path:"atencion-solicitudes",element:e.jsx(br,{})}),e.jsx(z,{path:"liquidaciones/presentar",element:e.jsx(Nr,{})}),e.jsx(z,{path:"liquidaciones/presentar/:id",element:e.jsx(Rs,{})}),e.jsx(z,{path:"liquidaciones/solicitud/:id/documento",element:e.jsx(Ms,{})}),e.jsx(z,{path:"gastos/aprobacion-liquidacion",element:e.jsx(Ar,{})}),e.jsx(z,{path:"movimientos/arqueo",element:e.jsx(Ra,{})}),e.jsx(z,{path:"registros/actividades",element:e.jsx(Or,{})}),e.jsx(z,{path:"registros/guias-salida",element:e.jsx(Ir,{})}),e.jsx(z,{path:"reportes",element:e.jsx(Jr,{})})]}),e.jsx(z,{path:"/",element:e.jsx(xa,{to:"/dashboard",replace:!0})}),e.jsx(z,{path:"*",element:e.jsx(xa,{to:"/dashboard",replace:!0})})]})]})})}Et.createRoot(document.getElementById("root")).render(e.jsx(ha.StrictMode,{children:e.jsx(vs,{children:e.jsx(Yr,{})})}));
