import{a as aa,r as n,j as e,N as xa,O as Pa,u as ze,E as ua,b as ne,L as _s,F as We,c as Ta,d as za,e as La,W as Je,C as De,f as W,g as Re,U as As,S as Ds,h as Fs,X as Le,M as Es,i as Ms,t as Rs,k as Os,l as $a,P as Ps,m as Ia,n as Ts,T as qa,D as Ga,R as zs,o as Ls,p as Ba,q as Ua,A as fa,s as L,_ as Fe,v as xe,w as $,x as Oe,y as Z,z as q,B as oe,G as Ka,H as $s,I as sa,J as Ha,K as Ye,Q as Va,V as Wa,Y as J,Z as ha,$ as Ja,a0 as ae,a1 as ge,a2 as Qe,a3 as Xe,a4 as fe,a5 as Ya,a6 as Is,a7 as qs,a8 as pa,a9 as Qa,aa as we,ab as Gs,ac as Bs,ad as ba,ae as Us,af as Ks,ag as Xa,ah as Hs,ai as Vs,aj as Ws,ak as Sa,al as Za,am as es,an as as,ao as Js,ap as Ys,aq as ss,ar as Qs,as as ts,at as Se,au as le,av as ie,aw as rs,ax as ta,ay as os,az as Xs,aA as ra,aB as oa,aC as Ca,aD as Zs,aE as et,aF as at,aG as Ee,aH as st,aI as tt,aJ as rt,aK as ot,aL as nt,aM as lt,aN as it,aO as ns,aP as ct,aQ as dt,aR as ka,aS as ja,aT as mt,aU as ls,aV as is,aW as xt,aX as cs,aY as ut,aZ as ds,a_ as ht,a$ as ms,b0 as xs,b1 as pt,b2 as gt,b3 as ft,b4 as bt,b5 as jt,b6 as yt,b7 as _a,b8 as vt,b9 as Nt,ba as wt,bb as St,bc as Ct,bd as z,be as kt}from"./vendor-BPHHy7BM.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(l){if(l.ep)return;l.ep=!0;const c=a(l);fetch(l.href,c)}})();const P=aa.create({baseURL:"http://localhost:8000/api/",withCredentials:!0,headers:{"Content-Type":"application/json",Accept:"application/json"}});P.interceptors.request.use(s=>{const t=localStorage.getItem("access_token");return t&&(s.headers.Authorization=`Bearer ${t}`),s},s=>Promise.reject(s));P.interceptors.response.use(s=>s,async s=>{const t=s.config;if(s.response&&s.response.status===401&&!t._retry){t._retry=!0;const a=localStorage.getItem("refresh_token");if(!a)return console.error("⚠️ No hay refresh token"),localStorage.clear(),window.location.href="/login",Promise.reject(s);try{const l=(await aa.post("http://localhost:8000/api/token/refresh/",{refresh:a})).data.access;return localStorage.setItem("access_token",l),P.defaults.headers.common.Authorization=`Bearer ${l}`,t.headers.Authorization=`Bearer ${l}`,P(t)}catch(r){return console.error("🔴 Error al refrescar token:",r),localStorage.clear(),window.location.href="/login",Promise.reject(r)}}return Promise.reject(s)});const us=n.createContext(),hs=({children:s})=>{const[t,a]=n.useState(null),[r,l]=n.useState(!0),c=async()=>{var x;try{const j=await P.get("usuarios/actual/");console.log("Usuario backend:",j.data),a(j.data),localStorage.setItem("auth_user",JSON.stringify(j.data))}catch(j){console.error("No se pudo obtener usuario actual:",((x=j.response)==null?void 0:x.data)??j),i()}finally{l(!1)}};n.useEffect(()=>{const x=localStorage.getItem("access_token"),j=localStorage.getItem("auth_user");if(x){if(P.defaults.headers.common.Authorization=`Bearer ${x}`,j)try{const m=JSON.parse(j);a(m)}catch(m){console.error("Error al parsear auth_user:",m),i();return}c()}else l(!1)},[]);const o=async({email:x,password:j})=>{try{const m=await P.post("login/",{email:x,password:j}),{access:d,refresh:h,user:b}=m.data;return localStorage.setItem("access_token",d),localStorage.setItem("refresh_token",h),P.defaults.headers.common.Authorization=`Bearer ${d}`,localStorage.setItem("auth_user",JSON.stringify(b)),a(b),{success:!0}}catch(m){return console.error("Error de inicio de sesión:",m),{success:!1,message:"Credenciales inválidas o servidor no disponible"}}},y=async({email:x,password:j,nombre:m,apellido:d,rol:h,area:b})=>{try{return{success:!0,data:(await P.post("register/",{email:x,password:j,nombre:m,apellido:d,rol:h,area:b})).data}}catch(p){return console.error("Error de registro:",p),{success:!1,message:"No se pudo registrar el usuario"}}},i=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("auth_user"),delete P.defaults.headers.common.Authorization,a(null),window.location.href="/login"},w=async()=>{try{const x=localStorage.getItem("refresh_token");if(!x)throw new Error("No se encontró refresh token");const j=await P.post("token/refresh/",{refresh:x}),{access:m}=j.data;localStorage.setItem("access_token",m),P.defaults.headers.common.Authorization=`Bearer ${m}`,await c()}catch(x){console.error("Error al refrescar token:",x),i()}};return e.jsx(us.Provider,{value:{authUser:t,setAuthUser:a,login:o,register:y,logout:i,refreshToken:w,loading:r},children:s})},ce=()=>n.useContext(us),_t=({children:s})=>{const{authUser:t,loading:a}=ce();return a?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"Validando sesión..."})}):t?s??e.jsx(Pa,{}):e.jsx(xa,{to:"/login",replace:!0})},ya="/static/assets/logo-DoccodYy.png",ps="/static/assets/Fondo-CcBCqOiu.jpg";function At(){const{login:s}=ce(),t=ze(),[a,r]=n.useState({email:"",password:""}),[l,c]=n.useState(!1),[o,y]=n.useState(!1),[i,w]=n.useState(""),x=d=>{r({...a,[d.target.name]:d.target.value})},j=d=>/\S+@\S+\.\S+/.test(d),m=async d=>{var h,b;if(d.preventDefault(),w(""),!j(a.email)){w("Ingrese un correo válido.");return}y(!0);try{await s(a),t("/dashboard")}catch(p){const f=((b=(h=p.response)==null?void 0:h.data)==null?void 0:b.detail)??"Credenciales inválidas. Inténtalo nuevamente.";w(Array.isArray(f)?f[0]:f)}finally{y(!1)}};return e.jsxs("div",{className:"w-full min-h-screen bg-cover bg-center bg-fixed flex items-center justify-center px-4 sm:px-6 md:px-10",style:{backgroundImage:`url(${ps})`},children:[e.jsxs("div",{className:"relative z-10 p-6 sm:p-8 w-full max-w-3xl bg-white/60 backdrop-blur-min rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx("img",{src:ya,alt:"Logo",className:"w-32 sm:w-40 h-auto mb-2"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 text-center",children:"Iniciar Sesión"}),i&&e.jsx("div",{className:"mt-3 text-sm text-red-700 bg-red-50 border border-red-100 px-3 py-2 rounded-md w-full text-center",children:i})]}),e.jsxs("form",{onSubmit:m,className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"text-xs font-medium text-gray-600 sr-only",children:"Correo electrónico"}),e.jsx("input",{id:"email",name:"email",type:"email",placeholder:"Correo electrónico",value:a.email,onChange:x,className:`w-full px-4 py-2 rounded-xl text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${a.email&&!j(a.email)?"border-red-500":"border-gray-300"}`,autoComplete:"email","aria-label":"Correo electrónico"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"password",className:"text-xs font-medium text-gray-600 sr-only",children:"Contraseña"}),e.jsx("input",{id:"password",name:"password",type:l?"text":"password",placeholder:"Contraseña",value:a.password,onChange:x,className:"w-full px-4 py-2 pr-10 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"current-password","aria-label":"Contraseña"}),e.jsx("button",{type:"button",onClick:()=>c(!l),"aria-label":l?"Ocultar contraseña":"Mostrar contraseña",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-600",children:l?e.jsx(ua,{size:18}):e.jsx(ne,{size:18})})]}),e.jsx("button",{type:"submit",disabled:o,className:`w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-4 rounded-xl transition ${o?"cursor-not-allowed opacity-70":""}`,children:o?"Ingresando...":"Iniciar Sesión"})]}),e.jsxs("p",{className:"text-sm text-gray-700 mt-6 text-center",children:["¿No tienes una cuenta?"," ",e.jsx("span",{className:"text-teal-700 font-semibold hover:underline cursor-pointer",onClick:()=>t("/register"),children:"Regístrate aquí"})]})]}),e.jsx("div",{className:"absolute bottom-4 text-center text-sm text-white w-full z-10 px-4",children:"© 2025 Producto desarrollado por V&C Corporation SAC"})]})}const Dt=["Gerencia General","Industria","Minería","Mantenimiento","Petroquímica","Administración","Contabilidad","Tecnología de la Información","Logística - Almacén","Recursos Humanos","Comercial","SIG. HSEQ","Seguridad de Maquinaria","Comité CSSO"],Ft=["Administrador","Jefe de Proyecto","Colaborador"],Et=["Perú","Argentina","Colombia","Chile"];function Mt(){const s=ze(),{register:t,login:a}=ce(),[r,l]=n.useState({nombre:"",apellido:"",email:"",edad:"",empresa:"",pais:"",rol:"",area:"",password:"",confirmarPassword:""}),[c,o]=n.useState(!1),[y,i]=n.useState(!1),[w,x]=n.useState(!1),[j,m]=n.useState(""),d=p=>{l({...r,[p.target.name]:p.target.value})},h=p=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p),b=async p=>{var _,R;p.preventDefault(),m(""),o(!0);const{nombre:f,apellido:g,email:v,edad:S,empresa:C,pais:M,rol:A,area:N,password:k,confirmarPassword:G}=r;if(!f||!g||!v||!S||!M||!A||!N||!k||!G){m("Por favor completa todos los campos obligatorios."),o(!1);return}if(!h(v)){m("Correo electrónico inválido."),o(!1);return}if(Number(S)<=0||isNaN(Number(S))){m("La edad debe ser un número válido mayor que 0."),o(!1);return}if(k!==G){m("Las contraseñas no coinciden."),o(!1);return}const T={nombre:f,apellido:g,email:v,edad:Number(S),empresa:C,pais:M,rol:A,area:N,password:k};try{const O=await t(T);if(!O||O.success===!1){const pe=(O==null?void 0:O.message)||(O==null?void 0:O.error)||"No se pudo registrar el usuario.";m(pe),o(!1);return}const ee=await a({email:v,password:k});ee&&ee.success,s("/login")}catch(O){console.error("Error en el registro:",O);const ee=((R=(_=O==null?void 0:O.response)==null?void 0:_.data)==null?void 0:R.detail)||(O==null?void 0:O.message)||"Ocurrió un error al registrar.";m(ee)}finally{o(!1)}};return e.jsxs("div",{className:"w-full min-h-screen bg-cover bg-center bg-fixed flex items-center justify-center px-4 sm:px-6 md:px-10",style:{backgroundImage:`url(${ps})`},children:[e.jsxs("div",{className:"relative z-10 p-6 sm:p-8 w-full max-w-3xl bg-white/60 backdrop-blur-min rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx("img",{src:ya,alt:"Logo",className:"w-32 sm:w-40 h-auto mb-2"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 text-center",children:"Registro de Usuario"}),j&&e.jsx("div",{className:"mt-3 text-sm text-red-700 bg-red-50 border border-red-100 px-3 py-2 rounded-md w-full text-center",children:j})]}),e.jsxs("form",{onSubmit:b,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nombre",className:"text-xs font-medium text-gray-600 sr-only",children:"Nombre"}),e.jsx("input",{id:"nombre",name:"nombre",type:"text",placeholder:"Nombre",value:r.nombre,onChange:d,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"given-name","aria-label":"Nombre"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"text-xs font-medium text-gray-600 sr-only",children:"Correo electrónico"}),e.jsx("input",{id:"email",name:"email",type:"email",placeholder:"Correo electrónico",value:r.email,onChange:d,className:`w-full px-4 py-2 rounded-xl text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 ${r.email&&!h(r.email)?"border-red-500":"border-gray-300"}`,autoComplete:"email","aria-label":"Correo electrónico"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"empresa",className:"text-xs font-medium text-gray-600 sr-only",children:"Empresa"}),e.jsx("input",{id:"empresa",name:"empresa",type:"text",placeholder:"Empresa",value:r.empresa,onChange:d,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Empresa"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"rol",className:"text-xs font-medium text-gray-600 sr-only",children:"Rol"}),e.jsxs("select",{id:"rol",name:"rol",value:r.rol,onChange:d,className:"w-full px-4 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Rol",children:[e.jsx("option",{value:"",children:"Selecciona un rol"}),Ft.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Contraseña"}),e.jsx("input",{id:"password",name:"password",type:y?"text":"password",placeholder:"Contraseña",value:r.password,onChange:d,className:"w-full px-4 py-2 pr-10 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"new-password","aria-label":"Contraseña"}),e.jsx("button",{type:"button",onClick:()=>i(!y),"aria-label":y?"Ocultar contraseña":"Mostrar contraseña",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-600",children:y?e.jsx(ua,{size:18}):e.jsx(ne,{size:18})})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"apellido",className:"text-xs font-medium text-gray-600 sr-only",children:"Apellido"}),e.jsx("input",{id:"apellido",name:"apellido",type:"text",placeholder:"Apellido",value:r.apellido,onChange:d,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"family-name","aria-label":"Apellido"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edad",className:"text-xs font-medium text-gray-600 sr-only",children:"Edad"}),e.jsx("input",{id:"edad",name:"edad",type:"number",placeholder:"Edad",value:r.edad,onChange:d,className:"w-full px-4 py-2 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Edad",min:0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pais",className:"text-xs font-medium text-gray-600 sr-only",children:"País"}),e.jsxs("select",{id:"pais",name:"pais",value:r.pais,onChange:d,className:"w-full px-4 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"País",children:[e.jsx("option",{value:"",children:"Selecciona un país"}),Et.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"area",className:"text-xs font-medium text-gray-600 sr-only",children:"Área"}),e.jsxs("select",{id:"area",name:"area",value:r.area,onChange:d,className:"w-full px-4 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500","aria-label":"Área",children:[e.jsx("option",{value:"",children:"Selecciona un área"}),Dt.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"confirmarPassword",className:"sr-only",children:"Confirmar contraseña"}),e.jsx("input",{id:"confirmarPassword",name:"confirmarPassword",type:w?"text":"password",placeholder:"Confirmar contraseña",value:r.confirmarPassword,onChange:d,className:"w-full px-4 py-2 pr-10 rounded-xl border border-gray-300 text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500",autoComplete:"new-password","aria-label":"Confirmar contraseña"}),e.jsx("button",{type:"button",onClick:()=>x(!w),"aria-label":w?"Ocultar confirmación":"Mostrar confirmación",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-600",children:w?e.jsx(ua,{size:18}):e.jsx(ne,{size:18})})]})]}),e.jsx("div",{className:"md:col-span-2 mt-4",children:e.jsx("button",{type:"submit",disabled:c,className:`w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-4 rounded-xl transition ${c?"cursor-not-allowed opacity-70":""}`,children:c?"Registrando...":"Registrarse"})})]}),e.jsxs("p",{className:"text-sm text-gray-700 mt-6 text-center",children:["¿Ya tienes una cuenta?"," ",e.jsx("span",{className:"text-teal-700 font-semibold hover:underline cursor-pointer",onClick:()=>s("/login"),children:"Inicia sesión aquí"})]})]}),e.jsx("div",{className:"absolute bottom-4 text-center text-sm text-white w-full z-10 px-4",children:"© 2025 Producto desarrollado por V&C Corporation SAC"})]})}const Rt=[{section:"Dashboard Principal",items:[{to:"/dashboard",label:"Pantalla Principal",icon:_s,roles:["Administrador","Jefe de Proyecto","Colaborador"]}]},{section:"Gestión de Gastos y Liquidaciones",items:[{to:"/dashboard/liquidaciones/solicitud",label:"Solicitud de Gasto",icon:We,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/atencion-solicitudes",label:"Atención de Solicitudes",icon:Ta,roles:["Administrador","Jefe de Proyecto"]},{to:"/dashboard/liquidaciones/presentar",label:"Liquidaciones",icon:za,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/gastos/aprobacion-liquidacion",label:"Aprobación de Liquidación",icon:La,roles:["Administrador"]}]},{section:"Registros y Movimientos",items:[{to:"/dashboard/movimientos/arqueo",label:"Caja Chica",icon:Je,roles:["Administrador"]},{to:"/dashboard/registros/actividades",label:"Registro de Actividades",icon:De,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/registros/guias-salida",label:"Guías de Salida",icon:W,roles:["Administrador"]}]},{section:"Reportes y Análisis",items:[{to:"/dashboard/reportes",label:"Estadísticas y Reportes",icon:Re,roles:["Administrador","Jefe de Proyecto","Colaborador"]}]},{section:"Mi Cuenta",items:[{to:"/dashboard/editar-perfil",label:"Editar Perfil",icon:As,roles:["Administrador","Jefe de Proyecto","Colaborador"]},{to:"/dashboard/cambiar-clave",label:"Cambiar Contraseña",icon:Ds,roles:["Administrador","Jefe de Proyecto","Colaborador"]}]}],Ot=({title:s})=>e.jsx("div",{className:"text-xs uppercase text-gray-400 font-semibold px-4 pt-6 pb-1",children:s}),Pt=({to:s,label:t,icon:a})=>e.jsxs(Ms,{to:s,className:({isActive:r})=>`flex items-center gap-3 px-4 py-2 rounded-md text-sm transition-colors duration-200 ${r?"bg-indigo-100 text-indigo-700 font-semibold":"text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(a,{className:"w-4 h-4"}),t]});function Tt(){const s=ze(),[t,a]=n.useState(!1),{authUser:r}=ce(),l=()=>{localStorage.removeItem("token"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),s("/login")},c=n.useMemo(()=>r!=null&&r.rol?Rt.map(o=>({...o,items:o.items.filter(y=>y.roles.includes(r.rol))})).filter(o=>o.items.length>0):[],[r]);return e.jsxs("div",{className:"flex min-h-screen bg-[#f3f4f6]",children:[e.jsxs("aside",{className:`fixed md:static z-40 top-0 left-0 h-screen bg-white shadow-md border-r flex flex-col transform transition-transform duration-300 
        ${t?"translate-x-0 w-64":"-translate-x-full w-64"} md:translate-x-0`,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center py-6 border-b",children:[e.jsx("img",{src:ya,alt:"V&C Corporation",className:"h-16"}),e.jsx("span",{className:"text-sm font-bold text-gray-700 mt-2",children:r!=null&&r.nombre?`${r.nombre} ${r.apellido||""}`:"Usuario"})]}),e.jsx("nav",{className:"flex-1 overflow-y-auto pb-6",children:c.map(o=>e.jsxs("div",{children:[e.jsx(Ot,{title:o.section}),o.items.map(y=>e.jsx(Pt,{...y},y.to))]},o.section))}),e.jsx("div",{className:"px-4 py-4 border-t",children:e.jsxs("button",{onClick:l,className:"flex items-center gap-2 text-red-600 hover:text-red-800 text-sm",children:[e.jsx(Fs,{className:"w-4 h-4"}),"Cerrar sesión"]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-screen",children:[e.jsxs("div",{className:"md:hidden flex items-center justify-between bg-white shadow px-4 py-2",children:[e.jsx("button",{onClick:()=>a(!t),children:t?e.jsx(Le,{className:"w-6 h-6 text-gray-700"}):e.jsx(Es,{className:"w-6 h-6 text-gray-700"})}),e.jsx("span",{className:"font-bold text-gray-800",children:"Dashboard"})]}),e.jsx("main",{className:"flex-1 flex flex-col p-4 md:p-6 bg-white overflow-y-auto",children:e.jsx(Pa,{})})]})]})}const ue=n.forwardRef(({className:s="",...t},a)=>e.jsx("div",{ref:a,className:`rounded-2xl border bg-white shadow-sm ${s}`,...t}));ue.displayName="Card";const zt=n.forwardRef(({className:s="",...t},a)=>e.jsx("div",{ref:a,className:`p-4 border-b ${s}`,...t}));zt.displayName="CardHeader";const Lt=n.forwardRef(({className:s="",...t},a)=>e.jsx("h3",{ref:a,className:`text-lg font-semibold leading-none tracking-tight ${s}`,...t}));Lt.displayName="CardTitle";const $t=n.forwardRef(({className:s="",...t},a)=>e.jsx("p",{ref:a,className:`text-sm text-gray-500 ${s}`,...t}));$t.displayName="CardDescription";const be=n.forwardRef(({className:s="",...t},a)=>e.jsx("div",{ref:a,className:`p-4 ${s}`,...t}));be.displayName="CardContent";function F(...s){return Rs(Os(s))}const re=n.forwardRef(({className:s,variant:t="default",...a},r)=>e.jsx("div",{ref:r,className:F("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors",t==="default"&&"bg-gray-200 text-gray-900",t==="success"&&"bg-green-200 text-green-900",t==="warning"&&"bg-yellow-200 text-yellow-900",t==="error"&&"bg-red-200 text-red-900",s),...a}));re.displayName="Badge";const V=zs,It=Ps,gs=n.forwardRef(({className:s,...t},a)=>e.jsx($a,{ref:a,className:F("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));gs.displayName=$a.displayName;const U=n.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(It,{children:[e.jsx(gs,{}),e.jsxs(Ia,{ref:r,className:F("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[t,e.jsxs(Ts,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));U.displayName=Ia.displayName;const K=({className:s,...t})=>e.jsx("div",{className:F("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});K.displayName="DialogHeader";const de=({className:s,...t})=>e.jsx("div",{className:F("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});de.displayName="DialogFooter";const H=n.forwardRef(({className:s,...t},a)=>e.jsx(qa,{ref:a,className:F("text-lg font-semibold leading-none tracking-tight",s),...t}));H.displayName=qa.displayName;const fs=n.forwardRef(({className:s,...t},a)=>e.jsx(Ga,{ref:a,className:F("text-sm text-muted-foreground",s),...t}));fs.displayName=Ga.displayName;const ga=Ba("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),E=n.forwardRef(({className:s,variant:t,size:a,asChild:r=!1,...l},c)=>{const o=r?Ls:"button";return e.jsx(o,{className:F(ga({variant:t,size:a,className:s})),ref:c,...l})});E.displayName="Button";const Q=n.forwardRef(({className:s,type:t,...a},r)=>e.jsx("input",{type:t,className:F("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...a}));Q.displayName="Input";const qt=Ba("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),te=n.forwardRef(({className:s,...t},a)=>e.jsx(Ua,{ref:a,className:F(qt(),s),...t}));te.displayName=Ua.displayName;function Gt({label:s,name:t,value:a,onChange:r,placeholder:l,className:c=""}){return e.jsxs("div",{className:"flex flex-col mb-2",children:[s&&e.jsxs("label",{className:"mb-1 font-medium text-gray-700",children:[s,":"]}),e.jsx("textarea",{name:t,value:a,onChange:r,placeholder:l,className:`border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${c}`})]})}const Bt=({open:s,onClose:t,onSuccess:a})=>{const[r,l]=n.useState(""),[c,o]=n.useState(""),[y,i]=n.useState(!1),w=async()=>{if(!r||isNaN(r)){alert("Por favor ingresa un monto inicial válido.");return}try{i(!0),await P.post("/boleta/caja_diaria/",{monto_base:Number(r),observaciones:c||""}),a&&a(),t()}catch(x){console.error("Error al abrir caja diaria:",x),alert("Hubo un error al abrir la caja. Revisa la consola.")}finally{i(!1)}};return e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"max-w-md",children:[e.jsx(K,{children:e.jsx(H,{children:"Apertura de Caja"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(te,{children:"Monto Inicial"}),e.jsx(Q,{type:"number",placeholder:"Ingrese el monto inicial",value:r,onChange:x=>l(x.target.value)})]}),e.jsxs("div",{children:[e.jsx(te,{children:"Observaciones (opcional)"}),e.jsx(Gt,{placeholder:"Escribe aquí las observaciones...",value:c,onChange:x=>o(x.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(E,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(E,{onClick:w,disabled:y,children:y?"Abriendo...":"Abrir Caja"})]})]})]})})};function Ut({open:s,onClose:t,caja:a,onCajaCerrada:r}){const[l,c]=n.useState(!1),[o,y]=n.useState({totalIngresos:0,totalEgresos:0,saldoFinal:0});n.useEffect(()=>{a&&i()},[a]);const i=()=>{var m,d;const x=((m=a.movimientos)==null?void 0:m.filter(h=>h.tipo==="Ingreso").reduce((h,b)=>h+b.monto,0))||0,j=((d=a.movimientos)==null?void 0:d.filter(h=>h.tipo==="Egreso").reduce((h,b)=>h+b.monto,0))||0;y({totalIngresos:x,totalEgresos:j,saldoFinal:a.monto_inicial+x-j})},w=async()=>{if(window.confirm("¿Confirmas cerrar la caja? Esta acción no se puede revertir."))try{c(!0),await P.put(`/boleta/caja_diaria/${a.id}/cerrar/`),r==null||r(),t==null||t()}catch(x){console.error("Error cerrando caja:",x),alert("No se pudo cerrar la caja. Intenta nuevamente.")}finally{c(!1)}};return a?e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"max-w-md p-6 rounded-xl shadow-xl",children:[e.jsx(K,{children:e.jsx(H,{children:"Cierre de Caja"})}),e.jsxs("div",{className:"space-y-3 mt-2 text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de Apertura:"})," ",a.fecha_apertura]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto Inicial:"})," S/ ",a.monto_inicial.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Ingresos:"})," S/ ",o.totalIngresos.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Egresos:"})," S/ ",o.totalEgresos.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Saldo Final:"})," S/ ",o.saldoFinal.toFixed(2)]})]}),e.jsxs(de,{className:"flex justify-between mt-4",children:[e.jsx(E,{variant:"outline",onClick:t,disabled:l,className:"hover:bg-gray-100 transition",children:"Cancelar"}),e.jsx(E,{onClick:w,disabled:l,className:`${l?"opacity-50 cursor-not-allowed":"hover:bg-red-700 transition"}`,children:l?"Cerrando...":"Cerrar Caja"})]})]})}):null}function Kt({open:s,onClose:t,cajaId:a,onMovimientoGuardado:r}){const[l,c]=n.useState("Ingreso"),[o,y]=n.useState(""),[i,w]=n.useState(""),[x,j]=n.useState(null),[m,d]=n.useState(!1),h=async()=>{if(!o.trim()){alert("Ingresa un concepto válido");return}if(!i||isNaN(Number(i))||Number(i)<=0){alert("Ingresa un monto válido mayor a 0");return}try{d(!0);const b=new FormData;b.append("tipo",l),b.append("concepto",o),b.append("monto",Number(i)),x&&b.append("documento",x),await P.post(`/boleta/caja_diaria/${a}/movimientos/`,b,{headers:{"Content-Type":"multipart/form-data"}}),alert("Movimiento registrado correctamente"),r==null||r(),t==null||t(),c("Ingreso"),y(""),w(""),j(null)}catch(b){console.error("Error registrando movimiento:",b),alert("No se pudo registrar el movimiento. Intenta nuevamente.")}finally{d(!1)}};return e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"max-w-md p-6 rounded-xl shadow-xl",children:[e.jsx(K,{children:e.jsx(H,{children:"Registrar Movimiento"})}),e.jsxs("div",{className:"space-y-3 mt-2 text-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Tipo"}),e.jsxs("select",{value:l,onChange:b=>c(b.target.value),className:"w-full border rounded p-2",disabled:m,children:[e.jsx("option",{value:"Ingreso",children:"Ingreso"}),e.jsx("option",{value:"Egreso",children:"Egreso"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Concepto / Descripción"}),e.jsx("input",{type:"text",value:o,onChange:b=>y(b.target.value),className:"w-full border rounded p-2",disabled:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Monto"}),e.jsx("input",{type:"number",min:"0",value:i,onChange:b=>w(b.target.value),className:"w-full border rounded p-2",disabled:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Documento (opcional)"}),e.jsx("input",{type:"file",onChange:b=>j(b.target.files[0]),className:"w-full",disabled:m})]})]}),e.jsxs(de,{className:"flex justify-between mt-4",children:[e.jsx(E,{variant:"outline",onClick:t,disabled:m,className:"hover:bg-gray-100 transition",children:"Cancelar"}),e.jsx(E,{onClick:h,disabled:m,className:`${m?"opacity-50 cursor-not-allowed":"hover:bg-green-700 transition"}`,children:m?"Guardando...":"Guardar Movimiento"})]})]})})}function va({open:s,onClose:t,documento:a}){const r=n.useRef(),l=()=>{if(!a.url)return;const c=window.open("","_blank");c.document.write(`
      <html>
        <head>
          <title>${a.nombre||"Documento"}</title>
        </head>
        <body style="margin:0; display:flex; justify-content:center; align-items:center; height:100vh;">
          <img src="${a.url}" style="max-width:100%; max-height:100vh;" />
        </body>
      </html>
    `),c.document.close(),c.focus(),c.print(),c.close()};return a?e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"max-w-3xl w-full shadow-xl rounded-xl p-6",children:[e.jsx(K,{children:e.jsx(H,{children:a.nombre||"Documento"})}),e.jsx("div",{className:"flex justify-center my-4",children:a.url?e.jsx("img",{ref:r,src:a.url,alt:a.nombre||"Documento",className:"max-h-[70vh] w-auto object-contain rounded border"}):e.jsx("p",{className:"text-center text-gray-500",children:"No hay vista disponible"})}),e.jsxs(de,{className:"flex justify-between",children:[e.jsx(E,{variant:"outline",onClick:t,className:"hover:bg-gray-100 transition",children:"Cerrar"}),a.url&&e.jsx(E,{onClick:l,className:"hover:bg-gray-100 transition",children:"Imprimir"})]})]})}):null}const Ht={Ingreso:"#16a34a",Egreso:"#ef4444"};function bs({open:s,onClose:t,movimiento:a}){const[r,l]=n.useState(!1);return a?e.jsxs(e.Fragment,{children:[e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"max-w-lg shadow-xl rounded-xl p-6",children:[e.jsx(K,{children:e.jsxs(H,{children:["Movimiento #",a.numero_operacion||a.id]})}),e.jsxs("div",{className:"space-y-3 mt-2 text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",a.fecha]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tipo:"})," ",e.jsx(re,{style:{backgroundColor:Ht[a.tipo],color:"#fff",marginLeft:4},children:a.tipo})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Concepto:"})," ",a.concepto]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto:"})," S/ ",a.monto.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Usuario:"})," ",a.usuario]}),a.documento?e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{children:e.jsx("strong",{children:"Documento:"})}),e.jsx(E,{size:"sm",variant:"outline",onClick:()=>l(!0),className:"hover:bg-gray-100 transition",children:"Ver Documento"})]}):e.jsx("p",{className:"text-gray-400",children:"Sin documento"}),a.observaciones&&e.jsxs("p",{children:[e.jsx("strong",{children:"Observaciones:"})," ",a.observaciones]})]}),e.jsx(de,{className:"mt-4",children:e.jsx(E,{variant:"outline",onClick:t,className:"hover:bg-gray-100 transition",children:"Cerrar"})})]})}),r&&a.documento&&e.jsx(va,{open:r,onClose:()=>l(!1),documento:a.documento})]}):null}const Vt={Ingreso:"#16a34a",Egreso:"#ef4444"};function Wt({movimientos:s}){const[t,a]=n.useState(""),[r,l]=n.useState("Todos"),[c,o]=n.useState(null),[y,i]=n.useState(!1),[w,x]=n.useState(null),[j,m]=n.useState(!1),d=n.useMemo(()=>s.filter(g=>{var C,M;const v=((C=g.numero_operacion)==null?void 0:C.toString().includes(t))||((M=g.concepto)==null?void 0:M.toLowerCase().includes(t.toLowerCase())),S=r==="Todos"||g.tipo===r;return v&&S}),[s,t,r]),h=n.useMemo(()=>d.filter(g=>g.tipo==="Ingreso").reduce((g,v)=>g+(v.monto||0),0),[d]),b=n.useMemo(()=>d.filter(g=>g.tipo==="Egreso").reduce((g,v)=>g+(v.monto||0),0),[d]),p=h-b,f=g=>{g.documento&&(x(g),m(!0),o(g.id))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Buscar por N° operación o concepto...",value:t,onChange:g=>a(g.target.value),className:"max-w-xs border rounded-lg px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"}),e.jsx("div",{className:"flex gap-2",children:["Todos","Ingreso","Egreso"].map(g=>e.jsx(E,{variant:r===g?"secondary":"outline",onClick:()=>l(g),children:g},g))})]}),e.jsx("div",{className:"overflow-x-auto shadow-md rounded-xl border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-center",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"N° Operación"}),e.jsx("th",{className:"px-4 py-3",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3",children:"Concepto"}),e.jsx("th",{className:"px-4 py-3",children:"Monto"}),e.jsx("th",{className:"px-4 py-3",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3",children:"Documento"}),e.jsx("th",{className:"px-4 py-3",children:"Acciones"})]})}),e.jsx("tbody",{children:e.jsx(fa,{children:d.length>0?d.map(g=>e.jsxs(L.tr,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:`border-t border-gray-100 hover:shadow-lg hover:translate-y-[-2px] hover:bg-gray-50 transition-transform duration-200 ${c===g.id?"bg-blue-50":""}`,onClick:()=>o(g.id),children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:g.numero_operacion||"-"}),e.jsx("td",{className:"px-4 py-3",children:g.fecha||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(re,{style:{backgroundColor:Vt[g.tipo]||"#6b7280",color:"#fff"},children:g.tipo||"-"})}),e.jsx("td",{className:"px-4 py-3",children:g.concepto||"-"}),e.jsxs("td",{className:"px-4 py-3",children:["S/ ",(g.monto||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:g.usuario||"-"}),e.jsx("td",{className:"px-4 py-3",children:g.documento?e.jsx(E,{size:"sm",className:"bg-gradient-to-r from-blue-300 to-blue-400 hover:from-blue-400 hover:to-blue-500 text-white p-2 rounded-lg shadow-md transition",onClick:v=>{v.stopPropagation(),f(g)},children:g.documento.nombre}):"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{className:"bg-gradient-to-r from-indigo-400 to-indigo-500 hover:from-indigo-500 hover:to-indigo-600 text-white p-2 rounded-lg shadow-md transition",onClick:()=>{x(mov),setDetalleMovimientoOpen(!0)},children:e.jsx(ne,{size:16})})})]},g.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-6 text-gray-500",children:"No hay movimientos registrados."})})})})]})}),e.jsxs("div",{className:"flex justify-end gap-6 mt-2 font-medium text-sm",children:[e.jsxs("p",{children:["Total Ingresos: S/ ",h.toFixed(2)]}),e.jsxs("p",{children:["Total Egresos: S/ ",b.toFixed(2)]}),e.jsxs("p",{children:["Saldo Actual: S/ ",p.toFixed(2)]})]}),y&&w&&e.jsx(bs,{open:y,onClose:()=>i(!1),movimiento:w}),j&&(w==null?void 0:w.documento)&&e.jsx(va,{open:j,onClose:()=>m(!1),documento:w.documento})]})}const Jt={id:1,fecha_apertura:"2025-08-14",monto_inicial:1e3,cerrada:!1},Yt=[{id:1,fecha:"2025-08-14",tipo:"Ingreso",concepto:"Rollover",monto:200,usuario:"Admin",documento:null},{id:2,fecha:"2025-08-14",tipo:"Egreso",concepto:"Compra de papelería",monto:50,usuario:"Admin",documento:{nombre:"Ticket Papelería",url:"/fake-doc1.jpg"}},{id:3,fecha:"2025-08-14",tipo:"Egreso",concepto:"Yape a proveedor",monto:150,usuario:"Admin",documento:{nombre:"Yape",url:"/fake-doc2.jpg"}}],Aa={Ingreso:"#16a34a",Egreso:"#ef4444"},la={saldo:"#3b82f6",ingresos:"#16a34a",egresos:"#ef4444"},Qt="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center";function Da(){const[s,t]=n.useState(null),[a,r]=n.useState([]),[l,c]=n.useState(!0),[o,y]=n.useState(!1),[i,w]=n.useState(!1),[x,j]=n.useState(!1),[m,d]=n.useState(null),[h,b]=n.useState(null),[p,f]=n.useState(!1),[g,v]=n.useState(!1),S=async()=>{c(!0),setTimeout(()=>{r(Yt),t(Jt),c(!1)},800)};n.useEffect(()=>{S()},[]);const C=n.useMemo(()=>{const N=a.filter(T=>T.tipo==="Ingreso").reduce((T,_)=>T+_.monto,0),k=a.filter(T=>T.tipo==="Egreso").reduce((T,_)=>T+_.monto,0),G=((s==null?void 0:s.monto_inicial)||0)+N-k;return{ingresos:N,egresos:k,saldo:G}},[a,s]),M=n.useMemo(()=>[{name:"Ingresos",value:C.ingresos,fill:Aa.Ingreso},{name:"Egresos",value:C.egresos,fill:Aa.Egreso}],[C]),A=N=>{const k=Math.max(C.saldo,C.ingresos,C.egresos,1);return`${N/k*100}%`};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2 mb-4",children:[e.jsx(Je,{className:"w-6 h-6"})," Caja Chica"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 text-center",children:[{label:"Saldo Actual",value:C.saldo,color:la.saldo},{label:"Total Ingresos",value:C.ingresos,color:la.ingresos},{label:"Total Egresos",value:C.egresos,color:la.egresos}].map((N,k)=>e.jsxs("div",{className:`${Qt} flex flex-col items-center justify-center text-white p-5 rounded-xl`,style:{background:`linear-gradient(135deg, ${N.color}cc, ${N.color}99)`},children:[e.jsx("p",{className:"text-sm font-medium",children:N.label}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:e.jsx(Fe,{end:N.value,duration:1.2,separator:",",decimals:2})}),N.label!=="Saldo Actual"&&e.jsx("div",{className:"w-full h-2 bg-white bg-opacity-30 rounded-full mt-2",children:e.jsx("div",{className:"h-2 rounded-full",style:{width:A(N.value),backgroundColor:N.color}})})]},k))}),e.jsx(ue,{className:"shadow-lg rounded-xl mt-5",children:e.jsxs(be,{children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(xe,{className:"w-5 h-5 text-gray-800"}),e.jsx("h3",{className:"text-center font-medium",children:"Distribución Ingresos/Egresos"})]}),e.jsx($,{width:"100%",height:300,children:e.jsxs(xe,{children:[e.jsx(Oe,{data:M,dataKey:"value",nameKey:"name",innerRadius:55,outerRadius:85,label:({name:N,percent:k})=>`${N} ${(k*100).toFixed(1)}%`,children:M.map((N,k)=>e.jsx(Z,{fill:N.fill},k))}),e.jsx(q,{formatter:N=>`${N.toFixed(2)} S/`}),e.jsx(oe,{verticalAlign:"bottom",height:36})]})})]})}),e.jsx("div",{className:"flex flex-wrap gap-4 mt-4",children:s!=null&&s.cerrada?e.jsx(re,{variant:"outline",className:"text-gray-600",children:"Caja cerrada"}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",onClick:()=>y(!0),children:[e.jsx(Ka,{size:16})," Abrir Caja"]}),e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",onClick:()=>j(!0),disabled:!s,children:[e.jsx($s,{size:16})," Nuevo Movimiento"]}),e.jsxs("button",{className:"bg-gradient-to-r from-orange-500 to-red-500 hover:from-red-500 hover:to-red-600 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",onClick:()=>w(!0),disabled:!s,children:[e.jsx(sa,{size:16})," Cerrar Caja"]})]})}),e.jsx(Wt,{movimientos:a,onMovimientoSeleccionado:N=>{d(N),f(!0)},onMovimientoGuardado:S}),o&&e.jsx(Bt,{open:o,onClose:()=>y(!1)}),i&&e.jsx(Ut,{open:i,onClose:()=>w(!1),caja:s,totales:C}),x&&e.jsx(Kt,{open:x,onClose:()=>j(!1),cajaId:s==null?void 0:s.id,onMovimientoGuardado:S}),p&&m&&e.jsx(bs,{open:p,onClose:()=>f(!1),movimiento:m}),g&&h&&e.jsx(va,{open:g,onClose:()=>v(!1),documento:h})]})}const $e=({label:s,value:t,gradient:a,icon:r,tooltip:l,decimals:c=0})=>e.jsxs("div",{className:`\r
        rounded-xl p-4 shadow-md text-white relative\r
        flex flex-col items-center justify-center text-center\r
        transition-all duration-300 transform\r
        hover:scale-105 hover:shadow-lg cursor-pointer\r
        min-h-[90px] sm:min-h-[100px]\r
      `,style:{background:a},children:[l&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Ha,{content:l,children:e.jsx(Ye,{size:14,className:"text-white opacity-80 cursor-pointer"})})}),r&&e.jsx(r,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-xs sm:text-sm opacity-90",children:s}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold",children:e.jsx(Fe,{end:Number(t)||0,duration:1.2,separator:",",decimals:c})})]}),Pe=({headers:s,data:t,renderRow:a,emptyMessage:r="No hay datos disponibles.",activeRow:l=null,rowsPerPage:c=10})=>{const[o,y]=n.useState(1),i=Math.ceil(t.length/c)||1,w=(o-1)*c,x=w+c,j=t.slice(w,x),m=d=>{d>=1&&d<=i&&y(d)};return e.jsx(ue,{className:"rounded-2xl shadow-md border border-gray-200",children:e.jsxs(be,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-2xl",children:e.jsxs("table",{className:"min-w-full table-auto text-sm text-center border-collapse",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700 font-medium",children:e.jsx("tr",{children:s.map((d,h)=>e.jsx("th",{className:"px-3 sm:px-4 py-3 border border-gray-200",children:d},h))})}),e.jsx("tbody",{className:"bg-gray-50",children:e.jsx(fa,{children:j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"px-4 py-10 text-center text-gray-500 italic border border-gray-200",children:r})}):j.map((d,h)=>e.jsx(L.tr,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.25},className:`transition-all duration-200 ${l===(d.id||h)?"bg-blue-50 border-l-4 border-blue-500 shadow-sm":"hover:bg-gray-50 hover:shadow-md hover:ring-1 hover:ring-gray-200 cursor-pointer"}`,children:Array.isArray(a(d))?a(d).map((b,p)=>e.jsx("td",{className:"px-3 sm:px-4 py-3 border border-gray-200",children:b},p)):a(d)},d.id||h))})})]})}),i>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-3 border-t border-gray-200 bg-gray-50",children:[e.jsxs(E,{variant:"outline",size:"sm",disabled:o===1,onClick:()=>m(o-1),className:"flex items-center gap-1",children:[e.jsx(Va,{className:"w-4 h-4"})," Anterior"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:i},(d,h)=>h+1).map(d=>e.jsx(E,{variant:d===o?"default":"outline",size:"sm",onClick:()=>m(d),className:`w-8 h-8 rounded-full ${d===o?"bg-blue-500 text-white hover:bg-blue-600":"hover:bg-gray-100"}`,children:d},d))}),e.jsxs(E,{variant:"outline",size:"sm",disabled:o===i,onClick:()=>m(o+1),className:"flex items-center gap-1",children:["Siguiente ",e.jsx(Wa,{className:"w-4 h-4"})]})]})]})})},Ze={"Pendiente de Envío":"bg-orange-200 text-orange-800","Pendiente para Atención":"bg-yellow-200 text-yellow-800","Atendido, Pendiente de Liquidación":"bg-sky-200 text-sky-800","Liquidación enviada para Aprobación":"bg-green-200 text-green-800","Liquidación Aprobada":"bg-gray-600 text-white",Rechazado:"bg-red-200 text-red-800"},je={"Pendiente de Envío":"#f97316","Pendiente para Atención":"#ffef00","Atendido, Pendiente de Liquidación":"#0ea5e9","Liquidación enviada para Aprobación":"#22c55e","Liquidación Aprobada":"#0f172a",Rechazado:"#ef4444"},Na={Viáticos:"bg-blue-600 text-white",Movilidad:"bg-emerald-500 text-white",Compras:"bg-purple-500 text-white","Otros gastos":"bg-yellow-100 text-yellow-800"},he={Viáticos:"#0218db",Movilidad:"#059669",Compras:"#7c3aed","Otros gastos":"#eab308"},Me=(s,t,a)=>[`${s}`,`${t}`],ea=(s,t,a)=>[`${s}`,`${t}`],X=({title:s,icon:t,subtitle:a,children:r,className:l="",legend:c=[],tooltipFormatter:o})=>e.jsx(ue,{className:`rounded-xl shadow-md hover:shadow-lg transition-shadow ${l}`,children:e.jsxs(be,{className:"flex flex-col p-4 w-full h-full",children:[(s||a||t)&&e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx("span",{className:"text-gray-700",children:t}),s&&e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:s})]}),a&&e.jsx("div",{className:"text-sm text-gray-500",children:a})]}),c&&c.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:c.map((y,i)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:y.color}}),e.jsxs("span",{className:"text-sm text-gray-700",children:[y.name," (",y.value,")"]})]},i))}),e.jsx("div",{className:"flex-1 w-full min-h-[220px]",children:ha.Children.map(r,y=>{var i;return o&&((i=y==null?void 0:y.type)==null?void 0:i.displayName)==="Tooltip"?ha.cloneElement(y,{formatter:o}):y})})]})});X.propTypes={title:J.string,icon:J.element,subtitle:J.string,children:J.node.isRequired,className:J.string,legend:J.arrayOf(J.shape({name:J.string.isRequired,value:J.oneOfType([J.string,J.number]).isRequired,color:J.string.isRequired})),tooltipFormatter:J.func};const Xt=()=>{const{authUser:s}=ce(),[t,a]=n.useState({}),[r,l]=n.useState(!0),[c,o]=n.useState([]),[y,i]=n.useState([]),[w,x]=n.useState(null),j=()=>{const p=new Date().getHours();return p<12?"Buenos días":p<18?"Buenas tardes":"Buenas noches"};n.useEffect(()=>{(async()=>{try{const f=await P.get("/dashboard/home-stats/");a(f.data.stats||{}),o(f.data.solicitudesRecientes||[]),i(f.data.alertas||[])}catch(f){console.error("Error cargando estadísticas del Dashboard Home:",f)}finally{l(!1)}})()},[]);const m=[{label:"Solicitudes Pendientes",value:t.solicitudesPendientes??0,icon:De,gradient:"linear-gradient(135deg,#f97316cc,#fb923c99)",tooltip:"Solicitudes que aún no han sido atendidas o aprobadas."},{label:"Liquidaciones Pendientes",value:t.liquidacionesPendientes??0,icon:W,gradient:"linear-gradient(135deg,#0ea5e9cc,#38bdf899)",tooltip:"Solicitudes en estado pendiente de liquidación o aprobación."},{label:"Liquidaciones Aprobadas (Mes)",value:t.liquidacionesAprobadasMes??0,icon:Ja,gradient:"linear-gradient(135deg,#16a34acc,#4ade8099)",tooltip:"Cantidad de liquidaciones aprobadas este mes."},{label:"Monto Total Solicitado (Mes)",value:parseFloat(t.montoTotalSolicitadoMes??0),icon:ae,gradient:"linear-gradient(135deg,#7c3aedcc,#a78bfa99)",tooltip:"Monto total solicitado en caja chica este mes."}],d=p=>{alert(`Ir a: ${p}`)},h=[{name:"Viáticos",value:120},{name:"Movilidad",value:80},{name:"Compras",value:60},{name:"Otros gastos",value:40}],b=[{name:"Pendiente de Envío",value:15},{name:"Pendiente para Atención",value:10},{name:"Atendido, Pendiente de Liquidación",value:8},{name:"Liquidación enviada para Aprobación",value:12},{name:"Liquidación Aprobada",value:20},{name:"Rechazado",value:5}];return e.jsxs("div",{className:"p-6 bg-gray-100 min-h-screen font-sans flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("header",{className:"mb-6",children:[e.jsxs(L.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[j(),","," ",s!=null&&s.nombre?`${s.nombre} ${s.apellido||""}`:"Usuario"," 👋"]}),e.jsxs(L.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.8},className:"mt-1 text-lg text-gray-600 italic",children:["Bienvenido a"," ",e.jsx("span",{className:"font-semibold text-blue-600",children:"PMInsight"}),". Aquí tienes un resumen de hoy."]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6 mb-6",children:m.map(p=>e.jsx($e,{label:p.label,value:r?0:p.value,icon:p.icon,gradient:p.gradient,tooltip:p.tooltip,decimals:Number.isInteger(p.value)?0:2},p.label))}),e.jsxs("section",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(X,{title:"Distribución por tipo de solicitud",icon:e.jsx(ge,{size:18}),legend:h.map(p=>({name:p.name,value:p.value,color:he[p.name]})),tooltipFormatter:Me,children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(xe,{children:[e.jsx(Oe,{data:h,dataKey:"value",nameKey:"name",innerRadius:60,outerRadius:90,paddingAngle:3,label:!0,children:h.map((p,f)=>e.jsx(Z,{fill:he[p.name]},f))}),e.jsx(q,{})]})})}),e.jsx(X,{title:"Estado de solicitudes",icon:e.jsx(fe,{size:18}),legend:b.map(p=>({name:p.name,value:p.value,color:je[p.name]})),tooltipFormatter:ea,children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(Qe,{cx:"50%",cy:"50%",innerRadius:"20%",outerRadius:"90%",barSize:15,data:b,children:[e.jsx(Xe,{minAngle:15,label:{position:"insideStart",fill:"#fff"},background:!0,dataKey:"value"}),e.jsx(oe,{iconSize:10,layout:"vertical",verticalAlign:"middle",align:"right"}),e.jsx(q,{})]})})})]}),e.jsxs("section",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(W,{size:18}),"Movimientos recientes"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Total: ",c.length]})]}),e.jsx(Pe,{headers:["N°","Fecha","Solicitante","Estado","Acciones"],data:c,emptyMessage:"No hay movimientos recientes.",rowsPerPage:5,renderRow:p=>[e.jsx("span",{className:"font-semibold",children:p.nro}),p.fecha,p.solicitante,e.jsx("span",{className:`font-bold ${p.estado==="Aprobada"?"text-green-600":p.estado==="Pendiente"?"text-yellow-600":"text-red-600"}`,children:p.estado}),e.jsxs("button",{className:"bg-gradient-to-r from-blue-400 to-blue-600 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition flex items-center gap-2 justify-center",onClick:()=>x(p.nro),children:[e.jsx(ne,{size:16}),"Revisar"]})]})]}),e.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 mt-6",children:[e.jsxs("div",{onClick:()=>d("/nueva-solicitud"),className:"group bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-2xl shadow-md p-6 flex flex-col items-center justify-center cursor-pointer transition transform hover:scale-105 hover:shadow-lg",children:[e.jsx("div",{className:"bg-white/20 rounded-full p-3 mb-3 group-hover:bg-white/30 transition",children:e.jsx(We,{size:28})}),e.jsx("h4",{className:"font-semibold text-lg",children:"Nueva Solicitud"}),e.jsx("p",{className:"text-sm opacity-80 text-center mt-1",children:"Registra una nueva solicitud de gasto."})]}),e.jsxs("div",{onClick:()=>d("/liquidaciones"),className:"group bg-gradient-to-r from-emerald-600 to-emerald-500 text-white rounded-2xl shadow-md p-6 flex flex-col items-center justify-center cursor-pointer transition transform hover:scale-105 hover:shadow-lg",children:[e.jsx("div",{className:"bg-white/20 rounded-full p-3 mb-3 group-hover:bg-white/30 transition",children:e.jsx(xe,{size:28})}),e.jsx("h4",{className:"font-semibold text-lg",children:"Ver Liquidaciones"}),e.jsx("p",{className:"text-sm opacity-80 text-center mt-1",children:"Consulta el estado de tus liquidaciones."})]}),e.jsxs("div",{onClick:()=>d("/reportes"),className:"group bg-gradient-to-r from-indigo-600 to-indigo-500 text-white rounded-2xl shadow-md p-6 flex flex-col items-center justify-center cursor-pointer transition transform hover:scale-105 hover:shadow-lg",children:[e.jsx("div",{className:"bg-white/20 rounded-full p-3 mb-3 group-hover:bg-white/30 transition",children:e.jsx(fe,{size:28})}),e.jsx("h4",{className:"font-semibold text-lg",children:"Reportes"}),e.jsx("p",{className:"text-sm opacity-80 text-center mt-1",children:"Estadísticas y reportes ejecutivos."})]})]})]}),y.length>0&&e.jsx("div",{className:"fixed top-20 right-6 z-50 w-80 animate-slideIn",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-2xl border border-red-200 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between bg-red-500 text-white px-4 py-2",children:[e.jsx("h3",{className:"text-sm font-semibold flex items-center gap-2",children:"⚠️ Alertas Activas"}),e.jsx("button",{onClick:()=>i([]),className:"hover:text-gray-200 transition",children:"✖"})]}),e.jsx("ul",{className:"p-4 space-y-2 text-gray-700 text-sm max-h-64 overflow-y-auto",children:y.map((p,f)=>e.jsx("li",{className:"bg-red-50 border border-red-200 rounded-lg px-3 py-2",children:p},f))})]})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-lg max-w-sm w-full",children:[e.jsxs("h4",{className:"text-lg font-bold mb-2",children:["Detalle Solicitud #",w]}),e.jsx("p",{className:"mb-4",children:"Aquí irían los datos detallados de la solicitud."}),e.jsx("button",{className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",onClick:()=>x(null),children:"Cerrar"})]})})]})};function Zt({data:s}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Código"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Referencia"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Empresa"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Área"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Monto Programado"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Monto Ejecutado"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Saldo"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Estado"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-4 text-gray-500",children:"No se encontraron programaciones registradas."})}):s.map((t,a)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 font-mono text-gray-600",children:t.codigo}),e.jsx("td",{className:"px-4 py-2",children:t.referencia}),e.jsx("td",{className:"px-4 py-2",children:t.empresa}),e.jsx("td",{className:"px-4 py-2",children:t.area}),e.jsx("td",{className:"px-4 py-2 font-semibold",children:t.monto_programado.toLocaleString("es-PE",{style:"currency",currency:"PEN"})}),e.jsx("td",{className:"px-4 py-2 text-green-700",children:t.monto_ejecutado?t.monto_ejecutado.toLocaleString("es-PE",{style:"currency",currency:"PEN"}):"-"}),e.jsx("td",{className:"px-4 py-2 font-semibold",children:t.saldo?t.saldo.toLocaleString("es-PE",{style:"currency",currency:"PEN"}):"-"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${t.estado==="Pendiente"?"bg-yellow-100 text-yellow-800":t.estado==="Ejecutado"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.estado})})]},a))})]})})}function er({className:s,classNames:t,showOutsideDays:a=!0,captionLayout:r="label",buttonVariant:l="ghost",formatters:c,components:o,...y}){const i=Ya();return e.jsx(Is,{showOutsideDays:a,className:F("bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,s),captionLayout:r,formatters:{formatMonthDropdown:w=>w.toLocaleString("default",{month:"short"}),...c},classNames:{root:F("w-fit",i.root),months:F("relative flex flex-col gap-4 md:flex-row",i.months),month:F("flex w-full flex-col gap-4",i.month),nav:F("absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1",i.nav),button_previous:F(ga({variant:l}),"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50",i.button_previous),button_next:F(ga({variant:l}),"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50",i.button_next),month_caption:F("flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]",i.month_caption),dropdowns:F("flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium",i.dropdowns),dropdown_root:F("has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border",i.dropdown_root),dropdown:F("bg-popover absolute inset-0 opacity-0",i.dropdown),caption_label:F("select-none font-medium",r==="label"?"text-sm":"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5",i.caption_label),table:"w-full border-collapse",weekdays:F("flex",i.weekdays),weekday:F("text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal",i.weekday),week:F("mt-2 flex w-full",i.week),week_number_header:F("w-[--cell-size] select-none",i.week_number_header),week_number:F("text-muted-foreground select-none text-[0.8rem]",i.week_number),day:F("group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md",i.day),range_start:F("bg-accent rounded-l-md",i.range_start),range_middle:F("rounded-none",i.range_middle),range_end:F("bg-accent rounded-r-md",i.range_end),today:F("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",i.today),outside:F("text-muted-foreground aria-selected:text-muted-foreground",i.outside),disabled:F("text-muted-foreground opacity-50",i.disabled),hidden:F("invisible",i.hidden),...t},components:{Root:({className:w,rootRef:x,...j})=>e.jsx("div",{"data-slot":"calendar",ref:x,className:F(w),...j}),Chevron:({className:w,orientation:x,...j})=>x==="left"?e.jsx(Va,{className:F("size-4",w),...j}):x==="right"?e.jsx(Wa,{className:F("size-4",w),...j}):e.jsx(qs,{className:F("size-4",w),...j}),DayButton:ar,WeekNumber:({children:w,...x})=>e.jsx("td",{...x,children:e.jsx("div",{className:"flex size-[--cell-size] items-center justify-center text-center",children:w})}),...o},...y})}function ar({className:s,day:t,modifiers:a,...r}){const l=Ya(),c=n.useRef(null);return n.useEffect(()=>{var o;a.focused&&((o=c.current)==null||o.focus())},[a.focused]),e.jsx(E,{ref:c,variant:"ghost",size:"icon","data-day":t.date.toLocaleDateString(),"data-selected-single":a.selected&&!a.range_start&&!a.range_end&&!a.range_middle,"data-range-start":a.range_start,"data-range-end":a.range_end,"data-range-middle":a.range_middle,className:F("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70",l.day,s),...r})}const sr=({open:s,onClose:t,onSave:a,initialData:r})=>{const[l,c]=n.useState({codigo:"",referencia:"",descripcion:"",monto_programado:"",fecha:new Date,proyecto:"",area:"",empresa:""});n.useEffect(()=>{r&&c({codigo:r.codigo||"",referencia:r.referencia||"",descripcion:r.descripcion||"",monto_programado:r.monto_programado||"",fecha:r.fecha?new Date(r.fecha):new Date,proyecto:r.proyecto||"",area:r.area||"",empresa:r.empresa||""})},[r]);const o=(i,w)=>{c(x=>({...x,[i]:w}))},y=()=>{a(l),t()};return e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"max-w-lg",children:[e.jsx(K,{children:e.jsx(H,{children:r?"Editar Programación":"Nueva Programación"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(te,{htmlFor:"referencia",children:"Referencia"}),e.jsx(Q,{id:"referencia",value:l.referencia,onChange:i=>o("referencia",i.target.value),placeholder:"Ej: PRG-2025-001"})]}),e.jsxs("div",{children:[e.jsx(te,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(Q,{id:"descripcion",value:l.descripcion,onChange:i=>o("descripcion",i.target.value),placeholder:"Ej: Compra de equipos de oficina"})]}),e.jsxs("div",{children:[e.jsx(te,{htmlFor:"monto_programado",children:"Monto Programado (S/)"}),e.jsx(Q,{id:"monto_programado",type:"number",value:l.monto_programado,onChange:i=>o("monto_programado",i.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(te,{htmlFor:"proyecto",children:"Proyecto"}),e.jsx(Q,{id:"proyecto",value:l.proyecto,onChange:i=>o("proyecto",i.target.value),placeholder:"Ej: Proyecto Alfa"})]}),e.jsxs("div",{children:[e.jsx(te,{htmlFor:"area",children:"Área"}),e.jsx(Q,{id:"area",value:l.area,onChange:i=>o("area",i.target.value),placeholder:"Ej: Contabilidad"})]}),e.jsxs("div",{children:[e.jsx(te,{htmlFor:"empresa",children:"Empresa"}),e.jsx(Q,{id:"empresa",value:l.empresa,onChange:i=>o("empresa",i.target.value),placeholder:"Ej: V&C Corporation"})]}),e.jsxs("div",{children:[e.jsx(te,{children:"Fecha de Ejecución"}),e.jsx(er,{mode:"single",selected:l.fecha,onSelect:i=>o("fecha",i)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Fecha seleccionada: ",pa(l.fecha,"dd/MM/yyyy")]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(E,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(E,{onClick:y,children:r?"Actualizar":"Guardar"})]})]})})},tr="http://localhost:8000/api",js=aa.create({baseURL:tr,headers:{"Content-Type":"application/json"}});js.interceptors.request.use(s=>{const t=localStorage.getItem("access");return t&&(s.headers.Authorization=`Bearer ${t}`),s},s=>Promise.reject(s));const rr=async()=>(await js.get("/programaciones/")).data;function or(){const[s,t]=n.useState([]),[a,r]=n.useState(!1),[l,c]=n.useState(!1),[o,y]=n.useState({year:"2025",proyecto:"",area:"",empresa:"",encargado:""}),i=async()=>{c(!0);try{const j=await rr(o);t(j)}catch(j){console.error("Error al cargar programaciones:",j)}finally{c(!1)}};n.useEffect(()=>{i()},[o]);const w=()=>{i()},x=()=>{console.log("Generando reporte...")};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Programación de Gastos"}),e.jsxs(E,{onClick:()=>r(!0),className:"flex items-center gap-2",children:[e.jsx(Qa,{size:18})," Nueva Programación"]})]}),e.jsxs(ue,{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{size:20,className:"text-gray-500"}),e.jsxs("select",{value:o.year,onChange:j=>y({...o,year:j.target.value}),className:"flex-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"2025",children:"2025"}),e.jsx("option",{value:"2024",children:"2024"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gs,{size:20,className:"text-gray-500"}),e.jsx("select",{value:o.proyecto,onChange:j=>y({...o,proyecto:j.target.value}),className:"flex-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:e.jsx("option",{value:"",children:"Todos"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bs,{size:20,className:"text-gray-500"}),e.jsx("select",{value:o.area,onChange:j=>y({...o,area:j.target.value}),className:"flex-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:e.jsx("option",{value:"",children:"Todos"})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsxs(E,{onClick:w,className:"flex items-center gap-2",children:[e.jsx(ba,{size:18})," Procesar"]}),e.jsxs(E,{onClick:x,className:"flex items-center gap-2",children:[e.jsx(W,{size:18})," Reporte"]})]})]}),e.jsx(ue,{children:e.jsx(be,{className:"p-6",children:l?e.jsx("p",{children:"Cargando datos..."}):e.jsx(Zt,{data:s})})}),a&&e.jsx(sr,{open:a,onClose:()=>r(!1),onSave:()=>{r(!1),i()}})]})}class nr{constructor(){this.listeners={}}on(t,a){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(a),()=>this.off(t,a)}off(t,a){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(r=>r!==a))}emit(t,a){this.listeners[t]&&this.listeners[t].forEach(r=>r(a))}}const B=new nr;function se({label:s,name:t,value:a,onChange:r,readOnly:l=!1,type:c="text"}){return e.jsxs("div",{className:"flex flex-col mb-3 w-full",children:[s&&e.jsxs("label",{className:"mb-1 text-xs sm:text-sm font-medium text-gray-700",children:[s,":"]}),e.jsx("input",{type:c,name:t,value:a,onChange:r,readOnly:l,className:"border border-gray-300 rounded-lg px-3 py-2 sm:px-4 sm:py-2 bg-gray-50 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm w-full"})]})}function Fa({label:s,name:t,value:a,onChange:r}){return e.jsxs("div",{className:"flex flex-col mb-3 w-full",children:[s&&e.jsxs("label",{className:"mb-1 text-xs sm:text-sm font-medium text-gray-700",children:[s,":"]}),e.jsx("textarea",{name:t,value:a,onChange:r,className:"border border-gray-300 rounded-lg px-3 py-2 sm:px-4 sm:py-2 bg-gray-50 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm resize-none w-full"})]})}function ia({label:s,name:t,value:a,onChange:r,options:l=[]}){return e.jsxs("div",{className:"flex flex-col mb-3 w-full",children:[s&&e.jsxs("label",{className:"mb-1 text-xs sm:text-sm font-medium text-gray-700",children:[s,":"]}),e.jsxs("select",{name:t,value:a||"",onChange:r,className:"border border-gray-300 rounded-lg px-3 py-2 sm:px-4 sm:py-2 bg-gray-50 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm w-full",children:[e.jsx("option",{value:"",children:"Selecciona..."}),l.map(c=>e.jsxs("option",{value:c.id,children:[c.nombre," ",c.apellido]},c.id))]})]})}function ys({open:s,onClose:t,onCreated:a}){const{authUser:r}=ce(),l=ze(),c=[{id:2,nombre:"Cristina",apellido:"Martinez"},{id:3,nombre:"Marisol",apellido:"Rojas"},{id:4,nombre:"Cristina",apellido:"Silva"}],[o,y]=n.useState({numero_solicitud:"",fecha:"",hora:"",codigo:"",solicitante:"",destinatario_id:null,tipo_solicitud:"",area:"",tipo_moneda:"",tipo_cambio:"3.55",monto_soles:"",monto_dolares:"",fecha_transferencia:"",fecha_liquidacion:"",banco:"",numero_cuenta:"",concepto_gasto:"",observacion:""});n.useEffect(()=>{if(!s)return;const x=new Date;y(j=>({...j,numero_solicitud:Math.floor(1e3+Math.random()*9e3),codigo:Us().split("-")[0].toUpperCase(),fecha:pa(x,"yyyy-MM-dd"),hora:pa(x,"HH:mm:ss"),solicitante:(r==null?void 0:r.id)||"",area:(r==null?void 0:r.area)||"",banco:(r==null?void 0:r.banco)||"",numero_cuenta:(r==null?void 0:r.numero_cuenta)||"",tipo_cambio:"3.55"}))},[s,r]),n.useEffect(()=>{o.monto_soles&&o.tipo_cambio&&y(x=>({...x,monto_dolares:(parseFloat(x.monto_soles)/parseFloat(x.tipo_cambio)).toFixed(2)}))},[o.monto_soles,o.tipo_cambio]);const i=x=>{const{name:j,value:m}=x.target;y(d=>({...d,[j]:j==="destinatario_id"?m?parseInt(m):null:m}))},w=async()=>{var j;const x={numero_solicitud:o.numero_solicitud,fecha:o.fecha,hora:o.hora,codigo:o.codigo,solicitante:o.solicitante,destinatario_id:o.destinatario_id,tipo_solicitud:o.tipo_solicitud,area:o.area,estado:"Pendiente para Atención",moneda:"PEN",tipo_cambio:o.tipo_cambio,total_soles:o.monto_soles||0,total_dolares:o.monto_dolares||0,fecha_transferencia:o.fecha_transferencia,fecha_liquidacion:o.fecha_liquidacion,banco:o.banco,numero_cuenta:o.numero_cuenta,concepto_gasto:o.concepto_gasto,observacion:o.observacion};try{await P.post("boleta/solicitudes/guardar-solicitud/",x),Sa.fire("¡Guardado!","La solicitud fue registrada correctamente","success"),B.emit("solicitudCreada",x),a==null||a(),t==null||t(),l("/dashboard/liquidaciones/solicitud")}catch(m){const d=((j=m==null?void 0:m.response)==null?void 0:j.data)||{};Sa.fire("Error",`No se pudo guardar la solicitud. Detalles: ${JSON.stringify(d)}`,"error")}};return e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"max-w-5xl w-[95%] max-h-[90vh] overflow-y-auto bg-white",children:[e.jsx(K,{children:e.jsxs(H,{className:"flex items-center gap-2 text-lg sm:text-xl md:text-2xl font-bold text-gray-800",children:[e.jsx(Ks,{className:"w-5 h-5 sm:w-6 sm:h-6"})," Nueva Solicitud de Gasto"]})}),e.jsx("p",{className:"text-gray-700 mb-6 text-xs sm:text-sm md:text-base",children:"Completa los campos para registrar una nueva solicitud de gasto."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm sm:text-base md:text-lg font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(Xa,{className:"w-4 h-4 sm:w-5 sm:h-5"})," Datos Generales"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(se,{label:"N° Solicitud",value:o.numero_solicitud,readOnly:!0}),e.jsx(se,{label:"Fecha",value:o.fecha,readOnly:!0}),e.jsx(se,{label:"Hora",value:o.hora,readOnly:!0}),e.jsx(se,{label:"Código",value:o.codigo,readOnly:!0}),e.jsx(se,{label:"Solicitante",value:r?`${r.nombre} ${r.apellido}`:"",readOnly:!0}),e.jsx(ia,{label:"Destinatario",name:"destinatario_id",value:o.destinatario_id,onChange:i,options:c}),e.jsx(ia,{label:"Tipo de Solicitud",name:"tipo_solicitud",value:o.tipo_solicitud,onChange:i,options:[{id:"Viáticos",nombre:"Viáticos",apellido:""},{id:"Movilidad",nombre:"Movilidad",apellido:""},{id:"Compras",nombre:"Compras",apellido:""},{id:"Otros Gastos",nombre:"Otros Gastos",apellido:""}]}),e.jsx(se,{label:"Área",value:o.area,readOnly:!0})]}),e.jsxs("h3",{className:"text-sm sm:text-base md:text-lg font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(Hs,{className:"w-4 h-4 sm:w-5 sm:h-5"})," Monto y Fechas"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(se,{label:"Monto en Soles",name:"monto_soles",value:o.monto_soles,onChange:i}),e.jsx(se,{label:"Fecha Transferencia",type:"date",name:"fecha_transferencia",value:o.fecha_transferencia,onChange:i}),e.jsx(se,{label:"Fecha Liquidación",type:"date",name:"fecha_liquidacion",value:o.fecha_liquidacion,onChange:i})]}),e.jsxs("h3",{className:"text-sm sm:text-base md:text-lg font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(Vs,{className:"w-4 h-4 sm:w-5 sm:h-5"})," Datos Bancarios"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(ia,{label:"Banco",name:"banco",value:o.banco,onChange:i,options:[{id:"BCP",nombre:"BCP",apellido:""},{id:"Interbank",nombre:"Interbank",apellido:""}]}),e.jsx(se,{label:o.banco==="Interbank"?"CCI":"Número de Cuenta",name:"numero_cuenta",value:o.numero_cuenta,onChange:i})]}),e.jsxs("h3",{className:"text-sm sm:text-base md:text-lg font-semibold border-b pb-1 flex items-center gap-2 text-gray-800",children:[e.jsx(Ws,{className:"w-4 h-4 sm:w-5 sm:h-5"})," Detalles del Gasto"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(Fa,{label:"Concepto de Gasto",name:"concepto_gasto",value:o.concepto_gasto,onChange:i}),e.jsx(Fa,{label:"Observación",name:"observacion",value:o.observacion,onChange:i})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 mt-6",children:[e.jsx(E,{onClick:t,className:"bg-gradient-to-r from-gray-300 to-gray-400 hover:from-gray-400 hover:to-gray-500 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",children:"Cancelar"}),e.jsx(E,{onClick:w,className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",children:"Guardar"})]})]})})}const lr=Js,vs=n.forwardRef(({className:s,...t},a)=>e.jsx(Za,{ref:a,className:F("inline-flex items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500",s),...t}));vs.displayName=Za.displayName;const He=n.forwardRef(({className:s,...t},a)=>e.jsx(es,{ref:a,className:F("inline-flex min-w-[100px] items-center justify-center rounded-sm px-3 py-1.5 text-sm font-medium transition-all","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","data-[state=active]:bg-white data-[state=active]:text-black",s),...t}));He.displayName=es.displayName;const Ve=n.forwardRef(({className:s,...t},a)=>e.jsx(as,{ref:a,className:F("mt-2 rounded-md border p-4 bg-white shadow-sm",s),...t}));Ve.displayName=as.displayName;function Ns({open:s,onClose:t,solicitudId:a,solicitudInit:r}){const{authUser:l}=ce(),[c,o]=n.useState(r||null),[y,i]=n.useState([]),[w,x]=n.useState(!c),[j,m]=n.useState(!1),[d,h]=n.useState(!1),[b,p]=n.useState(null),f=()=>(l==null?void 0:l.rol)==="Colaborador"&&(c==null?void 0:c.estado)==="Pendiente de Envío";return n.useEffect(()=>{if(!a)return;(async()=>{try{x(!0);const{data:v}=await P.get(`/boleta/mis_solicitudes/${a}/`);o(v);try{const{data:S}=await P.get(`/boleta/mis_solicitudes/${a}/historial/`);i(S)}catch{i([])}}catch(v){console.error("❌ Error al cargar solicitud:",v),alert("No se pudo cargar la solicitud.")}finally{x(!1)}})()},[a]),e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"max-w-4xl w-[95%] max-h-[90vh] overflow-y-auto bg-white rounded-2xl shadow-lg animate-fadeIn",children:[e.jsxs(K,{children:[e.jsxs(H,{className:"flex items-center gap-2 text-lg sm:text-xl font-bold text-gray-800",children:[e.jsx(W,{className:"w-5 h-5"}),"Detalles de la Solicitud ",(c==null?void 0:c.numero_solicitud)||"-"]}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:["Usuario: ",l!=null&&l.nombre?`${l.nombre} ${l.apellido||""}`:"Usuario"]})]}),w?e.jsx("p",{className:"text-gray-500",children:"Cargando solicitud..."}):c?e.jsxs(e.Fragment,{children:[e.jsxs(lr,{defaultValue:"basicos",className:"w-full mt-2",children:[e.jsxs(vs,{className:"grid grid-cols-3 gap-2 mb-4",children:[e.jsxs(He,{value:"basicos",className:"flex items-center gap-1",children:[e.jsx(Xa,{className:"w-4 h-4"})," Básicos"]}),e.jsxs(He,{value:"historial",className:"flex items-center gap-1",children:[e.jsx(Ys,{className:"w-4 h-4"})," Historial"]}),e.jsxs(He,{value:"adjuntos",className:"flex items-center gap-1",children:[e.jsx(ss,{className:"w-4 h-4"})," Adjuntos"]})]}),e.jsx(Ve,{value:"basicos",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(Y,{label:"N° Solicitud",value:c.numero_solicitud}),e.jsx(Y,{label:"Fecha",value:c.fecha}),e.jsx(Y,{label:"Destinatario",value:c.destinatario_nombre||"-"}),e.jsx(Y,{label:"Tipo de Solicitud",value:c.tipo_solicitud}),e.jsx(Y,{label:"Concepto",value:c.concepto_gasto}),e.jsx(Y,{label:"Estado",value:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs sm:text-sm font-semibold ${je[c.estado]||"bg-gray-200 text-gray-700"}`,children:c.estado})}),e.jsx(Y,{label:"Observación",value:c.observacion}),e.jsx(Y,{label:"Total (S/.)",value:c.total_soles}),e.jsx(Y,{label:"Total (USD)",value:c.total_dolares}),e.jsx(Y,{label:"Fecha Transferencia",value:c.fecha_transferencia}),e.jsx(Y,{label:"Fecha Liquidación",value:c.fecha_liquidacion}),e.jsx(Y,{label:"Banco",value:c.banco}),e.jsx(Y,{label:"N° Cuenta",value:c.numero_cuenta})]})}),e.jsx(Ve,{value:"historial",children:y.length===0?e.jsx("p",{className:"text-gray-500",children:"No hay historial disponible."}):e.jsx("ul",{className:"space-y-4",children:y.map(g=>e.jsxs("li",{className:"border-l-4 border-blue-500 pl-4 bg-gray-50 p-3 rounded-md shadow-sm",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:g.estado_anterior})," → ",e.jsx("span",{className:"font-semibold",children:g.estado_nuevo})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(g.fecha_cambio).toLocaleString()," | Usuario: ",g.usuario||"N/A"]})]},g.id))})}),e.jsx(Ve,{value:"adjuntos",children:e.jsx("p",{className:"text-gray-500",children:"Aquí se mostrarán los documentos adjuntos."})})]}),e.jsx("div",{className:"flex justify-end mt-6 gap-3 flex-wrap",children:f()&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(E,{onClick:()=>{p("enviar"),h(!0)},disabled:j,className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-5 py-2 rounded-lg shadow-lg font-semibold transition-all duration-200",children:j&&b==="enviar"?"Procesando...":"Enviar Solicitud"})})}),d&&b==="enviar"&&e.jsx(V,{open:d,onOpenChange:()=>h(!1),children:e.jsxs(U,{className:"max-w-md w-[90%] p-6 bg-white rounded-xl shadow-2xl animate-fadeInDown",children:[e.jsx(K,{children:e.jsx(H,{className:"text-lg font-bold text-gray-800",children:"Confirmar envío"})}),e.jsxs("p",{className:"mt-2 text-gray-600",children:["¿Deseas enviar esta solicitud? Una vez enviada, pasará a ",e.jsx("b",{children:"Pendiente para Atención"}),"."]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-3",children:[e.jsx(E,{variant:"outline",onClick:()=>h(!1),children:"Cancelar"}),e.jsx(E,{onClick:async()=>{var g,v,S;m(!0);try{const{data:C}=await P.patch(`/boleta/mis_solicitudes/${c.id}/estado/`,{estado:"Pendiente para Atención"});o(M=>{var A;return{...M,estado:((A=C.solicitud)==null?void 0:A.estado)||"Pendiente para Atención"}}),B.emit("solicitudEnviada",{numero_solicitud:((g=C.solicitud)==null?void 0:g.numero_solicitud)||c.numero_solicitud}),h(!1),p(null)}catch(C){console.error("❌ Error al enviar solicitud:",C),alert(((S=(v=C.response)==null?void 0:v.data)==null?void 0:S.error)||"No se pudo enviar la solicitud.")}finally{m(!1)}},disabled:j,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Sí, enviar"})]})]})})]}):e.jsx("p",{className:"text-gray-500",children:"No se encontró la solicitud."})]})})}function Y({label:s,value:t}){return e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-3 sm:p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:s}),e.jsx("p",{className:"text-sm sm:text-base lg:text-lg font-semibold text-gray-800 break-words",children:t||"-"})]})}const ws=({open:s,onClose:t})=>{const[a,r]=n.useState([]),[l,c]=n.useState("Todos"),[o,y]=n.useState(""),[i,w]=n.useState(""),[x,j]=n.useState(!1),[m,d]=n.useState(null);n.useEffect(()=>{s&&h();const f=C=>{r(M=>[C,...M])},g=C=>{r(M=>M.map(A=>A.numero_solicitud===C.numero_solicitud?{...A,estado:"Enviada"}:A))},v=B.on("solicitudCreada",f),S=B.on("solicitudEnviada",g);return()=>{v(),S()}},[s]);const h=async()=>{try{const f=await P.get("/boleta/mis_solicitudes/");r(f.data)}catch(f){console.error("Error cargando solicitudes:",f)}},b=a.filter(f=>{const g=l==="Todos"||f.estado===l,v=(!o||new Date(f.fecha)>=new Date(o))&&(!i||new Date(f.fecha)<=new Date(i));return g&&v}),p=(f,g,v=null)=>{v&&(d(v),j(!0))};return e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"max-w-6xl w-[95%] max-h-[90vh] overflow-y-auto bg-white",children:[e.jsx(K,{children:e.jsxs(H,{className:"flex items-center gap-2 text-xl sm:text-2xl font-bold text-gray-800",children:[e.jsx(W,{className:"w-6 h-6"}),"Mis Solicitudes"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Estado:"}),e.jsxs("select",{value:l,onChange:f=>c(f.target.value),className:"border rounded-md px-2 py-1 text-sm",children:[e.jsx("option",{value:"Todos",children:"Todos"}),Object.keys(Ze).map((f,g)=>e.jsx("option",{value:f,children:f},g))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Desde:"}),e.jsx("input",{type:"date",value:o,onChange:f=>y(f.target.value),className:"border rounded-md px-2 py-1 text-sm"}),e.jsx("label",{className:"text-sm font-medium",children:"Hasta:"}),e.jsx("input",{type:"date",value:i,onChange:f=>w(f.target.value),className:"border rounded-md px-2 py-1 text-sm"})]})]}),e.jsx(Pe,{headers:["N° Solicitud","Tipo","Monto (S/.)","Monto ($)","Fecha","Concepto","Estado","Acción"],data:b,emptyMessage:"No hay solicitudes en este estado o rango de fechas.",renderRow:f=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 font-semibold text-center",children:f.numero_solicitud}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Na[f.tipo_solicitud]||"bg-gray-200 text-gray-700"}`,children:f.tipo_solicitud})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:f.total_soles?`S/. ${f.total_soles}`:"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:f.total_dolares?`$ ${f.total_dolares}`:"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:f.fecha}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:f.concepto_gasto??"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ze[f.estado]||"bg-gray-200 text-gray-700"}`,children:f.estado})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>p(f.id,"Ver Detalle",f),className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-4 h-4"})," Detalle"]})})]})}),x&&m&&e.jsx(Ns,{open:x,onClose:()=>j(!1),solicitudId:m==null?void 0:m.id,solicitudInit:m})]})})},Ge=Object.values(je),Be=Object.values(he);function ir(){return Array.from({length:12},(s,t)=>new Date(0,t).toLocaleString("es-PE",{month:"long"}))}function cr(){const{authUser:s}=ce(),t=ir(),a={total:0,montoTotalSoles:0,montoTotalDolares:0,promedioSoles:0,promedioDolares:0,chartAreaMes:t.map(b=>({mes:b.charAt(0).toUpperCase()+b.slice(1),solicitudes:0})),chartRadialEstado:Object.keys(je).map(b=>({name:b,value:0})),chartTreemapTipo:Object.keys(he).map(b=>({name:b,value:0}))},[r,l]=n.useState(a),[c,o]=n.useState(!0),[y,i]=n.useState(null),[w,x]=n.useState(null),[j,m]=n.useState(!1),d=async()=>{if(!s)return;const b=localStorage.getItem("access_token");if(!b){i("Sesión expirada, inicia sesión nuevamente.");return}try{o(!0),i(null);const f=(await P.get("/boleta/solicitudes/dashboard/",{headers:{Authorization:`Bearer ${b}`}})).data||{},g=f.chartAreaMes&&f.chartAreaMes.length===12?f.chartAreaMes.map((C,M)=>({mes:t[M].charAt(0).toUpperCase()+t[M].slice(1),solicitudes:C.solicitudes??C.value??0})):a.chartAreaMes,v=f.chartRadialEstado&&f.chartRadialEstado.length?Object.keys(je).map(C=>{const M=(f.chartRadialEstado||[]).find(A=>String(A.name).toLowerCase().includes(String(C).toLowerCase()));return{name:C,value:M?Number(M.value||0):0}}):a.chartRadialEstado;let S=[];f.chartTreemapTipo&&f.chartTreemapTipo.length?(S=f.chartTreemapTipo.map(C=>({name:C.name,value:Number(C.value||0)})),Object.keys(he).forEach(C=>{S.find(M=>String(M.name).toLowerCase()===C.toLowerCase())||S.push({name:C,value:0})})):S=a.chartTreemapTipo,l(C=>({...C,...f,chartAreaMes:g,chartRadialEstado:v,chartTreemapTipo:S}))}catch(p){console.error("Error al cargar datos",p),i(p.message||"No se pudieron cargar los datos."),l(a)}finally{o(!1)}};if(n.useEffect(()=>{d();const b=B.on("solicitudCreada",()=>d()),p=B.on("solicitudEnviada",()=>d());return()=>{b(),p()}},[s]),!s||c)return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"h-8 w-1/3 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6",children:Array.from({length:5}).map((b,p)=>e.jsx("div",{className:"bg-gray-200 h-24 rounded animate-pulse"},p))})]});if(y)return e.jsx("p",{className:"text-red-500 font-semibold p-6",children:y});const h=[{label:"Total Solicitudes",value:r.total??0,icon:De,gradient:"linear-gradient(135deg,#3b82f6cc,#60a5fa99)",tooltip:"Número total de solicitudes registradas."},{label:"Monto Total S/.",value:parseFloat(r.montoTotalSoles??0),icon:ae,gradient:"linear-gradient(135deg,#0ea5e9cc,#60a5fa99)",tooltip:"Suma total en soles."},{label:"Monto Total $",value:parseFloat(r.montoTotalDolares??0),icon:ae,gradient:"linear-gradient(135deg,#7c3aedcc,#a78bfa99)",tooltip:"Suma total en dólares."},{label:"Promedio S/.",value:parseFloat(r.promedioSoles??0),icon:Ye,gradient:"linear-gradient(135deg,#14b8a6cc,#34d39999)",tooltip:"Promedio por solicitud en soles."},{label:"Promedio $",value:parseFloat(r.promedioDolares??0),icon:Ye,gradient:"linear-gradient(135deg,#f59e0bcc,#fbbf24aa)",tooltip:"Promedio por solicitud en dólares."}];return e.jsxs("div",{className:"min-h-screen w-full flex flex-col p-4 sm:p-6 bg-gray-50 overflow-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2 text-gray-800 mb-6",children:[e.jsx(We,{className:"w-7 h-7 text-gray-800"})," Solicitud de Gasto"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 md:gap-6 mb-6",children:h.map(b=>e.jsx($e,{label:b.label,value:b.value,icon:b.icon,gradient:b.gradient,tooltip:b.tooltip,decimals:Number.isInteger(b.value)?0:2},b.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 w-full",children:[e.jsx(X,{title:"Estados de Solicitudes",icon:e.jsx(ge,{className:"w-5 h-5 text-gray-700"}),subtitle:"Última actualización",className:"h-[380px] w-[500px]",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 h-full items-stretch",children:[e.jsx("div",{className:"flex-1 min-h-[220px]",children:e.jsx($,{width:"100%",height:260,children:e.jsxs(Qe,{innerRadius:"10%",outerRadius:"95%",data:r.chartRadialEstado,children:[e.jsx(Xe,{minAngle:10,background:!0,clockWise:!0,dataKey:"value",cornerRadius:8,children:r.chartRadialEstado.map((b,p)=>e.jsx(Z,{fill:Ge[p%Ge.length]},`cell-${p}`))}),e.jsx(q,{formatter:ea,wrapperStyle:{outline:"none"}})]})})}),e.jsx("div",{className:"w-full lg:w-48 flex-shrink-0",children:r.chartRadialEstado.map((b,p)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[e.jsx("span",{style:{width:12,height:12,background:Ge[p%Ge.length],display:"inline-block",borderRadius:3}}),e.jsx("span",{className:"font-medium",children:b.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",b.value,")"]})]},b.name))})]})}),e.jsx(X,{title:"Tipos de Solicitudes",icon:e.jsx(Qs,{className:"w-5 h-5 text-gray-700"}),className:"h-[380px] w-[500px]",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 h-full items-stretch",children:[e.jsx("div",{className:"flex-1 min-h-[220px]",children:e.jsx($,{width:"100%",height:260,children:e.jsxs(Qe,{innerRadius:"10%",outerRadius:"95%",data:r.chartTreemapTipo,children:[e.jsx(Xe,{minAngle:10,background:!0,clockWise:!0,dataKey:"value",cornerRadius:8,children:r.chartTreemapTipo.map((b,p)=>e.jsx(Z,{fill:Be[p%Be.length]||"#334155"},`cell-type-${p}`))}),e.jsx(q,{formatter:ea,wrapperStyle:{outline:"none"}})]})})}),e.jsx("div",{className:"w-full lg:w-48 flex-shrink-0",children:r.chartTreemapTipo.map((b,p)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[e.jsx("span",{style:{width:12,height:12,background:Be[p%Be.length]||"#334155",display:"inline-block",borderRadius:3}}),e.jsx("span",{className:"font-medium",children:b.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",b.value,")"]})]},b.name))})]})})]}),e.jsx("div",{className:"grid grid-cols-1 mt-6",children:e.jsx(X,{title:"Evolución Mensual",icon:e.jsx(ta,{className:"w-5 h-5 text-gray-700"}),className:"h-[420px]",tooltipFormatter:Me,children:e.jsx($,{width:"100%",height:320,children:e.jsxs(ts,{data:r.chartAreaMes,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorArea",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.35}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.05})]})}),e.jsx(Se,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(le,{dataKey:"mes",stroke:"#6b7280",tick:{fontSize:12}}),e.jsx(ie,{stroke:"#6b7280",domain:[0,"dataMax + 1"],allowDecimals:!1}),e.jsx(q,{wrapperStyle:{outline:"none"}}),e.jsx(rs,{type:"monotone",dataKey:"solicitudes",stroke:"#3b82f6",fill:"url(#colorArea)",strokeWidth:3})]})})})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-6",children:[e.jsxs(E,{onClick:()=>x("nueva"),className:"bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white text-sm px-4 py-2 rounded-lg shadow-md transition flex items-center gap-2 justify-center",children:[e.jsx(We,{className:"w-5 h-5"})," Nueva Solicitud"]}),e.jsxs(E,{onClick:()=>m(!0),className:"bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-white text-sm px-4 py-2 rounded-lg shadow-md transition flex items-center gap-2 justify-center",children:[e.jsx(De,{className:"w-5 h-5"})," Mis Solicitudes"]})]}),e.jsx(ys,{open:w==="nueva",onClose:()=>x(null),onCreated:d}),e.jsx(ws,{open:j,onClose:()=>m(!1),onRefresh:d})]})}function dr({solicitudId:s,onClose:t,onDecided:a}){const{authUser:r,logout:l}=ce(),c=ze(),[o,y]=n.useState(null),[i,w]=n.useState(!0),[x,j]=n.useState(""),[m,d]=n.useState(null),[h,b]=n.useState(null);n.useEffect(()=>{(async()=>{var g;if(!(!r||!s)){w(!0),b(null);try{const v=localStorage.getItem("access_token"),{data:S}=await P.get(`/boleta/solicitudes/${s}/`,{headers:{Authorization:`Bearer ${v}`}});y(S)}catch(v){console.error(v),b("No se pudo cargar la información de la solicitud."),((g=v==null?void 0:v.response)==null?void 0:g.status)===401&&l()}finally{w(!1)}}})()},[r,s,l]);const p=async f=>{var g;if(s){d(f);try{const v=localStorage.getItem("access_token");await P.post(`/boleta/solicitudes/${s}/decision/`,{decision:f,comentario:x},{headers:{Authorization:`Bearer ${v}`}}),f==="Atendido"?B.emit("solicitudAtendida",{id:s}):f==="Rechazado"&&B.emit("solicitudRechazada",{id:s}),a&&a(f==="Atendido"?"Solicitud atendida correctamente.":"Solicitud rechazada correctamente."),t(),f==="Atendido"&&c("/dashboard/liquidaciones")}catch(v){console.error(v),os.error("Error al registrar la acción."),((g=v==null?void 0:v.response)==null?void 0:g.status)===401&&l()}finally{d(null)}}};return s?e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex justify-center items-center z-50 px-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-3xl shadow-xl relative border border-gray-100 dark:border-gray-700 overflow-y-auto max-h-[90vh]",children:[e.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:hover:text-gray-200",onClick:t,"aria-label":"Cerrar",children:"✖"}),i?e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Cargando solicitud..."})}):h?e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:"text-red-500 font-semibold",children:h})}):e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100 text-center md:text-left",children:["Solicitud #",o==null?void 0:o.numero_solicitud]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-5 text-sm sm:text-base",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Solicitante:"})," ",(o==null?void 0:o.solicitante_nombre)||(o==null?void 0:o.solicitante)||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tipo:"})," ",(o==null?void 0:o.tipo_solicitud)||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto S/:"})," ",(Number((o==null?void 0:o.total_soles)??0)||0).toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto $:"})," ",(Number((o==null?void 0:o.total_dolares)??0)||0).toFixed(2)]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",o!=null&&o.fecha?new Date(o.fecha).toLocaleDateString("es-PE"):"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Estado actual:"})," ",(o==null?void 0:o.estado)||"—"]}),(o==null?void 0:o.banco)&&e.jsxs("p",{children:[e.jsx("strong",{children:"Banco:"})," ",o.banco]}),(o==null?void 0:o.numero_cuenta)&&e.jsxs("p",{children:[e.jsx("strong",{children:"N° Cuenta:"})," ",o.numero_cuenta]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 font-medium text-gray-700 dark:text-gray-200",children:"Comentario del revisor (opcional)"}),e.jsx("textarea",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-lg p-2 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-400",rows:4,value:x,onChange:f=>j(f.target.value),placeholder:"Agregar comentario opcional..."})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-3 mt-4",children:[e.jsx("button",{className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-2 rounded-lg shadow-md transition",onClick:()=>p("Rechazado"),disabled:m==="Rechazado",children:"Rechazar"}),e.jsx("button",{className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2 rounded-lg shadow-md transition",onClick:()=>p("Atendido"),disabled:m==="Atendido",children:"Atender"})]})]})]})}):null}function mr(){const{authUser:s,logout:t}=ce(),[a,r]=n.useState([]),[l,c]=n.useState(!0),[o,y]=n.useState(null),[i,w]=n.useState(null),x=n.useCallback(async()=>{var h;if(s){c(!0),y(null);try{const b=localStorage.getItem("access_token"),{data:p}=await P.get("/boleta/solicitudes/pendientes/",{headers:{Authorization:`Bearer ${b}`},params:{destinatario_id:s.id,estado:"Pendiente para Atención"}});r(p)}catch(b){console.error(b),y("No se pudieron cargar las solicitudes pendientes."),((h=b==null?void 0:b.response)==null?void 0:h.status)===401&&t()}finally{c(!1)}}},[s,t]);n.useEffect(()=>(B.on("solicitudEnviada",x),B.on("solicitudAtendida",x),B.on("solicitudRechazada",x),()=>{B.off("solicitudEnviada",x),B.off("solicitudAtendida",x),B.off("solicitudRechazada",x)}),[x]),n.useEffect(()=>{x()},[x]);const{kpis:j,serie:m,estados:d}=n.useMemo(()=>{const h=a.filter(A=>A.estado==="Pendiente para Atención").length,b=a.filter(A=>A.estado==="Atendido, Pendiente de Liquidación").length,p=a.filter(A=>A.estado==="Rechazado").length,f=a.filter(A=>A.estado==="Pendiente para Atención").reduce((A,N)=>A+(parseFloat(N.total_soles)||0),0),g=a.filter(A=>A.estado==="Atendido, Pendiente de Liquidación").reduce((A,N)=>A+(parseFloat(N.total_soles)||0),0),v=a.filter(A=>A.estado==="Rechazado").reduce((A,N)=>A+(parseFloat(N.total_soles)||0),0),S=new Map;a.forEach(A=>{if(A.estado==="Pendiente para Atención"){const k=new Date(A.fecha).toLocaleDateString("es-PE");S.set(k,(S.get(k)||0)+1)}});const C=[];for(let A=29;A>=0;A--){const N=new Date;N.setDate(N.getDate()-A);const k=N.toLocaleDateString("es-PE");C.push({dia:k,pendientes:S.get(k)||0})}const M={};return a.forEach(A=>{const N=A.estado||"Sin estado";M[N]=(M[N]||0)+1}),{kpis:{totalPendientes:h,totalAtendidas:b,totalRechazadas:p,montoPendienteSoles:f,montoAtendidoSoles:g,montoRechazadoSoles:v},serie:C,estados:Object.entries(M).map(([A,N])=>({name:A,value:N}))}},[a]);return l?e.jsxs("div",{className:"p-6 space-y-6 min-h-screen flex flex-col",children:[e.jsx("div",{className:"h-8 w-2/3 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Array.from({length:4}).map((h,b)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-2xl animate-pulse"},b))}),e.jsx("div",{className:"h-72 bg-gray-200 rounded-2xl animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded-2xl animate-pulse"})]}):o?e.jsx("div",{className:"p-6 min-h-screen flex flex-col",children:e.jsx("p",{className:"text-red-500 font-semibold",children:o})}):e.jsxs("div",{className:"p-6 w-full space-y-8 min-h-screen flex flex-col",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:e.jsxs("h2",{className:"text-2xl font-bold text-black flex items-center gap-3",children:[e.jsx(Ta,{size:24}),"Atención de Solicitudes",e.jsx("button",{onClick:x,className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition",children:e.jsx(Xs,{size:18})})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 md:gap-6 mb-6",children:[{label:"Pendientes",value:j.totalPendientes,gradient:"linear-gradient(135deg, #f97316cc, #fb923c99)",icon:ra},{label:"Atendidas",value:j.totalAtendidas,gradient:"linear-gradient(135deg,#3b82f6cc,#60a5fa99)",icon:oa},{label:"Rechazadas",value:j.totalRechazadas,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",icon:sa},{label:"Monto Pendiente S/.",value:j.montoPendienteSoles,gradient:"linear-gradient(135deg, #facc15cc, #fcd34d99)",icon:ae},{label:"Monto Atendido S/.",value:j.montoAtendidoSoles,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",icon:ae},{label:"Monto Rechazado S/.",value:j.montoRechazadoSoles,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",icon:ae}].map(h=>e.jsx($e,{...h,decimals:isNaN(h.value)?0:String(h.value).includes(".")?2:0},h.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(X,{title:"Evolución de solicitudes",icon:e.jsx(W,{size:18}),className:"h-80",tooltipFormatter:Me,children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(ts,{data:m,margin:{top:10,right:20,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorPend",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#2563eb",stopOpacity:.45}),e.jsx("stop",{offset:"95%",stopColor:"#2563eb",stopOpacity:.05})]})}),e.jsx(Se,{strokeDasharray:"3 3",opacity:.3}),e.jsx(le,{dataKey:"dia",tick:{fontSize:11},minTickGap:24}),e.jsx(ie,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(q,{contentStyle:{borderRadius:10,border:"none",boxShadow:"0 6px 18px rgba(0,0,0,.12)"},labelStyle:{fontWeight:600},formatter:Me}),e.jsx(rs,{type:"monotone",dataKey:"pendientes",stroke:"#2563eb",fill:"url(#colorPend)",strokeWidth:2})]})})}),e.jsx(X,{title:"Distribución por estado",icon:e.jsx(xe,{size:18}),className:"h-80",tooltipFormatter:ea,children:e.jsx("div",{className:"flex flex-col lg:flex-row h-full gap-4 items-stretch",children:e.jsx("div",{className:"flex-1 min-h-[220px]",children:e.jsx($,{width:"100%",height:"100%",children:e.jsx(Qe,{innerRadius:"10%",outerRadius:"95%",data:d,children:e.jsx(Xe,{minAngle:10,background:!0,clockWise:!0,dataKey:"value",cornerRadius:8,children:d.map((h,b)=>e.jsx(Z,{fill:je[h.name]||"#9ca3af"},`cell-${b}`))})})})})})})]}),e.jsx(Pe,{headers:["N° Solicitud","Solicitante","Tipo","Monto S/.","Monto $","Fecha","Estado","Acciones"],data:a,emptyMessage:"No hay solicitudes pendientes por ahora.",renderRow:h=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 sm:px-4 py-3 font-semibold text-center",children:h.numero_solicitud||"-"}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center",children:h.solicitante_nombre||"-"}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center hidden sm:table-cell",children:h.tipo_solicitud||"-"}),e.jsxs("td",{className:"px-3 sm:px-4 py-3 text-center",children:["S/ ",(Number(h.total_soles)||0).toFixed(2)]}),e.jsxs("td",{className:"px-3 sm:px-4 py-3 text-center",children:["$ ",(Number(h.total_dolares)||0).toFixed(2)]}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center hidden sm:table-cell",children:h.fecha?new Date(h.fecha).toLocaleDateString("es-PE"):"-"}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${je[h.estado]||"bg-gray-100 text-gray-700"}`,children:h.estado||"Sin estado"})}),e.jsx("td",{className:"px-3 sm:px-4 py-3 text-center",children:e.jsxs("button",{className:"bg-indigo-500 hover:bg-indigo-600 text-white text-sm px-3 py-1.5 rounded-lg shadow-md flex items-center gap-2 justify-center",onClick:()=>w(h.id),children:[e.jsx(ne,{size:16})," Revisar"]})})]})}),i&&e.jsx(dr,{solicitudId:i,onClose:()=>w(null),onDecided:h=>{h&&os.success(h),w(null),x()}})]})}const xr="http://localhost:8000/api/boleta/documentos",ur=async s=>{var t,a;try{const r=await aa.post(`${xr}/procesar/`,s,{headers:{"Content-Type":"multipart/form-data"}}),{datos_detectados:l}=r.data||{};console.log("✅ OCR recibido:",l);const o=["ruc"].filter(y=>!(l!=null&&l[y])||l[y]==="No encontrado"||l[y]==="");return o.length>0&&console.warn(`⚠️ OCR incompleto. Faltan: ${o.join(", ")}`),l||{}}catch(r){throw console.error("❌ Error procesando OCR:",r),new Error(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"No se pudo procesar el documento. Intenta nuevamente con otra imagen.")}};function Ss({idSolicitud:s,tipoSolicitud:t,open:a,onClose:r,onProcesado:l}){const[c,o]=n.useState("Boleta"),[y,i]=n.useState(null),[w,x]=n.useState(!1),[j,m]=n.useState(null),[d,h]=n.useState(""),[b,p]=n.useState(!1);n.useEffect(()=>{const v=/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);p(v)},[]);const f=v=>{const S=v.target.files[0];S&&(i(S),m(null),h(""))},g=async()=>{if(!y){alert("⚠️ Selecciona un archivo antes de procesar.");return}const v=new FormData;v.append("archivo",y),v.append("tipo_documento",c),v.append("id_solicitud",s);try{x(!0);const S=await ur(v);console.log("📦 OCR recibido:",S),console.log("🔍 Total recibido:",`"${S==null?void 0:S.total}"`);const C=S!=null&&S.total?S.total.toString().trim().replace(",","."):"";if((!C||C==="0.00")&&!d){alert("⚠️ El OCR no detectó el total. Ingresa el importe manualmente."),x(!1);return}l({...S,total:C||d},y,c,s,t),r()}catch(S){console.error("Error OCR:",S),m("No se pudo procesar el documento. Intenta con otra imagen.")}finally{x(!1)}};return e.jsx(V,{open:a,onOpenChange:r,children:e.jsxs(U,{className:"w-[95vw] max-w-md h-auto max-h-[90vh] overflow-y-auto",children:[e.jsx(K,{children:e.jsxs(H,{className:"flex items-center gap-2 text-base sm:text-lg",children:[e.jsx(Ca,{className:"w-5 h-5 text-gray-700"}),"Subir Documento - Solicitud #",s]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tipo de Documento"}),e.jsxs("select",{value:c,onChange:v=>o(v.target.value),className:"mt-1 p-2 w-full border rounded-md focus:ring focus:ring-blue-200 text-sm",children:[e.jsx("option",{value:"",children:"--Seleccionar--"}),e.jsx("option",{value:"Boleta",children:"Boleta"}),e.jsx("option",{value:"Factura",children:"Factura"}),e.jsx("option",{value:"Honorarios",children:"Honorarios"}),e.jsx("option",{value:"Otros",children:"Otros"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[b&&e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:f,style:{display:"none"}}),e.jsxs("span",{className:"bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white text-sm px-4 py-2 rounded-lg shadow-md flex items-center gap-2 justify-center",children:[e.jsx(Zs,{className:"w-4 h-4"})," Cámara"]})]}),e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*,application/pdf",onChange:f,style:{display:"none"}}),e.jsxs("span",{className:"bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-white text-sm px-4 py-2 rounded-lg shadow-md flex items-center gap-2 justify-center",children:[e.jsx(Ca,{className:"w-4 h-4"})," Archivo"]})]})]}),y&&e.jsxs("p",{className:"text-xs text-gray-600 mt-2 flex items-center gap-1 truncate",children:[e.jsx(ss,{className:"w-4 h-4"})," ",y.name]}),!j&&y&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Total (si OCR no lo detecta)"}),e.jsx("input",{type:"number",step:"0.01",value:d,onChange:v=>h(v.target.value),className:"mt-1 p-2 w-full border rounded-md focus:ring focus:ring-blue-200 text-sm",placeholder:"Ej. 150.75"})]}),j&&e.jsxs("p",{className:"text-sm text-red-600 bg-red-100 rounded p-2 flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4"})," ",j]})]}),e.jsxs(de,{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[e.jsxs(E,{variant:"outline",onClick:r,className:"bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white text-sm px-4 py-2 rounded-lg flex items-center gap-2 justify-center w-full sm:w-auto",children:[e.jsx(Le,{className:"w-4 h-4"})," Cerrar"]}),e.jsx(E,{onClick:g,disabled:w,className:"bg-gradient-to-r from-green-400 to-green-500 hover:from-green-500 hover:to-green-600 text-white text-sm px-4 py-2 rounded-lg flex items-center gap-2 justify-center w-full sm:w-auto",children:w?"Procesando...":e.jsxs(e.Fragment,{children:[e.jsx(oa,{className:"w-4 h-4"})," Procesar"]})})]})]})})}const hr=3.52,Cs=({open:s,onClose:t,solicitud:a})=>{const[r,l]=n.useState([]),[c,o]=n.useState(!1),[y,i]=n.useState(!1);if(!a)return null;const{totalSoles:w,totalDolares:x}=n.useMemo(()=>{const d=r.reduce((b,p)=>{var f;return b+parseFloat(((f=p.total)==null?void 0:f.toString().replace(",","."))||0)},0),h=d/hr;return{totalSoles:d,totalDolares:h}},[r]),j=async(d,h,b,p,f)=>{const g=(d==null?void 0:d.datos_detectados)||{};try{const v=new FormData;v.append("solicitud_id",p),v.append("tipo_documento",b||"Boleta"),v.append("numero_documento",g.numero_documento||"ND"),v.append("fecha",g.fecha||new Date().toISOString().split("T")[0]),v.append("ruc",g.ruc||"00000000000"),v.append("razon_social",g.razon_social||"RAZÓN SOCIAL DESCONOCIDA"),v.append("concepto_gasto",f||"Nueva Solicitud de Gasto"),v.append("total",g.total||"0.00"),h&&(v.append("nombre_archivo",h.name),v.append("archivo",h));const{data:S}=await P.post("http://localhost:8000/api/boleta/documentos/guardar/",v,{headers:{"Content-Type":"multipart/form-data"}});l(C=>[...C,{nombre_archivo:S.documento.nombre_archivo,numero_documento:S.documento.numero_documento,tipo_documento:S.documento.tipo_documento,fecha:S.documento.fecha,ruc:S.documento.ruc,razon_social:S.documento.razon_social,concepto:S.documento.concepto,total:S.documento.total,archivo_url:S.documento.archivo_url}]),console.log("✅ Documento guardado con éxito:",S)}catch(v){v.response?console.error("❌ Error en respuesta del servidor:",v.response.data):v.request?console.error("❌ No hubo respuesta del servidor:",v.request):console.error("❌ Error al configurar la petición:",v.message)}},m=async()=>{try{o(!0),await P.post("/api/liquidaciones/",{solicitud_id:a.id,documentos:r,total_documentado_soles:w,total_documentado_dolares:x}),alert("✅ Liquidación presentada correctamente."),t()}catch(d){console.error("Error presentando liquidación:",d),alert("❌ Error al presentar la liquidación.")}finally{o(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"w-[95vw] max-w-5xl h-[90vh] overflow-y-auto",children:[e.jsx(K,{children:e.jsx(H,{children:"Presentar Documentación"})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsx(ue,{children:e.jsxs(be,{className:"p-4 space-y-2 text-sm sm:text-base",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Solicitud:"})," ",a.numero_solicitud]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Solicitante:"})," ",a.solicitante||"—"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Tipo:"})," ",a.tipo||"—"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Monto Soles:"})," ",a.monto_soles||a.monto||"—"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Monto Dólares:"})," ",a.monto_dolares||"—"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Fecha:"})," ",a.fecha||"—"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Estado actual:"})," ",a.estado||"Pendiente"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Número operación:"})," —"]})]})}),e.jsx(ue,{children:e.jsxs(be,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Comprobantes OCR"}),e.jsxs(E,{size:"sm",onClick:()=>i(!0),className:"bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 transition",children:[e.jsx(Qa,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1",children:"Agregar"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Pe,{headers:["Nombre del Archivo","N° Doc","Tipo","Fecha","RUC","Razón Social","Concepto","Total"],data:r,emptyMessage:"No se han agregado comprobantes todavía.",renderRow:d=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:d.imagen_url||d.archivo_url?e.jsx("a",{href:d.imagen_url||d.archivo_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline hover:text-blue-800",children:d.nombre_archivo}):d.nombre_archivo}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:d.numero_documento}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:d.tipo_documento}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:d.fecha}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:d.ruc}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:d.razon_social}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:d.concepto_gasto}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:d.total})]})})}),e.jsxs("div",{className:"mt-4 text-right font-semibold text-gray-800 text-sm sm:text-base",children:[e.jsxs("p",{children:["Total Documentado: S/ ",w.toFixed(2)]}),e.jsxs("p",{children:["Total Documentado: $ ",x.toFixed(2)]})]})]})})]}),e.jsxs(de,{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[e.jsxs(E,{onClick:t,className:"bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition flex items-center gap-2 justify-center cursor-pointer w-full sm:w-auto",children:[e.jsx(Le,{className:"w-4 h-4"})," Cancelar"]}),e.jsxs(E,{onClick:m,disabled:c||r.length===0,className:"bg-gradient-to-r from-blue-700 to-blue-800 hover:from-blue-800 hover:to-blue-900 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition flex items-center gap-2 justify-center cursor-pointer w-full sm:w-auto",children:[e.jsx(at,{className:"w-4 h-4"}),c?"Presentando...":"Presentar Liquidación"]})]})]})}),y&&e.jsx(Ss,{idSolicitud:a.id,open:y,onClose:()=>i(!1),onProcesado:j})]})};function pr(){const[s,t]=n.useState([]),[a,r]=n.useState(!0),[l,c]=n.useState(""),[o,y]=n.useState(""),[i,w]=n.useState(""),[x,j]=n.useState(""),[m,d]=n.useState(""),[h,b]=n.useState(null),[p,f]=n.useState(!1);n.useEffect(()=>(g(),B.on("liquidacion_actualizada",g),()=>B.off("liquidacion_actualizada",g)),[]);const g=async()=>{try{r(!0);const N=localStorage.getItem("access_token"),k=await P.get("/boleta/liquidaciones_pendientes/",{headers:{Authorization:`Bearer ${N}`}});t(k.data)}catch(N){console.error("Error cargando liquidaciones pendientes:",N)}finally{r(!1)}};n.useMemo(()=>{const N=new Set(s.map(k=>k.solicitante_nombre));return Array.from(N)},[s]);const v=n.useMemo(()=>s.filter(N=>{var R;const k=((R=N.solicitante_nombre)==null?void 0:R.toLowerCase().includes(l.toLowerCase()))||N.numero_solicitud.toString().includes(l),G=o===""||N.solicitante_nombre===o,T=i===""||N.tipo_solicitud===i,_=(!x||new Date(N.fecha)>=new Date(x))&&(!m||new Date(N.fecha)<=new Date(m));return k&&G&&T&&_}),[s,l,o,i,x,m]),S=n.useMemo(()=>{const N=v.length,k=v.reduce((_,R)=>_+(R.monto_soles||0),0),G=v.reduce((_,R)=>_+(R.monto_dolares||0),0),T=N?(k/N).toFixed(2):0;return{total:N,totalSoles:k,totalDolares:G,promedio:T}},[v]),C=n.useMemo(()=>Object.entries(v.reduce((N,k)=>(N[k.tipo_solicitud]=(N[k.tipo_solicitud]||0)+1,N),{})).map(([N,k])=>({name:N,value:k})),[v]),M=n.useMemo(()=>Object.entries(v.reduce((N,k)=>(N[k.tipo_solicitud]=(N[k.tipo_solicitud]||0)+(k.monto_soles||0),N),{})).map(([N,k])=>({name:N,value:Number(k.toFixed(2))})),[v]),A=N=>{b(N),f(!0)};return e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-center md:justify-start items-center mb-4",children:e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold flex items-center gap-2 text-black",children:[e.jsx(za,{className:"w-5 sm:w-6 h-5 sm:h-6"})," Liquidaciones Pendientes"]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 text-center",children:[{label:"Total Pendientes",value:S.total,gradient:"linear-gradient(135deg, #f97316cc, #fb923c99)",icon:ra,tooltip:"Número total de solicitudes pendientes."},{label:"Monto Total (S/)",value:S.totalSoles,gradient:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)",icon:ae,tooltip:"Monto acumulado en soles.",decimals:2},{label:"Monto Total ($)",value:S.totalDolares,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",icon:ae,tooltip:"Monto acumulado en dólares.",decimals:2},{label:"Promedio por Solicitud (S/)",value:S.promedio,gradient:"linear-gradient(135deg, #f59e0bcc, #fcd34d99)",icon:ae,tooltip:"Promedio por solicitud.",decimals:2}].map((N,k)=>e.jsx($e,{...N},k))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsx(X,{title:"Montos por Tipo de Solicitud (S/.)",icon:e.jsx(st,{className:"w-4 h-4"}),className:"h-72",tooltipFormatter:N=>`S/ ${N.toLocaleString()}`,children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(fe,{data:M,layout:"vertical",margin:{left:20},children:[e.jsx(Se,{strokeDasharray:"3 3",opacity:.2}),e.jsx(le,{type:"number"}),e.jsx(ie,{dataKey:"name",type:"category",width:100}),e.jsx(q,{formatter:N=>`S/ ${N.toLocaleString()}`}),e.jsx(Ee,{dataKey:"value",barSize:35,children:M.map((N,k)=>e.jsx(Z,{fill:he[N.name]||"#9CA3AF"},k))})]})})}),e.jsx(X,{title:"Distribución por Tipo",icon:e.jsx(tt,{className:"w-4 h-4"}),className:"h-72",tooltipFormatter:Me,children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(fe,{data:C,children:[e.jsx(Se,{strokeDasharray:"3 3",opacity:.2}),e.jsx(le,{dataKey:"name"}),e.jsx(ie,{allowDecimals:!1}),e.jsx(q,{formatter:Me}),e.jsx(Ee,{dataKey:"value",barSize:35,children:C.map((N,k)=>e.jsx(Z,{fill:he[N.name]||"#9CA3AF"},k))})]})})})]}),e.jsx(Pe,{headers:["N° Solicitud","Tipo","Monto (S/.)","Monto ($)","Fecha","Concepto","Estado","Acción"],data:v,loading:a,emptyMessage:"No hay solicitudes en este estado o rango de fechas.",renderRow:N=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 font-semibold text-center",children:N.numero_solicitud}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Na[N.tipo_solicitud]||"bg-gray-200 text-gray-700"}`,children:N.tipo_solicitud})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:N.monto_soles?`S/. ${N.monto_soles}`:"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:N.monto_dolares?`$ ${N.monto_dolares}`:"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:N.fecha}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:N.concepto_gasto??"-"}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ze[N.estado]||"bg-gray-200 text-gray-700"}`,children:N.estado})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>A(N),className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-4 h-4"})," Presentar"]})})]})}),p&&e.jsx(Cs,{open:p,onClose:()=>f(!1),solicitud:h})]})}function gr({open:s,onClose:t,accion:a,onConfirm:r,liquidacion:l}){if(!a)return null;const c={aprobar:{text:"aprobar",color:"from-green-400 to-green-600",icon:e.jsx(Ja,{className:"w-5 h-5"})},ajuste:{text:"ajustar",color:"from-orange-400 to-orange-600",icon:e.jsx(ot,{className:"w-5 h-5"})},rechazar:{text:"rechazar",color:"from-red-400 to-red-600",icon:e.jsx(sa,{className:"w-5 h-5"})},devolucion:{text:"devolver",color:"from-yellow-400 to-yellow-600",icon:e.jsx(rt,{className:"w-5 h-5"})}},{text:o,color:y,icon:i}=c[a]||c.aprobar;return e.jsx(V,{open:s,onOpenChange:t,children:e.jsx(U,{className:"p-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl overflow-hidden border border-gray-200",children:[e.jsx(K,{className:"p-4 border-b border-gray-100",children:e.jsxs(H,{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(L.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.3},children:i}),"Confirmar acción"]})}),e.jsx(L.div,{className:"p-4 text-gray-700",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3,delay:.1},children:e.jsxs("p",{className:"text-sm",children:["¿Estás seguro de que deseas ",e.jsx("strong",{children:o}),l?` la liquidación #${l.id}`:" esta liquidación","?"]})}),e.jsxs(de,{className:"p-4 flex justify-end gap-2 border-t border-gray-100",children:[e.jsx(E,{variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(L.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:e.jsx(E,{className:`bg-gradient-to-r ${y} text-white hover:brightness-110 transition-all flex items-center gap-1`,onClick:r,children:e.jsx(L.span,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:o.charAt(0).toUpperCase()+o.slice(1)})})})]})]})})})}function fr({open:s,onClose:t,documento:a}){const r=n.useRef();if(!a)return null;const l=a.archivo_url||a.url,c=()=>{if(!l)return;const o=window.open("","_blank");o.document.write(`
      <html>
        <head>
          <title>${a.nombre||"Documento"}</title>
        </head>
        <body style="margin:0; display:flex; justify-content:center; align-items:center; height:100vh;">
          <img src="${l}" style="max-width:100%; max-height:100vh;" />
        </body>
      </html>
    `),o.document.close(),o.focus(),o.print(),o.close()};return e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"max-w-3xl w-full shadow-xl rounded-xl p-6",children:[e.jsx(K,{children:e.jsx(H,{children:a.nombre||a.numero_documento||"Documento"})}),e.jsx("div",{className:"flex justify-center my-4",children:l?e.jsx("img",{ref:r,src:l,alt:a.nombre||"Documento",className:"max-h-[70vh] w-auto object-contain rounded border"}):e.jsx("p",{className:"text-center text-gray-500",children:"No hay vista disponible"})}),e.jsxs(de,{className:"flex justify-between",children:[e.jsx(E,{variant:"outline",onClick:t,children:"Cerrar"}),l&&e.jsx(E,{onClick:c,children:"Imprimir"})]})]})})}const ca=3.52;function br({open:s,onClose:t,liquidacion:a}){var f;const[r,l]=n.useState(!1),[c,o]=n.useState(null);if(!a)return null;const y={Pendiente:"#facc15",Aprobado:"#16a34a",Rechazado:"#ef4444","Aprobado con ajuste":"#f59e0b",Devolucion:"#f97316"}[a.estado]||"#ccc",i=g=>Number(g).toLocaleString("es-PE",{minimumFractionDigits:2,maximumFractionDigits:2}),w=g=>(g/ca).toFixed(2),x=n.useMemo(()=>a.total_documentado||a.monto,[a]),j=x/ca,m=a.monto-x,d=m/ca,h=g=>{o(g),l(!0)},b=g=>typeof g=="string"?g:g.numero_documento||g.nombre_archivo||"Documento",p=g=>(g==null?void 0:g.archivo_url)||null;return e.jsxs(e.Fragment,{children:[e.jsx(V,{open:s,onOpenChange:t,children:e.jsxs(U,{className:"max-w-lg shadow-xl rounded-xl p-6","aria-describedby":`detalle-liquidacion-${a.id}`,children:[e.jsxs(K,{children:[e.jsxs(H,{children:["Liquidación #",a.id]}),e.jsx(fs,{id:`detalle-liquidacion-${a.id}`,children:"Detalles"})]}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Operación:"})," ",a.numero_operacion||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",a.fecha]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Solicitante:"})," ",a.solicitante]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center",children:[e.jsx("span",{className:"font-semibold",children:"Monto Solicitado:"}),e.jsxs("span",{children:["S/ ",i(a.monto)]}),e.jsxs("span",{children:["$ ",w(a.monto)]}),e.jsx("span",{className:"font-semibold",children:"Total Documentado:"}),e.jsxs("span",{children:["S/ ",i(x)]}),e.jsxs("span",{children:["$ ",w(j)]}),e.jsx("span",{className:"font-semibold",children:"Diferencia:"}),e.jsxs("span",{children:["S/ ",i(m)]}),e.jsxs("span",{children:["$ ",w(d)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Estado:"}),e.jsx(re,{style:{backgroundColor:y,color:"#fff"},children:a.estado})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Observaciones:"})," ",a.observaciones||"Sin observaciones"]}),((f=a.documentos)==null?void 0:f.length)>0&&e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Documentos:"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.documentos.map((g,v)=>{const S=b(g),C=p(g);return e.jsx(re,{variant:"outline",className:"cursor-pointer hover:bg-blue-100 transition",onClick:()=>C?window.open(C,"_blank"):h(g),children:S},v)})})]})]}),e.jsx(de,{className:"mt-4",children:e.jsx(E,{variant:"outline",onClick:t,children:"Cerrar"})})]})}),r&&c&&e.jsx(fr,{open:r,documento:c,onClose:()=>l(!1)})]})}const Ea=!0,da=3.52,jr=[{id:1,numero_operacion:"OP-1001",fecha:"2025-08-14",monto:150,tipo:"Viáticos",estado:"Pendiente de Envío",solicitante:"Juan Pérez",observaciones:"Documento completo",documentos:["F001-123","F002-456"]},{id:2,numero_operacion:"OP-1002",fecha:"2025-08-12",monto:300,tipo:"Movilidad",estado:"Pendiente para Atención",solicitante:"María López",observaciones:"Falta recibo",documentos:["F003-789"]},{id:3,numero_operacion:"OP-1003",fecha:"2025-08-10",monto:200,tipo:"Compras",estado:"Atendido, Pendiente de Liquidación",solicitante:"Carlos Díaz",observaciones:"Revisar gastos",documentos:["F004-101"]},{id:4,numero_operacion:"OP-1004",fecha:"2025-08-11",monto:500,tipo:"Otros gastos",estado:"Liquidación enviada para Aprobación",solicitante:"Ana Torres",observaciones:"Completo",documentos:["F005-202","F006-303"]},{id:5,numero_operacion:"OP-1005",fecha:"2025-08-09",monto:250,tipo:"Viáticos",estado:"Liquidación Aprobada",solicitante:"Luis Ramírez",observaciones:"",documentos:["F007-404"]},{id:6,numero_operacion:"OP-1006",fecha:"2025-08-08",monto:180,tipo:"Compras",estado:"Rechazado",solicitante:"Sofía Martínez",observaciones:"Error en factura",documentos:["F008-505"]}];function yr(){const[s,t]=n.useState([]),[a,r]=n.useState(!0),[l,c]=n.useState(""),[o,y]=n.useState("Todas"),[i,w]=n.useState(""),[x,j]=n.useState(""),[m,d]=n.useState(""),[h,b]=n.useState(""),[p,f]=n.useState(""),[g,v]=n.useState(!1),[S,C]=n.useState(null),[M,A]=n.useState(!1),[N,k]=n.useState(""),[G,T]=n.useState(null),_=async()=>{try{r(!0),Ea&&setTimeout(()=>{t(jr),r(!1)},800)}catch(u){console.error(u),r(!1)}};n.useEffect(()=>{_()},[]);const R=n.useMemo(()=>s.filter(u=>{const D=u.solicitante.toLowerCase().includes(l.toLowerCase())||u.id.toString().includes(l),I=o==="Todas"||u.tipo===o,me=i===""||new Date(u.fecha)>=new Date(i),Ne=x===""||new Date(u.fecha)<=new Date(x),na=m===""||u.monto>=parseFloat(m),Ie=h===""||u.monto<=parseFloat(h),qe=p===""||u.documentos.some(ks=>ks.toLowerCase().includes(p.toLowerCase()));return D&&I&&me&&Ne&&na&&Ie&&qe}),[s,l,o,i,x,m,h,p]),O=n.useMemo(()=>{const u={Aprobado:0,Rechazado:0};let D=0,I=0;s.forEach(Ne=>{D++,I+=Ne.monto,u[Ne.estado]!==void 0&&u[Ne.estado]++});const me=I/da;return{Total:D,Aprobadas:u.Aprobado,Rechazadas:u.Rechazado,TotalSoles:I,TotalDolares:me}},[s]),ee=async()=>{if(S)try{const u=ACTION_STATE_MAP[N];Ea&&t(D=>D.map(I=>I.id===S.id?{...I,estado:u}:I)),A(!1),v(!1),T(S.id),setTimeout(()=>T(null),1500)}catch(u){console.error(u)}},pe=n.useMemo(()=>Object.entries(R.reduce((u,D)=>(u[D.estado]=(u[D.estado]||0)+1,u),{})).map(([u,D])=>({name:u,value:D})),[R]),ye=n.useMemo(()=>Object.entries(R.reduce((u,D)=>(u[D.tipo]=(u[D.tipo]||0)+1,u),{})).map(([u,D])=>({name:u,value:D})),[R]),ve=u=>Number(u).toLocaleString("es-PE",{minimumFractionDigits:2}),Ce=u=>(u/da).toLocaleString("en-US",{minimumFractionDigits:2});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(La,{className:"w-6 h-6"})," Aprobación de Liquidaciones"]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 md:gap-6 mb-6",children:[{label:"Total",value:O.Total,gradient:"linear-gradient(135deg, #6366f1cc, #818cf899)",icon:Je,tooltip:"Cantidad total de liquidaciones."},{label:"Aprobadas",value:O.Aprobadas,gradient:"linear-gradient(135deg, #16a34acc, #22c55e99)",icon:oa,tooltip:"Liquidaciones aprobadas."},{label:"Rechazadas",value:O.Rechazadas,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",icon:sa,tooltip:"Liquidaciones rechazadas."},{label:"Total S/",value:O.TotalSoles,gradient:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)",icon:Je,tooltip:"Monto total en soles."},{label:"Total $",value:O.TotalDolares,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",icon:ae,tooltip:"Monto total en dólares."}].map(u=>e.jsx($e,{label:u.label,value:u.value,icon:u.icon,gradient:u.gradient,tooltip:u.tooltip,decimals:typeof u.value=="number"?0:2},u.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(X,{title:"Distribución por Estado",className:"h-64",tooltipFormatter:(u,D)=>[`${u}`,`${D}`],children:[e.jsx($,{width:"100%",height:"100%",children:e.jsxs(xe,{children:[e.jsx(Oe,{data:pe,dataKey:"value",nameKey:"name",innerRadius:60,outerRadius:100,paddingAngle:5,children:pe.map((u,D)=>e.jsx(Z,{fill:je[u.name]},D))}),e.jsx(q,{})]})}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total"}),e.jsx("div",{className:"text-xl font-bold",children:s.length})]})]})}),e.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsx(X,{title:"Distribución por Tipo",className:"h-64",tooltipFormatter:(u,D)=>[`${u}`,`${D}`],children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(fe,{data:ye,margin:{top:20,right:20,bottom:20,left:0},children:[e.jsx(le,{dataKey:"name",tick:{fill:"#6b7280",fontWeight:500},axisLine:{stroke:"#d1d5db"},tickLine:!1}),e.jsx(ie,{allowDecimals:!1,tick:{fill:"#6b7280",fontWeight:500},axisLine:{stroke:"#d1d5db"},tickLine:!1}),e.jsx(q,{}),e.jsx(Ee,{dataKey:"value",radius:[6,6,0,0],children:ye.map((u,D)=>e.jsx(Z,{fill:he[u.name]},D))})]})})})})]}),e.jsxs(ue,{className:"rounded-xl p-4 shadow-md mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsx(Q,{type:"date",value:i,onChange:u=>w(u.target.value),placeholder:"Desde"}),e.jsx(Q,{type:"date",value:x,onChange:u=>j(u.target.value),placeholder:"Hasta"}),e.jsx(Q,{type:"number",value:m,onChange:u=>d(u.target.value),placeholder:"Monto mínimo"}),e.jsx(Q,{type:"number",value:h,onChange:u=>b(u.target.value),placeholder:"Monto máximo"})]}),e.jsx(Q,{placeholder:"Documento...",value:p,onChange:u=>f(u.target.value),className:"mb-4"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["Todas","Viáticos","Movilidad","Compras","Otros gastos"].map(u=>e.jsx(re,{className:"px-4 py-1 rounded-full cursor-pointer transition-transform hover:scale-105",style:{backgroundColor:o===u?he[u]:"#f3f4f6",color:o===u?"#fff":"#000"},onClick:()=>y(u),children:u},u))})]}),e.jsx(be,{children:a?e.jsx("p",{className:"text-center py-10 animate-pulse",children:"Cargando..."}):e.jsx(Pe,{headers:["Solicitante","Tipo","Fecha","Monto S/","Monto $","Estado","Documentos","Acciones"],data:R,emptyMessage:"No hay liquidaciones.",activeRow:G,renderRow:u=>e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",title:u.observaciones,children:u.solicitante}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx(re,{className:`${Na[u.tipo]||"bg-gray-200 text-gray-700"} px-3 py-1 rounded-full`,children:u.tipo})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:u.fecha}),e.jsxs("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:["S/ ",ve(u.monto)]}),e.jsxs("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:["$ ",Ce(u.monto/da)]}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:e.jsx(re,{className:`${Ze[u.estado]||"bg-gray-200 text-gray-700"} px-3 py-1 rounded-full`,children:u.estado})}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:u.documentos.map((D,I)=>e.jsx(re,{variant:"outline",className:`mr-1 ${p&&D.toLowerCase().includes(p.toLowerCase())?"bg-yellow-300 font-medium shadow-md":""}`,children:D},I))}),e.jsxs("td",{className:"px-2 sm:px-4 py-2 sm:py-3 flex gap-1 justify-center",children:[e.jsx("button",{"data-tooltip-id":"tooltip","data-tooltip-content":"Ver Detalle",className:"bg-indigo-500 hover:bg-indigo-600 text-white p-2 rounded-lg shadow-md",onClick:()=>{C(u),v(!0)},children:e.jsx(ne,{size:16})}),e.jsx("button",{"data-tooltip-id":"tooltip","data-tooltip-content":"Aprobar",className:"bg-green-500 hover:bg-green-600 text-white p-2 rounded-lg shadow-md",onClick:()=>{C(u),k("aprobar"),A(!0)},children:e.jsx(nt,{size:16})}),e.jsx("button",{"data-tooltip-id":"tooltip","data-tooltip-content":"Rechazar",className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded-lg shadow-md",onClick:()=>{C(u),k("rechazar"),A(!0)},children:e.jsx(Le,{size:16})})]})]})})}),g&&S&&e.jsx(br,{open:g,liquidacion:S,onClose:()=>v(!1)}),e.jsx(gr,{open:M,onClose:()=>A(!1),accion:N,onConfirm:ee,liquidacion:S}),e.jsx(lt,{id:"tooltip",place:"top",effect:"solid"})]})}const wa=!0;function vr({filtroId:s,setFiltroId:t,filtroUsuario:a,setFiltroUsuario:r,filtroTipo:l,setFiltroTipo:c,filtroDescripcion:o,setFiltroDescripcion:y,filtroFechaInicio:i,setFiltroFechaInicio:w,filtroFechaFin:x,setFiltroFechaFin:j,onLimpiarFiltros:m}){return e.jsxs("div",{className:"bg-white rounded-xl shadow p-4 border border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(it,{size:16})," ID"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por ID",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:s,onChange:d=>t(d.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(ns,{size:16})," Usuario"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por usuario",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:a,onChange:d=>r(d.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(ct,{size:16})," Tipo de Acción"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por tipo de acción",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:l,onChange:d=>c(d.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(W,{size:16})," Descripción"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por descripción",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:o,onChange:d=>y(d.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(we,{size:16})," Fecha Inicio"]}),e.jsx("input",{type:"date",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:i,onChange:d=>w(d.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-700 text-sm font-medium flex items-center gap-1",children:[e.jsx(we,{size:16})," Fecha Fin"]}),e.jsx("input",{type:"date",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:x,onChange:d=>j(d.target.value)})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("button",{onClick:m,className:`bg-gradient-to-r from-pink-500 to-rose-600 hover:from-pink-600 hover:to-rose-700 \r
                     text-white font-medium px-5 py-2 rounded-lg shadow-md transition flex items-center gap-2`,children:[e.jsx(dt,{size:16})," Limpiar filtros"]})})]})}function Nr(s){return s?new Date(s).toLocaleString():"-"}const Ue={tipos:{Aprobación:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Rechazo:"bg-red-200 text-red-800 dark:bg-red-700/40 dark:text-red-200",Devolución:"bg-orange-200 text-orange-800 dark:bg-orange-700/40 dark:text-orange-200",Pendiente:"bg-yellow-200 text-yellow-800 dark:bg-yellow-700/40 dark:text-yellow-200",Otro:"bg-indigo-200 text-indigo-800 dark:bg-indigo-700/40 dark:text-indigo-200"},acciones:{Aprobado:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Rechazado:"bg-red-200 text-red-800 dark:bg-red-700/40 dark:text-red-200",Pendiente:"bg-yellow-200 text-yellow-800 dark:bg-yellow-700/40 dark:text-yellow-200",Devolucion:"bg-orange-200 text-orange-800 dark:bg-orange-700/40 dark:text-orange-200",Otro:"bg-gray-200 text-gray-800 dark:bg-gray-700/40 dark:text-gray-200"}};function wr({actividades:s,abrirModal:t}){return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(W,{size:18}),"Registro de Actividades"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Total: ",s.length]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-100 text-center",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"N°"}),e.jsx("th",{className:"px-4 py-3",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3",children:"Acción"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Detalle"})]})}),e.jsxs("tbody",{children:[s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-10 text-center text-gray-500 dark:text-gray-400",children:"No hay actividades registradas por ahora."})}),s.map((a,r)=>e.jsxs(L.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"border-t border-gray-100 dark:border-gray-700 hover:shadow-lg hover:translate-y-[-2px] hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-transform duration-200",children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:r+1}),e.jsx("td",{className:"px-4 py-3",children:a.usuario??"-"}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ue.tipos[a.tipo]||Ue.tipos.Otro}`,children:a.tipo??"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ue.acciones[a.accion]||Ue.acciones.Otro}`,children:a.accion??"-"})}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:a.descripcion??"-"}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:Nr(a.fecha)??"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{onClick:()=>t(a),className:"bg-gradient-to-r from-indigo-300 to-indigo-400 hover:from-indigo-400 hover:to-indigo-500 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition flex items-center gap-2 justify-center",children:[e.jsx(ne,{size:16}),"Ver detalle"]})})]},a.id))]})]})})]})}function Sr(s){return s?new Date(s).toLocaleString():"-"}function Cr({actividad:s,isOpen:t,onClose:a}){return s?e.jsx(fa,{children:t&&e.jsx(L.div,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(L.div,{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 relative shadow-lg",initial:{scale:.8},animate:{scale:1},exit:{scale:.8},transition:{duration:.2},children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Detalle de Actividad"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"ID / Número"}),e.jsx("p",{className:"text-gray-800",children:s.id??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Fecha y Hora"}),e.jsx("p",{className:"text-gray-800",children:Sr(s.fecha)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Usuario"}),e.jsx("p",{className:"text-gray-800",children:s.usuario??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Tipo"}),e.jsx("p",{className:"text-gray-800",children:s.tipo??"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Acción"}),e.jsx("p",{className:"text-gray-800",children:s.accion??"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Descripción"}),e.jsx("p",{className:"text-gray-800",children:s.descripcion??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Estado"}),e.jsx("p",{className:`font-medium ${s.estado==="pendiente"?"text-yellow-600":s.estado==="completada"?"text-green-600":"text-gray-600"}`,children:s.estado??"-"})]}),s.documentos&&s.documentos.length>0&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Documentos Referenciados"}),e.jsx("ul",{className:"list-disc list-inside text-gray-800",children:s.documentos.map((r,l)=>e.jsx("li",{children:e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:r.nombre??`Documento ${l+1}`})},l))})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:a,className:"bg-gray-400 text-gray-800 px-4 py-2 rounded hover:bg-gray-500 transition",children:"Cerrar"})})]})})}):null}const ke={total:"#3b82f6",usuarios:"#22c55e",promedio:"#8b5cf6",frecuente:"#f59e0b",ultima:"#6366f1",eficiencia:"#10b981"},_e={aprobado:"#22c55e",rechazado:"#ef4444",devolucion:"#f97316",pendiente:"#f59e0b",azul:"#3b82f6",morado:"#a78bfa"},Te="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center",kr="transition-all duration-300 hover:scale-[1.01] hover:shadow-md";function _r(){const[s,t]=n.useState([]),[a,r]=n.useState(!1),[l,c]=n.useState(null),[o,y]=n.useState(!1),[i,w]=n.useState(null),[x,j]=n.useState(""),[m,d]=n.useState(""),[h,b]=n.useState(""),[p,f]=n.useState(""),[g,v]=n.useState("fecha"),[S,C]=n.useState("desc");n.useEffect(()=>{M()},[]);const M=async()=>{r(!0),c(null);try{let u=[];wa&&(u=[{id:1,fecha:"2025-08-14 | 08:30:00",usuario:"Juan",tipo:"Liquidaciones",accion:"Aprobado",descripcion:"Liquidación aprobada correctamente"},{id:2,fecha:"2025-08-14 | 09:15:00",usuario:"Maria",tipo:"Solicitudes",accion:"Pendiente",descripcion:"Solicitud de reembolso creada"},{id:3,fecha:"2025-08-14 | 10:45:00",usuario:"Carlos",tipo:"Liquidaciones",accion:"Rechazado",descripcion:"Liquidación con errores"},{id:4,fecha:"2025-08-14 | 11:30:00",usuario:"Ana",tipo:"Solicitudes",accion:"Devolución",descripcion:"Solicitud devuelta para corrección"}]),t(u)}catch(u){console.error(u),c("Error cargando actividades.")}finally{r(!1)}},A=u=>{w(u),y(!0)},N=()=>{y(!1),w(null)},k=n.useMemo(()=>s.filter(u=>{var Ie,qe;const D=x?(Ie=u.usuario)==null?void 0:Ie.toLowerCase().includes(x.toLowerCase()):!0,I=m?(qe=u.tipo)==null?void 0:qe.toLowerCase().includes(m.toLowerCase()):!0,me=new Date(u.fecha),Ne=h?me>=new Date(h):!0,na=p?me<=new Date(p):!0;return D&&I&&Ne&&na}).sort((u,D)=>{if(g==="fecha")return S==="asc"?new Date(u.fecha)-new Date(D.fecha):new Date(D.fecha)-new Date(u.fecha);{const I=(u[g]??"").toString().toLowerCase(),me=(D[g]??"").toString().toLowerCase();return I<me?S==="asc"?-1:1:I>me?S==="asc"?1:-1:0}}),[s,x,m,h,p,g,S]),G=k.length,T=new Set(k.map(u=>u.usuario)).size,_=T>0?(G/T).toFixed(1):0,R=k.reduce((u,D)=>(u[D.accion]=(u[D.accion]||0)+1,u),{}),O=Object.entries(R).sort((u,D)=>D[1]-u[1])[0]||[],ee=k.length>0?k[0].fecha:"Sin registros",pe=R.Aprobado?(R.Aprobado/G*100).toFixed(1):0,ye=Object.entries(R).map(([u,D])=>({name:u,value:D})),ve=Object.entries(R).map(([u,D])=>({name:u,count:D})),Ce=Object.values(k.reduce((u,D)=>{const I=new Date(D.fecha).toLocaleDateString();return u[I]=(u[I]||0)+1,u},{})).map((u,D)=>({fecha:Object.keys(R)[D],count:u}));return e.jsxs("div",{className:"p-6",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(De,{className:"w-7 h-7 text-gray-800"}),"Registro de Actividades"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6 text-center mb-8",children:[{label:"Total Actividades",value:G,color:ke.total,icon:ka},{label:"Usuarios Activos",value:T,color:ke.usuarios,icon:ja},{label:"Promedio por Usuario",value:_,color:ke.promedio,icon:W},{label:"Acción más Frecuente",value:O.length>0?`${O[0]} (${O[1]})`:"N/A",color:ke.frecuente,icon:ta},{label:"Última Actividad",value:ee,color:ke.ultima,icon:ra},{label:"% Aprobaciones",value:pe+"%",color:ke.eficiencia,icon:mt}].map((u,D)=>e.jsxs("div",{className:`flex flex-col items-center justify-center text-white p-4 rounded-xl cursor-pointer ${Te}`,style:{background:`linear-gradient(135deg, ${u.color}cc, ${u.color}99)`},children:[e.jsx(u.icon,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm",children:u.label}),e.jsx("p",{className:"text-2xl font-bold",children:typeof u.value=="number"?e.jsx(Fe,{end:u.value,duration:1.2,separator:","}):u.value})]},D))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md ${Te}`,children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(ge,{className:"w-5 h-5 text-blue-500"})," Distribución de Acciones"]}),e.jsx($,{width:"100%",height:300,children:e.jsxs(xe,{children:[e.jsx(Oe,{data:ye,dataKey:"value",nameKey:"name",outerRadius:110,label:!0,children:ye.map((u,D)=>e.jsx(Z,{fill:_e[u.name.toLowerCase()]||_e.azul,stroke:"#fff",strokeWidth:2},`cell-${D}`))}),e.jsx(q,{contentStyle:{background:"#1f2937",color:"#fff",borderRadius:"8px"}}),e.jsx(oe,{})]})})]}),e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md ${Te}`,children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Re,{className:"w-5 h-5 text-green-600"})," Cantidad por Acción"]}),e.jsx($,{width:"100%",height:300,children:e.jsxs(fe,{data:ve,margin:{top:10,right:10,left:0,bottom:5},children:[e.jsx(Se,{strokeDasharray:"3 3",strokeOpacity:.2}),e.jsx(le,{dataKey:"name"}),e.jsx(ie,{}),e.jsx(q,{contentStyle:{background:"#1f2937",color:"#fff",borderRadius:"8px"}}),e.jsx(oe,{}),ve.map((u,D)=>e.jsx(Ee,{dataKey:"count",fill:_e[u.name.toLowerCase()]||_e.azul,name:u.name,radius:[6,6,0,0]},D))]})})]}),e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md ${Te}`,children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2 mb-4",children:[e.jsx(ka,{className:"w-5 h-5 text-purple-600"})," Evolución en el Tiempo"]}),e.jsx($,{width:"100%",height:300,children:e.jsxs(ls,{data:Ce,children:[e.jsx(Se,{strokeDasharray:"3 3",strokeOpacity:.2}),e.jsx(le,{dataKey:"fecha"}),e.jsx(ie,{}),e.jsx(q,{contentStyle:{background:"#1f2937",color:"#fff",borderRadius:"8px"}}),e.jsx(oe,{}),e.jsx(is,{type:"monotone",dataKey:"count",stroke:_e.morado,strokeWidth:3,dot:{r:5,strokeWidth:2,fill:_e.morado},activeDot:{r:8}})]})})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(vr,{filtroUsuario:x,setFiltroUsuario:j,filtroTipo:m,setFiltroTipo:d,filtroFechaInicio:h,setFiltroFechaInicio:b,filtroFechaFin:p,setFiltroFechaFin:f})}),l&&e.jsx("div",{className:`mb-4 p-3 bg-red-100 text-red-700 rounded ${kr}`,children:l}),a&&e.jsx("p",{children:"Cargando actividades..."}),!a&&e.jsx("div",{className:Te,children:e.jsx(wr,{actividades:k,abrirModal:A})}),o&&i&&e.jsx(Cr,{actividad:i,cerrarModal:N})]})}function Ar({isOpen:s,onClose:t,onGuardar:a}){const[r,l]=n.useState(""),[c,o]=n.useState(""),[y,i]=n.useState(""),[w,x]=n.useState(""),[j,m]=n.useState([{cantidad:1,descripcion:""}]),d=()=>m([...j,{cantidad:1,descripcion:""}]),h=f=>m(j.filter((g,v)=>v!==f)),b=(f,g,v)=>{const S=[...j];S[f][g]=g==="cantidad"?Number(v):v,m(S)},p=()=>{if(!r||!c||!y){alert("Por favor, completa los campos obligatorios.");return}const f={origen:r,destino:c,responsable:y,observaciones:w,items:j,estado:"Pendiente",fecha:new Date().toISOString()};a(f),t(),l(""),o(""),i(""),x(""),m([{cantidad:1,descripcion:""}])};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 relative",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"📦 Crear Nueva Guía"}),e.jsxs("div",{className:"flex flex-col gap-3 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Origen *",className:"border rounded p-2",value:r,onChange:f=>l(f.target.value)}),e.jsx("input",{type:"text",placeholder:"Destino *",className:"border rounded p-2",value:c,onChange:f=>o(f.target.value)}),e.jsx("input",{type:"text",placeholder:"Responsable *",className:"border rounded p-2",value:y,onChange:f=>i(f.target.value)}),e.jsx("textarea",{placeholder:"Observaciones (opcional)",className:"border rounded p-2",value:w,onChange:f=>x(f.target.value)})]}),e.jsx("h3",{className:"font-semibold mb-2",children:"Ítems de la Guía"}),e.jsx("div",{className:"overflow-x-auto mb-4",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Cantidad"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Descripción"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Acciones"})]})}),e.jsx("tbody",{children:j.map((f,g)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx("input",{type:"number",min:1,className:"border rounded p-1 w-full",value:f.cantidad,onChange:v=>b(g,"cantidad",v.target.value)})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:e.jsx("input",{type:"text",className:"border rounded p-1 w-full",value:f.descripcion,onChange:v=>b(g,"descripcion",v.target.value)})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center",children:e.jsx("button",{onClick:()=>h(g),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 transition",children:"Eliminar"})})]},g))})]})}),e.jsx("button",{onClick:d,className:"mb-4 bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition",children:"+ Agregar Ítem"}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:t,className:"bg-gray-400 text-gray-800 px-4 py-2 rounded hover:bg-gray-500 transition",children:"Cancelar"}),e.jsx("button",{onClick:p,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Guardar Guía"})]})]})}):null}function Dr({isOpen:s,onClose:t,guia:a}){var r;return!s||!a?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 relative",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Detalle de Guía #",a.numero??"-"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Fecha:"}),e.jsx("p",{children:new Date(a.fecha).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Responsable:"}),e.jsx("p",{children:a.responsable})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Origen:"}),e.jsx("p",{children:a.origen})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Destino:"}),e.jsx("p",{children:a.destino})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"font-semibold",children:"Observaciones:"}),e.jsx("p",{children:a.observaciones||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Estado:"}),e.jsx("span",{className:`px-2 py-1 rounded font-semibold ${a.estado==="Pendiente"?"bg-yellow-200 text-yellow-800":a.estado==="Enviada"?"bg-blue-200 text-blue-800":a.estado==="Recibida"?"bg-green-200 text-green-800":"bg-gray-200 text-gray-800"}`,children:a.estado})]})]}),e.jsx("h3",{className:"font-semibold mb-2",children:"Ítems de la Guía"}),e.jsx("div",{className:"overflow-x-auto mb-4",children:e.jsxs("table",{className:"min-w-full border-collapse border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Cantidad"}),e.jsx("th",{className:"border border-gray-300 px-3 py-2",children:"Descripción"})]})}),e.jsx("tbody",{children:((r=a.items)==null?void 0:r.length)>0?a.items.map((l,c)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:l.cantidad}),e.jsx("td",{className:"border border-gray-300 px-3 py-2",children:l.descripcion})]},c)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-4",children:"No hay ítems registrados."})})})]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:t,className:"bg-gray-400 text-gray-800 px-4 py-2 rounded hover:bg-gray-500 transition",children:"Cerrar"}),e.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Imprimir / PDF"})]})]})})}const Ma={Pendiente:"bg-yellow-200 text-yellow-800 dark:bg-yellow-700/40 dark:text-yellow-200",Enviada:"bg-blue-200 text-blue-800 dark:bg-blue-700/40 dark:text-blue-200",Recibida:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Otro:"bg-gray-200 text-gray-800 dark:bg-gray-700/40 dark:text-gray-200"},Fr="transition-all duration-300 hover:shadow-lg hover:scale-[1.02] hover:bg-gray-50 dark:hover:bg-gray-700/40";function Er({guias:s,abrirDetalle:t}){const[a,r]=n.useState(""),[l,c]=n.useState(""),[o,y]=n.useState("fecha"),[i,w]=n.useState("desc"),x=m=>{o===m?w(i==="asc"?"desc":"asc"):(y(m),w("asc"))},j=n.useMemo(()=>s.filter(m=>{const d=a?m.responsable.toLowerCase().includes(a.toLowerCase()):!0,h=l?m.estado.toLowerCase().includes(l.toLowerCase()):!0;return d&&h}).sort((m,d)=>{if(o==="fecha")return i==="asc"?new Date(m.fecha)-new Date(d.fecha):new Date(d.fecha)-new Date(m.fecha);{const h=(m[o]??"").toString().toLowerCase(),b=(d[o]??"").toString().toLowerCase();return h<b?i==="asc"?-1:1:h>b?i==="asc"?1:-1:0}}),[s,a,l,o,i]);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(xt,{size:18}),"Guías de Salida"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Total: ",s.length]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4 items-end",children:[e.jsx("input",{type:"text",placeholder:"Filtrar por responsable",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:a,onChange:m=>r(m.target.value)}),e.jsx("input",{type:"text",placeholder:"Filtrar por estado",className:"border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",value:l,onChange:m=>c(m.target.value)}),e.jsx("button",{onClick:()=>{r(""),c("")},className:"bg-gradient-to-r from-indigo-400 to-indigo-500 hover:from-indigo-500 hover:to-indigo-600 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition",children:"Limpiar filtros"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-100 text-left",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 cursor-pointer",onClick:()=>x("numero"),children:"N°"}),e.jsx("th",{className:"px-4 py-3 cursor-pointer",onClick:()=>x("fecha"),children:"Fecha"}),e.jsx("th",{className:"px-4 py-3",children:"Origen → Destino"}),e.jsx("th",{className:"px-4 py-3 cursor-pointer",onClick:()=>x("responsable"),children:"Responsable"}),e.jsx("th",{className:"px-4 py-3",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Detalle"})]})}),e.jsxs("tbody",{children:[j.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-10 text-center text-gray-500 dark:text-gray-400",children:"No hay guías registradas por ahora."})}),j.map(m=>e.jsxs(L.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:`border-t border-gray-100 dark:border-gray-700 ${Fr}`,children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:m.numero??"-"}),e.jsx("td",{className:"px-4 py-3",children:new Date(m.fecha).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3",children:[m.origen," → ",m.destino]}),e.jsx("td",{className:"px-4 py-3",children:m.responsable}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Ma[m.estado]||Ma.Otro}`,children:m.estado})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{onClick:()=>t(m),className:"bg-gradient-to-r from-indigo-400 to-indigo-500 hover:from-indigo-500 hover:to-indigo-600 text-white text-sm px-4 py-1.5 rounded-lg shadow-md transition flex items-center gap-2 justify-center transform hover:scale-[1.05]",children:[e.jsx(ne,{size:16}),"Ver detalle"]})})]},m.numero))]})]})})]})}const Ke={Pendiente:"#f59e0b",Enviada:"#3b82f6",Recibida:"#10b981"},Mr={Pendiente:ra,Enviada:cs,Recibida:oa},ma="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center",Ae="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center";function Rr(){const[s,t]=n.useState([]),[a,r]=n.useState(!1),[l,c]=n.useState(null),[o,y]=n.useState(!1),[i,w]=n.useState(null),[x,j]=n.useState(!1),[m,d]=n.useState(""),[h,b]=n.useState(""),[p,f]=n.useState(""),[g,v]=n.useState("");n.useEffect(()=>{S()},[]);const S=async()=>{r(!0),c(null);try{let _=[];wa&&(_=[{id:1,fecha:"2025-08-14T08:00:00",origen:"Almacén A",destino:"Sucursal 1",responsable:"Juan",estado:"Pendiente",items:[{cantidad:10,descripcion:"Formularios"}]},{id:2,fecha:"2025-08-14T09:30:00",origen:"Almacén B",destino:"Sucursal 2",responsable:"Maria",estado:"Enviada",items:[{cantidad:5,descripcion:"Cartuchos"}]},{id:3,fecha:"2025-08-14T10:15:00",origen:"Almacén A",destino:"Sucursal 3",responsable:"Carlos",estado:"Recibida",items:[{cantidad:3,descripcion:"Documentos"}]}]),t(_)}catch(_){console.error(_),c("Error cargando guías de salida.")}finally{r(!1)}},C=_=>{w(_),y(!0)},M=()=>{y(!1),w(null)},A=n.useMemo(()=>s.filter(_=>{var ve,Ce;const R=m?(ve=_.responsable)==null?void 0:ve.toLowerCase().includes(m.toLowerCase()):!0,O=h?(Ce=_.estado)==null?void 0:Ce.toLowerCase().includes(h.toLowerCase()):!0,ee=new Date(_.fecha),pe=p?ee>=new Date(p):!0,ye=g?ee<=new Date(g):!0;return R&&O&&pe&&ye}),[s,m,h,p,g]),N=A.length,k=A.reduce((_,R)=>(_[R.estado]=(_[R.estado]||0)+1,_),{}),G=Object.entries(k).map(([_,R])=>({name:_,value:R})),T=Object.entries(k).map(([_,R])=>({name:_,count:R}));return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(cs,{})," Guías de Salida"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 text-center",children:[e.jsxs("div",{className:`${Ae} flex flex-col items-center justify-center text-white p-4 rounded-xl`,style:{background:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)"},children:[e.jsx(De,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm",children:"Total Guías"}),e.jsx("p",{className:"text-2xl font-bold",children:e.jsx(Fe,{end:N,duration:1.2,separator:","})})]}),G.map(_=>{const R=Mr[_.name]||ge;return e.jsxs("div",{className:`${Ae} flex flex-col items-center justify-center text-white p-4 rounded-xl`,style:{background:`linear-gradient(135deg, ${Ke[_.name]||"#6b7280"}cc, ${Ke[_.name]||"#6b7280"}99)`},children:[e.jsx(R,{className:"w-6 h-6 mb-2 opacity-90"}),e.jsx("p",{className:"text-sm",children:_.name}),e.jsx("p",{className:"text-2xl font-bold",children:e.jsx(Fe,{end:_.value,duration:1.2,separator:","})})]},_.name)})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:`${ma} ${Ae}`,children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(ge,{size:18})," Distribución por Estado"]}),e.jsx($,{width:"100%",height:250,children:e.jsxs(xe,{children:[e.jsx(Oe,{data:G,dataKey:"value",nameKey:"name",outerRadius:80,label:!0,isAnimationActive:!0,children:G.map(_=>e.jsx(Z,{fill:Ke[_.name]||"#6b7280"},_.name))}),e.jsx(q,{}),e.jsx(oe,{})]})})]}),e.jsxs("div",{className:`${ma} ${Ae}`,children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Re,{size:18})," Cantidad por Estado"]}),e.jsx($,{width:"100%",height:250,children:e.jsxs(fe,{data:T,margin:{top:10,right:20,left:0,bottom:5},children:[e.jsx(Se,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name"}),e.jsx(ie,{}),e.jsx(q,{}),e.jsx(oe,{}),T.map(_=>e.jsx(Ee,{dataKey:"count",data:[_],fill:Ke[_.name]||"#6b7280"},_.name))]})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>j(!0),className:`${Ae} flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white px-5 py-2 rounded-xl shadow hover:from-indigo-600 hover:to-indigo-700 transition`,children:[e.jsx(Ka,{size:18})," Crear Guía"]})}),e.jsxs("div",{className:`${ma} ${Ae} flex flex-wrap gap-4 items-end`,children:[e.jsxs("div",{className:"flex flex-col flex-1 min-w-[180px]",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(ns,{size:16})," Responsable"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por responsable",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:m,onChange:_=>d(_.target.value)})]}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-[180px]",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(W,{size:16})," Estado"]}),e.jsx("input",{type:"text",placeholder:"Filtrar por estado",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:h,onChange:_=>b(_.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(we,{size:16})," Fecha Inicio"]}),e.jsx("input",{type:"date",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:p,onChange:_=>f(_.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-gray-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(we,{size:16})," Fecha Fin"]}),e.jsx("input",{type:"date",className:"border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400",value:g,onChange:_=>v(_.target.value)})]}),e.jsxs("button",{onClick:()=>{d(""),b(""),f(""),v("")},className:"flex items-center gap-2 bg-gradient-to-r from-gray-400 to-gray-500 text-white px-4 py-2 rounded-lg shadow hover:from-gray-500 hover:to-gray-600 transition",children:[e.jsx(ba,{size:16})," Limpiar"]})]}),l&&e.jsx("div",{className:"p-3 bg-red-100 text-red-700 rounded",children:l}),a?e.jsx("p",{children:"Cargando guías..."}):e.jsx(Er,{guias:A,abrirDetalle:C}),e.jsx(Dr,{guia:i,isOpen:o,onClose:M}),e.jsx(Ar,{isOpen:x,onClose:()=>j(!1),onSave:_=>t(R=>[_,...R])})]})}function Or({filtros:s={},setFiltros:t,data:a=[]}){const[r,l]=n.useState({fechaInicio:s.fechaInicio||"",fechaFin:s.fechaFin||"",categoria:s.categoria||"",responsable:s.responsable||""}),[c,o]=n.useState([]);n.useEffect(()=>{const i=[...new Set(a.map(w=>w.responsable))];o(i)},[a]);const y=()=>{t(r)};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-md mb-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4 items-end",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(we,{className:"mr-2",size:16})," Fecha Inicio"]}),e.jsx("input",{type:"date",value:r.fechaInicio,onChange:i=>l({...r,fechaInicio:i.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(we,{className:"mr-2",size:16})," Fecha Fin"]}),e.jsx("input",{type:"date",value:r.fechaFin,onChange:i=>l({...r,fechaFin:i.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(ut,{className:"mr-2",size:16})," Categoría"]}),e.jsxs("select",{value:r.categoria,onChange:i=>l({...r,categoria:i.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"Transporte",children:"Transporte"}),e.jsx("option",{value:"Alimentación",children:"Alimentación"}),e.jsx("option",{value:"Oficina",children:"Oficina"}),e.jsx("option",{value:"Hospedaje",children:"Hospedaje"}),e.jsx("option",{value:"Otros",children:"Otros"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"flex items-center text-sm font-medium mb-1 text-gray-700 dark:text-gray-200",children:[e.jsx(ja,{className:"mr-2",size:16})," Responsable"]}),e.jsxs("select",{value:r.responsable,onChange:i=>l({...r,responsable:i.target.value}),className:"w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition",children:[e.jsx("option",{value:"",children:"Todos"}),c.map((i,w)=>e.jsx("option",{value:i,children:i},w))]})]}),e.jsx("div",{className:"flex items-center justify-start",children:e.jsxs("button",{onClick:y,className:"flex items-center gap-2 bg-gradient-to-r from-gray-400 to-gray-500 text-white px-4 py-2 rounded-lg shadow hover:from-gray-500 hover:to-gray-600 transition",children:[e.jsx(ba,{size:16})," Filtrar"]})})]})}const Ra=["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ef4444"];function Pr({data:s}){const t=s.length>5?10:12;return e.jsxs(L.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(ge,{size:18})," Gastos por Categoría"]}),e.jsx($,{width:"100%",height:"85%",children:e.jsxs(xe,{children:[e.jsx(Oe,{data:s,dataKey:"monto",nameKey:"categoria",cx:"50%",cy:"50%",outerRadius:100,label:{fontSize:t},children:s.map((a,r)=>e.jsx(Z,{fill:Ra[r%Ra.length]},r))}),e.jsx(q,{formatter:a=>`S/ ${a}`}),e.jsx(oe,{})]})})]})}function Tr({data:s}){const t=s.length>8?-30:0,a=s.length>12?10:12,r=s.length>12?Math.max(8,60-s.length*2):50;return e.jsxs(L.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(Re,{size:18})," Comparativa Mensual"]}),e.jsx($,{width:"100%",height:"90%",children:e.jsxs(fe,{data:s,margin:{top:10,right:20,left:0,bottom:10},children:[e.jsx(le,{dataKey:"mes",stroke:"#374151",tick:{fontSize:a,fontWeight:"bold",angle:t,textAnchor:t!==0?"end":"middle"}}),e.jsx(ie,{stroke:"#374151",tick:{fontWeight:"bold"}}),e.jsx(q,{formatter:l=>`S/ ${l.toLocaleString()}`}),e.jsx(oe,{}),e.jsx(Ee,{dataKey:"gastos",fill:"#3b82f6",barSize:r})]})})]})}function zr({data:s}){return e.jsxs(L.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(ta,{size:18})," Tendencia de Gastos"]}),e.jsx($,{width:"100%",height:"90%",children:e.jsxs(ls,{data:s,children:[e.jsx(le,{dataKey:"mes",stroke:"#374151",tick:{fontWeight:"bold"}}),e.jsx(ie,{stroke:"#374151",tick:{fontWeight:"bold"}}),e.jsx(q,{formatter:t=>`S/ ${t.toLocaleString()}`}),e.jsx(oe,{}),e.jsx(is,{type:"monotone",dataKey:"gastos",stroke:"#10b981",strokeWidth:2})]})})]})}ds.register(ht,ms,xs);function Lr({data:s}){const t={labels:s.map(r=>r.categoria),datasets:[{label:"Gastos por Categoría",data:s.map(r=>r.monto),backgroundColor:["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ef4444"],borderColor:"#ffffff",borderWidth:2}]},a={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:"#374151"}},tooltip:{callbacks:{label:r=>`S/ ${r.raw}`}}},animation:{animateScale:!0,animateRotate:!0}};return e.jsxs(L.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(ge,{size:18})," Top Categorías de Gasto"]}),e.jsx("div",{className:"w-full h-[90%]",children:e.jsx(pt,{data:t,options:a})})]})}ds.register(gt,ft,bt,jt,ms,xs);function $r({data:s}){const t={labels:s.map(r=>r.responsable),datasets:[{label:"Gasto por Responsable",data:s.map(r=>r.monto),backgroundColor:"#3b82f6",borderColor:"#3b82f6",borderWidth:1,hoverBackgroundColor:"#2563eb",hoverBorderColor:"#2563eb"}]},a={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{color:"#374151",font:{weight:"bold"}}},tooltip:{callbacks:{label:r=>`S/ ${r.raw.toLocaleString()}`}}},scales:{x:{ticks:{color:"#374151",font:{weight:"bold"}},grid:{display:!1}},y:{beginAtZero:!0,ticks:{color:"#374151",font:{weight:"bold"}},grid:{color:"rgba(229,231,235,0.5)"}}},animation:{duration:1e3,easing:"easeOutQuart"}};return e.jsxs(L.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-4 transition h-[350px]",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-800 dark:text-gray-200",children:[e.jsx(Re,{size:18})," Gasto por Responsable"]}),e.jsx("div",{className:"w-full h-[90%]",children:e.jsx(yt,{data:t,options:a})})]})}const Oa={categorias:{Transporte:"bg-blue-200 text-blue-800 dark:bg-blue-700/40 dark:text-blue-200",Alimentación:"bg-green-200 text-green-800 dark:bg-green-700/40 dark:text-green-200",Oficina:"bg-indigo-200 text-indigo-800 dark:bg-indigo-700/40 dark:text-indigo-200",Hospedaje:"bg-purple-200 text-purple-800 dark:bg-purple-700/40 dark:text-purple-200",Otros:"bg-gray-200 text-gray-800 dark:bg-gray-700/40 dark:text-gray-200"}};function Ir({data:s=[],abrirModal:t}){return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-md p-6 overflow-x-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx(W,{size:18}),"Detalle de Reportes"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Total: ",s.length]})]}),e.jsxs("table",{className:"min-w-full table-auto rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-100 text-center",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"#"}),e.jsx("th",{className:"px-4 py-3",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3",children:"Categoría"}),e.jsx("th",{className:"px-4 py-3 hidden sm:table-cell",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3",children:"Monto"})]})}),e.jsxs("tbody",{children:[s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-10 text-center text-gray-500 dark:text-gray-400",children:"No hay registros disponibles."})}),s.map((a,r)=>{var l;return e.jsxs(L.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"border-t border-gray-100 dark:border-gray-700 hover:shadow-lg hover:translate-y-[-2px] hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-transform duration-200",children:[e.jsx("td",{className:"px-4 py-3 font-semibold",children:r+1}),e.jsx("td",{className:"px-4 py-3",children:a.fecha??"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${Oa.categorias[a.categoria]??Oa.categorias.Otros}`,children:a.categoria??"-"})}),e.jsx("td",{className:"px-4 py-3 hidden sm:table-cell",children:a.descripcion??"-"}),e.jsxs("td",{className:"px-4 py-3 font-semibold",children:["S/ ",((l=a.monto)==null?void 0:l.toFixed(2))??"0.00"]})]},a.id??r)})]})]})]})}function qr(){const s=()=>window.open("/api/reportes/exportar_excel/","_blank"),t=()=>window.open("/api/reportes/exportar_pdf/","_blank");return e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsxs("button",{onClick:s,className:"px-4 py-2 bg-gradient-to-r from-green-400 to-green-500 hover:from-green-500 hover:to-green-600 text-white rounded-lg flex items-center gap-2 shadow-md transition transform hover:scale-[1.05]",children:[e.jsx(_a,{size:18})," Exportar Excel"]}),e.jsxs("button",{onClick:t,className:"px-4 py-2 bg-gradient-to-r from-red-400 to-red-500 hover:from-red-500 hover:to-red-600 text-white rounded-lg flex items-center gap-2 shadow-md transition transform hover:scale-[1.05]",children:[e.jsx(_a,{size:18})," Exportar PDF"]})]})}function Gr(){const[s,t]=n.useState({fechaInicio:"",fechaFin:"",categoria:"todas",rango:"mensual"}),[a,r]=n.useState({gastosPorCategoria:[],comparativoMensual:[],tendencias:[],tabla:[]}),l=async()=>{try{wa&&r({gastosPorCategoria:[{categoria:"Transporte",monto:1200},{categoria:"Alimentación",monto:2e3},{categoria:"Oficina",monto:800}],comparativoMensual:[{mes:"Enero",gastos:1200},{mes:"Febrero",gastos:1600},{mes:"Marzo",gastos:1400}],tendencias:[{mes:"Enero",gastos:200},{mes:"Febrero",gastos:350},{mes:"Marzo",gastos:400}],tabla:[{id:1,fecha:"2025-01-10",categoria:"Transporte",descripcion:"Taxi",monto:300,responsable:"Juan"},{id:2,fecha:"2025-02-12",categoria:"Alimentación",descripcion:"Comida",monto:500,responsable:"Ana"},{id:3,fecha:"2025-03-15",categoria:"Oficina",descripcion:"Papelería",monto:800,responsable:"Luis"}]})}catch(h){console.error("Error cargando datos de reportes:",h)}};n.useEffect(()=>{l()},[s]);const c=a.tabla.reduce((h,b)=>h+b.monto,0),o=a.tabla.length?(c/3).toFixed(2):0,y=a.tabla.length?Math.max(...a.tabla.map(h=>h.monto)):0,i=a.tabla.length,w=new Set(a.tabla.map(h=>h.responsable)).size,x=1500,j=c-x,m=(j/x*100).toFixed(1),d="rounded-xl p-4 shadow-md transform transition-transform hover:scale-[1.02] text-center";return e.jsxs("div",{className:"p-4 md:p-6 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Re,{size:25,className:"text-gray-800"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:"Estadísticas y Reportes"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 md:gap-6 mb-6",children:[{label:"Total Gastos",value:c,icon:ae,gradient:"linear-gradient(135deg, #10b981cc, #34d39999)",tooltip:"Suma total de todos los gastos registrados"},{label:"Promedio Mensual",value:o,icon:ta,gradient:"linear-gradient(135deg, #3b82f6cc, #60a5fa99)",tooltip:"Gasto promedio mensual"},{label:"Mayor Gasto",value:y,icon:ge,gradient:"linear-gradient(135deg, #8b5cf6cc, #a78bfa99)",tooltip:"Registro de gasto individual más alto"},{label:"Transacciones",value:i,icon:W,gradient:"linear-gradient(135deg, #ef4444cc, #f8717199)",tooltip:"Número total de transacciones"},{label:"Responsables",value:w,icon:ja,gradient:"linear-gradient(135deg, #facc15cc, #fcd34d99)",tooltip:"Cantidad de personas responsables"},{label:"Crecimiento Mensual",value:j,icon:j>=0?vt:Nt,gradient:"linear-gradient(135deg, #f97316cc, #fb923c99)",tooltip:`Cambio respecto al mes anterior: ${m}%`,positive:j>=0}].map(h=>{const b=h.icon,p=h.positive??!0;return e.jsxs("div",{className:d,style:{background:h.gradient},children:[e.jsx(b,{size:28,className:"text-white mb-2"}),e.jsxs("p",{className:"text-sm text-white opacity-90 flex items-center justify-center gap-1",children:[h.label,e.jsx(Ha,{content:h.tooltip,children:e.jsx(Ye,{size:16,className:"text-white opacity-70"})})]}),e.jsx("p",{className:`text-2xl font-bold text-white ${h.label==="Crecimiento Mensual"?p?"text-green-400":"text-red-400":""}`,children:e.jsx(Fe,{end:h.value,duration:1.5,separator:",",decimals:2,decimal:"."})})]},h.label)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6",children:[e.jsx("div",{className:d,children:e.jsx(Pr,{data:a.gastosPorCategoria})}),e.jsx("div",{className:d,children:e.jsx(Tr,{data:a.comparativoMensual})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6",children:[e.jsx("div",{className:d,children:e.jsx(Lr,{data:a.gastosPorCategoria})}),e.jsx("div",{className:d,children:e.jsx($r,{data:a.tabla})})]}),e.jsx("div",{className:`${d} mb-6`,children:e.jsx(zr,{data:a.tendencias})}),e.jsx("div",{className:`${d} mb-6 bg-gray-100 dark:bg-gray-700/50`,children:e.jsx(Or,{filtros:s,setFiltros:t,data:a.tabla})}),e.jsx("div",{className:`${d} mb-6`,children:e.jsx(Ir,{data:a.tabla})}),e.jsx("div",{className:`${d} mb-6`,children:e.jsx(qr,{})})]})}function Br(){return e.jsx(wt,{children:e.jsxs(hs,{children:[e.jsx(St,{position:"top-right",autoClose:3e3}),e.jsxs(Ct,{children:[e.jsx(z,{path:"/login",element:e.jsx(At,{})}),e.jsx(z,{path:"/register",element:e.jsx(Mt,{})}),e.jsxs(z,{path:"/dashboard/*",element:e.jsx(_t,{children:e.jsx(Tt,{})}),children:[e.jsx(z,{index:!0,element:e.jsx(Xt,{})}),e.jsx(z,{path:"gastos/programacion",element:e.jsx(or,{})}),e.jsx(z,{path:"liquidaciones",element:e.jsx(Da,{})}),e.jsx(z,{path:"liquidaciones/solicitud",element:e.jsx(cr,{})}),e.jsx(z,{path:"liquidaciones/solicitud/nueva",element:e.jsx(ys,{})}),e.jsx(z,{path:"liquidaciones/solicitud/mis-solicitudes",element:e.jsx(ws,{})}),e.jsx(z,{path:"solicitudes/:nro_solicitud",element:e.jsx(Ns,{})}),e.jsx(z,{path:"atencion-solicitudes",element:e.jsx(mr,{})}),e.jsx(z,{path:"liquidaciones/presentar",element:e.jsx(pr,{})}),e.jsx(z,{path:"liquidaciones/presentar/:id",element:e.jsx(Cs,{})}),e.jsx(z,{path:"liquidaciones/solicitud/:id/documento",element:e.jsx(Ss,{})}),e.jsx(z,{path:"gastos/aprobacion-liquidacion",element:e.jsx(yr,{})}),e.jsx(z,{path:"movimientos/arqueo",element:e.jsx(Da,{})}),e.jsx(z,{path:"registros/actividades",element:e.jsx(_r,{})}),e.jsx(z,{path:"registros/guias-salida",element:e.jsx(Rr,{})}),e.jsx(z,{path:"reportes",element:e.jsx(Gr,{})})]}),e.jsx(z,{path:"/",element:e.jsx(xa,{to:"/dashboard",replace:!0})}),e.jsx(z,{path:"*",element:e.jsx(xa,{to:"/dashboard",replace:!0})})]})]})})}kt.createRoot(document.getElementById("root")).render(e.jsx(ha.StrictMode,{children:e.jsx(hs,{children:e.jsx(Br,{})})}));
